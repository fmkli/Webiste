!function(a){function b(a){var b=this;b.uri=a.uri,b.name=a.uri.name,b.address=a.uri.address,b.key=b.address.toLowerCase(),b.valid=a.valid,t.superClass.initialize.call(b,a)}function c(){try{}catch(b){return b}var c=this,d=c.id,e=c.getsub(c.name),f=c.getsub(c.address),g=c.name?'<strong class="nui-addr-name" unselectable="on">'+e+"</strong>":"",h=c.name?"&lt;"+f+"&gt;":f,i=c.valid?a.String.escapeHTML(c.address):o.t("该地址格式有误，请双击修改");if(-1!=i.indexOf('"')){if(-1!=i.indexOf('\\"')){var j=i.replace(/\\"/g,"§");j=j.replace(/"/g,""),i=j.replace(/§/g,'\\"')}i=i.replace(/"/g,"")}-1!=i.indexOf('"')&&(i="");var k="nui-editableAddr nui-addr nui-addr-hasAdd",l="";if(c.valid){var n=m.getAddrObj(c.address);n?(c[s]=n[s],l='<a href="javascript:void(0)" class="nui-addr-add" hidefocus="hidefocus"><b class="nui-ico nui-ico-edit"></b></a>'):l='<a href="javascript:void(0)" class="nui-addr-add" hidefocus="hidefocus">+</a>'}else k+=" nui-editableAddr-err",l='<a href="javascript:void(0)" class="nui-addr-add" hidefocus="hidefocus">x</a>';var p='<div id="'+d+'" class="js-component-emailblock '+k+'" title="'+i+'"  unselectable="on">'+g+'<em class="nui-addr-email" unselectable="on">'+h+"</em>"+l+"</div>";return p}function d(){return this.uri}function e(a){var b=this,c=b.ownerCt,d=b.getEl();return a?(c.selectItem(b),void 0):(d.addClass("nui-addr-active"),d.addClass("nui-editableAddr-active"),b.selected=!0,c.lastSelectItem=b,void 0)}function f(a){var b=this,c=b.ownerCt,d=b.getEl();return a?(c.unselectItem(b),void 0):(d.removeClass("nui-addr-active"),d.removeClass("nui-editableAddr-active"),this.selected=!1,void 0)}function g(b){var c=30,d=26;if(!b)return"";if(b.length<=c)return a.String.escapeHTML(b);if(-1!=b.indexOf("@")){var e=b.split("@"),f=e[0],g=e[1];return f.length>c&&(f=f.substr(0,d)+".."),g.length>50&&(g=g.substr(0,46)+".."),a.String.escapeHTML(f+"@"+g)}return a.String.escapeHTML(b.substr(0,d)+"..")}function h(a){var b=this;b.warn=!0;var c=this.getEl();if(1==a){var d=b.address.split("@"),e=d[0]+'<span class="nui-txt-err">@'+d[1]+"</span>";b.name&&(e="&lt;"+e+"&gt;");var f=c.dom,g=f.getElementsByTagName("EM")[0];g.innerHTML=e,c.attr({title:o.t("该地址的域名可能不存在，请双击修改")})}else 0==a&&(c.addClass("nui-editableAddr-err"),c.attr({title:o.t("您输入的地址可能有误，请双击修改")}))}function i(b){var c=this,d=this.getEl(),e=c.ownerCt;e.itemMap[c.key]=null,c.warn=!1,c.address=b.address||c.address,oUri=new r(c.address,c.name),oUri.valid=!0,c.uri=oUri,c.key=c.address.toLowerCase();var f=c.getsub(c.address),g=c.name?"&lt;"+f+"&gt;":f,h=a.String.escapeHTML(c.address),i=d.dom,j=i.getElementsByTagName("EM")[0];j.innerHTML=g,d.attr({title:h}),d.removeClass("nui-editableAddr-err")}function j(b){var c=this,d=c.getEl();c.name=b.name,c.address=b.address;var e=new r(c.address,c.name);e.valid=!0,c.uri=e;var f=d.dom,g=f.getElementsByTagName("STRONG")[0];if(g)g.innerHTML=c.getsub(c.name);else{g=document.createElement("STRONG"),g.className="nui-addr-name",g.unselectable="on",g.innerHTML=c.getsub(c.name);var h=f.getElementsByTagName("EM")[0];a(h).before(g)}if(!c[s]){c[s]=b.id;var i=f.getElementsByTagName("A")[0];i.innerHTML='<b class="nui-ico nui-ico-edit"></b>'}var j="<"+c.getsub(c.address)+">",h=f.getElementsByTagName("EM")[0];h.innerHTML=c.getsub(j)}function k(a){var b=this;if(b.valid!=a){b.valid=a;var c,d=b.getEl();if(a){var e=m.getAddrObj(b.address);e?(b[s]=e[s],c='<b class="nui-ico nui-ico-edit"></b>'):c="+",d.removeClass("nui-editableAddr-err")}else d.addClass("nui-editableAddr-err"),c="x";var f=d.dom;f.getElementsByTagName("A")[0].innerHTML=c}}function l(){var a=this,b=a.ownerCt;b.emailinput.move("itemNext",a.getEl()),b.emailinput.set(a.uri),b.removeItem({item:a});var c=0;c=a.name?a.name.length+3:a.address.length,b.emailinput.setPos(c)}try{var m=$L("support.AddressSupport")}catch(n){return n}var o=new $I18N("component.emailinput.EmailBlock"),p=a.Component,q=a.Object,r=a.Email,s=a.EMAIL_ID,t=a.createClass($N("component.emailinput.EmailBlock"));q.mix(t,p,{_listeners:[{name:"init",handler:function(){},custom:!0},{name:"keydown",handler:function(){}},{name:"mouseover",handler:function(){var a=p.getItem(this),b=a.getEl(),c=a.valid?"nui-addr-hover nui-editableAddr-hover":"nui-editableAddr-errHover";b.addClass(c)}},{name:"mouseout",handler:function(){var a=p.getItem(this),b=a.getEl(),c=a.valid?"nui-addr-hover nui-editableAddr-hover":"nui-editableAddr-errHover";b.removeClass(c)}},{name:"mousedown",handler:function(){var b=p.getItem(this),c=a.Event.getTarget();if("A"==c.tagName||"A"==c.parentNode.tagName);else{var d=a.Event.get();d.ctrlKey||d.metaKey?b.selected?b.unselect(!0):b.select(!0):b.selected||(b.ownerCt.resetSelectItem(),b.select(!0))}}},{name:"click",handler:function(){var b=p.getItem(this),c=a.Event.get();try{}catch(d){return d}var e=a.Event.getTarget();if("A"==e.tagName||"A"==e.parentNode.tagName)if(b.valid)b[s]?m.contactDialog({type:"modify",addr:{id:b[s]},callback:function(a){b.refreshAddr(a)}}):m.contactDialog({type:"add",addr:{name:b.name,email:b.address},callback:function(a){b.refreshAddr(a)}});else{var f=b.ownerCt;f.removeItem({item:b}),a.Event.cancel()}else{var c=a.Event.get();c.ctrlKey||c.metaKey?b.ownerCt.selectData({allSelect:!0}):(3!=c.which&&b.selected&&(b.ownerCt.resetSelectItem(),b.select(!0)),b.ownerCt.selectData({value:b.getValue().toString()})),b.ownerCt.fire("containerfocus"),b.ownerCt.drag._start=!1}}},{name:"dblclick",handler:function(){var a=p.getItem(this);a.toEdit()}},{name:"render",handler:function(){var a=this;a.getEl().set("key",this.address)},custom:!0}],xtype:"emailblock"},{name:null,address:null,key:null,index:-1,selected:!1,valid:!0,initialize:b,html:c,getValue:d,select:e,unselect:f,getsub:g,setWarn:h,fixWarn:i,refreshAddr:j,setValid:k,toEdit:l})}($,window),function(a){function b(a){i.superClass.initialize.call(this,a)}function c(){var a={};return a}function d(b){a.String.trim(b)&&(this.input.dom.value=b,this.input.dom.select())}function e(){var b=this,c=b.ownerCt,d=c.emailinput,e=a.Event.get(),f=e.which;switch(f){case 8:case 46:c.lastSelectItem&&d.move("itemNext",c.lastSelectItem.getEl()),c.delSelectItem(),c.select();break;case 35:e.shiftKey?c.selectPos("inputRight"):(c.resetSelectItem(),d.move("last"));break;case 36:e.shiftKey?c.selectPos("inputLeft"):(c.resetSelectItem(),d.move("first"));break;case 37:case 38:e.shiftKey?c.selectPos("shiftLeft"):(c.resetSelectItem(),c.lastSelectItem&&d.move("itemPre",c.lastSelectItem.getEl()));break;case 39:case 40:e.shiftKey?c.selectPos("shiftRight"):(c.resetSelectItem(),c.lastSelectItem&&d.move("itemNext",c.lastSelectItem.getEl()));break;case 65:e.ctrlKey||e.metaKey?c.selectAllItem():a.Event.cancel();break;case 67:e.ctrlKey||e.metaKey||a.Event.cancel();break;case 86:e.ctrlKey||e.metaKey?a.Event.cancel():a.Event.cancel();break;case 88:e.ctrlKey||e.metaKey?c.delSelectItem():a.Event.cancel();break;default:a.Event.cancel()}}function f(){var b=this,c=b.ownerCt;c.emailinput;var d=a.Event.get(),e=d.which;switch(e){case 88:c.focus()}}var g=a.Component,h=a.Object,i=a.createClass($N("component.emailinput.EmailHide"));h.mix(i,g,{_template:'<div class="nui-fGetout"><input tabindex="-1" role="presentation" type="text" /></div>',_listeners:[{name:"render",handler:function(){var b=this;b.input=b.getEl().find("INPUT");for(var c=[{name:"keydown",handler:function(){b.keydownAction()}},{name:"keyup",handler:function(){b.keyupAction()}},{name:"focus",handler:function(){}},{name:"blur",handler:function(){}}],d=c.length-1;d>=0;d--){var e=c[d];a.Event.listen(b.input,e.name,e.handler)}},custom:!0}],xtype:"emailhide"},{initialize:b,_getData:c,selectData:d,keydownAction:e,keyupAction:f})}($,window),function(a,b){function c(a){y.superClass.initialize.call(this,a)}function d(a){var b={tabIndex:a.tabIndex>=0?"tabIndex='"+a.tabIndex+"'":"",inputLable:a.inputLable?"aria-label='"+a.inputLable+"'":""};return b}function e(){return this.input.dom.value}function f(a){this.input.dom.value=a,this.syncWidth()}function g(){this.input.dom.value=""}function h(a){var c=this.input.dom;if(a)b.setTimeout(function(){try{c.focus()}catch(a){}},0);else try{c.focus()}catch(d){}}function i(){var a=this.input.dom;a.select()}function j(){var a=this.input.dom;a.blur()}function k(b){var c=this,d=c.ownerCt;d.clearTips();var e=c.get(),f=c.getPos(),g=a.Event.get(),h=g.which;switch(h){case 8:if(0==f.start){var i=c.getEl(),j=i.pre();d.removeItem({el:j})}break;case 16:break;case 27:break;case 46:if(e.length==f.start){var i=c.getEl(),k=i.next();d.removeItem({el:k})}break;case 35:g.shiftKey?""==x.trim(e)&&d.selectPos("inputRight"):e.length>0?f.end==e.length&&(d.addItem(e),c.clear(),c.move("last")):""==x.trim(e)&&c.move("last");break;case 36:g.shiftKey?""==x.trim(e)&&(d.selectPos("inputLeft"),a.Event.cancel()):e.length>0?0==f.start&&(d.addItem(e),c.clear(),c.move("first")):0==e.length&&c.move("first");break;case 37:g.shiftKey?""==x.trim(e)&&d.selectPos("shiftLeft"):e.length>0?0==f.start&&(d.addItem(e,"after"),c.clear()):""==x.trim(e)&&c.move("pre");break;case 38:a.Event.cancel(b);break;case 39:g.shiftKey?""==x.trim(e)&&d.selectPos("shiftRight"):e.length>0?f.end==e.length&&(d.addItem(e),c.clear()):""==x.trim(e)&&c.move("next");break;case 40:a.Event.cancel(b);break;case 65:(g.ctrlKey||g.metaKey)&&""==x.trim(e)?(d.selectAllItem(),a.Event.cancelBubble()):c.syncWidth();break;case 32:case 59:case 186:case 188:32!=h&&g.shiftKey||(-1==e.indexOf("@")?c.isMobile(e)&&(d.addItem(e),c.clear(),a.Event.cancel()):(d.addItem(e),c.clear(),a.Event.cancel())),c.syncWidth();break;case 86:if(g.ctrlKey||g.metaKey){var e=c.get();e||(c.keydownPaste=!0)}break;default:c.syncWidth()}this.autoComplete()}function l(){var c=this;c.ownerCt;var d=c.get(),e=a.Event.get(),f=e.which;switch(f){case 13:-1==d.indexOf("@")&&c.isMobile(d)&&(c.ownerCt.addItem(d),c.clear());break;case 17:case 91:case 86:if(c.keydownPaste){if(a.Browser.isIE()){var g=b.clipboardData.getData("Text").replace(/(\r\n|\n|\r)/gm," ");c.input.dom.value=g}c.paste()}c.syncWidth();break;case 9:case 35:case 36:case 37:case 38:case 39:case 40:break;case 59:case 186:case 188:break;default:c.syncWidth()}c.keydownPaste=!1}function m(){var b=this,c=x.trim(b.get());if(c){var d=a.Uri.getEmails(c,null,!0);d&&d.match&&d.match.length&&(c=c.replace(/[ \t]+ ?(?![^"]+"\s*<)/g,","),b.ownerCt.addItem(c),b.input.dom.value="")}}function n(){var a=this,b=a.get();b=b.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /gi,"&nbsp;"),a.widthSpan.dom.innerHTML=b+"WW"}function o(a){if(!this.ownerCt.domain)return!1;a=a||this.get();var b=/^1\d{10}$/gi;return b.test(a)?!0:!1}function p(a,b,c){var d=this,e=d.ownerCt,f=e.getEl(),g=d.getEl(),h=g.dom;switch(x.trim(d.get())&&(e.addItem(d.get()),d.clear(),d.widthSpan.dom.innerHTML="W"),a){case"first":f.prepend(h);break;case"last":f.append(h);break;case"pre":var i=g.pre();i&&i.dom&&i.before(h);break;case"next":var j=g.next();j&&j.dom&&j.after(h);break;case"itemPre":b&&b.before(h);break;case"itemNext":b&&b.after(h)}c?d.focus(c):d.select()}function q(){function a(a){o.addItem(a),n.clear()}function b(a,b){if(""!=a){var c;try{var c=b.name,d=b.email,e=c.toLowerCase(),f=d.toLowerCase()}catch(g){return}a=x.trim(a).toLowerCase();var h=d;if(c&&(h='"'+c+'"<'+d+">"),""==a)return h;if(1==a.length){if(0==f.indexOf(a)||0==e.indexOf(a)||b.fpy&&0===b.fpy.indexOf(a))return h}else if(f.indexOf(a)>-1||e.indexOf(a)>-1||b.py&&b.py.indexOf(a)>-1||b.fpy&&b.fpy.indexOf(a)>-1)return h}}function c(a){o.addItem(h[a].CONTACTS),n.clear()}function d(a,b){a=x.trim(a).toLowerCase();var c=b.N.toLowerCase();return""==a?null:c.indexOf(a)>-1?!0:void 0}try{var e=$L("support.AddressSupport",this)}catch(f){return f}try{if(!e.dataInited)return;if(this.autoCompltedInited)return;this.autoCompltedInited=!0;for(var g=e.data.extDataMap.groupArray||[],h=[],i=0,j=g.length;j>i;i++){var k=g[i];if(k.N&&k.CONTACTS&&k.CONTACTS.length){var l=h.length;k.index=l,h[l]=k}}}catch(m){}var n=this,o=n.ownerCt,p=n.input;new t({product:"emailinput",input:p,fill:a,match:b,groupData:h,groupFill:c,groupMatch:d})}function r(a){var b=this.input.dom;if(b.setSelectionRange)b.focus(),b.setSelectionRange(a,a);else if(b.createTextRange){var c=b.createTextRange();c.collapse(!0),c.moveEnd("character",a),c.moveStart("character",a),c.select()}}function s(){var a=this.input.dom,c=0,d=0,e=b.document;if(e.selection){var f=e.selection.createRange();f.setEndPoint("EndToStart",a.createTextRange()),c=(f.text||"").length,f=e.selection.createRange(),f.setEndPoint("StartToStart",a.createTextRange()),d=(f.text||"").length}else c=a.selectionStart,d=a.selectionEnd;return{start:c,end:d}}try{var t=$L("util.AutoComplete")}catch(u){return u}var v=a.Component,w=a.Object,x=a.String,y=a.createClass($N("component.emailinput.EmailInput"));w.mix(y,v,{_template:'<div class="nui-addr nui-editableAddr nui-editableAddr-edit"><input class="nui-editableAddr-ipt" type="text" role="combobox" #{tabIndex} #{inputLable} /><span class="nui-editableAddr-txt">W</span></div>',_listeners:[{name:"render",handler:function(){var b=this,c=this.getEl();b.input=c.find("INPUT"),b.widthSpan=c.find("SPAN");for(var d=[{name:"keydown",handler:function(a){b.keydownAction(a)}},{name:"keyup",handler:function(){b.keyupAction()}},{name:"focus",handler:function(){b.ownerCt.fire("containerfocus")}},{name:"blur",handler:function(){b.ownerCt.addItem(b.get()),b.input.dom.value="",b.widthSpan.dom.innerHTML="W",b.ownerCt.fire("containerblur")}}],e=d.length-1;e>=0;e--){var f=d[e];a.Event.listen(b.input,f.name,f.handler)}},custom:!0}],xtype:"emailinput"},{index:-1,initialize:c,_getData:d,get:e,set:f,clear:g,focus:h,select:i,blur:j,keydownAction:k,keyupAction:l,paste:m,syncWidth:n,isMobile:o,move:p,autoComplete:q,setPos:r,getPos:s})}($,window),function(a){function b(a){var b={text:a.text};return b}var c=a.Component,d=a.Object,e=a.createClass($N("component.emailinput.EmailTips"));d.mix(e,c,{_template:'<label class="nui-ipt-placeholder">#{text}</label>',_listeners:[],xtype:"emailtips"},{_getData:b})}($,window),function(a,b){function c(a){var b=[];if(eb.isArray(a))for(var c=0;c<a.length;c++){var d=gb.getEmail(a[c]);d&&b.push(d)}else"object"==typeof a?b.push(gb.getEmail(a)):b=b.concat(gb.matchEmails(a));return b}function d(b,c){b=fb.trim(b).replace(/[，；;]+/g,",");var d=[],e=db.getEmails(b,"Email");return e.match.length>0&&a.Array.each(e.match,function(a,b){b.valid=!0,d.push(b)}),c||e.wrong.length>0&&a.Array.each(e.wrong,function(a,b){var c=new bb(b);c.valid=!1,d.push(c)}),d}function e(b){var c=null;if("string"==typeof b&&fb.trim(b))c=new db(b,db.type.EMAIL),c.type==db.type.EMAIL?c.valid=!0:(c=new bb(b),c.valid=!1);else if("object"==typeof b)if(b.type==db.type.EMAIL)c=b,c.valid=!0;else if(b[cb])c=new bb(b[cb],b.FN),c.valid=!0;else if(b[a.EMAIL_ID]){var d=b[a.EMAIL_ID],e=Z.data.extDataMap.contactLite[d];if(e&&e.email&&e.email.length){var f=e.email;f.length>=1&&(c=new bb(f[0],e.name),c.valid=!0)}}return c}function f(a){var b=this;b.domain=a.domain,b.itemList=[],b.itemMap={},b.selectItemList=[],b.selectItemMap={},b.tipsItemList=[],b.key=a.key,gb.superClass.initialize.call(b,a),a.containerfocus&&b.listen("containerfocus",a.containerfocus),a.containerblur&&b.listen("containerblur",a.containerblur),a.containerresize&&b.listen("containerresize",a.containerresize),a.containerupdate&&b.listen("containerupdate",a.containerupdate),a.itemwarnremove&&b.listen("itemwarnremove",a.itemwarnremove)}function g(a){var b={cls_type:"",defaultValue:a.defaultValue?a.defaultValue:"",title:a.title?'title="'+a.title+'"':""};!a.tips||a.tips.pos&&"left"!=a.tips.pos||(a.items=[{xtype:"emailtips",type:"tips",text:a.tips.text}]);var c={xtype:"emailinput",tabIndex:a.tabIndex,inputLable:a.inputLable};return b.input=this._getChildHtml(c),b}function h(b){var c=this,d=c.itemList,e=[],f=[],g=[],h=null;if("object"==b&&c.build(!0),"empty"!=b&&"suc"!=b)for(var i=d.length,j=0;i>j;j++){var k=c.itemList[j],l=k.getValue();k.valid?e.push(l):f.push(l),g.push(l)}if("suc"==b){var m=c.getEl();if(m)for(var n=m.find("DIV"),o=n.doms,j=0,i=o.length;i>j;j++){var p=o[j],k=a.Component.getItem(p);if("emailblock"==k.xtype&&k.valid){var l=k.getValue();e.push(l)}}}switch(b){case"object":h={suc:e,fail:f};break;case"array":h=g;break;case"suc":h=e;break;case"fail":h=f;break;case"item":h=d;break;case"empty":h=d.length>0?!1:!0;break;case"dom":h=this.getEl.dom}return h}function i(a){var b=this,c=a.pos||"left";if("left"==c){var d={xtype:"emailtips",text:a.text},e=b.add(d);b.tipsItemList.push(e)}}function j(a,b,c){var d=this;if("string"==typeof a){if(""==fb.trim(a))return;d.domain&&d.emailinput.isMobile(a)&&(a+="@"+d.domain)}d.clearTips();var e=d.emailinput.getEl(),f=gb.getEmails(a);b=b||"before";for(var g=!1,h=0;h<f.length;h++){var i=f[h];i.name=fb.trim(i.name||"");var j=i.address.toLowerCase();if(!c||i.valid)if(d.itemMap[j]){var k=d.findItem(j);k.render(e.dom,b)}else{({xtype:"emailblock",uri:i,valid:i.valid});var k=new X({parent:d,uri:i,valid:i.valid});d.add(k,!0),k.render(e.dom,b),d.itemList.push(k),d.itemMap[j]=k,g=!0}}d.checkHeight(),g&&d.fire("containerupdate")}function k(){var b=this;a.Array.each(b.itemList,function(a,b){b.destroy()}),b.itemList=[],b.itemMap={},b.checkHeight(),b.fire("containerupdate")}function l(a){this.clearItem(),this.addItem(a)}function m(a){for(var b=this,c=gb.getEmails(a),d=0;d<c.length;d++){var e=c[d].address.toLowerCase();b.removeItem({address:e})}}function n(a,b){for(var c=this,d=gb.getEmails(a),e=0;e<d.length;e++){var f=d[e].address.toLowerCase(),g=c.findItem(f);g&&g.setValid(b)}}function o(){}function p(){}function q(){this.emailinput.autoComplete()}function r(){return this.emailinput.get()}function s(){this.emailinput.select()}function t(){this.emailinput&&this.emailinput.focus()}function u(){this.emailinput.blur()}function v(a){var b=this,c=fb.trim(b.getInputValue());c&&(b.addItem(c,null,a),b.emailinput.set(""))}function w(){var b=this;b.clearTips(),a.Array.each(b.itemList,function(a,b){b.destroy()}),b.tipsItemList&&b.tipsItemList.length&&a.Array.each(b.tipsItemList,function(a,b){b.destroy()}),b.menu&&b.menu.destroy(),delete b.itemList,delete b.selectItemList,delete b.tipsItemList,delete b.menu;for(var c in b.itemMap)delete b.itemMap[c];for(var c in b.selectItemMap)delete b.selectItemMap[c]}function x(){for(var b=this,c=b.getEl(),d=c.find("DIV"),e=d.doms,f=0,g=e.length;g>f;f++){var h=e[f];a.Component.getItem(h).index=f}}function y(b){var c=this;b=b.toLowerCase();var d=null;return a.Array.each(c.itemList,function(c,e){return e.key==b?(d=e,a.BREAK):void 0}),d}function z(b){var c=this;c.buildIndex();var d=[],e=c.emailinput.index;switch(b){case"shiftLeft":return c.shiftIndex--,c.shiftIndex+e<0&&(c.shiftIndex=-e),c.findItemsByPos("shift");case"shiftRight":return c.shiftIndex++,c.shiftIndex+e>c.itemList.length&&(c.shiftIndex=c.itemList.length-e),c.findItemsByPos("shift");case"shift":a.Array.each(c.itemList,function(a,b){(b.index<e&&b.index>=e+c.shiftIndex||b.index>e&&b.index<=e+c.shiftIndex)&&d.push(b)}),c.resetSelectItem(!0);break;case"inputLeft":a.Array.each(c.itemList,function(a,b){b.index<e&&d.push(b)}),c.resetSelectItem();break;case"inputRight":a.Array.each(c.itemList,function(a,b){b.index>e&&d.push(b)}),c.resetSelectItem()}return d}function A(b,c){for(;"DIV"!=b.tagName;)b=b.parentNode;if(b){var d=a.Component.getItem(b);if(d)return c?d.xtype==c?d:null:d}return null}function B(){var b=this,c="";a.Array.each(b.itemList,function(a,d){b.selectItemList.push(d),b.selectItemMap[d.key]=!0,d.select(),c+=d.getValue()+";"}),b.selectData({value:c})}function C(b){var c=this,d="";b.value&&(d=b.value),b.allSelect&&a.Array.each(c.selectItemList,function(a,b){d+=b.getValue()+";"}),c.emailhide.selectData(d)}function D(b){var c=this;a.Array.each(c.selectItemList,function(a,b){b.unselect()}),c.selectItemList=[],c.selectItemMap={},b||(c.shiftIndex=0)}function E(a){var b=this,c=a.key,d=b.selectItemMap;d[c]||(d[c]=a,b.selectItemList.push(a),a.select())}function F(a){for(var b=this,c="",d=b.findItemsByPos(a),e=0,f=d.length;f>e;e++){var g=d[e];b.selectItem(g),c+=g.getValue()+";"}b.selectData({value:c})}function G(b){var c=this,d=b.key,e=c.selectItemMap;e[d]&&(e[d]=null,a.Array.remove(c.selectItemList,b),b.unselect())}function H(){var b=this;a.Array.each(b.selectItemList,function(c,d){a.Array.remove(b.itemList,d),b.itemMap[d.key]=null,d.destroy(),d.warn&&b.fire("itemwarnremove",d.key)}),b.selectItemList=[],b.selectItemMap={},b.checkHeight()}function I(b){var c=this,d=null;if(b.el&&b.el.dom?d=a.Component.getItem(b.el.dom):b.address?d=c.findItem(b.address):b.item&&(d=b.item),d){var c=this;a.Array.remove(c.itemList,d),c.itemMap[d.key]=null,a.Array.remove(c.selectItemList,d),c.selectItemMap[d.key]=null,d.destroy(),d.warn&&c.fire("itemwarnremove",d.key),c.checkHeight(),c.fire("containerupdate")}}function J(){var b=this;b.tipsItemList&&b.tipsItemList.length&&(a.Array.each(b.tipsItemList,function(a,b){b.destroy()}),b.tipsItemList=[])}function K(){var a=this,b=this.getEl().dom.scrollHeight;a.height!=b&&(a.height=b,this.fire("containerresize"))}function L(){var b=this;if(""==fb.trim(b.getInputValue())){var c=a.Event.get();b.selectStartX=c.pageX,b.selectStartY=c.pageY,b.buildIndex(),b.mousemove=a.Function.bind(b.mouseSelect,b),a.Event.listen(document,"mousemove",b.mousemove),a.Event.listen(document,"mouseup",function(){b.mousemove&&(a.Event.unlisten(document,"mousemove",b.mousemove),b.mousemove=null)})}}function M(){var b=this,c=b.getEl();if(c&&c.dom){var d=a.Event.get(),e=d.pageX,f=d.pageY,g=e-b.selectStartX,h=f-b.selectStartY;if(Math.abs(h)>10||Math.abs(g)>10){b.isSelect=!0;var i=c.dom,j=i.childNodes,k=b.getPosition(),l=k[0],m=k[1],n=k[2],o=k[3],p=j[0];e<o+p.offsetLeft&&(e=o+p.offsetLeft+1),e>m&&(e=m-1),f<=l+p.offsetTop&&(f=l+p.offsetTop+1),f>n-4&&(f=n-4);for(var q=null,r=null,s=0,t=j.length;t>s;s++){var u=j[s],v=l+u.offsetTop,w=e<=o+u.offsetLeft+2;f<=v+u.offsetHeight;var x=v>=f,y=f>v&&f<=v+u.offsetHeight,z=e>o+u.offsetLeft&&e<o+u.offsetLeft+u.offsetWidth+2;if(y&&z){if(b.findItemByDom(u,"emailblock")){q=u;break}return b.resetSelectItem(),void 0}if(!w&&x){if(u.previousSibling){q=u.previousSibling;break}}else y&&(r=u)}if(q||r&&b.findItemByDom(r,"emailblock")&&(q=r),!q)return b.resetSelectItem(),void 0;try{var A=b.emailinput.index,B=b.findItemByDom(q,"emailblock").index}catch(C){return}var D=[],E="";b.resetSelectItem(),A>B?a.Array.each(b.itemList,function(a,b){b.index>=B&&b.index<A&&D.push(b)}):a.Array.each(b.itemList,function(a,b){b.index<=B&&b.index>A&&D.push(b)});for(var s=0,t=D.length;t>s;s++){var F=D[s];b.selectItem(F),E+=F.getValue()+";"}b.selectData({value:E})}}}function N(){var b=this,c=b.getEl();if(c&&c.dom){var d=c.dom,e=d.childNodes,f=b.getPosition(),g=f[3],h=f[0],i=0;try{i=document.getElementById(a.Context.module.createId("main")).scrollTop||0}catch(j){}for(var k=a.Event.get(),l=k.pageX,m=k.pageY+i,n=!1,o=0,p=e.length;p>o;o++){var q=e[o],r=h+q.offsetTop,s=l<=g+q.offsetLeft+2,t=m<=r+q.offsetHeight,u=r>=m;if(s&&t||!s&&u){n=!0,b.emailinput.move("itemPre",a(q),!0);break}}n||b.emailinput.move("last",null,!0)}}function O(){for(var a=this.getEl().dom,b=[0,a?a.offsetWidth:0,a?a.offsetHeight:0,0],c=a;c;c=c.offsetParent)b[3]+=c.offsetLeft,b[0]+=c.offsetTop-(document.all?c.offsetParent?c.scrollTop:0:0);return b[1]+=b[3],b[2]+=b[0],b}function P(){var b=this,c=a.Event.get();if(3!=c.which){var d=a.Event.getTarget(),e=b.findItemByDom(d);if(e&&"emailblock"==e.xtype){var f,c=a.Event.get(),g=b.dragItem,h=b.selectItemList.length;f=h>1?'<div class="nui-addr nui-editableAddr"><em class="nui-addr-email">'+$.t("您选择了")+h+$.t("个地址")+"</em></div>":e.getEl().dom.innerHTML,g.getEl().html(f);var i=g.getEl().dom;i.style.left=c.pageX+2+"px",i.style.top=c.pageY+2+"px",b.drag._start=!0}}}function Q(){this.dragItem.show()}function R(){var b=this,c=a.Event.getTarget(),d=b.findItemByDom(c);!d||"emailcontainer"!=d.xtype&&"emailcontainer"!=d.owenCt.xtype?(b.locate(),b.destItem=b):("emailcontainer"!=d.xtype&&(d=d.owenCt),d!=b?(d.locate(),d.fire("containerfocus"),b.destItem=d):(b.locate(),b.destItem=b))}function S(){var b=this;if(0!=b.drag._start&&(b.drag._start=!1,b.dragItem.hide(),b.destItem)){var c=[];a.Array.each(b.selectItemList,function(a,b){b.valid?c.push(b.getValue()):c.push(b.getValue().toString())}),b.delSelectItem(),b.destItem.addItem(c)}}function T(){var b,c=this,d="nui-menu-item-disabled";if(c.menu)b=c.menu.find("menuitem");else{var e={xtype:"menu",width:110,hidden:!0,groups:[{items:[{text:$.t("剪切    Ctrl+X"),click:function(){c.menuCut()}},{text:$.t("复制    Ctrl+C"),click:function(){c.menuCopy()}},{text:$.t("粘贴    Ctrl+V"),click:function(){c.menuPaste()}},{text:$.t("删除    Delete"),click:function(){c.delSelectItem()}},{type:"split"},{text:$.t("全选    Ctrl+A"),click:function(){c.selectAllItem()}}]}]};c.menu=new a.Menu(e),c.menu.render(document.body),b=c.menu.find("menuitem"),ab.isIE()||(b[0].getEl().addClass(d),b[1].getEl().addClass(d))}var f=a.Event.getTarget(),g=c.findItemByDom(f);if(g)switch(g.xtype){case"emailinput":return;case"emailblock":ab.isIE()&&(b[0].getEl().removeClass(d),b[1].getEl().removeClass(d)),b[3].getEl().removeClass(d),a.Event.cancel();break;case"emailcontainer":ab.isIE()&&(b[0].getEl().addClass(d),b[1].getEl().addClass(d)),b[3].getEl().addClass(d),a.Event.cancel()}var h=a.Event.get(),i=h.pageX+"px",j=h.pageY+"px",k=c.menu.getEl();k.css({top:j,left:i}),c.menu.show()}function U(){this.menuCopy()&&this.delSelectItem()}function V(){var c="";a.Array.each(this.selectItemList,function(a,b){c+=b.getValue()+";"});try{if(b.clipboardData)return b.clipboardData.clearData(),b.clipboardData.setData("Text",c),!0}catch(d){}}function W(){var a=this;if(ab.isIE())try{var c=b.clipboardData.getData("Text");return c&&(a.emailinput.set(c),a.emailinput.paste()),void 0}catch(d){}var c=b.prompt($.t("因为您的浏览器安全设置原因，不能直接访问剪贴板内容，需要重新粘贴一次。\n\n请使用键盘快捷键(Ctrl+V)把内容粘贴到下面的方框里，再按 确定。"));a.emailinput.set(c),a.emailinput.paste()}try{var X=$L("component.emailinput.EmailBlock")}catch(Y){return Y}try{$L("component.emailinput.EmailTips")}catch(Y){return Y}try{$L("component.emailinput.EmailInput")}catch(Y){return Y}try{$L("component.emailinput.EmailHide")}catch(Y){return Y}try{var Z=$L("support.AddressSupport")}catch(Y){return Y}var $=new $I18N("component.emailinput.EmailContainer"),_=a.Component,ab=a.Browser,bb=a.Email,cb=a.EMAIL_ADDRESS,db=a.Uri,eb=a.Object,fb=a.String,gb=a.createClass($N("component.emailinput.EmailContainer"));eb.mix(gb,_,{_template:'<div class="nui-multiLineIpt C-multiLineIpt nui-ipt#{cls_type}" #{title} unselectable="on">#{input}</div>',_events:["containerfocus","containerblur","containerresize","containerupdate","itemwarnremove"],_listeners:[{name:"init",handler:function(){},custom:!0},{name:"mousedown",handler:function(){var b=a.Event.getTarget(),c=_.getItem(this),d=c.findItemByDom(b);if(d)switch(d.xtype){case"emailblock":break;case"emailinput":c.resetSelectItem(),c.clearTips(),c.initSelect();break;case"emailcontainer":c.locate(),c.resetSelectItem(),c.clearTips(),c.initSelect();break;case"emailhide":c.clearTips(),c.locate(),c.fire("containerfocus");break;case"emailtips":c.clearTips(),c.locate(),c.fire("containerfocus");break;default:c.clearTips(),c.locate(),c.fire("containerfocus")}else c.clearTips(),c.locate(),c.fire("containerfocus")}},{name:"click",handler:function(){}},{name:"mouseover",handler:function(){var a=_.getItem(this).getEl();a.addClass("nui-ipt-hover")}},{name:"contextmenu",handler:function(){var a=_.getItem(this);a.contextMenu()}},{name:"keydown",handler:function(){}},{name:"mouseout",handler:function(){var a=_.getItem(this).getEl();a.removeClass("nui-ipt-hover")}},{name:"render",handler:function(){var c=this;c.emailinput=c.find("emailinput")[0];var d={xtype:"emailhide"},e=c.add(d,!0);if(e.render(c.getEl().dom,"before"),c.emailhide=c.find("emailhide")[0],!a.Browser.firefox()){c.dragItem=new _({renderTo:b.document.body,hidden:!0,html:'<div class="nui-addr nui-editableAddr nui-editableAddr-hover nui-editableAddr-draging" style="left:0px;top:0px;"></div>'});var f=a.getClass("netease.mail.util.DragDrop");this.drag=new f({drag:c.dragItem.getEl().dom,trigger:c.getEl().dom,triggerOffset:5,noListenerSelect:!0,listeners:[{name:"mousedown",handler:a.Function.bind(c._dragInit,c)},{name:"start",handler:a.Function.bind(c._dragStart,c)},{name:"drag",handler:a.Function.bind(c._dragMove,c)},{name:"drop",handler:a.Function.bind(c._dragDrop,c)}]}),c.drag._start=!1}},custom:!0},{name:"afterRender",handler:function(){var a=this,b=a.find("emailtips");b&&(a.tipsItemList=a.tipsItemList.concat(b))},custom:!0}],xtype:"emailcontainer",getEmails:c,matchEmails:d,getEmail:e},{itemList:null,itemMap:null,selectItemList:null,selectItemMap:null,tipsItemList:null,height:0,shiftIndex:0,selectStartX:0,selectStartY:0,key:null,_getData:g,initialize:f,get:h,addItem:j,clearItem:k,setItem:l,delItem:m,setItemValid:n,choose:o,leave:p,select:s,focus:t,blur:u,build:v,exit:w,initComplete:q,getInputValue:r,buildIndex:x,findItem:y,findItemByDom:A,findItemsByPos:z,selectData:C,selectAllItem:B,resetSelectItem:D,selectItem:E,selectPos:F,unselectItem:G,delSelectItem:H,removeItem:I,addTips:i,clearTips:J,_dragInit:P,_dragStart:Q,_dragMove:R,_dragDrop:S,contextMenu:T,menuCut:U,menuCopy:V,menuPaste:W,checkHeight:K,initSelect:L,mouseSelect:M,locate:N,getPosition:O})}($,window),function(a,b){function c(b){return v.isArray(b)?b=b.join(",")||"":v.isString(b)||(b=""),a.String.encodeHTML(b)}function d(){var b=A.cards;if(!(b.length<=0))for(var c=b.length-1;c>=0;c--){var d=b[c];try{var e,f=d.rawConfig;if(!f.doNotHide&&!f.tmpDoNotHide){var g,h=d.getEl();try{g=a.Event.getTarget()}catch(i){}h&&g&&(e=h&&a.Element.inside(g,h)),e||d.close()}f.tmpDoNotHide=null}catch(i){}}}function e(b){var c=this;try{}catch(d){return d}A.hideCard(),b.scrollEl||(b.scrollEl=document.body);var e,f=o.data.extDataMap.contact,g=b.info||{};g.cid||b.cid?(e=f[g.cid||b.cid],c.contact=e,c.isNew=!1):g.email?(e=o.getAddrObj(g.email),e?(c.contact=e,c.isNew=!1):(c.isNew=!0,c.newInfo={email:g.email,name:a.Uri.getDefaultName(g.email)})):(c.isNew=!0,c.newInfo={email:"",name:""}),A.cards.push(c),A.superClass.initialize.call(c,b)}function f(){var a=this,b=a.rawConfig;!a.isNew&&b.del?b.del.call(a,a.contact):o.deleteContact({contacts:[a.contact.CID],call:function(){a.fire("del")},error:function(){a.fire("delError")}}),a.close()}function g(){var a=this,b=a.rawConfig;!a.isNew&&b.edit?b.edit.call(a,a.contact):q.show({cid:a.contact.CID}),a.fire("edit"),a.close()}function h(){var b=this,c=b.newInfo||{};b.hide(),o.contactDialog({type:"add",addr:{name:a.String.encodeHTML(c.name||""),email:c.email},callback:b.rawConfig.addOneCb})}function i(){var a=this;a.fire("close"),a.closeTimer&&(clearTimeout(a.closeTimer),a.closeTimer=null),a.destroy()}function j(b){try{u.cache({contact_card_compose_click:1},function(a,b){a.value=(+a.value||0)+ +b})}catch(c){}try{var d=$L("interface.ComposeInterface",this)}catch(c){return c}var e=d;if(!b)return a.Tips.show({text:t.t("请先选择联系人")}),void 0;var f=[];v.isObject(b)?f.push(b):b.length>0&&f.push(b),e.compose.apply(e,[{info:{to:f}}])}function k(b,c){try{u.cache({contact_card_related_click:1},function(a,b){a.value=(+a.value||0)+ +b})}catch(d){}var e=r;return b?(e.contacts({email:b},{cid:c}),void 0):(a.Tips.show({text:t.t("该联系人无邮箱"),succ:!0}),void 0)}function l(){var b=this,c=b.formContact.mail;if(c.length>0&&c[0].value&&(a.Ext.avatar_show||c[0].value===B))try{try{var d=$L("init.Avatar",this)}catch(e){return e}d.get(c[0].value,180,c[0].value!==B,function(a,c){if(!c){var d=b.getEl().find(".uW0 IMG").dom;d.src=a}})}catch(e){}}function m(a){var b=this,c={hasSubTemplate:!0,closeIcon:a.noClose?"":b._getChildHtml({xtype:"link",text:'<b class="nZ0 nui-ico nui-ico-close">x</b>',cls:"nui-layer-close",click:w.bind(b.close,b)}),delBtn:a.noDel||b.isNew?"":b._getChildHtml({xtype:"button",text:t.t("删 除"),icon:"trash",click:w.bind(b.del,b)}),editBtn:a.noAction?"":b.isNew?b._getChildHtml({xtype:"button",subclass:"mainBtn",text:t.t("添加"),click:w.bind(b.addOne,b)}):b._getChildHtml({xtype:"button",subclass:"mainBtn",text:t.t("编 辑"),click:w.bind(b.edit,b)}),closeBtn:b._getChildHtml({xtype:"button",text:t.t("关 闭"),click:w.bind(b.close,b)})};
return c.content=b._getContentHtml(a),c}function n(){function b(){return A.encodeHTML(o.parseName(C)||t.t("未命名"))}function c(){var c=b(),d="";return(C["X-PHONETIC-LAST-NAME"]||C["X-PHONETIC-FIRST-NAME"])&&(d="&nbsp;<span>("+x.encodeHTML(C["X-PHONETIC-LAST-NAME"]||"")+" "+x.encodeHTML(C["X-PHONETIC-FIRST-NAME"]||"")+")</span>"),c='<strong class="fN0" title="'+c+'">'+c+"</strong>"+d,a.Link.html({icon:C.MARKED?"star-selected":"star",click:function(){var a=u.rawConfig;a.mark&&a.mark.call(u,u.contact)}})+"&nbsp&nbsp"+c}function d(b){return a.Ext.contact_TDCode?'<img class="gE0" src="../contacts/call.do?from=webmail&cmd=newapi.formContactsInfo&vcardver=3.0&type=qrcode&uid='+B+"&sid="+$S("sid")+"&cid="+b+'" alt="'+t.t("二维码")+'" title="'+t.t("二维码")+'"></img>':""}function e(){return C.NICKNAME?q(A.encodeHTML(C.NICKNAME),t.t("昵称")):""}function f(){return C.GENDER||""}function g(){if(C.BDAY||C["BDAY;value=date"]){var a=C.BDAY||C["BDAY;value=date"];return a=a.replace(/^0/,""),a=a.replace(/(\d{3,4})(\d{2})(\d{2})/,"$1年$2月$3日").replace(t.t("1604年"),""),q(A.encodeHTML(a),t.t("生日"))}return""}function h(a,b,c){var d="";switch(a){case"URL;type=pref":var e=G.url;d=b[a]||b.URL||e[0]?e[0].value:"";break;default:d=b[a]}return d?(d=r(a,d,b),q(d,c||s.keyMap[a]||"")):""}function i(){if(C.JINIAN||C.ANNIVERSARY){var a=C.JINIAN||C.ANNIVERSARY;return j(a,"date")}return""}function j(b,c){var d,e,f,g,h="";if(!b)return h;d=b.split(";");for(var i,j=0,k=d.length;k>j;j++)if(i=d[j]){e=i.split(":"),f=2===e.length?e[0]:"other",g=e[e.length-1];var l={im:a.ADDR_IM_TITLE,date:a.ADDR_MEMORIAL_DAY}[c];v.each(l,function(a){a===f&&("date"===c&&(g=g.replace(/(\d{1,4})-(\d{1,2})-(\d{1,2})/g,"$1年$2月$3日")),g=r(c,g,C),h+=q(g,l[f]))})}return h}function k(){var a=C.GROUPING||C.Grouping||"",b=a.split(";"),c=[];b[0]&&""!==b[0]&&z[b[0]]&&c.push(z[b[0]].N);for(var d=1,e=b.length;e>d;d++)z[b[d]]&&c.push(z[b[d]].N);return q(A.encodeHTML(c.join(" ; ")),t.t("所属分组"))}function l(a,b){var c="";return a.length>0&&y.each(a,function(a,d){var e=r(b,d.value,C);c+=q(e,d.text||s.keyMap[d.fKey||""]||"",d.value)}),c}function m(a){var b="";return a.length>0&&y.each(a,function(a,c){if(c.label){var d=r(c.key,c.value,C);b+=q(d,c.label,c.value)}}),b}function n(b){return a.Email.checkMobile(b)?a.Icon.html({type:"phone"}):""}function p(b){return/@(vip\.163|vip\.126|188|vip\.188)\.com$/i.test(a.String.trim(b))?a.Icon.html({xtype:"icon",type:"user",subtype:"vip"}):""}function q(a,b,c,d){return a=x.trim(a),a||d?['<dl class="',b===t.t("电子邮箱")?"ou0 jS1":"ou0",'">','<dt class="iX0">',b+"：","</dt>",'<dd class="is0">','<span title="',A.encodeHTML((c||a).replace(/&nbsp;/g,"")),'">',a||"&nbsp;","</span>","</dd>","</dl>"].join(""):""}function r(b,c,d){var e="";switch(b){case"MAIL":case"MAILHOME":case"MAILWORK":return e=o.parseName(d)||t.t("未命名"),[p(c),A.encodeHTML(c),"&nbsp;",n(c),"&nbsp;&nbsp;&nbsp;",a.Link.html({text:'<b class="nui-ico"></b>',icon:"envelop",attrs:'title="'+t.t("写信")+'"',click:function(){u.gotoCompose(new a.Email(c,e)),u.close()}}),"&nbsp;",a.Link.html({text:'<b class="nui-ico"></b>',icon:"dealings",attrs:'title="'+t.t("邮件往来")+'"',click:function(){u.gotoMbox(c,d.CID),u.close()}})].join("");case"TEL;CELL":case"TEL;HOME;VOICE":case"TEL;WORK;FAX":case"TEL;WORK;VOICE":return A.encodeHTML(c);case"adr":return A.encodeHTML(s.parseADR(c));default:return A.encodeHTML(x.trim(c)).replace(/\n/gi,"<br>")}}var u=this,z=o.data.extDataMap.group,C=u.contact,D=u.newInfo||{};if(u.isNew&&!D.email)return'<div class="sD0 ot0">#{closeIcon}'+t.t("这个联系人还没有信息。 ")+u._getChildHtml({xtype:"link",text:t.t("现在添加"),click:w.bind(u.addOne,u)})+"</div>";if(u.isNew&&D.email){var E=D.email;return sEmailHtml=[p(E),A.encodeHTML(E),"&nbsp;",n(E),"&nbsp;&nbsp;&nbsp;",a.Link.html({text:'<b class="nui-ico"></b>',icon:"envelop",attrs:'title="'+t.t("写信")+'"',click:function(){u.gotoCompose(new a.Email(E,D.name)),u.close()}}),"&nbsp;",a.Link.html({text:'<b class="nui-ico"></b>',icon:"dealings",attrs:'title="'+t.t("邮件往来")+'"',click:function(){u.gotoMbox(E),u.close()}})].join(""),['<div class="sD0">',"#{closeIcon}<h1>"+t.t("查看联系人")+"</h1>",'<div class="jZ0">','<strong class="fN0" title="',D.name,'">',D.name,"</strong>","</div>",'<div class="pf0 nui-scroll contact_info_layer">',q(sEmailHtml,t.t("邮箱地址"),D.email||" "),q("",t.t("手机号码"),!1,!0),"</div>","</div>"].join("")}var F=C.CID,G=u.formContact=s.formatContact(C),H=G.mail||[],I=a.Ext.avatar_show&&H[0]&&H[0].value===B&&a.Email.checkFree(B);return['<div class="sD0">',"#{closeIcon}<h1>"+t.t("查看联系人")+"</h1>",I?'<a href="javascript:void(0);" class="uW0 nui-faceEdit nui-faceEdit-100">':'<span class="uW0 nui-faceEdit nui-faceEdit-100">','<img src="http://mimg.127.net/p/js6/lib/img/noface.gif" class="nui-faceEdit-face" alt="',b(),t.t("的头像")+'">',I?'<span class="nui-faceEdit-tips">'+t.t("点击编辑头像")+"</span>":"",I?"</a>":"</span>",'<div class="jZ0">',c(),"</div>","<!-- "+t.t("详情列表 Start")+" -->",'<div class="pf0 nui-scroll contact_info_layer">',d(F),'<div class="fu1"></div>',e(),f(),l(G.mail,"MAIL")||q("",t.t("邮箱地址"),!1,!0),l(G.tel,"TEL;CELL")||q("",t.t("手机号码"),!1,!0),l(G.fax,"TEL;CELL"),l(G.icq,"im"),l(G.adr,"adr"),g(),h("ZS",C),i(),h("URL;type=pref",C),h("ORGNAME",C),h("ORG",C),h("TITLE",C),h("ROLE",C),h("MEMBER",C),h("LOGO",C),h("RELATED",C),h("LANG",C),h("TZ",C),h("GEO",C),k()||q("",t.t("所属分组"),!1,!0),m(G.other),"</div>","</div>"].join("")}try{var o=$L("support.AddressSupport")}catch(p){return p}try{var q=$L("component.contact.ContactEdit")}catch(p){return p}try{var r=$L("interface.MboxInterface")}catch(p){return p}try{var s=$L("util.Contact")}catch(p){return p}var t=new $I18N("component.contact.ContactCard"),u=a.Log||b.Log,v=a.Object,w=a.Function,x=a.String,y=a.Array,z=a.getClass("netease.mail.component.Component"),A=a.createClass($N("component.contact.ContactCard")),B=$S("orgUid");a.fly(document).listen("click",function(){A.hideCard()}),v.mix(A,z,{xtype:"contactcard",_template:['<div class="nui-layer nui-layer-arrLeft oC0">','<b class="nui-layer-arr"></b>','<div class="nui-layer-normal">',"#{content}",'<div class="ny0">','<div class="fR0">',"#{delBtn}","</div>",'<div class="fj0">',"#{editBtn}#{closeBtn}","</div>","</div>","</div>","</div>"].join(""),_listeners:[{name:"render",handler:function(){var b=this,c=b.rawConfig,d=b.getEl(),e=d.dom.firstChild,f=b.rawConfig.floatTo;if(b.checkAvatar(),f){d.show();var g=d.find("div.contact_info_layer"),h=g.dom.offsetHeight;h-380>0&&(g.dom.style.height="380px");var i,j,k=a.fly(f).offset(),l=k.x+f.offsetWidth;c.positionX&&(l=Math.min(l,c.positionX));var m=k.y,n=c.scrollEl.scrollTop,o=m-n,p=o-60,q=document.body.clientHeight;h=d.dom.offsetHeight;var r=q-p-h,s=a.Browser.isIE()?4:2;i=0>r?q>=h?p+r:p:p,j=o-i+7;var t=137-o,u=q-o;t>0&&38>t&&(j+=t/2),38>u&&(u>12?j-=38-u-s:j=-1),j>-1?(e.style.top=j+"px",e.style.display=""):e.style.display="none",d.css({left:l+"px",top:i+"px",visibility:"",display:"block"});try{var w,x,y=a.Event.getEvent();y&&(x=a.Event.getTarget(),w=x&&x.nodeType),b.rawConfig.tmpDoNotHide=w}catch(z){b.rawConfig.tmpDoNotHide=!0}a.Component.setEvents();var C=b.formContact.mail||[0];if(a.Ext.avatar_show&&C[0]&&C[0].value===B&&a.Email.checkFree(B)){var D=b.getEl().find("span.nui-faceEdit-tips");a.Event.listen(D,"click",function(){var a=v.clone(b.rawConfig);b.close();try{var c=$L("support.OptionSupport",this)}catch(d){return d}c.avatarUploader({uploader:function(){try{new A(a)}catch(b){}},cancel:function(){}})})}}},custom:!0},{name:"destroy",handler:function(){var b=this;a.Array.each(A.cards,function(c,d){return d===b?(A.cards.splice(c,1),a.BREAK):void 0})},custom:!0},{name:"mouseout",handler:function(b){var c=this;if(!a.Event.isMouseout(c,b))return!1;var d=z.getItem(c);d.closeTimer=setTimeout(function(){d.close()},2e3)}},{name:"mouseover",handler:function(b){var c=this;if(!a.Event.isMouseover(c,b))return!1;var d=z.getItem(c);d.closeTimer&&(clearTimeout(d.closeTimer),d.closeTimer=null)}}],cards:[],encodeHTML:c,hideCard:d},{initialize:e,del:f,edit:g,addOne:h,close:i,gotoCompose:j,gotoMbox:k,checkAvatar:l,_getData:m,_getContentHtml:n})}($,window),function(a,b,c){function d(b){var c=new R(b);if(a.Msgbox.show({header:b.cid?K.t("编辑联系人"):K.t("新建联系人"),contentType:"wide",top:"157px",width:"540px",content:c.html(),ok:N.bind(c.submit,c),cancel:N.bind(c.cancel,c),listeners:{destroy:N.bind(c.destroy,c),render:function(){Q.setEvents(),setTimeout(function(){try{c.components.name[0].input.focus()}catch(a){}},10)}},close:b.close}),c.initData(b),Q.setEvents(),b.hideMark)try{var d=c.components.MARKED[0].checkbox;d.setChecked(!1),d.getEl().findParent("dl.ou0",!1,!0).hide()}catch(e){}}function e(b){var c=this;try{}catch(d){return d}c.components={name:[],MAIL:[],TEL:[],ZS:[],MARKED:[],GROUP:[],FAX:[],ADR:[],ICQ:[],date:[],"URL;type=pref":[],ORGNAME:[],ORG:[],TITLE:[],ROLE:[],MEMBER:[]},c.formatContact={mail:[],tel:[],fax:[],adr:[],url:[],icq:[],date:[],other:[]},c.boolGroup={},R.superClass.initialize.call(c,b);var e=b.cid;G.data.rawDataArray.group;var f=G.data.extDataMap.contact;c.contact=e?f[e]:b.data,c.action=new I(G),c.inContactModule="contact.ContactModule"===(a.Context.getModule()||{}).mtype,c.curModule=a.Context.getModule()}function f(){var a=this,b={};return b.normalContent=a.getBaseHtml(),b.moreInfo=a.getMoreInfoHtml(),b}function g(){var b,d=this,e="",f=d.components,g="input_N",h=new a.Input({inputId:g});b=a.Link.html({text:K.t("详细"),title:K.t("编辑详细姓名"),extcls:"nui-txt-link nui-txt-s12",click:N.bind(d.clickShowDetail,d,"name")}),e+=d._getDlHtml(K.t("姓名"),h.html()+b,c,g),f.name.push({input:h,nickname:"",n:""}),e+=d._getDivHtml(["MAIL"]);var i=new a.Checkbox({text:K.t("设为星标联系人")});e+=d._getDlHtml("",i.html()+'<b class="nui-ico nui-ico-help" title="'+K.t("设为星标联系人后，该联系人将添加至收件箱的左侧栏，您可以很方便的查看他们的往来邮件哦！")+'"></b>'),f.MARKED.push({checkbox:i}),e+=d._getDivHtml(["TEL"]),g="input_DETAIL";var j=new a.Input({subclass:"multiLineIpt",rows:2,inputId:g});return e+=d._getDlHtml(K.t("备注"),j.html(),c,g),f.ZS.push({input:j}),b=["<div>",a.Button.html({text:K.t("请选择"),extcls:"ef0",click:a.Function.bind(d.clickShowGroupEdit,d)}),'</div><div style="display:none;"></div>'].join(""),e+=d._getDlHtml(K.t("分组"),b,"contact_edit_group")}function h(){var a=this,b="";return a.bBDAY=!0,b+=a._getDivHtml(["FAX","ADR","ICQ","date"]),P.each(R.otherArray,function(c,d){b+=a._getMulDlHtml(d)}),b}function i(b){var c=this;c.delItems={},c.components;var d,e=G.data.rawDataArray.group,f=G.data.extDataMap.contact,g=c.boolGroup={},h=b.cid,i=[];c.filled=!1,c.newContact=!1;try{var j=h?f[h]:b.data;if(h?(j=f[h],j&&b.data&&L.isObject(b.data)&&(j=L.clone(j),delete b.data["EMAIL;PREF"],L.extend(j,b.data))):j=b.data,c.contact=j,j){c.formatContact=J.formatContact(j),c.maxItem=c.formatContact.maxItem,delete c.formatContact.maxItem,d=c.formatContact,L.each(d,function(a,b){"url"!==a&&"other"!==a&&b.length<=0&&b.push({key:"",value:"",bEmpty:!0})});var k=j.GROUPING||j.Grouping||"";if(k){var l=k.split(";");P.each(e,function(b,c){var d=c.CID;P.each(l,function(b,c){return c===d?(l.splice(b,1),g[d]=!0,i.push(d),a.BREAK):void 0})}),c.fillGroup(i)}c.fillDate(),c.fillSingle(j),c.fillMulti(),c.filled=!0}else{d=c.formatContact,L.each(d,function(a,b){"url"!=a&&"other"!=a&&b.length<=0&&b.push({key:"",value:"",bEmpty:!0})}),c.newContact=!0;var m=c.inContactModule&&c.curModule?c.curModule.currentGroup:null;m&&(P.each(e,function(a,b){m==b.CID&&(g[m]=!0,i.push(m))}),c.fillGroup(i))}}catch(n){}}function j(b,c){switch(b){case"date":if(-1===c.search(/^(\d){2,4}-(1[0-2]|0?[1-9])-(0?[1-9]|[12][0-9]|3[01])$/gi))return!0;break;case"zs":if(O.len(c)>1e3)return!0;break;case"N":case"ADR":if(c.indexOf(";")>-1)return!0;break;case"MAIL":case"EMAIL":case"EMAIL;type=INTERNET":case"EMAIL;type=INTERNET;type=HOME":case"EMAIL;type=INTERNET;type=WORK":if(""==c||/[,;]/gi.test(c))return!0;var d=a.Uri.getEmails(c);if(d.wrong.length>0)return!0;break;default:return!1}return!1}function k(){var b,c=this,d=c.editField,e=c.components;switch(a.Msgbox.msgbox.footer.html(""),d){case"group":c.boolGroup={};var f=[];P.each(e.GROUP,function(a,b){b.getChecked()&&f.push(b.value),b.destroy()}),c.fillGroup(f);break;case"name":var g=O.trim($C("contactDialogNickName").getValue()),h=O.trim($C("contactDialogFront").getValue()),i=O.trim($C("contactDialogFirstName").getValue()),j=O.trim($C("contactDialogMidName").getValue()),k=O.trim($C("contactDialogFamilyName").getValue()),l=O.trim($C("contactDialogEnd").getValue()),m=[k,i,j,h,l];b=e.name[0],b.nickname=g,b.n=m.join(";"),b.input.setValue(G.parseN(m)),a("#contact_edit_details").empty();break;case"ADR":var n=O.trim($C("contactDialogCountry").getValue()),o=O.trim($C("contactDialogProvince").getValue()),p=O.trim($C("contactDialogCity").getValue()),q=O.trim($C("contactDialogStreet").getValue()),r=O.trim($C("contactDialogCode").getValue()),s=[n,o,p,q,"","",r];b=e.ADR[c.detailIndex],b.value=s.join(";"),b.input.setValue(G.parseADR(s)),a("#contact_edit_details").empty();break;default:if(c.submitLock)return!0;var t=c.getContact(function(a){c.submitLock=!0,c[a.CID?"updateSubmit":"addSubmit"](a)});return!t}return c.cancel()}function l(b){var c=this,d=c.rawConfig,e=c.curModule,f={contacts:L.isArray(b)?b:[b]};e&&e.isSort&&(f.order=[{field:e.sortType,desc:e.sortDesc}]);try{c.action.addContact({data:f,returnType:"all",call:function(b){c.submitLock=!1,a.Msgbox.msgbox.hide(),a.Tips.show({text:K.t("您已成功添加联系人"),succ:!0}),d.success&&d.success(b)},error:function(a){c.submitLock=!1,c.onError(K.t("添加失败"),a),d.fail&&d.fail(a)},extData:{contact:b}})}catch(g){}}function m(b){var c=this,d=c.rawConfig,e=c.curModule,f={contacts:L.isArray(b)?b:[b]};e&&e.isSort&&(f.order=[{field:e.sortType,desc:e.sortDesc}]);try{c.action.updateContact({data:f,returnType:"all",call:function(b){c.submitLock=!1,a.Msgbox.msgbox.hide(),a.Tips.show({text:K.t("您已成功编辑联系人"),succ:!0}),d.success&&d.success(b)},error:function(a){c.submitLock=!1,c.onError(K.t("修改失败"),a),d.error&&d.error(a)},extData:{contact:b}})}catch(g){}}function n(){var b=this,c=b.editField,d=a.Msgbox.msgbox;if(c){b.unfoldMore&&b.getEl().addClass("oL0");var e=b.getEl();e.find("#contact_edit_main").css({left:"0"}),e.find("#contact_edit_details").css({left:"100%"}).empty();var f=d.buttons;return f.ok.update({text:K.t("确 定")}),f.cancel.update({text:K.t("取 消")}),delete b.editField,!0}b.unfoldMore=!1,b.rawConfig.cancel&&b.rawConfig.cancel()}function o(){var a=this;L.each(a.components,function(a,b){b.length=0}),L.each(a.formatContact,function(a,b){b.length=0}),a.boolGroup=null}function p(b){function d(a){var b=0,c="";for(var d in a)c+=b++ +"-------"+d+"  :   "+a[d]+"\n"}function e(){var a=h.formatContact.date;P.each(m.date,function(b,c){var d=c.select,e=d.getValue(),i=O.trim(c.input[0].getValue()),j=O.trim(c.input[1].getValue()),k=O.trim(c.input[2].getValue()),m=a[b]||{},o=m.fullKey,p="";if(i||(i=1604),(j||k)&&(p=i+"-"+j+"-"+k),p){if(h.checkValue("date",p))return f(K.t("日期格式错误，请检查。"),c.input[0]),g(!1),v=!0,!1;if(o&&!u[o]){if(P.has(o.split("."),"BDAY;value=date"))n[o]=h.formatValue("BDAY",p);else{if(e!=m.fKey){var q=o.split(".")[0];n[q+".X-ABLabel"]&&(n[q+".X-ABLabel"]="_$!<"+e.substring(0,1).toUpperCase()+e.substring(1,e.length)+">!$_")}n[o]=h.formatValue("date",p)}u[o]=!0}else if("BDAY;value=date"==e){var r=h.formatValue("BDAY",p);r&&(n[e]=r)}else{var s=h.formatValue("date",p),t="item"+l++,w=t+".X-ABDATE";n[w]=s,n[t+".X-ABLabel"]=m.label?e===m.fKey||"other"===e&&"other"!==m.fKey?m.label:"_$!<"+e.substring(0,1).toUpperCase()+e.substring(1,e.length)+">!$_":"_$!<"+e.substring(0,1).toUpperCase()+e.substring(1,e.length)+">!$_"}}else o&&delete n[o]})}function f(b,c){a.Msgbox.msgbox.footer.html(b?a.Label.html({text:b,type:"err"}):"");try{c.select()}catch(d){}}function g(a){if(j){var b=j._toolbar.find("button");b[1].setDisabled(a)}}var h=this,i=h.rawConfig,j=h.inContactModule&&h.curModule?h.curModule:null,k=h.formatContact,l=h.formatContact.maxItem;l=L.isNumber(l)?l+1:1;var m=h.components,n={};if(i.cid){n=L.clone(G.data.extDataMap.contact[i.cid]);var o=h.delItems;for(var p in o)try{delete n[p]}catch(q){}}var r,s,t,u={},v=!1,w=O.trim(m.name[0].nickname||"");w=h.formatValue("NICKNAME",w),w?n.NICKNAME=w:n.NICKNAME&&delete n.NICKNAME;var x=m.MARKED[0].checkbox.getChecked();x?n.MARKED&&L.isNumber(+n.MARKED)||(n.MARKED=G.getMarkSort()):delete n.MARKED;var y=h.boolGroup;if(y){var z="";L.each(y,function(a,b){b&&(z+=";"+a)}),n.GROUPING=z.substring(1)}if(e(),v)return!1;var A=m.ZS[0].input;if(r=O.trim(A.getValue()),h.checkValue("zs",r))return f(K.t("备注超过500个中文或1000个英文字母的长度限制。"),A),g(!1),!1;r?n.ZS=h.formatValue("ZS",r):n.ZS&&delete n.ZS;var B,C="",D=[];if(P.each(R.contactArray,function(b,c){var d=c.toLowerCase(),e=!1,i=k[d.toLowerCase()];if("icq"===d)P.each(m.ICQ,function(a,b){var d=i[a]||{},e=d.fullKey,f=b.select.getValue(),g=O.trim(b.input.getValue());if(d.key)if(e&&!u[e])n[e]=g,u[e]=!0;else{var j;j=f===d.fKey?d.key:"IMPP;X-SERVICE-TYPE="+f;var k="item"+l++;j=k+"."+j,d.label&&(n[k+".X-ABLabel"]=d.label),d.label||!n[j]?n[j]=g:L.isString(n[j])?n[j]=[n[j],g]:n[j].push(g)}else g=h.formatValue(c,g),f="item"+l++ +".IMPP;X-SERVICE-TYPE="+f,n[f]?L.isString(n[f])?n[f]=[n[f],g]:n[f].push(g):n[f]=g,n[e]&&delete n[e]});else{var j=G.data.cache.addrCache;P.each(m[c],function(b,k){var m,o=i[b]||{},p=o.fullKey,q=k.select.getValue();if("fax"===d&&3===k.input.length){var r=O.trim(k.input[0].getValue());m=O.trim(k.input[1].getValue());var s=O.trim(k.input[2].getValue());r=r?r+"-":r,s=s?"-"+s:s,r&&s&&(m=m||" "),m=r+m+s}else m=O.trim(k.input.getValue());var t,w;if(m){var x;if(h.checkValue(c,m))return x=q.indexOf("EMAIL")>=0?K.t("请正确填写邮件地址。"):q.indexOf("ADR")>=0?K.t("请不要填写;等特殊字符"):K.t("输入不合法"),f(x,k.input),g(!1),v=!0,a.BREAK;if("mail"===d){if(C.indexOf(m)>=0)return x=K.t("Email地址重复"),f(x,k.input),g(!1),v=!0,a.BREAK;C+="@@"+m}if("tel"===d&&m.length>20)return f(K.t("手机/电话长度不能超过20个字符"),k.input),g(!1),v=!0,a.BREAK}if("adr"==d){t=k.value||";;;;;;";var y=t.split(";");if(w=G.parseADR(y),w===m)m=[y[5],y[4],y[3],y[2],y[1],y[6],y[0]].join(";");else if(";;;;;;"!=m){var z=j[m];z?(y[2]=z.city,y[3]=z.street,y[1]=z.province,y[4]="",y[0]=z.country,y[5]="",y[6]=z.zip,m=[y[5],y[4],y[3],y[2],y[1],y[6],y[0]].join(";")):m&&D.push(m)}}if(m=h.formatValue(c,m),e||"EMAIL;type=INTERNET"!==q&&"TEL;type=CELL;type=VOICE"!==q||(q+=";type=pref",e=!0),B||"mail"!==d||(B=m),p&&!u[p])e===!0?(delete n[p],n[q]=m,e="used"):n[p]=m,u[p]=!0;else{q===J.iaddrMap[o.fKey]&&(q=o.key);var A="item"+l++;q.indexOf("pref")<0&&(q=A+"."+q),o.label&&(n[A+".X-ABLabel"]=o.label,q.indexOf(A)<0&&(q=A+"."+q)),o.label||!n[q]?n[q]=m:L.isString(n[q])?n[q]=[n[q],m]:n[q].push(m)}})}return v?a.BREAK:void 0}),v)return!1;if(""===C)return f(K.t("请正确填写邮件地址。"),m.MAIL[0].input),g(!1),!1;var E=D.length;if(E>0){var F=0;return P.each(D,function(a,c){h.action.splitAddr({addr:c,call:N.bind(function(a){F++,F===a&&h.getContact(b)},null,E)})}),!1}P.each(R.otherArray,function(a,b){b.toLowerCase();var c=m[b][0].input;if(c){var d=O.trim(c.getValue());d=h.formatValue(b,d),d?"URL;type=pref"!=b&&(n[b]=d):"URL;type=pref"!=b&&n[b]&&delete n[b]}});var H=m["URL;type=pref"][0],I=H.input,M=O.trim(I.getValue());k.url||[];var Q="URL;type=pref",S=H.key;if(n[S||Q]=M,v)return!1;var T=m.name[0],U=T.input;if(r=O.trim(U.getValue()),h.checkValue("N",r))return f(K.t("请不要填写；特殊字符。"),U),g(!1),!1;s=a.String.escapeHTML(T.n)||";;;;",t=s.split(";");var V=G.parseN(s);if(r){var W=G.data.cache.nameCache;if(r!=V){var X=W[r];if(!X)return h.action.splitName({name:r,call:N.bind(h.getContact,h,b)}),!1;t[0]=X.last,t[1]=X.first,t[2]=X.middle,t[3]=X.prefix,t[4]=X.suffix,s=t.join(";")}}else r=B?B.substring(0,B.indexOf("@")):K.t("未命名");n.N=s,n.FN=r,d(n),d(G.data.extDataMap.contact[i.cid]);for(var p in n){var Y=n[p];(Y===c||null===Y||""===Y||";;;;;;"===Y&&a.Array.has(p.toLowerCase().split("."),function(a){return"adr"===a||0===a.indexOf("adr;")}))&&delete n[p]}return b&&b(n),!1}function q(b,c){try{switch(b){case"BDAY":case"date":case"anniversary":var d=O.escapeHTML(c).split("-"),e=new Date(d[0],d[1]-1,d[2]);if(e.setHours(12),e.getFullYear(),"anniversary"==b||"date"==b)return a.Date.format(e,"yyyy-MM-dd");var f=a.Date.format(e,"yyyyMMdd");return 8==f.length?f:"0"+f;case"ADR":if(c.indexOf(";")<0){var g=[c,"","","","","",""];return g.join(";")}default:return O.escapeHTML(c)}}catch(h){}return c}function r(c,d){var e,f=this,g=a(M.getTarget(d)),h=f.components;if("name"!==c&&"ADR"!==c)return!1;var i,j,f=this;if("name"===c){e=h.name[0];var k=G.data.cache.nameCache,l=e.n||"",m=e.nickname||"",n=l.split(";"),o=G.parseN(n),p=O.trim(e.input.getValue());if(o!==p){var q=k[p];if(!q)return f.action.splitName({name:p,call:function(){f.clickShowDetail(c,d)}}),void 0;n[0]=q.last,n[1]=q.first,n[2]=q.middle,n[3]=q.prefix,n[4]=q.suffix}j="contactDialogFirstName",i=['<div class="ph0 nui-scroll">','<div class="jK0">','<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogFront">'+K.t("前缀")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogFront",inputId:"input_contactDialogFront",width:"222px",value:n[3]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogFirstName">'+K.t("名字")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogFirstName",inputId:"input_contactDialogFirstName",width:"222px",value:n[1]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogMidName">'+K.t("中间名")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogMidName",inputId:"input_contactDialogMidName",width:"222px",value:n[2]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogFamilyName">'+K.t("姓氏")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogFamilyName",inputId:"input_contactDialogFamilyName",width:"222px",value:n[0]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogEnd">'+K.t("后缀")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogEnd",inputId:"input_contactDialogEnd",width:"222px",value:n[4]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogNickName">'+K.t("昵称")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogNickName",inputId:"input_contactDialogNickName",width:"222px",value:m||""}),"</dd>","</dl>","</div>","</div>"].join("")}else if("ADR"===c){var r=g.findParent("DL",!1,!0);f.detailIndex=f._getIndex(r),e=h.ADR[f.detailIndex];var s=G.data.cache.addrCache,t=e.value||";;;;;;",u=t.split(";"),v=O.trim(e.input.getValue()),w=O.trim(G.parseADR(u));if(w!==v){var q=s[v];if(!q)return f.action.splitAddr({addr:v,call:function(){f.clickShowDetail(c,d)}}),void 0;u[2]=q.city,u[3]=q.street,u[1]=q.province,u[4]="",u[0]=q.country,u[5]="",u[6]=q.zip}j="contactDialogStreet",i=['<div class="ph0">','<div class="jK0">','<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogStreet">'+K.t("街道地址")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogStreet",inputId:"input_contactDialogStreet",width:"222px",value:u[3]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogCode">'+K.t("邮编")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogCode",inputId:"input_contactDialogCode",width:"222px",value:u[6]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogCity">'+K.t("城市")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogCity",inputId:"input_contactDialogCity",width:"222px",value:u[2]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogProvince">'+K.t("省份或地区")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogProvince",inputId:"input_contactDialogProvince",width:"222px",value:u[1]||""}),"</dd>","</dl>",'<dl class="ou0">','<dt class="iX0"><label for="input_contactDialogCountry">'+K.t("国家或地区")+"</label></dt>",'<dd class="is0">',a.Input.html({id:"contactDialogCountry",inputId:"input_contactDialogCountry",width:"222px",value:u[0]||""}),"</dd>","</dl>","</div>","</div>"].join("")}var x=f.getEl();x.removeClass("oL0"),x.find("#contact_edit_main").css({left:"-100%"}),x.find("#contact_edit_details").html(i).css({left:"0"}),f.editField=c;var y=a.Msgbox.msgbox.buttons;return y.ok.update({text:K.t("保 存")}),y.cancel.update({text:K.t("取消并返回")}),a.Component.setEvents(),j&&b.setTimeout(function(){$C(j).select()},100),!1}function s(b,c){var d=this,e=a(M.getTarget(c)),f=e.findParent("DL",!1,!0),g=f.find("a.dl-remove-link"),h=d._getIndex(f);g.show(),d._addRow(f,b,h)}function t(b,c){var d=this,e=a(M.getTarget(c)),f=e.findParent("DL",!1,!0),g=f.findParent("DIV",!1,!0),h=d._getIndex(f),i=d.components[b],j=d.formatContact[b.toLowerCase()];if(1!==i.length)try{var k=j[h];k.fullKey&&(d.delItems[k.fullKey]=!0),j.splice(h,1),f.empty(),f.remove(),i.splice(h,1),1===i.length&&g.find("dl a.dl-remove-link").hide()}catch(l){}}function u(){function b(){this.hide(),w.show();try{var a=$C(n);a.setValue(""),a.focus()}catch(b){}}function c(){var b=$C(n),c=a.String.trim(b.getValue());c?(e(!0),G.addGroup({name:c,call:f,error:g})):(g(K.t("请输入分组名")),b.setValue(""),b.focus())}function d(){g(),w.hide(),$C(q).show()}function e(a){$C(o).setDisabled(a),$C(p).setDisabled(a)}function f(b){try{var c=b.returns[0];x.append(h(G.data.extDataMap.group[c],!0)),x.dom.parentNode.parentNode.scrollTop+=30,a.Component.setEvents(),j.inContactModule&&(a.Context.navAdded=!0,a.Nav.update(),a.Nav.getModule(j.curModule))}catch(e){}d()}function g(b){var c=!!b,b=c?b.content||b:b;y.html(c?a.Label.html({text:b,type:"err"}):""),y.dom.parentNode.parentNode.scrollTop+=20,e(!1)}function h(b,c){var d=b.CID,e=a.String.encodeHTML(b.N),f=new a.Checkbox({title:e,name:"group_item",value:d,text:'<span class="nui-fIBlock rM0" title="'+e+'">'+e+"</span>",checked:c});return m.push(f),sLiHtml='<li class="eZ0">'+f.html()+"</li>"}var i,j=this,k=G.data.rawDataArray.group,l=j.boolGroup,m=j.components.GROUP,n="contact_edit_group_ipt",o="contact_edit_group_add_bt_submit",p="contact_edit_group_add_bt_cancel",q="contact_edit_group_add_bt",r=[];m.length=0;for(var s=0,t=k.length;t>s;s++)i=k[s],r.push(h(i,!!l[i.CID]));var u=['<div class="iN0 nui-scroll">','<ul id="contact_edit_group_data_ul">',r.join(""),"</ul>",'<ul id="contact_edit_group_add_ul" style="display:none;">','<li class="eZ0">','<div class="cW0">',a.Input.html({id:n}),a.Button.html({id:o,text:K.t("保 存"),click:c}),a.Button.html({id:p,text:K.t("取 消"),click:d}),"</div>","</li>","</ul>",'<div id="contact_edit_group_err"></div>',a.Button.html({id:q,text:K.t("新建分组"),extcls:"dX0",click:b}),"</div>"].join("");a.Msgbox.msgbox.footer.html("");var v=j.getEl();v.removeClass("oL0"),v.find("#contact_edit_main").css({left:"-100%"}),v.find("#contact_edit_details").html(u).css({left:"0"});var w=a("#contact_edit_group_add_ul"),x=a("#contact_edit_group_data_ul"),y=a("#contact_edit_group_err");j.editField="group";var z=a.Msgbox.msgbox.buttons;z.ok.update({text:K.t("保 存")}),z.cancel.update({text:K.t("取消并返回")}),a.Component.setEvents()}function v(b){function c(b,c){var e="contact_edit_group_item_"+b;return['<div class="nui-fIBlock rM0" id="',e,'">',a.String.encodeHTML(c),"&nbsp",a.Link.html({title:K.t("去掉此分组"),cls:"nui-close",text:'<b class="js-component-icon nui-ico nui-ico-close">x</b>',click:function(){var c=a("#"+e);c.remove(),d.boolGroup[b]=!1}}),"</div>"].join("")}var d=this,e=G.data.extDataMap.group,f=[],g=d.boolGroup;b=b||[];var h=a.fly("#contact_edit_group").dom.childNodes,i=h[0],j=h[1];P.each(b,function(a,b){var d=e[b];f.push(c(b,d.N)),g[b]=!0}),f.length>0?(i.style.display="none",j.innerHTML=f.join("")+a.Link.html({text:K.t("修改"),extcls:"nui-txt-link contact-editor-group-link",click:N.bind(d.clickShowGroupEdit,d)}),j.style.display="",Q.setEvents()):(j.style.display="none",a(j).empty(),i.style.display="")}function w(){function b(b,f,g){var h;if(b){var i=c._getLast(e).input[0].getEl(),j=a(i.findParent("DL",!1,!0).dom);c._addRow(j,"date",e.length-1,g,f)}else if(h=e[0],h.input[0].getValue()){var i=c._getLast(e).input[0].getEl(),j=a(i.findParent("DL",!1,!0).dom);c._addRow(j,"date",e.length-1,g,f)}else{var k,l=0;"BDAY;value=date"!=f&&(L.each(d,function(b){return b===f?a.BREAK:(l++,void 0)}),l++),g.indexOf("-")>=0?k=g.split("-"):(7===g.length&&(g="0"+g),k=[g.substring(0,4)-0,g.substring(4,6),g.substring(6,8)]),1604!==k[0]-0&&h.input[0].setValue(k[0]),h.input[1].setValue(k[1]),h.input[2].setValue(k[2]),h.select.setSelected(l),l>0&&(c.bBDAY=!1)}}var c=this,d=a.ADDR_MEMORIAL_DAY,e=c.components.date,f=c.formatContact.date;if(1!=f.length||f[0].value){var g,h,i=f.length;P.each(f,function(a,c){c&&(g=J.iaddrMap[c.fKey]||"other",h=c.value,b(a,g,h,i))})}}function x(a){var b,c=this,d=c.components,e=R.singleArray;P.each(e,function(e,f){if("FN"===f){var g=a.N||"",h=g.split(";"),i=G.parseN(h);d.name[0].input.setValue(i||a.FN||"")}else if("N"===f||"NICKNAME"===f)d.name[0][f.toLowerCase()]=a[f];else if("MARKED"===f)a.MARKED&&d.MARKED[0].checkbox.setChecked(!0);else if(b=d[f][0],"URL;type=pref"===f){var j=c.formatContact.url,k=j[0],l=b.input;l.setValue(a[f]||k?k.value:""),k&&k.fullKey&&(b.key=k.fullKey)}else b.input.setValue(a[f]||"")})}function y(){var b=this,c=b.components,d=b.formatContact,e=R.contactArray;try{P.each(e,function(e,f){var g=f.toLowerCase(),h=d[g];c[f];var i;P.each(h,function(d,e){if(!e.bEmpty){var h=e.value,j=e.fKey,k=J.iaddrMap[j]||j;if(d){var l=("fax"===g?b._getLast(c[f]).input[0]:b._getLast(c[f]).input).getEl(),m=a(l.findParent("DL",!1,!0).doms[0]),n=m.find("a.dl-remove-link");n.show(),b._addRow(m,f,c[f].length-1,h,k,e.fullKey)}else{var o,p=0;i=c[f][0],o="icq"!==g?R[g+"Map"]:a.ADDR_IM_TITLE,L.each(o,function(b){return b===k?a.BREAK:(p++,void 0)});try{i.select.setSelected(p)}catch(q){i.select.setSelected(--p)}"adr"===g?(i.value=h,i.input.setValue(G.parseADR(h))):"fax"===g?3===i.input.length&&(aFax=J.formatFAX(h),i.input[0].setValue(aFax[0]),i.input[1].setValue(aFax[1]),i.input[2].setValue(aFax[2])):i.input.setValue(h),e.fullKey&&(i.key=e.fullKey)}}})})}catch(f){}}function z(b,c,d,e,f){var g=this;try{var h=g._getMulDlHtml(c,!0,!0,d,e,f);b.after(h),a.Component.setEvents()}catch(i){}}function A(a){var b,c=this,d=[];return P.each(a,function(a,e){b="iaddress_"+e+"_wrap";var f=c._getMulDlHtml(e,!0,!1,0);d.push('<div class="eH0" id="'+b+'">'+f+"</div>")}),d.join("")}function B(b,d,e,f,g,h){function i(b,c){var d,e={options:[],subclass:"simpleSelect",selectedchange:function(){j.call(o,this,b)}},f={};return"icq"===b?f=a.ADDR_IM_TITLE:"date"===b?(f=a.ADDR_MEMORIAL_DAY,e.options.push({text:K.t("生日"),value:"BDAY;value=date",disabled:o.bBDAY})):f=R[b+"Map"],L.each(f,function(a,b){d="uc"===a?K.t("新浪UC"):"other"===a?K.t("其他"):a,e.options.push({text:b.replace(/googletalk/i,"GTalk"),value:d,checked:c==a})
}),"date"===b&&(o.filled||o.newContact)&&(e.options[1].checked=o.bBDAY,o.bBDAY=!0),l=new a.Select(e)}function j(a,b){var c=this,d=a.getEl(),e=d.findParent("DL",!1,!0),f=c._getIndex(e),g=c.formatContact[b];g&&g[f]&&g[f].fullKey&&(c.delItems[g[f].fullKey]=!0,delete g[f].fullKey)}var k,l,m,n,o=this,p=b.toLowerCase(),q=g?!0:!1,r="",s="",t=o.components[b],u=J.keyMap[b],v=o.formatContact,w=[];if(d){if("date"===p){b="date";var x=[];g&&(x=g.split("-")),k=new a.Input({width:"50px",maxLength:4,value:x[0]||""}),s+=k.html(),s+=K.t("年")+"&nbsp;",w.push(k),k=new a.Input({width:"37px",maxLength:2,value:x[1]||""}),s+=k.html(),s+=K.t("月")+"&nbsp;",w.push(k),k=new a.Input({width:"37px",maxLength:2,value:x[2]||""}),s+=k.html(),s+=K.t("日")+"&nbsp;",w.push(k),l=i(p,h,f),r+=l.html(),u=K.t("纪念日")}else if(l=i(p,h,f),r=l.html(),"ADR"===b)w=new a.Input({width:"183px",value:L.isString(g)?G.parseADR(g):""}),s+=w.html(),s+=a.Link.html({text:K.t("详细"),title:K.t("编辑详细地址"),extcls:"nui-txt-link nui-txt-s12",click:N.bind(o.clickShowDetail,o,"ADR")}),m=L.isString(g)?g:";;;;;;";else if("FAX"===b){var y=J.formatFAX(g);P.each(y,function(b,c){k=new a.Input({width:1===b?"75px":"40px",value:c}),s+=k.html(),w.push(k),2>b&&(s+="-&nbsp;")})}else"ICQ"===b&&(u=K.t("聊天工具")),w=new a.Input({value:g||""}),s+=w.html();s+=a.Link.html({click:N.bind(o.clickAddIcon,o,b),title:K.t("添加一个")+(u||""),items:[{xtype:"icon",type:"add"}],extcls:"dl-add-link",hidden:!1}),s+="&nbsp;",s+=a.Link.html({click:N.bind(o.clickRemoveIcon,o,b),title:K.t("移除这个")+(u||""),items:[{xtype:"icon",type:"remove"}],extcls:"dl-remove-link",hidden:!e})}else n="input_"+a.String.encodeHTML(b),r+=u,w=new a.Input({inputId:n}),s+=w.html();return f=0===t.length?0:f+1,!q&&d&&v&&v[p].splice(f,0,{key:"",value:""}),t.splice(f,0,{input:w,select:l,value:"ADR"===b&&m?m:null}),o._getDlHtml(r,s,c,n)}function C(a,b,c,d){return d&&(a='<label for="'+d+'">'+a+"</label>"),['<dl class="ou0">','<dt class="iX0">',a,"</dt>",'<dd class="is0" ',c?'id="'+c+'"':"",">",b,"</dd>","</dl>"].join("")}function D(b){b instanceof a.Element&&(b=b.dom);for(var c=-1;b;)c++,b=b.previousSibling;return c}function E(a){return 0===a.length?null:a[a.length-1]}function F(b,c){var d;d={title:K.t("抱歉，")+(b||c.title||K.t("操作失败")),content:K.t("原因：")+c.content},$S("isVip")&&c.content===K.t("联系人分组个数超过上限")&&(d.content+=a.Link.html({text:K.t("升级分组上限"),cls:"nui-txt-link",bracket:!0,click:function(){a.Msgbox.msgbox&&a.Msgbox.msgbox.close();try{var b=$L("interface.OutlinkInterface",this)}catch(c){return c}b.goOutlink({url:a.Uri.getUrl("option_viptype"),key:"option_viptype"})}})),a.Msgbox.show(d),a.Component.setEvents()}try{var G=$L("support.AddressSupport")}catch(H){return H}try{var I=$L("support.AddressSupportAction")}catch(H){return H}try{var J=$L("util.Contact")}catch(H){return H}var K=new $I18N("component.contact.ContactEdit"),L=a.Object,M=a.Event,N=a.Function,O=a.String,P=a.Array,Q=a.getClass("netease.mail.component.Component"),R=a.createClass($N("component.contact.ContactEdit"));L.mix(R,Q,{xtype:"contactedit",_cssClass:{baseclass:{tpl:['<div class="tg0">','<div id="contact_edit_main" class="pc0 nui-scroll" style="left:0">','<div class="ph0">','<div id="contact_edit_main_normal" class="jK0">',"#{normalContent}","</div>",'<div class="qA0">','<b class="nui-ico nui-ico-rArr"></b>','<b class="nui-ico nui-ico-dArr" style="display: none;"></b>',' <span class="nui-txt-cLink">'+K.t("更多选项")+"</span>","</div>",'<div id="contact_edit_pinfo" class="jK0" style="display:none">',"#{moreInfo}","</div>","</div>","</div>",'<div id="contact_edit_details" class="pc0 nui-scroll" style="left:100%">',"#{detailContent}","</div>","</div>"].join("")}},_listeners:[{name:"render",handler:function(){var b=this.getEl(),c=b.find("#contact_edit_pinfo");M.live(b,"click","div.qA0",function(d,e){var f=this,g=a(e.currentTarget),h="oL0",i=g.find("b.nui-ico"),j=i.doms[0],k=i.doms[1];return"none"===j.style.display?(j.style.display="",k.style.display="none",g.css({borderBottomWidth:"0px"}),b.removeClass(h),c.hide(),f.unfoldMore=!1):(j.style.display="none",k.style.display="",g.css({borderBottomWidth:"1px"}),b.addClass(h),c.show(),f.unfoldMore=!0),!1})},type:"custom"}],show:d,otherArray:["URL;type=pref","ORGNAME","ORG","TITLE","ROLE","MEMBER"],singleArray:["URL;type=pref","ORGNAME","ORG","TITLE","ROLE","MEMBER","N","FN","NICKNAME","ZS","MARKED"],contactArray:["MAIL","TEL","FAX","ICQ","ADR"],mailMap:{"EMAIL;type=INTERNET":K.t("电子邮箱"),"EMAIL;type=INTERNET;type=HOME":K.t("家庭邮箱"),"EMAIL;type=INTERNET;type=WORK":K.t("工作邮箱")},telMap:{"TEL;type=CELL;type=VOICE":K.t("手机号码"),"TEL;type=VOICE":K.t("电话号码"),"TEL;type=HOME;type=VOICE":K.t("家庭电话"),"TEL;type=WORK;type=VOICE":K.t("办公电话")},faxMap:{"TEL;type=FAX":K.t("传真号码"),"TEL;type=HOME;type=FAX":K.t("家庭传真"),"TEL;type=WORK;type=FAX":K.t("办公传真")},adrMap:{ADR:K.t("居住地址"),"ADR;type=HOME":K.t("家庭地址"),"ADR;type=WORK;type=pref":K.t("工作地址")}},{initialize:e,_getData:f,getBaseHtml:g,getMoreInfoHtml:h,initData:i,checkValue:j,submit:k,addSubmit:l,updateSubmit:m,cancel:n,destroy:o,getContact:p,formatValue:q,clickShowDetail:r,clickAddIcon:s,clickRemoveIcon:t,clickShowGroupEdit:u,fillGroup:v,fillDate:w,fillSingle:x,fillMulti:y,_addRow:z,_getDivHtml:A,_getMulDlHtml:B,_getDlHtml:C,_getIndex:D,_getLast:E,onError:F,test:"hello world"})}($,window),function(a,b,c){function d(c){var d=a.Msgbox,e=new H(c),f=!1,g=d.show({header:y.t("添加星标联系人/联系组"),contentType:"wide",width:"480px",content:e.html(),isParentBox:!0,listeners:{render:function(){b.setTimeout(function(){var b=a("#markLeftTree");b.html(""),new a.Tree({extcls:"nui-simpleTree",isRoot:!0,items:e.getTree(),renderTo:a("#markLeftTree")}),b.destroy()},20),G.setEvents()},destroy:function(){e.destroy()}},ok:function(){if(f)return!0;f=!0;var b=e.selected,d=e.recommend,h=[];return D.each(b,function(a,b){h.push({cid:b.CID,ctype:"GROUP"===b["X-TYPE"]?"group":null})}),D.each(d,function(a,b){h.push(b)}),0===h.length?(a.Tips.show({text:y.t("未添加任何联系人和联系组至左侧栏"),type:"err"}),void 0):(v.markData({data:h,mark:!0,call:function(){f=!1,g.hide(),c.call&&c.call(e.format(b))},error:function(){f=!1,c.error&&c.error()}}),!0)}});c.noGotoContact||g.footer.html(new a.Link({text:y.t("去通讯录管理添加>")+">",extcls:"nui-txt-link",click:function(){g.hide();try{var a=$L("interface.AddressInterface",this)}catch(b){return b}a.entry({action:"marked"})}}).html())}function e(a){try{}catch(b){return b}var c=this;c.c2liMap={},c.r2liMap={},H.superClass.initialize.call(c,a),c.selected=[],c.recommend=[]}function f(b){function c(){var a=this,b=A.getEvent(),c=b.keyCode;27===c&&a.setValue("");var e=C.trim(a.getValue());if(e){var f=a.find("icon")[0];f.update({type:"close",title:y.t("取消")}),d.searchContact({key:e})}else d.searchCancel()}var d=this,e={},f=[],g=d.searchInput=new w({voiceInput:!0,iconBtn:"search",width:"129px",placeholder:y.t("搜索联系人"),iconbtnclick:function(){this.setValue(""),this.showPlaceholder(),this.iconBtn.update({type:"search"}),d.searchCancel()},keyup:c}),h=d.addBtn=new a.Button({subclass:"inputBtn",title:y.t("新建联系人"),text:'<b class="nui-ico nui-ico-plus"></b>',click:B.bind(d.addNewContact,d)});f.push(g.html()),f.push(h.html()),f.push('<div class="kr0 nui-scroll">'),f.push('<div class="contactmark-search"></div>'),f.push('<div class="contactmark-list" id="markLeftTree">'+y.t("加载中...")),f.push("</div></div>"),e.left=f.join(""),e.title=b.title||"";var i=d.removeAllLink=new a.Link({text:y.t("移除全部"),extcls:"nui-contacts-to-removeAll nui-txt-link",hidden:!0,click:function(){d.removeAll()}});return e.removeAll=i.html(),e}function g(){function b(){var b=a("#markLeftTree");b.empty(),b.html(x.html({extcls:"nui-simpleTree",isRoot:!0,items:c.getTree()})),a.Component.setEvents()}var c=this;t.show({hideMark:!0,success:function(a){var d=v.data.extDataMap.contact,e=d[a.returns[0]];c.choose(e),b()},cancel:function(){b()},close:function(){b()}})}function h(){var b=this,d=v.data.extDataMap.groupArray,e=v.data.extDataMap.contact,f=[];D.each(d,function(c,d){if("ALL"!==d.CID){var e=d.CONTACTS||[],g=[];if(D.each(e,function(c,d){if(d){var e=v.getGivenName(d)||"",f=v.getContactEmails(d)[0]||"";if(!f)return;!e&&f&&(e=f.split("@")[0]),g.push({text:a.String.left(e,24,!0),click:function(){b.choose(d),D.each((b.c2liMap[d.CID]||{}).div,function(a,b){b.addClass("nui-tree-item-label-disable")})},title:f||null,titleScale:"label",listeners:{render:function(){var c=b.c2liMap,e=this.getEl(),f=a(e.dom.firstChild);(d.MARKED||b.checkSelected(d))&&f.addClass("nui-tree-item-label-disable");var g=c[d.CID];g=g||{},g.div=g.div||[],g.div.push(f),c[d.CID]=g}}})}}),0!==g.length||"OTHERS"===d.CID){var h=g.length>0,i=d.N||y.t("未命名分组"),j={text:a.String.left(i,10,!0)+"("+g.length+")",title:i,items:g,isFold:!0,extItems:"OTHERS"===d.CID||"SYSTEM"===d["X-TYPE1"]?null:[{xtype:"link",text:y.t("添加组"),extcls:"nui-txt-link",title:h?y.t("添加后，可以方便查看与该组成员的往来邮件。"):y.t("该组无联系人，无法添加"),click:function(){if(h){b.choose(d,!0);var c=this,e=a(c).findParent("DIV",!1,!0);e&&e.addClass("nui-tree-item-label-disable"),c.className="nui-txt-link nui-txt-disabled"}}}],listeners:{render:function(){var c=b.c2liMap,e=a(this.getEl().dom.firstChild),f=a(this.getEl()).find("a.nui-txt-link");(d.MARKED||b.checkSelected(d)||!h)&&(e.addClass("nui-tree-item-label-disable"),f&&f.addClass("nui-txt-disabled")),c[d.CID]={div:[e],a:f}}}};f.push(j)}}});try{var g=v.getMarkData().recommend;if(g.length>0){var h=[];D.each(g,function(d,f){if(f){f.__CID=b._tmpId++;var g=f.name,i=f.email;i&&(!g&&i&&(g=i.split("@")[0]),h.push({text:a.String.left(g,24,!0),click:function(){if(f.cid==c){b.chooseRecommend(f);var d=a(this.getEl().dom.firstChild);d.addClass("nui-tree-item-label-disable");var g=b.r2liMap;return g[f.__CID]=d,void 0}var h=e[f.cid];h&&(b.choose(h),D.each((b.c2liMap[h.CID]||{}).div,function(a,b){b.addClass("nui-tree-item-label-disable")}))},title:i||null,titleScale:"label",listeners:{render:function(){if(f.cid!=c){var d=e[f.cid];if(d){var g=b.c2liMap,h=this.getEl(),i=a(h.dom.firstChild);(d.MARKED||b.checkSelected(d))&&i.addClass("nui-tree-item-label-disable");var j=g[d.CID];j=j||{},j.div=j.div||[],j.div.push(i),g[d.CID]=j}}}}}))}}),f.unshift({text:y.t("常用联系人"),title:y.t("常用联系人"),items:h,isFold:!0})}}catch(i){}return f}function i(){var b=this,c=b.getEl(),d=b.c2liMap;D.each(b.selected,function(a,b){var c=d[b.CID]||{};D.each(c.div,function(a,b){b.removeClass("nui-tree-item-label-disable")}),c.a&&c.a.removeClass("nui-txt-disabled")}),D.each(b.recommend.slice(0),function(a,c){b.removeRecommendSelected(c)}),b.selected.length=0,b.recommend.length=0,c.findFly("div.nB0 ul").empty(),b.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(b.selected.length+b.recommend.length)}function j(){var a=this;a.removeAllLink[a.selected.length+a.recommend.length>0?"show":"hide"]()}function k(b){function c(b){var c=b.contacts,e=d.c2liMap,f=d.getEl(),g=f.find("div.kr0 div.contactmark-search");if(g.empty(),c&&c.length)D.each(b.contacts,function(a,b){var c=E.create("A");c.addClass("nui-contacts-search-item"),c.attr({href:"javascript:void(0)",title:b.perAddress||b.contact["EMAIL;type=INTERNET;type=pref"]||""}),c.listen("click",function(){c.addClass("nui-tree-item-label-disable"),D.each((e[b.contact.CID]||{}).div,function(a,b){b.addClass("nui-tree-item-label-disable")}),d.choose(b.contact)});var f=E.create("STRONG");f.html("&quot;"+(b.name||b.contact.FN||y.t("未命名"))+"&quot;"),c.append(f.dom),c.append("&lt;"+(b.address||b.contact["EMAIL;type=INTERNET;type=pref"]||"")+"&gt;"),g.append(c.dom);var h=b.contact;(h.MARKED||d.checkSelected(h))&&c.addClass("nui-tree-item-label-disable");var i=e[h.CID];i=i||{},i.div=i.div||[],i.div.push(c),e[h.CID]=i});else{var h=E.create("DIV");h.addClass("nui-assistBlock nui-block nui-contacts-search-tit"),h.html(y.t("没有符合条件的联系人")+' [<a href="javascript:void(0)" class="back txt-link">'+y.t("返回")+"</a>]"),h.find("A").listen("click",function(b){d.searchCancel(),a.Event.cancel(b)}),g.append(h.dom)}}b=b||{};var d=this,e=v.simpleSearch(b);if(e.length?c({contacts:e}):c({contacts:null}),!d.isSearch){var f=d.getEl(),g=f.find("div.contactmark-list");g.hide();var h=f.find("div.contactmark-search");h.show(),d.isSearch=!0}}function l(){var a=this;if(a.isSearch){var b=a.searchInput,c=b.find("icon")[0];c.update({type:"search",title:y.t("查找")}),C.trim(b.getValue())&&(b.setValue(""),b.showPlaceholder()),a.clearSearch()}}function m(){var a=this,b=a.getEl();if(a.isSearch){var c=b.find("div.contactmark-search");c.hide(),c.empty();var d=b.find("div.contactmark-list");d.show(),a.isSearch=!1}}function n(b,c){var d=this;if((c||v.getContactEmails(b)[0]||b.address)&&!b.MARKED&&!d.checkSelected(b)){var e=d.getEl(),f=document.createElement("LI");f.className="hq0",f.title=c?b.N||y.t("未命名分组"):b.address||v.getContactEmails(b)||null;var g=document.createElement("A");g.className="ds0 nui-txt-link",g.href="javascript:void(0);",g.innerHTML=y.t("移除"),a.Event.listen(g,"click",function(){var a=g.parentNode;a.parentNode.removeChild(a),d.removeSelected(b)});var h=c?b.N||y.t("未命名分组"):b.defaultName||b.address||v.getGivenName(b)||v.getContactEmails(b),i=c?"nui-ico-stars nui-ico-stars-selected":"nui-ico-star nui-ico-star-selected";a.fly(f).append('<div class="eL1"><b class="nui-ico '+i+'"></b></div>'),a.fly(f).append('<p class="em0">'+a.String.escapeHTML(h)+"</p>"),a.fly(f).append(g),e.find("div.nB0 ul").append(f),d.selected.push(b),d.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(d.selected.length+d.recommend.length)}}function o(b){var c=this,d=!1;if(D.each(c.recommend,function(c,e){return e.name===b.name&&e.email===b.email&&e.emails===b.emails?(d=!0,a.BREAK):void 0}),!d){c.recommend.push(b);var e=c.getEl(),f=document.createElement("LI");f.className="hq0",f.title=b.name;var g=document.createElement("A");g.className="ds0 nui-txt-link",g.href="javascript:void(0);",g.innerHTML=y.t("移除"),a.Event.listen(g,"click",function(){var a=g.parentNode;a.parentNode.removeChild(a),c.removeRecommendSelected(b)}),a.fly(f).append('<div class="eL1"><b class="nui-ico nui-ico-star nui-ico-star-selected"></b></div>'),a.fly(f).append('<p class="em0">'+a.String.escapeHTML(b.name)+"</p>"),a.fly(f).append(g),e.find("div.nB0 ul").append(f),c.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(c.selected.length+c.recommend.length)}}function p(b){var c=this;c.checkSelected(b,!0),c.checkRemoveAllLink();var d=c.c2liMap[b.CID];d&&(D.each(d.div,function(a,b){b.removeClass("nui-tree-item-label-disable")}),d.a&&d.a.removeClass("nui-txt-disabled")),a.fly("#spnSelectContactSelectedNum").html(c.selected.length+c.recommend.length)}function q(b){var c=this,d=c.r2liMap[b.__CID];d&&d.removeClass("nui-tree-item-label-disable"),D.each(c.recommend,function(d,e){return e.name===b.name&&e.email===b.email&&e.emails===b.emails?(c.recommend.splice(d,1),a.BREAK):void 0}),a.fly("#spnSelectContactSelectedNum").html(c.selected.length+c.recommend.length),c.checkRemoveAllLink()}function r(b,c){var d=this,e=!1;return D.each(d.selected,function(f,g){return g.CID===b.CID?(c&&d.selected.splice(f,1),e=!0,a.BREAK):void 0}),e}function s(b){return D.each(b,function(c,d){return d.address?a.CONTINUE:(b[c]=new F(v.getContactEmails(d)[0],v.getGivenName(d)),void 0)}),b}try{var t=$L("component.contact.ContactEdit")}catch(u){return u}try{var v=$L("support.AddressSupport")}catch(u){return u}try{$L("support.AddressSupportAction")}catch(u){return u}try{var w=$L("component.Input")}catch(u){return u}try{var x=$L("component.Tree")}catch(u){return u}try{$L("util.Contact")}catch(u){return u}var y=new $I18N("component.contact.ContactMark"),z=a.Object,A=a.Event,B=a.Function,C=a.String,D=a.Array,E=a.Element,F=a.Email,G=a.getClass("netease.mail.component.Component"),H=a.createClass($N("component.contact.ContactMark"));z.mix(H,G,{xtype:"contactmark",_template:['<div class="sA1">','<div class="nT0">','<div class="iM0"></div>','<p class="iv0">'+y.t("添加星标联系人或联系组至左侧栏，可以很方便的查看他们的往来邮件哦")+"</p>","</div>",'<div class="pi0">','<b class="nui-ico nui-ico-next nW0"></b>','<div class="pS0">','<div class="nz0">'+y.t("所有联系人")+"</div>","#{left}","</div>",'<div class="ri0">','<div class="nz0">#{removeAll}'+y.t("你已选择 ")+'<span id="spnSelectContactSelectedNum">0</span>'+y.t(" 个联系人")+"</div>",'<div class="nB0 nui-scroll">',"<ul></ul>","</div>","</div>","</div>",'<div class="ub0 nui-txt-tips">'+y.t("小提示：添加联系组后，您可以在同个列表中查看该组成员的往来邮件")+"</div>","</div>"].join(""),_listeners:[{name:"render",handler:function(){var a=this,b=v.data,c=b.recentGroupId,d=(c?b.extDataMap.group[c]||{}:{}).CONTACTS;D.each(d,function(b,c){a.choose(c)})},type:"custom"},{name:"destroy",handler:function(){var a=this;delete a.c2liMap,delete a.r2liMap,a.selected.length=0,a.recommend.length=0},type:"custom"}],show:d},{initialize:e,_getData:f,addNewContact:g,_tmpId:1,getTree:h,removeAll:i,checkRemoveAllLink:j,searchContact:k,searchCancel:l,clearSearch:m,choose:n,chooseRecommend:o,removeSelected:p,removeRecommendSelected:q,checkSelected:r,format:s})}($,window),function(a,b){function c(a){var b=this;D.superClass.initialize.call(b,a),b.selected=[]}function d(b){function c(){var b=this,c=a.Event.getEvent(),e=c.keyCode;27===e&&b.setValue("");var f=x.trim(b.getValue());if(f){var g=b.find("icon")[0];g.update({type:"close",title:v.t("取消")}),d.searchContact({key:f})}else d.searchCancel()}var d=this,e={},f=[];f.push('<div class="nui-contacts-input">');var g=d.searchInput=new s({voiceInput:!0,iconBtn:"search",width:"147px",placeholder:v.t("搜索联系人"),iconbtnclick:function(){this.setValue(""),this.showPlaceholder(),this.iconBtn.update({type:"search"}),d.searchCancel()},keyup:c});f.push(g.html()),f.push("</div>"),f.push('<div class="nui-contacts-list nui-scroll" id="selectLeftTree">'+v.t("加载中...")),f.push("</div>"),f.push('<div class="nui-contacts-search nui-scroll" style="display:none"></div>'),e.left=f.join(""),e.title=b.title||v.t("收件人");var h=d.removeAllLink=new a.Link({text:v.t("移除全部"),extcls:"nui-contacts-to-removeAll nui-txt-link",hidden:!0,click:function(){d.removeAll()}});return e.removeAll=h.html(),e}function e(){var a=this;if(a.isSearch){var b=a.searchInput,c=b.find("icon")[0];c.update({type:"search",title:v.t("查找")}),x.trim(b.getValue())&&(b.setValue(""),b.showPlaceholder()),a.clearSearch()}}function f(){var a=this,b=a.getEl();if(a.isSearch){var c=b.find(".nui-contacts-search");c.hide(),c.empty();var d=b.find(".nui-contacts-list");d.show(),a.isSearch=!1}}function g(b){function c(b){var c=b.contacts,e=d.getEl(),f=e.find(".nui-contacts-search");if(f.empty(),c&&c.length)y.each(b.contacts,function(a,b){var c=A.create("A");c.addClass("nui-contacts-search-item"),c.attr({href:"javascript:void(0)",title:b.perAddress||b.contact["EMAIL;type=INTERNET;type=pref"]||""}),c.listen("click",function(){d.choose(b.contact)});var e=A.create("STRONG");e.html("&quot;"+(b.name||b.contact.FN||v.t("未命名"))+"&quot;"),c.append(e.dom),c.append("&lt;"+(b.address||b.contact["EMAIL;type=INTERNET;type=pref"]||"")+"&gt;"),f.append(c.dom)});else{var g=A.create("DIV");g.addClass("nui-assistBlock nui-block nui-contacts-search-tit"),g.html(v.t("没有符合条件的联系人")+' [<a href="javascript:void(0)" class="back txt-link">'+v.t("返回")+"</a>]"),g.find("A").listen("click",function(b){d.searchCancel(),a.Event.cancel(b)}),f.append(g.dom)}}b=b||{};var d=this,e=d.search(b);if(e.length?c({contacts:e}):c({contacts:null}),!d.isSearch){var f=d.getEl(),g=f.find(".nui-contacts-list");g.hide();var h=f.find(".nui-contacts-search");h.show(),d.isSearch=!0}}function h(a){var b=this,c=a.key||"",d=[],e=new RegExp("("+c+")","i"),f='<b class="nui-txt-mark">$1</b>';return y.each(b.rawConfig.data.rawDataArray.contact,function(a,c){var g=!1,h={id:c.CID,name:"",address:"",perAddress:"",contact:c},i=b.getContactEmails(c),j=i[0]||"";h.perAddress=j;var k=c.N,l=k.split(";"),m=c.FN||x.trim([l[3],l[0],l[1],l[4],l[2]].join(" "))||v.t("未命名");if(e.test(m)?(h.name=m.replace(e,f),g=!0):h.name=x.encodeHTML(m),e.test(j)?(h.address=j.replace(e,f),g=!0):h.address=j,!g){var n;for(var o in c)if("CID"!==o&&"GROUPING"!==o)if(n=c[o],"string"==typeof n){if(g=e.test(n))break}else if("array"==typeof n){for(var p=0,q=n.length;q>p&&!(g=e.test(n[p]));p++);if(g)break}}g&&d.push(h)}),d}function i(c){var d=new D(c);u.show({header:v.t("快速添加")+c.title,contentType:"normal",content:d.html(),listeners:{render:function(){b.setTimeout(function(){var b=a("#selectLeftTree");b.html(""),new a.Tree({extcls:"nui-simpleTree",isRoot:!0,items:d.getTree(),renderTo:b}),b.destroy()},20),C.setEvents()},destroy:function(){d.destroy()}},ok:function(){c&&c.callback&&c.callback(d.format(d.selected))},cancel:function(){c&&c.cancel&&c.cancel()}})}function j(b){var c=this,d=[];return y.each(b,function(b,e){if(e.address)return d.push(e),a.CONTINUE;for(var f=c.getContactEmails(e),g=c.getGivenName(e),h=0,i=f.length;i>h;h++)d.push(new B(f[h],g))}),d}function k(b){var c=this;if((c.getContactEmails(b)[0]||b.address)&&!c.checkSelected(b)){var d=c.getEl(),e=D.chooseDiv;e||(e=document.createElement("DIV"),e.className="nui-item",D.chooseDiv=e),e=e.cloneNode(!1),e.title=b.address||c.getContactEmails(b)||null;var f=D.chooseSpan;f||(f=document.createElement("SPAN"),f.className="nui-txt-link",f.style.cursor="pointer",D.chooseSpan=f),f=f.cloneNode(!1),f.innerHTML=v.t("移除"),a.Event.listen(f,"click",function(){var a=f.parentNode;a.parentNode.removeChild(a),c.removeSelected(b)});var g=b.defaultName||b.address||c.getGivenName(b)||c.getContactEmails(b);f.title=v.t("移除")+g,a.fly(e).append(f),a.fly(e).append('<span class="nui-contacts-selectedList-name">'+a.String.escapeHTML(g)+"</span>"),d.findFly(".nui-contacts-selectedList").append(e),c.selected.push(b),c.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(c.selected.length)}}function l(b){var c=this;c.checkSelected(b,!0),c.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(c.selected.length)}function m(){var a=this;a.selected.length>0?a.removeAllLink.show():a.removeAllLink.hide()}function n(){var b=this,c=b.getEl();b.selected=[],c.findFly(".nui-contacts-selectedList").empty(),b.checkRemoveAllLink(),a.fly("#spnSelectContactSelectedNum").html(b.selected.length)}function o(b,c){var d=this,e=!1;return y.each(d.selected,function(f,g){return g===b||b.CID&&g.CID==b.CID?(c&&d.selected.splice(f,1),e=!0,a.BREAK):void 0}),e}function p(){for(var b,c,d,e,f=this,g=f.rawConfig.data.extDataMap.groupArray,h=[],i=0,j=g.length,k=h;j>i;i+=1)if(b=g[i],"ALL"!==b.CID){c=b.CONTACTS||[],d={text:a.String.left(b.N||v.t("未命名分组"),16,!0),items:[],isFold:!0},e=d.items;for(var l,m,n,o,p=0,q=c.length;q>p;p+=1)if(l=c[p]){if(m=f.getGivenName(l)||"",o=f.getContactEmails(l),n=o[0]||"",!n)continue;m||n&&(m=n.split("@")[0]),e.push({text:a.String.left(m,22,!0),click:a.Function.bind(function(a){this.choose(a)},f,l),title:o.length>0?o.join(","):null,titleScale:"label"})}(0!==e.length||"OTHERS"===b.CID)&&(d.extItems=[{xtype:"link",text:"("+e.length+")",title:v.t("添加该组")+e.length+v.t("个联系人"),click:a.Function.bind(function(b){a.Event.cancel();var c=b.CONTACTS,d=this;y.each(c,function(a,b){d.choose(b)})},f,b)}],k.push(d))}return h}function q(a){var b=a.FN||"";return b}function r(a){var b,c,d,e=[];for(var f in a)d=a[f],f.indexOf("EMAIL")>=0&&d&&("string"==typeof d?c||f!==z?e.push(d):c=d:"function"==typeof d.pop&&(d=w.clone(d),c||f!==z||(c=d.shift()),e=e.concat(d)));return c&&e.unshift(c),b=e.join("@@").toLowerCase(),b.split("@@")}try{var s=$L("component.Input")}catch(t){return t}try{$L("component.Tree")}catch(t){return t}try{var u=$L("component.Msgbox")}catch(t){return t}var v=new $I18N("component.contact.SelectContact"),w=a.Object,x=a.String,y=a.Array,z=a.EMAIL_ADDRESS||b.EMAIL_ADDRESS,A=a.Element,B=a.Email||b.Email,C=a.getClass("netease.mail.component.Component"),D=a.createClass($N("component.contact.SelectContact"));w.mix(D,C,{_template:'<div class="nui-contacts nui-contacts-hasResult"><div class="nui-contacts-from"><div class="nui-contacts-listTitle">'+v.t("所有联系人")+'</div>#{left}</div><b class="nui-contacts-arr nui-ico nui-ico-next"></b><div class="nui-contacts-to"><div class="nui-contacts-listTitle">#{removeAll}#{title}(<span id="spnSelectContactSelectedNum">0</span>)</div><div class="nui-contacts-selectedList nui-scroll">#{right}</div></div></div>',_listeners:[{name:"render",handler:function(){var a=this,b=a.rawConfig;b.exist&&y.each(b.exist,function(b,c){a.choose(c)})},type:"custom"},{name:"destroy",handler:function(){this.removeAllLink.destroy(),this.removeAllLink=null,delete this.removeAllLink},type:"custom"}],xtype:"selectcontact",show:i},{selected:[],initialize:c,getTree:p,choose:k,removeSelected:l,removeAll:n,checkRemoveAllLink:m,getGivenName:q,getContactEmails:r,checkSelected:o,search:h,searchContact:g,searchCancel:e,clearSearch:f,format:j,_getData:d})}($,window),function(a,b,c){function d(){if(!f.inited){f.inited=!0;var a,b,d,e,g,h,i,j,k,l={a:0},m=["isindex","fieldset"],n=["input","button","select","textarea","label"],o=["a"].concat(n),p=["iframe"].concat(o),q=["hr","ul","menu","div","blockquote","noscript","table","center","address","dir","pre","h5","dl","h4","noframes","h6","ol","h1","h3","h2"],r=["ins","del","script","style"],s=["b","acronym","bdo","var","#","abbr","code","br","i","cite","kbd","u","strike","s","tt","strong","q","samp","em","dfn","span"].concat(r),t=["sub","img","embed","object","sup","basefont","map","applet","font","big","small"].concat(s),u=["p"].concat(t),v=["iframe"].concat(t).concat(n),w=["img","embed","noscript","br","kbd","center","button","basefont","h5","h4","samp","h6","ol","h1","h3","h2","form","font","#","select","menu","ins","abbr","label","code","table","script","cite","input","iframe","strong","textarea","noframes","big","small","span","hr","sub","bdo","var","div","object","sup","strike","dir","map","dl","applet","del","isindex","fieldset","ul","b","acronym","a","blockquote","i","u","s","tt","address","q","pre","p","em","dfn"],x=[l].concat(v),y=["tr"],z=["#"],A=["param"].concat(w),B=["form"].concat(m).concat(p).concat(q).concat(u),C=["li","ol","ul"],D=["style","script"],E=["base","link","meta","title"],F=E.concat(D),G=["head","body"],H=["html"],I=["address","blockquote","center","dir","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","isindex","menu","noframes","ol","p","pre","table","ul"],J=["area","base","basefont","br","col","command","dialog","embed","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"],K=[["nonBodyContent",H.concat(G).concat(E)],["block",I],["inline",x],["inlineWithA",["a"].concat(x)],["body",["script","style"].concat(I)],["cdata",["script","style"]],["empty",J],["nonChild",["iframe","textarea"]],["listItem",["dd","dt","li"]],["list",["ul","ol","dl"]],["isNotEmpty",["table","ul","ol","dl","iframe","area","base","col","hr","img","embed","input","link","meta","param","h1","h2","h3","h4","h5","h6"]],["removeEmpty",["a","abbr","acronym","address","b","bdo","big","cite","code","del","dfn","em","font","i","ins","label","kbd","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"]],["removeEmptyBlock",["p","div"]],["tableContent",["caption","col","colgroup","tbody","td","tfoot","th","thead","tr","table"]],["notTransContent",["pre","script","style","textarea"]],["html",G],["head",F],["style",z],["script",z],["body",B],["base",[]],["link",[]],["meta",[]],["title",z],["col",[]],["tr",["td","th"]],["img",[]],["embed",[]],["colgroup",["thead","col","tbody","tr","tfoot"]],["noscript",B],["td",B],["br",[]],["th",B],["center",B],["kbd",x],["button",u.concat(q)],["basefont",[]],["h5",x],["h4",x],["samp",x],["h6",x],["ol",C],["h1",x],["h3",x],["option",z],["h2",x],["form",m.concat(p).concat(q).concat(u)],["select",["optgroup","option"]],["font",x],["ins",x],["menu",C],["abbr",x],["label",x],["table",["thead","col","tbody","tr","colgroup","caption","tfoot"]],["code",x],["tfoot",y],["cite",x],["li",B],["input",[]],["iframe",B],["strong",x],["textarea",z],["noframes",B],["big",x],["small",x],["span",["#","br","b","strong","u","i","em","sub","sup","strike","span"]],["hr",x],["dt",x],["sub",x],["optgroup",["option"]],["param",[]],["bdo",x],["var",x],["div",B],["stationery",B],["object",A],["sup",x],["dd",B],["strike",x],["area",[]],["dir",C],["map",["area"].concat(m).concat(r).concat(q)],["applet",A],["dl",["dt","dd"]],["del",x],["isindex",[]],["fieldset",["legend"].concat(w)],["thead",y],["ul",C],["acronym",x],["b",x],["a",["a"].concat(v)],["blockquote",["td","tr","tbody","li"].concat(B)],["caption",x],["i",x],["u",x],["tbody",y],["s",x],["address",p.concat(u)],["tt",x],["legend",x],["q",x],["pre",s.concat(o)],["p",["a"].concat(x)],["em",x],["dfn",x]];for(a=0,d=K.length;d>a;a++){for(aMap=K[a],g=aMap[0],h=aMap[1],k={},b=0,e=h.length;e>b;b++)i=h[b],j=1,i===l&&(i="a",j=0),k[i]===c&&(k[i]=j,k[i.toUpperCase()]=j);h.length=0,f[g]=k,f[g.toUpperCase()]=k}K.length=0}}var e=a.Object,f=e.extend(a.createClass($N("component.editor.Dtd")),{init:d,inited:!1})}($,window),function(a,b,c){function d(){var a=navigator.userAgent.toLowerCase();return a.indexOf(" applewebkit/")>-1}function e(){var a=this;return"Gecko"===navigator.product&&!a.webkit()&&!ub.opera()}function f(a){if(!a)return{};a=tb.isArray(a)?a:a.split(",");for(var b,c={},d=0,e=a.length;e>d;d++)b=a[d],c[b]=c[b.toUpperCase()]=1;return c}function g(a){var b=this;if(!b.domStyleCache){var d=document.createElement("div").style;b.domStyleCache={"float":d.cssFloat!=c?"cssFloat":d.styleFloat!=c?"styleFloat":"float"}}var e=b.domStyleCache;return e[a]||(e[a]=a.toLowerCase().replace(/-./g,function(a){return a.charAt(1).toUpperCase()}))}function h(a,b){if(/color/i.test(a)&&/rgba?/.test(b)){var c=b.split(",");if(c.length>3)return"";b="#";for(var d=0,e=c.length;e>d;d++)sColor=c[d],sColor=parseInt(sColor.replace(/[^\d]/gi,""),10).toString(16),b+=1==sColor.length?"0"+sColor:sColor;b=b.toLowerCase()}return b}function i(a){if(!/(pt|cm)/.test(a))return a;var b;switch(a.replace(/([\d.]+)(\w+)/,function(c,d,e){a=d,b=e}),b){case"cm":a=25*parseFloat(a);break;case"pt":a=Math.round(96*parseFloat(a)/72)}return a+(a?"px":"")}function j(a){return vb.trim(a,!0)}function k(a,b,c){var d=-1;c=tb.isNumber(c)?c:0;for(var e=0,f=a.length;f>e;e++)if(e>=c&&a[e]===b){d=e;break}return d}function l(a,b,c){var d=this;return d.setAttributes(a.createElement(b),c)}function m(a,b){for(var c=a,d=0;c=c.previousSibling;)b&&3==c.nodeType?c.nodeType!=c.nextSibling.nodeType&&d++:d++;return d}function n(a,b,c){var d=this;if(a&&!d.isBody(a))for(a=c?a:a.parentNode;a;){if(!b||b(a)||d.isBody(a))return b&&!b(a)&&d.isBody(a)?null:a;a=a.parentNode}return null}function o(a,b,c,d){for(var e=this,f=b&&(c&&c(a)||!c)?[a]:[];a=e.findParent(a,c);)f.push(a);return d?f:f.reverse()}function p(a,b,c,d){var e=this;return b=e.listToMap(tb.isArray(b)?b:[b]),e.findParent(a,function(a){return b[a.tagName]&&!(d&&d(a))},c)}function q(a,b,c){var d=this,e=[];if(!tb.isFunction(b)){var f=b;b=function(a){return a.tagName?-1!=d.indexOf(tb.isArray(f)?f:f.split(" "),a.tagName.toLowerCase()):!1}}for(var g=0,h=a.length;h>g;g++)b(a[g])&&e.push(a[g]);return 0==e.length?null:1!=e.length&&c?e:e[0]}function r(a,b){var c,d=a.parentNode;if(d){if(b&&a.hasChildNodes())for(;c=a.firstChild;)d.insertBefore(c,a);d.removeChild(a)}return a}function t(a,b){var c=this;b=tb.isArray(b)?b:c.trim(b).replace(/[ ]{2,}/g," ").split(" ");for(var d,e=0,f=b.length;f>e;e++){switch(d=b[e],d=c.attrFix[d]||d){case"className":a[d]="";
break;case"style":if(a.style.cssText="",!ub.ie()){var g=a.getAttributeNode("style");if(g)try{a.removeAttribute(g)}catch(h){}}}a.removeAttribute(d)}}function u(a){for(var b=a.getElementsByTagName("*"),c=0,d=b.length;d>c;c++)b[c].removeAttribute("_moz_dirty");a.removeAttribute("_moz_dirty")}function v(a,b){if(a===b)return 0;for(var c=[a],d=[b],e=a;e=e.parentNode;){if(e===b)return 10;c.push(e)}for(e=b;e=e.parentNode;){if(e===a)return 20;d.push(e)}if(c.reverse(),d.reverse(),c[0]!==d[0])return 1;for(var f=-1;f++,c[f]===d[f];);for(a=c[f],b=d[f];a=a.nextSibling;)if(a===b)return 4;return 2}function w(a,b,c){function d(a,b,c){var d;if((d=c[a])&&!e.isBookmarkNode(d)&&1==d.nodeType&&e.isSameElement(c,d)){for(;d.firstChild;)"firstChild"===b?c.insertBefore(d.lastChild,c.firstChild):c.appendChild(d.firstChild);e.remove(d)}}var e=this;!b&&d("previousSibling","firstChild",a),!c&&d("nextSibling","lastChild",a)}function x(a,b,c){for(var d=this,e=d.getElementsByTagName(a,a.tagName.toLowerCase()),f=0,g=e.length;g>f;f++)if(oCi=e[f],oCi.parentNode&&!d.isBookmarkNode(oCi))if("span"!==oCi.tagName.toLowerCase())d.isSameElement(a,oCi)&&d.remove(oCi,!0);else{if(a===oCi.parentNode&&(d.trimWhiteTextNode(a),1==a.childNodes.length)){a.style.cssText=oCi.style.cssText+";"+a.style.cssText,d.remove(oCi,!0);continue}if(oCi.style.cssText=a.style.cssText+";"+oCi.style.cssText,c){var h=c.style;if(h){h=h.split(";");for(var i=0,j=h.length;j>i;i++)s=h[i],oCi.style[d.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1]}}d.isSameStyle(oCi,a)&&d.remove(oCi,!0)}}function y(a){for(var b=this,c=a.parentNode;c&&rb.removeEmpty[c.tagName];){if(c.tagName==a.tagName||"A"==c.tagName){if(b.trimWhiteTextNode(c),"SPAN"==c.tagName&&!b.isSameStyle(c,a)||"A"==c.tagName&&"SPAN"==a.tagName){if(c.childNodes.length>1||c!==a.parentNode){a.style.cssText=c.style.cssText+";"+a.style.cssText,c=c.parentNode;continue}c.style.cssText+=";"+a.style.cssText,"A"==c.tagName&&(c.style.textDecoration="underline")}if("A"!=c.tagName){c===a.parentNode&&b.remove(a,!0);break}}c=c.parentNode}}function z(a,b,c){function d(a,b){for(var c;a&&!e.isBookmarkNode(a)&&(e.isEmptyInlineElement(a)||!new RegExp("[^	\n\r"+e.fillChar+"]").test(a.nodeValue));)c=a[b],e.remove(a),a=c}var e=this;!b&&d(a.nextSibling,"nextSibling"),!c&&d(a.previousSibling,"previousSibling")}function A(a,b){if(a===b)return a;for(var c=[a],d=[b],e=a,f=-1;e=e.parentNode;){if(e===b)return e;c.push(e)}for(e=b;e=e.parentNode;){if(e===a)return e;d.push(e)}for(c.reverse(),d.reverse();f++,c[f]===d[f];);return 0==f?null:c[f-1]}function B(a,b,c){var d=this;if(c&&tb.isString(c)){var e=c;c=function(a){return d.hasClass(a,e)}}b=d.trim(b).replace(/[ ]{2,}/g," ").split(" ");for(var f=[],g=0,h=b.length;h>g;g++)for(var i=b[g],j=a.getElementsByTagName(i),k=0,l=j.length;l>k;k++)oCi=j[k],(!c||c(oCi))&&f.push(oCi);return f}function C(a,b){var c=this,d=a.ownerDocument;if(ub.ie()&&b==a.nodeValue.length){var e=d.createTextNode("");return c.insertAfter(a,e)}var f=a.splitText(b);if(ub.isIE(8)||ub.isIE(9)){var g=d.createTextNode("");c.insertAfter(f,g),c.remove(g)}return f}function D(a,b){return a.parentNode.insertBefore(b,a.nextSibling)}function E(a,b,c,d,e,f){var g,h=this,i=d&&a[b];for(i||(i=a[c]);!i&&(g=(g||a).parentNode);){if("body"===g.tagName.toLowerCase()||f&&!f(g))return null;i=g[c]}return i&&e&&!e(i)?h.getDomNode(i,b,c,!1,e):i}function F(a,b,c,d){var e=this;return e.getDomNode(a,"firstChild","nextSibling",b,c,d)}function G(a,b,c,d){return this.getDomNode(a,"lastChild","previousSibling",b,c,d)}function H(a){var b=a.ownerDocument||a;return b.defaultView||b.parentWindow}function I(a){for(var b,c={},d=/\s+(?:([\w\-:]+)|(?:([\w\-:]+)=([^\s"'<>]+))|(?:([\w\-:"]+)="([^"]*)")|(?:([\w\-:"]+)='([^']*)'))(?=(?:\s|\/|>)+)/g;b=d.exec(a);){var e=(b[1]||b[2]||b[4]||b[6]).toLowerCase(),f=(b[2]?b[3]:b[4]?b[5]:b[7])||"";c[e]=f}return c}function J(a,b){var c=this;return tb.each(b,function(b,d){switch(b){case"class":a.className=d;break;case"style":a.style.cssText=a.style.cssText+";"+d;break;case"innerHTML":a[b]=d;break;case"value":a.value=d;break;default:a.setAttribute(c.attrFix[b]||b,d)}}),a}function K(a,b,c){var d=this;a.style[d.cssStyleToDomStyle(b)]=c,d.trim(a.style.cssText)||d.removeAttributes(a,"style")}function L(a,b){var c=this;tb.each(b,function(b,d){c.setStyle(a,b,d)})}function M(a,b){var c=this;ub.ie()?("color"==b&&(b="(^|;)"+b),a.style.cssText=a.style.cssText.replace(new RegExp(b+"[^:]*:[^;]+;?","ig"),"")):a.style.removeProperty?a.style.removeProperty(b):a.style.removeAttribute(c.cssStyleToDomStyle(b)),a.style.cssText||c.removeAttributes(a,["style"])}function N(a,b){var c=this;if(tb.isRegExp(b))return b.test(a.className);b=c.trim(b).replace(/[ ]{2,}/g," ").split(" ");for(var d=a.className,e=0,f=b.length;f>e;e++){var g=b[e];if(!new RegExp("\\b"+g+"\\b","i").test(d))return!1}return e==b.length}function O(a){for(var b=0,c=0;a.offsetParent;)c+=a.offsetTop,b+=a.offsetLeft,a=a.offsetParent;return{x:b,y:c}}function P(a,b,c){function d(a){var b=a.document,c="CSS1Compat"==b.compatMode;return{width:(c?b.documentElement.clientWidth:b.body.clientWidth)||0,height:(c?b.documentElement.clientHeight:b.body.clientHeight)||0}}function e(a){if("pageXOffset"in a)return{x:a.pageXOffset||0,y:a.pageYOffset||0};var b=a.document;return{x:b.documentElement.scrollLeft||b.body.scrollLeft||0,y:b.documentElement.scrollTop||b.body.scrollTop||0}}var f=d(b).height,g=-1*f+(c||0);g+=a.offsetHeight||0;var h=yb.getXY(a);g+=h.y;var i=e(b).y;(g>i||i-f>g)&&b.scrollTo(0,g+(0>g?-20:20))}function Q(a,b){var c,d,e,f=this,g=a,h=a;do{for(g=g.parentNode,c?(e=g.cloneNode(!1),e.appendChild(c),c=e,e=g.cloneNode(!1),e.appendChild(d),d=e):(c=g.cloneNode(!1),d=c.cloneNode(!1));e=h.previousSibling;)c.insertBefore(e,c.firstChild);for(;e=h.nextSibling;)d.appendChild(e);h=g}while(b!==g);return e=b.parentNode,e.insertBefore(c,b),e.insertBefore(d,b),e.insertBefore(a,d),f.remove(b),a}function R(a){function b(b){for(var d;(d=a[b])&&3==d.nodeType&&c.isWhitespace(d);)a.removeChild(d)}var c=this;b("firstChild"),b("lastChild")}function S(a,b){var c=0,d=a.firstChild;for(b=b||function(){return 1};d;)b(d)&&c++,d=d.nextSibling;return c}function T(a,b,c){for(;a.firstChild;)c&&b.firstChild?b.insertBefore(a.lastChild,b.firstChild):b.appendChild(a.firstChild)}function U(a,b){var c=ub.ie()?a.createTextNode(yb.fillChar):a.createElement("BR");b.innerHTML="",b.appendChild(c)}function V(a,b){var c=this,d=a.style[c.cssStyleToDomStyle(b)];return c.fixColor(b,d)}function W(a,c){var d=this,e="width height top left";if(e.indexOf(c)>-1)return a["offset"+c.replace(/^\w/,function(a){return a.toUpperCase()})]+"px";if(3==a.nodeType&&(a=a.parentNode),ub.ie()&&ub.isIE("<9")&&"font-size"==c&&!a.style.fontSize&&!rb.empty[a.tagName]&&!rb.nonChild[a.tagName]){var f=a.ownerDocument.createElement("span");f.style.cssText="padding:0;border:0;font-family:simsun;",f.innerHTML=".",a.appendChild(f);var g=f.offsetHeight;return a.removeChild(f),f=null,g+"px"}try{var h=d.getStyle(a,c)||(b.getComputedStyle?d.getWindow(a).getComputedStyle(a,"").getPropertyValue(c):(a.currentStyle||a.style)[d.cssStyleToDomStyle(c)])}catch(i){return""}return d.transUnitToPx(d.fixColor(c,h))}function X(a,b){var c=this;return 10===c.getPosition(a,b)}function Y(a){return a&&1==a.nodeType&&"body"===a.tagName.toLowerCase()}function Z(a,b){var c=this;return 3==a.nodeType&&0===a.nodeValue.replace(new RegExp((b?"^":"")+c.fillChar),"").length}function $(a){var b=this;if(1!=a.nodeType||!rb.removeEmpty[a.tagName])return 0;for(a=a.firstChild;a;){if(b.isBookmarkNode(a))return 0;if(1==a.nodeType&&!b.isEmptyInlineElement(a)||3==a.nodeType&&!b.isWhitespace(a))return 0;a=a.nextSibling}return 1}function _(a){var b=this;return!a.firstChild||0==b.getChildCount(a,function(a){return!b.isBr(a)&&!b.isBookmarkNode(a)&&!b.isWhitespace(a)})}function ab(a){var b=this;return!new RegExp("[^ 	\n\r"+b.fillChar+"]").test(a.nodeValue)}function bb(a){return 1==a.nodeType&&a.id&&/^_webmail_bookmark_/i.test(a.id)}function cb(a){return 1==a.nodeType&&"BR"==a.tagName}function db(a){var b=this;return 1==a.nodeType&&(rb.block[a.tagName]||b.styleBlock[b.getComputedStyle(a,"display")])&&!rb.nonChild[a.tagName]}function eb(a,b){return 1==a.nodeType&&new RegExp("^"+a.tagName+"$","i").test(b)}function fb(a,b){var c=this;if(a.tagName!=b.tagName)return!1;var d=a.attributes,e=b.attributes;if(!ub.ie()&&d.length!==e.length)return!1;for(var f,g,h=0,i=0,j=0;f=d[j++];){if("style"==f.nodeName){if(f.specified&&h++,c.isSameStyle(a,b))continue;return!1}if(ub.ie()){if(!f.specified)continue;h++,g=e.getNamedItem(f.nodeName)}else g=b.attributes[f.nodeName];if(!g.specified||f.nodeValue!=g.nodeValue)return!1}if(ub.ie()){for(j=0;g=e[j++];)g.specified&&i++;if(h!=i)return!1}return!0}function gb(a,b){var c=a.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),d=b.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(ub.opera()){if(c=a.style,d=b.style,c.length!=d.length)return!1;for(var e in c)if(!/^(\d+|csstext)$/i.test(e)&&c[e]!=d[e])return!1;return!0}if(!c||!d)return c==d;if(c=c.split(";"),d=d.split(";"),c.length!=d.length)return!1;for(var f,g=0;f=c[g++];)if(-1==wb.indexOf(d,f))return!1;return!0}function hb(a,b){for(var c,d=this;!d.isBody(a);)if(c=a,a=a.parentNode,c!==a[b])return!1;return!0}function ib(a,b){var c=a.startContainer;if(3==c.nodeType&&a.startOffset!=c.nodeValue.length)return 0;if(1==c.nodeType&&a.startOffset!=c.childNodes.length)return 0;for(;c!==b;){if(c.nextSibling)return 0;c=c.parentNode}return 1}function jb(a){return a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /gi,"&nbsp;").replace(/\"/g,"&quot;").replace(/\n/gi,"<br>")}function kb(a,b){return a=a.replace(/\n/gi,""),a=a.replace(/\\s+/gi,""),b||(a=a.replace(/<\/(address|blockquote|center|dir|div|dl|fieldset|form|hr|h[1-6]|isindex|iframe|menu|ol|p|pre|table|ul)>/gi,"\n"),a=a.replace(/<br>/gi,"\n")),a=a.replace(/<li>/gi," . ").replace(/<[^>]+>/g,"").replace(/&nbsp;/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"').replace(/&amp;/gi,"&")}function lb(a,b){var c="";return function(a){if(b&&3!=a.nodeType&&("BR"==a.tagName||rb.block[a.tagName])&&(c+="\n"),3==a.nodeType)c+=a.nodeValue;else if(a.childNodes)for(var d=a.childNodes,e=0;e<d.length;e++)arguments.callee.call(null,d[e])}(a),c=c.replace(yb.fillCharReg,""),b?c:c.replace(/\n/g,"")}function mb(a){if(!a)return"";a=a.replace(/[\ud800-\udfff\ufffe\uffff]/g,"");var b=this,c=b.forbidden,d=c.tag||{},e=c.attr||{},f=/(\s*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>(\s*)/g,g=a.replace(f,function(a,c,f,g,h,i,j){if(c=c||"",f=f||"",g=g.toLowerCase(),h=h||"",i=i?" "+i:"",j=j||"",d[g])return"";if(""===i&&rb.empty[g]&&(i=" /"),""!==h){var k=b.getAttrList(a);tb.each(e,function(a){a in k&&delete k[a]}),h="",tb.each(k,function(a,b){h+=" "+a+'="'+b+'"'})}return c+"<"+f+g+h+i+">"+j});return g}function nb(a,b){return a?a.replace(b||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(a,b){return b?a:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}):""}function ob(a){return a.keyCode===yb.KEY_DELETE[0]||a.code===yb.KEY_DELETE[1]}function pb(a,b,c){var d,e,f,g,h=0;c||(c={});var i=function(){h=c.leading===!1?0:(new Date).getTime(),d=null,g=a.apply(e,f),d||(e=f=null)},j=function(){var j=(new Date).getTime();h||c.leading!==!1||(h=j);var k=b-(j-h);if(e=this,f=arguments,c.copyEvent&&"mousemove"===f[0].type){var l={};for(var m in f[0])l[m]=f[0][m];f[0]=l}return 0>=k||k>b?(d&&(clearTimeout(d),d=null),h=j,g=a.apply(e,f),d||(e=f=null)):d||c.trailing===!1||(d=setTimeout(i,k)),g};return j.cancel=function(){clearTimeout(d),h=0,d=e=f=null},j}function qb(a,b){var c;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}try{var rb=$L("component.editor.Dtd")}catch(sb){return sb}var tb=a.Object,ub=a.Browser,vb=a.String,wb=a.Array,xb={forbidden:{tag:{listing:1},attr:{xmlns:1}},NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,KEY_DELETE:[46,"Delete"],webkit:d,gecko:e,listToMap:f,cssStyleToDomStyle:g,fixColor:h,transUnitToPx:i,trim:j,indexOf:k,createElement:l,getNodeIndex:m,findParent:n,findParents:o,findParentByTagName:p,filterNodeList:q,remove:r,removeAttributes:t,removeDirtyAttr:u,getPosition:v,mergeSibling:w,mergeChild:x,mergeToParent:y,clearEmptySibling:z,getCommonAncestor:A,getElementsByTagName:B,split:C,insertAfter:D,getDomNode:E,getNextDomNode:F,getPreDomNode:G,getWindow:H,getAttrList:I,setAttributes:J,setStyle:K,setStyles:L,removeStyle:M,hasClass:N,getXY:O,scrollToView:P,breakParent:Q,trimWhiteTextNode:R,getChildCount:S,moveChild:T,fillNode:U,getStyle:V,getComputedStyle:W,inDoc:X,isBody:Y,isFillChar:Z,isEmptyInlineElement:$,isEmptyNode:_,isWhitespace:ab,isBookmarkNode:bb,isBr:cb,isBlockElm:db,isTagNode:eb,isSameElement:fb,isSameStyle:gb,isBoundaryNode:hb,isInNodeEndBoundary:ib,textToHtml:jb,htmlToText:kb,getDomText:lb,filterHtml:mb,unhtml:nb,fillChar:ub.isIE(6)?"﻿":"​",isDelete:ob,decounce:qb,debounce:qb,throttle:pb},yb=tb.extend(a.createClass($N("component.editor.Util")),xb);yb.fillCharReg=new RegExp(yb.fillChar,"g"),yb.styleBlock=yb.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),yb.attrFix=ub.isIE("<9")?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"}}($,window),function(a,b){function c(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer===a.endContainer&&a.startOffset==a.endOffset}function d(a){return!a.collapsed&&1==a.startContainer.nodeType&&a.startContainer===a.endContainer&&1==a.endOffset-a.startOffset}function e(a,b,c,d){var e=this;return 1==b.nodeType&&(W.empty[b.tagName]||W.nonChild[b.tagName])&&(c=Y.getNodeIndex(b)+(a?0:1),b=b.parentNode),a?(d.startContainer=b,d.startOffset=c,d.endContainer||d.collapse(!0)):(d.endContainer=b,d.endOffset=c,d.startContainer||d.collapse(!1)),e.updateCollapse(d),d}function f(a,b){var c,d,e=a.startContainer,f=a.endContainer,g=a.startOffset,h=a.endOffset,i=a.document,j=i.createDocumentFragment();if(1==e.nodeType&&(e=e.childNodes[g]||(c=e.appendChild(i.createTextNode("")))),1==f.nodeType&&(f=f.childNodes[h]||(d=f.appendChild(i.createTextNode("")))),e===f&&3==e.nodeType)return j.appendChild(i.createTextNode(e.substringData(g,h-g))),b&&(e.deleteData(g,h-g),a.collapse(!0)),j;for(var k,l,m,n,o=j,p=Y.findParents(e,!0),q=Y.findParents(f,!0),r=0;p[r]==q[r];)r++;for(var s=r;m=p[s];s++){for(k=m.nextSibling,m==e?c||(3==a.startContainer.nodeType?(o.appendChild(i.createTextNode(e.nodeValue.slice(g))),b&&e.deleteData(g,e.nodeValue.length-g)):o.appendChild(b?e:e.cloneNode(!0))):(l=m.cloneNode(!1),o.appendChild(l));k&&k!==f&&k!==q[s];)m=k.nextSibling,o.appendChild(b?k:k.cloneNode(!0)),k=m;o=l}o=j,p[r]||(o.appendChild(p[r-1].cloneNode(!1)),o=o.firstChild);for(var s=r;n=q[s];s++){if(k=n.previousSibling,n==f?d||3!=a.endContainer.nodeType||(o.appendChild(i.createTextNode(f.substringData(0,h))),b&&f.deleteData(0,h)):(l=n.cloneNode(!1),o.appendChild(l)),s!=r||!p[r])for(;k&&k!==e;)n=k.previousSibling,o.insertBefore(b?k:k.cloneNode(!0),o.firstChild),k=n;o=l}return b&&a.setStartBefore(q[r]?p[r]?q[r]:p[r-1]:q[r-1]).collapse(!0),c&&Y.remove(c),d&&Y.remove(d),j}function g(a,b){try{if(Z&&Y.inDoc(Z,a))if(Z.nodeValue.replace(bb,"").length)Z.nodeValue=Z.nodeValue.replace(bb,"");else{var c=Z.parentNode;for(Y.remove(Z);c&&Y.isEmptyInlineElement(c)&&!ab.inside(b,c);)Z=c.parentNode,Y.remove(c),c=Z}}catch(d){}}function h(a,b){var c;for(a=a[b];a&&Y.isFillChar(a);)c=a[b],Y.remove(a),a=c}function i(a){var b=this;b.startContainer=b.startOffset=b.endContainer=b.endOffset=null,b.document=a,b.collapsed=!0,b.spanCache=a.createElement("SPAN")}function j(){var a=this;return a.collapsed?null:cb.execContentsAction(a,0)}function k(){var a,b=this;return b.collapsed||cb.execContentsAction(b,1),_.ie()||(a=b.startContainer,3!=a.nodeType||a.nodeValue.length||(b.setStartBefore(a).collapse(!0),Y.remove(a))),b}function l(){var a=this;return a.collapsed?null:cb.execContentsAction(a,2)}function m(a,b){var c=this;return cb.setEndPoint(!0,a,b,c)}function n(a,b){var c=this;return cb.setEndPoint(!1,a,b,c)}function o(a){var b=this;return b.setStart(a.parentNode,Y.getNodeIndex(a)+1)}function p(a){var b=this;return b.setStart(a.parentNode,Y.getNodeIndex(a))}function q(a){var b=this;return b.setEnd(a.parentNode,Y.getNodeIndex(a)+1)}function r(a){var b=this;return b.setEnd(a.parentNode,Y.getNodeIndex(a))}function s(a){var b=this;return b.setStart(a,0)}function t(a){var b=this;return b.setStart(a,3==a.nodeType?a.nodeValue.length:a.childNodes.length)}function u(a){var b=this;return b.setEnd(a,0)}function v(a){var b=this;return b.setEnd(a,3==a.nodeType?a.nodeValue.length:a.childNodes.length)}function w(a){var b=this;return b.setStartBefore(a).setEndAfter(a)}function x(a){var b=this;return b.setStart(a,0).setEndAtLast(a)}function y(){var a=this;return new cb(a.document).setStart(a.startContainer,a.startOffset).setEnd(a.endContainer,a.endOffset)}function z(a){var b=this;return a?(b.endContainer=b.startContainer,b.endOffset=b.startOffset):(b.startContainer=b.endContainer,b.startOffset=b.endOffset),b.collapsed=!0,b}function A(a){function b(a){return 1==a.nodeType&&!Y.isBookmarkNode(a)&&!W.empty[a.tagName]&&!W.nonChild[a.tagName]}for(var c,d=this,e=d.collapsed;1==d.startContainer.nodeType&&(c=d.startContainer.childNodes[d.startOffset])&&b(c);)d.setStart(c,0);if(e)return d.collapse(!0);if(!a)for(;1==d.endContainer.nodeType&&d.endOffset>0&&(c=d.endContainer.childNodes[d.endOffset-1])&&b(c);)d.setEnd(c,c.childNodes.length);return d}function B(a){for(;!Y.isBlockElm(this.startContainer);)this.setStartBefore(this.startContainer);if(!a)for(;!Y.isBlockElm(this.endContainer);)this.setEndAfter(this.endContainer);return this}function C(a,b){var c=this,d=c.startContainer,e=c.endContainer;return d===e?a&&cb.selectOneNode(c)&&(d=d.childNodes[c.startOffset],1==d.nodeType)?d:b&&3==d.nodeType?d.parentNode:d:Y.getCommonAncestor(d,e)}function D(a){var b=this;b.txtToElmBoundary();var c=b.startContainer,d=b.startOffset,e=b.collapsed,f=b.endContainer;if(3==c.nodeType){if(0==d)b.setStartBefore(c);else if(d>=c.nodeValue.length)b.setStartAfter(c);else{var g=Y.split(c,d);c===f?b.setEnd(g,b.endOffset-d):c.parentNode===f&&(b.endOffset+=1),b.setStartBefore(g)}if(e)return b.collapse(!0)}return a||(d=b.endOffset,f=b.endContainer,3==f.nodeType&&(0==d?b.setEndBefore(f):(d<f.nodeValue.length&&Y.split(f,d),b.setEndAfter(f)))),b}function E(a){function b(a,b){var c=a[b+"Container"],d=a[b+"Offset"];3==c.nodeType&&(d?d>=c.nodeValue.length&&a["set"+b.replace(/(\w)/,function(a){return a.toUpperCase()})+"After"](c):a["set"+b.replace(/(\w)/,function(a){return a.toUpperCase()})+"Before"](c))}var c=this;return(a||!c.collapsed)&&(b(c,"start"),b(c,"end")),c}function F(a){var b=this,c=a,d=1;11==a.nodeType&&(c=a.firstChild,d=a.childNodes.length),b.trimBoundary(!0);var e=b.startContainer,f=b.startOffset,g=e.childNodes[f];return g?e.insertBefore(a,g):e.appendChild(a),c.parentNode===b.endContainer&&(b.endOffset=b.endOffset+d),b.setStartBefore(c)}function G(a,b){var c=this;return c.collapse(!a).select(b)}function H(a,b){var c,d=this,e=d.spanCache.cloneNode(!1);return cb.ieLess9||(e.style.display="none"),e.appendChild(d.document.createTextNode("‍")),e.id="_webmail_bookmark_start_"+(b?"":cb.guid++),d.collapsed||(c=e.cloneNode(!0),c.id="_webmail_bookmark_end_"+(b?"":cb.guid++)),d.insertNode(e),c&&d.collapse().insertNode(c).setEndBefore(c),d.setStartAfter(e),{start:a?e.id:e,end:c?a?c.id:c:null,id:a}}function I(a){if(!a)return b;var b=this,c=a.id?b.document.getElementById(a.start):a.start,d=a.end&&a.id?b.document.getElementById(a.end):a.end;return b.setStartBefore(c),Y.remove(c),d?(b.setEndBefore(d),Y.remove(d)):b.collapse(!0),b}function J(a,b){var c,d,e=this,f=e.document.createTextNode("");if(a){for(d=e.startContainer,1==d.nodeType?d.childNodes[e.startOffset]?c=d=d.childNodes[e.startOffset]:(d.appendChild(f),c=d=f):c=d;;){if(Y.isBlockElm(d)){for(d=c;(c=d.previousSibling)&&!Y.isBlockElm(c);)d=c;e.setStartBefore(d);break}c=d,d=d.parentNode}for(d=e.endContainer,1==d.nodeType?((c=d.childNodes[e.endOffset])?d.insertBefore(f,c):d.appendChild(f),c=d=f):c=d;;){if(Y.isBlockElm(d)){for(d=c;(c=d.nextSibling)&&!Y.isBlockElm(c);)d=c;e.setEndAfter(d);break}c=d,d=d.parentNode}f.parentNode===e.endContainer&&e.endOffset--,Y.remove(f)}if(!e.collapsed){for(;!(0!=e.startOffset||b&&b(e.startContainer)||Y.isBody(e.startContainer));)e.setStartBefore(e.startContainer);for(;!(e.endOffset!=(1==e.endContainer.nodeType?e.endContainer.childNodes.length:e.endContainer.nodeValue.length)||b&&b(e.endContainer)||Y.isBody(e.endContainer));)e.setEndAfter(e.endContainer)}return e}function K(){var a=this;if(!a.collapsed){for(;!Y.isBody(a.startContainer)&&a.startOffset==a.startContainer[3==a.startContainer.nodeType?"nodeValue":"childNodes"].length&&a.startContainer[3==a.startContainer.nodeType?"nodeValue":"childNodes"].length;)a.setStartAfter(a.startContainer);for(;!Y.isBody(a.endContainer)&&!a.endOffset&&a.endContainer[3==a.endContainer.nodeType?"nodeValue":"childNodes"].length;)a.setEndBefore(a.endContainer)}return a}function L(a,b,c){var d=this;if(d.collapsed)return d;d.trimBoundary().enlarge(!1,function(a){return 1==a.nodeType&&Y.isBlockElm(a)}).adjustmentBoundary();for(var e,f,g=d.createBookmark(),h=g.end,i=function(a){return 1==a.nodeType?"br"!=a.tagName.toLowerCase():!Y.isWhitespace(a)},j=Y.getNextDomNode(g.start,!1,i),k=d.cloneRange();j&&4&Y.getPosition(j,h);)if(3==j.nodeType||W[a][j.tagName]){for(k.setStartBefore(j),f=j;f&&(3==f.nodeType||W[a][f.tagName])&&f!==h;)e=f,f=Y.getNextDomNode(f,1==f.nodeType,null,function(b){return W[a][b.tagName]});var l,m=k.setEndAfter(e).extractContents();if(c&&c.length>0){var n,o;o=n=c[0].cloneNode(!1);for(var p,q=1;p=c[q++];)n.appendChild(p.cloneNode(!1)),n=n.firstChild;l=n}else l=k.document.createElement(a);b&&Y.setAttributes(l,b),l.appendChild(m),k.insertNode(c?o:l);var r;if("span"==a&&b.style&&/text\-decoration/.test(b.style)&&(r=Y.findParentByTagName(l,"a",!0))?(Y.setAttributes(r,b),Y.remove(l,!0),l=r):(Y.mergeSibling(l),Y.clearEmptySibling(l)),Y.mergeChild(l,b),j=Y.getNextDomNode(l,!1,i),Y.mergeToParent(l),f===h)break}else j=Y.getNextDomNode(j,!0,i);return d.moveToBookmark(g)}function M(a){var b=this;if(b.collapsed)return b;a=$.isArray(a)?a:[a],b.shrinkBoundary().adjustmentBoundary();for(var c=b.startContainer,d=b.endContainer;;){if(1==c.nodeType){if(Y.indexOf(a,c.tagName.toLowerCase())>-1)break;if("body"===c.tagName.toLowerCase()){c=null;break}}c=c.parentNode}for(;;){if(1==d.nodeType){if(Y.indexOf(a,d.tagName.toLowerCase())>-1)break;if("body"==d.tagName.toLowerCase()){d=null;break}}d=d.parentNode}var e,f,g=b.createBookmark();c&&(f=b.cloneRange().setEndBefore(g.start).setStartBefore(c),e=f.extractContents(),f.insertNode(e),Y.clearEmptySibling(c,!0),c.parentNode.insertBefore(g.start,c)),d&&(f=b.cloneRange().setStartAfter(g.end).setEndAfter(d),e=f.extractContents(),f.insertNode(e),Y.clearEmptySibling(d,!1,!0),d.parentNode.insertBefore(g.end,d.nextSibling));for(var h,i=Y.getNextDomNode(g.start,!1,function(a){return 1==a.nodeType});i&&i!==g.end;)h=Y.getNextDomNode(i,!0,function(a){return 1==a.nodeType}),Y.indexOf(a,i.tagName.toLowerCase())>-1&&Y.remove(i,!0),i=h;return b.moveToBookmark(g)}function N(){var a,b=this;if(!b.collapsed){var c=b.cloneRange().adjustmentBoundary().shrinkBoundary();if(cb.selectOneNode(c)){var d=c.startContainer.childNodes[c.startOffset];d&&1==d.nodeType&&(W.empty[d.tagName]||W.nonChild[d.tagName])&&(a=d)}}return a}function O(b,c){function d(a,b){var c,d=this;d.collapsed||d.shrinkBoundary();var e=d.getClosedNode();if(e&&!b){try{c=d.document.body.createControlRange(),c.addElement(e),c.select()}catch(f){}return d}var g,h=d.createBookmark(),i=h.start;if(c=d.document.body.createTextRange(),c.moveToElementText(i),c.moveStart("character",1),d.collapsed){if(!a&&3!=d.startContainer.nodeType){var j=d.document.createTextNode(Y.fillChar),k=d.spanCache.cloneNode(!1);k.appendChild(d.document.createTextNode(Y.fillChar)),i.parentNode.insertBefore(k,i),i.parentNode.insertBefore(j,i),cb.removeFillData(d.document,j),Z=j,cb.mergeSibling(k,"previousSibling"),cb.mergeSibling(i,"nextSibling"),c.moveStart("character",-1),c.collapse(!0)}}else{var l=d.document.body.createTextRange();g=h.end,l.moveToElementText(g),c.setEndPoint("EndToEnd",l)}d.moveToBookmark(h),k&&Y.remove(k);try{c.select()}catch(f){}return d}function e(a){var b,c=this,d=Y.getWindow(c.document),e=d.getSelection();if(Y.gecko()?c.document.body.focus():d.focus(),e){if(e.removeAllRanges(),c.collapsed&&!a){var g=c.startContainer,h=g;1==g.nodeType&&(h=g.childNodes[c.startOffset]),3==g.nodeType&&c.startOffset||(h?h.previousSibling&&3==h.previousSibling.nodeType:g.lastChild&&3==g.lastChild.nodeType)||(b=c.document.createTextNode(Y.fillChar),c.insertNode(b),cb.removeFillData(c.document,b),cb.mergeSibling(b,"previousSibling"),cb.mergeSibling(b,"nextSibling"),Z=b,c.setStart(b,Y.webkit()?1:0).collapse(!0))}var i=c.document.createRange();if(c.collapsed&&_.opera()&&1==c.startContainer.nodeType){var h=c.startContainer.childNodes[c.startOffset];if(h){for(;h&&Y.isBlockElm(h)&&1==h.nodeType&&h.childNodes[0];)h=h.childNodes[0];h&&c.setStartBefore(h).collapse(!0)}else h=c.startContainer.lastChild,h&&Y.isBr(h)&&c.setStartBefore(h).collapse(!0)}f(c),i.setStart(c.startContainer,c.startOffset);try{i.setEnd(c.endContainer,c.endOffset)}catch(j){}e.addRange(i)}return c}function f(a){function b(b,c,d){3==b.nodeType&&b.nodeValue.length<c&&(a[d+"Offset"]=b.nodeValue.length)}b(a.startContainer,a.startOffset,"start"),b(a.endContainer,a.endOffset,"end")}var g=this,h=a.Browser.isIE("<9")?d:e;return h.call(g,b,c)}function P(a,c){var d=this,e=d.spanCache.cloneNode(!1);return a=a?b:Y.getWindow(d.document),e.innerHTML="&nbsp;",d.cloneRange().insertNode(e),Y.scrollToView(e,a,c),Y.remove(e),d}function Q(){var a=this,b=a.startContainer;return this.collapsed&&3==b.nodeType&&b.nodeValue.replace(new RegExp("^"+Y.fillChar),"").length+1==b.nodeValue.length}function R(a,b){function c(a){for(var c=a?e.startContainer:e.endContainer,d=Y.findParents(c,!0,function(a){return!Y.isBody(a)}),f=[],g=0,h=d.length;h>g;g++)f.push(Y.getNodeIndex(d[g],b));var i=0;if(b)if(3==c.nodeType){for(var j=c.previousSibling;j&&3==j.nodeType;)i+=j.nodeValue.replace(bb,"").length,j=j.previousSibling;i+=a?e.startOffset:e.endOffset}else if(c=c.childNodes[a?e.startOffset:e.endOffset])i=Y.getNodeIndex(c,b);else{c=a?e.startContainer:e.endContainer;for(var k=c.firstChild;k;)if(Y.isFillChar(k))k=k.nextSibling;else if(i++,3==k.nodeType)for(;k&&3==k.nodeType;)k=k.nextSibling;else k=k.nextSibling}else i=a?Y.isFillChar(c)?0:e.startOffset:e.endOffset;return 0>i&&(i=0),f.push(i),f}var d={},e=this;return d.startAddress=c(!0),a||(d.endAddress=e.collapsed?[].concat(d.startAddress):c()),d}function S(a,b){function c(a,b){for(var c,e,f,g=d.document.body,h=0,i=a.length;i>h;h++)if(f=a[h],c=g,g=g.childNodes[f],!g){e=f;break}b?g?d.setStartBefore(g):d.setStart(c,e):g?d.setEndBefore(g):d.setEnd(c,e)}if(!a)return d;var d=this;return c(a.startAddress,!0),!b&&a.endAddress&&c(a.endAddress),d}function T(a){var b=this;return $.each(b,function(b,c){return c!==a[b]?!1:void 0}),!0}function U(a,b){var c=this;if(c.collapsed)return c;for(var d=c.createBookmark(),e=d.end,f=Y.getNextDomNode(d.start,!1,b);f&&f!==e&&4&Y.getPosition(f,e);){var g=Y.getNextDomNode(f,!1,b);a(f),f=g}return c.moveToBookmark(d)}function V(){var a=this,b=a.cloneContents(),c="";return b&&(c=Y.getDomText(b)),c}try{var W=$L("component.editor.Dtd")}catch(X){return X}try{var Y=$L("component.editor.Util")}catch(X){return X}var Z,$=a.Object,_=a.Browser,ab=a.Element,bb=Y.fillCharReg,cb=a.createClass($N("component.editor.Range"));$.extend(cb,{guid:1,ieLess9:_.isIE("<9"),updateCollapse:c,selectOneNode:d,setEndPoint:e,execContentsAction:f,removeFillData:g,mergeSibling:h,test:"hello world"}),$.extend(cb.prototype,{initialize:i,cloneContents:j,deleteContents:k,extractContents:l,setStart:m,setEnd:n,setStartAfter:o,setStartBefore:p,setEndAfter:q,setEndBefore:r,setStartAtFirst:s,setStartAtLast:t,setEndAtFirst:u,setEndAtLast:v,selectNode:w,selectNodeContents:x,cloneRange:y,collapse:z,shrinkBoundary:A,enlargeToBlockElm:B,getCommonAncestor:C,trimBoundary:D,txtToElmBoundary:E,insertNode:F,setCursor:G,createBookmark:H,moveToBookmark:I,enlarge:J,adjustmentBoundary:K,applyInlineStyle:L,removeInlineStyle:M,getClosedNode:N,select:O,scrollToView:P,inFillChar:Q,createAddress:R,moveToAddress:S,equals:T,traversal:U,toString:V})}($,window),function(a){function b(a,b){a=a.duplicate(),a.collapse(b);var c=a.parentElement();if(!c.hasChildNodes())return{container:c,offset:0};for(var d,e,f=c.children,g=a.duplicate(),h=0,i=f.length-1,j=-1;i>=h;){j=Math.floor((h+i)/2),d=f[j],g.moveToElementText(d);var k=g.compareEndPoints("StartToStart",a);if(k>0)i=j-1;else{if(!(0>k))return{container:c,offset:s.getNodeIndex(d)};h=j+1}}if(-1==j){if(g.moveToElementText(c),g.setEndPoint("StartToStart",a),e=g.text.replace(/(\r\n|\r)/g,"\n").length,f=c.childNodes,!e)return d=f[f.length-1],{container:d,offset:d.nodeValue.length};for(var l=f.length;e>0;)e-=f[--l].nodeValue.length;return{container:f[l],offset:-e}}if(g.collapse(k>0),g.setEndPoint(k>0?"StartToStart":"EndToStart",a),e=g.text.replace(/(\r\n|\r)/g,"\n").length,!e)return q.empty[d.tagName]||q.nonChild[d.tagName]?{container:c,offset:s.getNodeIndex(d)+(k>0?0:1)}:{container:d,offset:k>0?0:d.childNodes.length};for(;e>0;)try{var m=d;d=d[k>0?"previousSibling":"nextSibling"],e-=d.nodeValue.length}catch(n){return{container:c,offset:s.getNodeIndex(m)}}return{container:d,offset:k>0?-e:d.nodeValue.length+e}}function c(a,b){var c=this;if(a.item)b.selectNode(a.item(0));else{var d=c.getBoundaryInformation(a,!0);b.setStart(d.container,d.offset),0!=a.compareEndPoints("StartToEnd",a)&&(d=c.getBoundaryInformation(a,!1),b.setEnd(d.container,d.offset))}return b}function d(a){var b;try{b=a.getNative().createRange()}catch(c){return null}var d=b.item?b.item(0):b.parentElement();return(d.ownerDocument||d)===a.document?b:null}function e(a){var b=this;b.document=a;var c;if(v.ie()){if(c=s.getWindow(a).frameElement,!c)return;w.listen(c,"beforedeactivate",function(){b._bakIERange=b.getIERange()}),w.listen(c,"activate",function(){try{!x._getIERange(b)&&b._bakIERange&&b._bakIERange.select()}catch(a){}b._bakIERange=null})}c=a=null}function f(){var a=this,b=a.document;try{return b?a.ieLess9?b.selection:s.getWindow(b).getSelection():null}catch(c){return null}}function g(){var a=this,b=x._getIERange(a);return!b&&a._bakIERange?a._bakIERange:b}function h(){var a=this;a.clear(),a._cachedRange=a.getRange(),a._cachedStartElement=a.getStart(),a._cachedStartElementPath=a.getStartElementPath()}function i(){var a=this;if(a._cachedStartElementPath)return a._cachedStartElementPath;var b=a.getStart();return b?s.findParents(b,!0,null,!0):[]}function j(){var a=this;a._cachedStartElementPath=a._cachedRange=a._cachedStartElement=null}function k(){var a=this;try{if(a.ieLess9){var b=x._getIERange(a);return!(!b||!a.rangeInBody(b))}return!!a.getNative().rangeCount}catch(c){return!1}}function l(){function a(a){for(var c=b.document.body.firstChild,d=a.collapsed;c&&c.firstChild;)a.setStart(c,0),c=c.firstChild;a.startContainer||a.setStart(b.document.body,0),d&&a.collapse(!0)}var b=this;if(null!=b._cachedRange)return b._cachedRange;var c=new t(b.document);if(b.ieLess9){var d=b.getIERange();if(d)try{x.transformIERangeToRange(d,c)}catch(e){a(c)}else a(c)}else{var f=b.getNative();if(f&&f.rangeCount){var g=f.getRangeAt(0),h=f.getRangeAt(f.rangeCount-1);
c.setStart(g.startContainer,g.startOffset).setEnd(h.endContainer,h.endOffset),c.collapsed&&s.isBody(c.startContainer)&&!c.startOffset&&a(c)}else{if(b._bakRange&&s.inDoc(b._bakRange.startContainer,b.document))return b._bakRange;a(c)}}return b._bakRange=c}function m(){var a=this;if(a._cachedStartElement)return a._cachedStartElement;var b,c,d,e,f=a.ieLess9?a.getIERange():a.getRange();if(a.ieLess9){if(!f)return a.document.body.firstChild;if(f.item)return f.item(0);for(b=f.duplicate(),b.text.length>0&&b.moveStart("character",1),b.collapse(1),c=b.parentElement(),e=d=f.parentElement();d=d.parentNode;)if(d==c){c=e;break}}else if(f.shrinkBoundary(),c=f.startContainer,1==c.nodeType&&c.hasChildNodes()&&(c=c.childNodes[Math.min(c.childNodes.length-1,f.startOffset)]),3==c.nodeType)return c.parentNode;return c}function n(){var a,b,c=this;return c.isFocus()&&(a=c.getNative())?(b=c.ieLess9?a.createRange():a.getRangeAt(0),c.ieLess9?b.text:b.toString()):""}function o(){var a=this;try{var b=a.getNative();b.empty&&b.empty(),b.removeAllRanges&&b.removeAllRanges()}catch(c){}}function p(a,b){var c=this,d=c.ieLess9||b?a.item?a.item():a.parentElement():a.startContainer;return d===c.document.body||s.inDoc(d,c.document)}try{var q=$L("component.editor.Dtd")}catch(r){return r}try{var s=$L("component.editor.Util")}catch(r){return r}try{var t=$L("component.editor.Range")}catch(r){return r}var u=a.Object,v=a.Browser,w=a.Event,x=a.createClass($N("component.editor.Selection"));u.extend(x,{getBoundaryInformation:b,transformIERangeToRange:c,_getIERange:d}),u.extend(x.prototype,{ieLess9:v.isIE("<9"),initialize:e,getNative:f,getIERange:g,cache:h,getStartElementPath:i,clear:j,isFocus:k,getRange:l,getStart:m,getText:n,clearRange:o,rangeInBody:p})}($,window),function(a,b,c){function d(a){var b=this;b.document=a,b.selection=new z(a)}function e(a,b){var c=this;try{c.document.execCommand(a,!1,b)}catch(d){}}function f(a){try{var b=this,c=b.selection.getRange();if(a&&b.document.body.lastChild)c.setStartAtLast(b.document.body.lastChild).setCursor(!1,!0);else if(a===!1)try{c.setStartAtFirst(b.document.body).setCursor(!1,!0)}catch(d){c.select(!0)}else c.select(!0)}catch(d){}}function g(){var a=this,b=a.document.body,c=a.selection.getRange();b.innerHTML="<div>"+(C.ie()?"":"<br />")+"</div>",c.setStart(b.firstChild,0).setCursor(!1,!0)}function h(a,b,c,d){function e(a){return 1==a.nodeType}function f(a){if(3==a.nodeType||"span"!=a.tagName.toLowerCase())return 0;if(C.ie()){var b=a.attributes;if(b.length){for(var c=0,d=b.length;d>c;c++)if(b[c].specified)return 0;return 1}}return!a.attributes.length}function g(a){var c=a.createBookmark();if(a.collapsed&&a.enlarge(!0),!d){var g=x.findParentByTagName(a.startContainer,"a",!0);g&&a.setStartBefore(g),g=x.findParentByTagName(a.endContainer,"a",!0),g&&a.setEndAfter(g)}for(h=a.createBookmark(),p=h.start;(i=p.parentNode)&&!x.isBlockElm(i);)x.breakParent(p,i),x.clearEmptySibling(p);if(h.end){for(p=h.end;(i=p.parentNode)&&!x.isBlockElm(i);)x.breakParent(p,i),x.clearEmptySibling(p);for(var j,m=x.getNextDomNode(h.start,!1,e);m&&m!=h.end;)j=x.getNextDomNode(m,!0,e),v.empty[m.tagName.toLowerCase()]||x.isBookmarkNode(m)||(k.test(m.tagName)?b?(x.removeStyle(m,b),f(m)&&"text-decoration"!=b&&x.remove(m,!0)):x.remove(m,!0):v.tableContent[m.tagName]||v.list[m.tagName]||(x.removeAttributes(m,l),f(m)&&x.remove(m,!0))),m=j}var n=h.start.parentNode;!x.isBlockElm(n)||v.tableContent[n.tagName]||v.list[n.tagName]||x.removeAttributes(n,l),n=h.end.parentNode,h.end&&x.isBlockElm(n)&&!v.tableContent[n.tagName]&&!v.list[n.tagName]&&x.removeAttributes(n,l),a.moveToBookmark(h).moveToBookmark(c);for(var o,p=a.startContainer,q=a.collapsed;1==p.nodeType&&x.isEmptyNode(p)&&v.removeEmpty[p.tagName];)o=p.parentNode,a.setStartBefore(p),a.startContainer===a.endContainer&&a.endOffset--,x.remove(p),p=o;if(!q)for(p=a.endContainer;1==p.nodeType&&x.isEmptyNode(p)&&v.removeEmpty[p.tagName];)o=p.parentNode,a.setEndBefore(p),x.remove(p),p=o}var h,i,j=this,k=new RegExp("^(?:"+(a||D.options.removeFormatTags).replace(/,/g,"|")+")$","i"),l=b?[]:(c||D.options.removeFormatAttributes).split(","),m=new y(j.document);m=j.selection.getRange(),g(m),m.select()}function i(b){var c=this;if(a.Browser.ie()){var d=c.document.createDocumentFragment(),e=c.document.createElement("DIV");e.innerHTML=b;for(var f;f=e.firstChild;)oLastNode=d.appendChild(f);var g=c.selection.getRange();g.deleteContents(),g.insertNode(d),g.collapse(!1),g.select()}else c.nativeCmd("inserthtml",b)}function j(b){function d(a,b,e,g){e=e||" ";var h="",i=g?'"':"";return A.each(a,function(a,g){g!==c&&null!==g&&""!==g&&(h+=A.isObject(g)?a+b+i+d(g,":",";")+i+e:a+b+i+f(g+"")+i+e)}),h}var e=this,f=a.String.encodeHTML,g=d(b,"="," ",!0),h="<img "+g+" />";return e.insertHtml(h)}function k(a){var b=this,c={left:"justifyLeft",center:"justifyCenter",right:"justifyRight"}[a]||"justifyLeft";b.focus(),b.nativeCmd(c,null);try{var d=x.findParent(this.selection.getRange().startContainer,function(a){return x.isBlockElm(a)},!0),e=(x.getElementsByTagName(d,"br")||[]).pop();e&&x.remove(e)}catch(f){}b.selection.getRange().select(!0)}function l(){var a=this;if(-1!==a.horizontalState()){a.insertHtml("<hr />");var b=a.selection.getRange();return b.select(),!0}}function m(){var a=this;return x.filterNodeList(a.selection.getStartElementPath(),"table")?-1:0}function n(a,b,c){function d(a,b,c,d){var e,f=["TD","LI","PRE"],g=a.createBookmark(),h=function(a){return 1==a.nodeType?"br"!=a.tagName.toLowerCase()&&!x.isBookmarkNode(a):!x.isWhitespace(a)};a.enlarge(!0);for(var i,j=a.createBookmark(),k=x.getNextDomNode(j.start,!1,h),l=a.cloneRange();k&&!(x.getPosition(k,j.end)&x.POSITION_FOLLOWING);)if(3!=k.nodeType&&x.isBlockElm(k))k=x.getNextDomNode(k,!0,h);else{for(l.setStartBefore(k);k&&k!==j.end&&!x.isBlockElm(k);)i=k,k=x.getNextDomNode(k,!1,null,function(a){return!x.isBlockElm(a)});l.setEndAfter(i),e=a.document.createElement(b),c&&(x.setAttributes(e,c),d&&"customstyle"==d&&c.style&&(e.style.cssText=c.style)),e.appendChild(l.extractContents()),x.isEmptyNode(e)&&x.fillChar(a.document,e),l.insertNode(e);var m=e.parentNode;x.isBlockElm(m)&&!x.isBody(e.parentNode)&&-1==x.indexOf(f,m.tagName)&&(d&&"customstyle"==d||(m.getAttribute("dir")&&e.setAttribute("dir",m.getAttribute("dir")),m.style.cssText&&(e.style.cssText=m.style.cssText+";"+e.style.cssText),m.style.textAlign&&!e.style.textAlign&&(e.style.textAlign=m.style.textAlign),m.style.textIndent&&!e.style.textIndent&&(e.style.textIndent=m.style.textIndent),m.style.padding&&!e.style.padding&&(e.style.padding=m.style.padding)),c&&/h\d/i.test(m.tagName)&&!/h\d/i.test(e.tagName)?(x.setAttributes(m,c),d&&"customstyle"==d&&c.style&&(m.style.cssText=c.style),x.remove(e,!0),e=m):x.remove(e.parentNode,!0)),k=-1!=x.indexOf(f,m.tagName)?m:e,k=x.getNextDomNode(k,!1,h)}return a.moveToBookmark(j).moveToBookmark(g)}var e=this.selection.getRange();if(e.collapsed){var f=this.document.createTextNode("p");if(e.insertNode(f),C.ie()){var g=f.previousSibling;g&&x.isWhitespace(g)&&x.remove(g),g=f.nextSibling,g&&x.isWhitespace(g)&&x.remove(g)}}if(e=d(e,a,b,c),f&&(e.setStartBefore(f).collapse(!0),oPN=f.parentNode,x.remove(f),x.isBlockElm(oPN)&&x.isEmptyNode(oPN)&&x.fillNode(this.document,oPN)),x.gecko()&&e.collapsed&&1==e.startContainer.nodeType){var h=e.startContainer.childNodes[e.startOffset];h&&1==h.nodeType&&h.tagName.toLowerCase()==a&&e.setStart(h,0).collapse(!0)}return e.select(),!0}function o(){var a=x.filterNodeList(this.selection.getStartElementPath(),"div p h1 h2 h3 h4 h5 h6");return a?a.tagName.toLowerCase():""}function p(a){var b=this;b.focus();var c=b.selection.getRange();if(c.collapsed){var d=x.findParent(c.startContainer,function(a){return a&&1==a.nodeType&&!x.isBody(a)},!0);d&&x.setStyle(d,"line-height",a)}else c.applyInlineStyle("SPAN",{style:"line-height:"+a});return c.select(),!0}function q(){var a=this,b=x.filterNodeList(a.selection.getStartElementPath(),function(a){return x.isBlockElm(a)});if(b){var c=x.getComputedStyle(b,"line-height");return"normal"==c?1:c.replace(/[^\d.]*/gi,"")}}function r(a){function b(a,b){var c=a.cloneRange(),e=d.linkValue();d._optimize(a=a.adjustmentBoundary());var f=a.startContainer;if(1==f.nodeType&&e&&(f=f.childNodes[a.startOffset],f&&1==f.nodeType&&"A"==f.tagName&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(f[C.ie()?"innerText":"textContent"])&&(f[C.ie()?"innerText":"textContent"]=x.textToHtml(b.textValue||b.href))),(!c.collapsed||e)&&(a.removeInlineStyle("a"),c=a.cloneRange()),c.collapsed){var g=a.document.createElement("a"),h="";b.textValue?(h=x.textToHtml(b.textValue),delete b.textValue):h=x.textToHtml(b.href),x.setAttributes(g,b),f=x.findParentByTagName(c.startContainer,"oA",!0),f&&x.isInNodeEndBoundary(c,f)&&a.setStartAfter(f).collapse(!0),g[C.ie()?"innerText":"textContent"]=h,a.insertNode(g).selectNode(g)}else a.applyInlineStyle("a",b)}var c,d=this;a.href&&(a.href=x.unhtml(a.href,new RegExp('[<">]',"g"))),a.textValue&&(a.textValue=x.unhtml(a.textValue,new RegExp('[<">]',"g"))),b(c=d.selection.getRange(),a),c.collapse().select(!0)}function s(){var a,b=this.selection.getRange();if(!b.collapsed){b.shrinkBoundary();var c=3!=b.startContainer.nodeType&&b.startContainer.childNodes[b.startOffset]?b.startContainer.childNodes[b.startOffset]:b.startContainer,d=3==b.endContainer.nodeType||0==b.endOffset?b.endContainer:b.endContainer.childNodes[b.endOffset-1],e=b.getCommonAncestor();if(a=x.findParentByTagName(e,"a",!0),!a&&1==e.nodeType)for(var f,g,h,i=e.getElementsByTagName("a"),j=0,k=i.length;k>j;j++)if(h=i[j],f=x.getPosition(h,c),g=x.getPosition(h,d),(f&x.POSITION_FOLLOWING||f&x.POSITION_CONTAINS)&&(g&x.POSITION_PRECEDING||g&x.POSITION_CONTAINS)){a=h;break}return a}return a=b.startContainer,a=1==a.nodeType?a:a.parentNode,a&&(a=x.findParentByTagName(a,"a",!0))&&!x.isInNodeEndBoundary(b,a)?a:void 0}function t(){var a,b=this,c=b.selection.getRange();(!c.collapsed||x.findParentByTagName(c.startContainer,"a",!0))&&(a=c.createBookmark(),b._optimize(c),c.removeInlineStyle("a").moveToBookmark(a).select())}function u(a){var b=a.startContainer,c=a.endContainer;(b=x.findParentByTagName(b,"a",!0))&&a.setStartBefore(b),(c=x.findParentByTagName(c,"a",!0))&&a.setEndAfter(c)}try{var v=$L("component.editor.Dtd")}catch(w){return w}try{var x=$L("component.editor.Util")}catch(w){return w}try{var y=$L("component.editor.Range")}catch(w){return w}try{var z=$L("component.editor.Selection")}catch(w){return w}var A=a.Object,B=a.Array,C=a.Browser;a.Element,a.Event;var D=a.createClass($N("component.editor.Cmd"));A.extend(D,{basestyle:{bold:["b","strong"],italic:["i","em"],subscript:["sub"],superscript:["sup"],underline:["u"],strikethrough:["s"]},fonts:{forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",fontborder:"border"},needCmd:{underline:1,strikethrough:1,fontborder:1,forecolor:1,backcolor:1,fontsize:1},options:{removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}}),A.extend(D.prototype,{initialize:d,nativeCmd:e,focus:f,cleardoc:g,removeFormat:h,insertHtml:i,insertImage:j,justify:k,horizontal:l,horizontalState:m,paragraph:n,paragraphState:o,lineheight:p,lineheightState:q,link:r,linkValue:s,unlink:t,_optimize:u,test:"hello world"}),A.each(D.basestyle,function(a,b){D.prototype[a]=function(){var c=this,d=c.selection.getRange(),e=x.filterNodeList(c.selection.getStartElementPath(),b);if(d.collapsed){if(e){var f=c.document.createTextNode("");d.insertNode(f).removeInlineStyle(b),d.setStartBefore(f),x.remove(f)}else{var g=d.document.createElement(b[0]);("superscript"==a||"subscript"==a)&&(f=c.document.createTextNode(""),d.insertNode(f).removeInlineStyle(["sub","sup"]).setStartBefore(f).collapse(!0)),d.insertNode(g).setStart(g,0)}d.collapse(!0)}else("superscript"==a||"subscript"==a)&&(e&&e.tagName.toLowerCase()==a||d.removeInlineStyle(["sub","sup"])),e?d.removeInlineStyle(b):d.applyInlineStyle(b[0]);d.select()},D.prototype[a+"State"]=function(){var a=this;return x.filterNodeList(a.selection.getStartElementPath(),b)?1:0}}),A.each(D.fonts,function(a,b){D.prototype[a]=function(c){function d(a,b,c){var d,g=a.collapsed,h=a.createBookmark();if(g)for(d=h.start.parentNode;v.inline[d.tagName];)d=d.parentNode;else d=x.getCommonAncestor(h.start,h.end);B.each(x.getElementsByTagName(d,"span"),function(a,d){if(d.parentNode&&!x.isBookmarkNode(d)){if(/\s*border\s*:\s*none;?\s*/i.test(d.style.cssText))return/^\s*border\s*:\s*none;?\s*$/.test(d.style.cssText)?x.remove(d,!0):x.removeStyle(d,"border"),void 0;if(/border/i.test(d.style.cssText)&&"SPAN"==d.parentNode.tagName&&/border/i.test(d.parentNode.style.cssText)&&(d.style.cssText=d.style.cssText.replace(/border[^:]*:[^;]+;?/gi,"")),"fontborder"!=b||"none"!=c)for(var f=d.nextSibling;f&&1==f.nodeType&&"SPAN"==f.tagName;)if(x.isBookmarkNode(f)&&"fontborder"==b)d.appendChild(f),f=d.nextSibling;else{if(f.style.cssText==d.style.cssText&&(x.moveChild(f,d),x.remove(f)),d.nextSibling===f)break;f=d.nextSibling}if(e(d),C.isIE(">8")){var g=x.findParent(d,function(a){return"SPAN"==a.tagName&&/background-color/.test(a.style.cssText)});g&&!/background-color/.test(d.style.cssText)&&(d.style.backgroundColor=g.style.backgroundColor)}}}),a.moveToBookmark(h),f(a,b,c)}function e(a){for(var b;(b=a.parentNode)&&"SPAN"==b.tagName&&1==x.getChildCount(b,function(a){return!x.isBookmarkNode(a)&&!x.isBr(a)});)b.style.cssText+=a.style.cssText,x.remove(a,!0),a=b}function f(a,b,c){var d={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"};if(d[b]&&(a.adjustmentBoundary(),!a.collapsed&&1==a.startContainer.nodeType)){var e=a.startContainer.childNodes[a.startOffset];if(e&&x.isTagNode(e,"span")){var f=a.createBookmark();B.each(x.getElementsByTagName(e,"span"),function(a,e){e.parentNode&&!x.isBookmarkNode(e)&&("backcolor"!=b||x.getComputedStyle(e,"background-color").toLowerCase()!==c)&&(x.removeStyle(e,d[b]),0==e.style.cssText.replace(/^\s+$/,"").length&&x.remove(e,!0))}),a.moveToBookmark(f)}}}var g=this;c=c||(this[a+"State"]()?"none":"underline"==a?"underline":"fontborder"==a?"1px solid #000":"line-through");var h,i=this.selection.getRange();if("default"==c)i.collapsed&&(h=g.document.createTextNode("font"),i.insertNode(h).select()),g.removeFormat("span,a",b),h&&(i.setStartBefore(h).collapse(!0),x.remove(h)),d(i,a,c),i.select();else if(i.collapsed){var j=x.findParentByTagName(i.startContainer,"span",!0);if(h=g.document.createTextNode("font"),!j||j.children.length||j[C.ie()?"innerText":"textContent"].replace(x.fillCharReg,"").length){if(i.insertNode(h),i.selectNode(h).select(),j=i.document.createElement("span"),D.needCmd[a]){if(x.findParentByTagName(h,"a",!0))return i.setStartBefore(h).setCursor(),x.remove(h),void 0;g.removeFormat("span,a",b)}if(j.style.cssText=b+":"+c,h.parentNode.insertBefore(j,h),!C.ie()||C.isIE("9"))for(var k=j.parentNode;!x.isBlockElm(k);)"SPAN"==k.tagName&&(j.style.cssText=k.style.cssText+";"+j.style.cssText),k=k.parentNode;C.opera()?setTimeout(function(){i.setStart(j,0).collapse(!0),d(i,a,c),i.select()}):(i.setStart(j,0).collapse(!0),d(i,a,c),i.select())}else i.insertNode(h),D.needCmd[a]&&(i.selectNode(h).select(),g.removeFormat("span,a",b,null),j=x.findParentByTagName(h,"span",!0),i.setStartBefore(h)),j&&(j.style.cssText+=";"+b+":"+c),i.collapse(!0).select();x.remove(h)}else D.needCmd[a]&&g.removeFormat("span,a",b),i=g.selection.getRange(),i.applyInlineStyle("span",{style:b+":"+c}),d(i,a,c),i.select();return!0},D.prototype[a+"Value"]=function(){var c=this.selection.getStart();if("underline"==a||"strikethrough"==a){for(var d,e=c;e&&!x.isBlockElm(e)&&!x.isBody(e);){if(1==e.nodeType&&(d=x.getComputedStyle(e,b),"none"!=d))return d;e=e.parentNode}return"none"}if("fontborder"==a){for(var f,g=c;g&&v.inline[g.tagName];){if((f=x.getComputedStyle(g,"border"))&&/1px/.test(f)&&/solid/.test(f))return f;g=g.parentNode}return""}if("fontsize"==a){var h=x.getComputedStyle(c,b),g=/^([\d\.]+)(\w+)$/.exec(h);return g?Math.floor(g[1])+g[2]:h}return x.getComputedStyle(c,b)},D.prototype[a+"State"]=function(){var b=this;if(!D.needCmd[a])return 0;var c=b[a+"Value"]();return"fontborder"==a?/1px/.test(c)&&/solid/.test(c):c==("underline"==a?"underline":"line-through")}}),B.each("formatblock,selectall,insertorderedlist,insertunorderedlist,indent,outdent".split(","),function(a,b){D.prototype[b]=function(a){var c=this;c.focus(),c.nativeCmd(b,a)}}),B.each(["cut","copy","paste"],function(a,b){D.prototype[b]=function(){var a=this;return a.focus(),a.document.queryCommandSupported(b)?(a.nativeCmd(b,null),a):"not supported"}})}($,window),function(a){function b(){var b=this,c=(b.exec("fontfamilyValue")||"").replace(/'/g,"").replace(/"/g,""),d=k.getName(c),e=a(b.getEl().dom).find(".ico-editor-fontname");e&&e.html(d)}function c(a){var b=a.editMode,c=a[b+"FontnameMenu"],d=(a.exec("fontfamilyValue")||"").replace(/'/g,"").replace(/"/g,""),e=!1;return i.each(c&&c.items||k.config,function(a,b){b.checked&&b.setChecked&&b.setChecked(!1),(b.value||b.val)!==d&&(b.rawConfig||{}).text!==d||"setDefault"===d||(b.setChecked&&b.setChecked(!0),e=!0)}),e?d:null}function d(b){var c="";return a.Array.each(k.config,function(a,d){(d.val===b||d.name===b)&&(c=d.name)}),c}function e(a,b){var c=this,d=c.editMode,e=c[d+"FontnameMenu"];if(!e){var f=k.initMenuConf(c);e=new j(f),e.attachTo({clickFrom:b,delegateTo:"self"}),e.fire("attachToShow"),c[d+"FontnameMenu"]=e}setTimeout(function(){var a=k.findDefault(c);!a&&e.items&&e.items[0].setChecked(!0)},0)}function f(b){var c={extcls:"APP-editor-menu-fontname",groups:[{items:[],checkType:"radio"}],items:[],onItemClick:function(c){"setDefault"!==c.value&&(b.exec("fontfamily",c.value),a(b.getEl().dom).find(".ico-editor-fontname").html(c.rawConfig.text))},width:"158px"},d=c.groups[0].items;return i.each(k.config,function(a,b){return"split"===b.type?(d.push({type:"split"}),void 0):(d.push({text:b.name,value:b.val,code:b.code,extAttr:' style="font-family:'+b.val+';height:30px;line-height:30px;" ',checked:b.checked}),void 0)}),b.setDefault&&(d.push({type:"split"}),d.push({text:g.t("设置默认"),value:"setDefault",click:function(){b.log("setDefaultFontname"),b.plugin.SetDefault.selected.call(b)}})),c}var g=new $I18N("component.editor.plugin.Fontname"),h=a.Object,i=a.Array,j=a.getClass($N("component.Menu")),k=h.extend(a.createClass($N("component.editor.plugin.Fontname")),{init:b,findDefault:c,selected:e,getName:d,initMenuConf:f,config:[{name:g.t("宋体"),val:"simsun, STSongti-SC-Regular",code:1,checked:!0},{name:g.t("黑体"),val:"simhei, STHeitiSC-Light",code:2},{name:g.t("楷体,楷体_GB2312"),val:g.t("楷体, 楷体_GB2312, STKaitiSC-Regular"),code:3},{name:g.t("隶书"),val:g.t("隶书, STBaoliSC-Regular"),code:4},{name:g.t("幼圆"),val:g.t("幼圆, STYuanti-SC-Regular"),code:5},{name:g.t("微软雅黑"),val:"Microsoft Yahei",code:"e"},{name:"Arial",val:"Arial",code:6},{name:"Arial Black",val:"Arial Black",code:7},{name:"Comic Sans MS",val:"Comic Sans MS",code:8},{name:"Courier",val:"Courier",code:9},{name:"System",val:"System",code:"a"},{name:"Times New Roman",val:"Times New Roman",code:"b"},{name:"Verdana",val:"Verdana",code:"c"},{name:"Georgia",val:"Georgia",code:"d"},{name:"Calibri",val:"Calibri",code:"f"}]})}($,window),function(a){function b(){var b=this,c=j.findDefault(),d=a(b.getEl().dom).find(".ico-editor-fontsize");j.editor=b,d&&d.html(c.replace("px",""))}function c(){var b=a.Ud.get({field:"ntes_buzz",flag:"def_fontsize"}),c=!1,d="";return a.Array.each(j.config,function(a,e){e.code===b&&(c=!0,d=e.val)}),c?d:j.config[0].val}function d(a,b){var c=this,d=c.editMode,e=c[d+"FontsizeMenu"];if(!e){var f=j.initMenuConf(c);e=new i(f),e.attachTo({clickFrom:b,delegateTo:"self"}),e.fire("attachToShow"),c[d+"FontsizeMenu"]=e}setTimeout(function(){var a=(c.exec("fontsizeValue")||"").replace(/'/g,""),b=!1;h.each(e.items,function(c,d){d.checked&&d.setChecked(!1),d.value===a&&"setDefault"!==a&&(d.setChecked(!0),b=!0)})},0)}function e(b){var c={extcls:"APP-editor-menu-fontsize",groups:[{type:"scroll",items:[],checkType:"radio"}],items:[],onItemClick:function(c){"setDefault"!==c.value&&(b.exec("fontsize",c.value),a(b.getEl().dom).find(".ico-editor-fontsize").html(c.value.replace("px","")))},width:"190px"},d=c.groups[0].items;if(h.each(j.config,function(a,b){return"split"===b.type?(d.push({type:"split"}),void 0):(d.push({text:b.name,value:b.val,code:b.code,extText:b.val,extcls:"APP-editor-fontSize-"+b.size,checked:b.checked}),void 0)}),b.setDefault){var e={items:[]};e.items.push({text:f.t("设置默认"),value:"setDefault",click:function(){b.log("setDefaultFontsize"),b.plugin.SetDefault.selected.call(b)}}),c.groups.push(e)}return c}var f=new $I18N("component.editor.plugin.Fontsize"),g=a.Object,h=a.Array,i=a.getClass($N("component.Menu")),j=g.extend(a.createClass($N("component.editor.plugin.Fontsize")),{editor:null,init:b,findDefault:c,selected:d,initMenuConf:e,config:[{name:f.t("默认大小"),val:"14px",code:"c",size:0,checked:!0},{type:"split"},{name:f.t("文字"),val:"10px",code:"a",size:1},{name:f.t("文字"),val:"12px",code:"b",size:2},{name:f.t("文字"),val:"14px",code:"c",size:3},{name:f.t("文字"),val:"16px",code:"d",size:4},{name:f.t("文字"),val:"18px",code:"e",size:5},{name:f.t("文字"),val:"20px",code:"f",size:6},{name:f.t("文字"),val:"24px",code:"g",size:7},{name:f.t("文字"),val:"28px",code:"h",size:8},{name:f.t("文字"),val:"32px",code:"i",size:9},{name:f.t("文字"),val:"36px",code:"j",size:10},{name:f.t("文字"),val:"48px",code:"k",size:11}]})}($,window),function(a){function b(){var a=this,b=(a.exec("forecolorValue")||"").replace(/'/g,"");l.updateSelectedColorOnBtn(b),l.selectedColor=b;var c={xtype:"menu",groups:[{items:l.getColorBlocks(l.rawConfig.mainColor),checkType:"radio"},{items:l.getColorBlocks(l.rawConfig.subColor),checkType:"radio"}],extcls:"APP-editor-color-picker",onItemClick:function(b){if("setDefault"!==b.value){var c=a[a.editMode+"ForecolorMenu"];j.each(c.items,function(a,b){b.checked&&b.setChecked(!1)}),a.exec("forecolor",b.rawConfig.color),l.updateSelectedColorOnBtn(b.rawConfig.color)}},width:"220px"};l.config=c}function c(b,c){var d=this,e=d.editMode;if(!a(b.target||b.srcElement).hasClass("ico-editor-arrowDown-active"))return d.exec("forecolor",l.selectedColor),!1;var f=d[e+"ForecolorMenu"];if(!f){var g=l.initMenuConf(d);f=new k(g),f.attachTo({clickFrom:a(c).find(".ico-editor-arrowDown-active"),delegateTo:"self"}),f.fire("attachToShow"),d[e+"ForecolorMenu"]=f,setTimeout(function(){var a=(d.exec("forecolorValue")||"").replace(/'/g,""),b=!1;j.each(f.items,function(c,d){d.checked&&d.setChecked(!1),d.rawConfig.color===a&&(d.setChecked(!0),b=!0)}),!b&&f.items&&"setDefault"!==a&&f.items[0].setChecked(!0)},0)}setTimeout(function(){var b=l.findDefault()||"#000";a(".APP-editor-ico-color-default b").css({backgroundColor:b})},0)}function d(b){var c=this,d=c.config;if(b.setDefault){var e={items:[]};e.items.push({extAttr:'style="float:none"',extText:'<span style="color:#555;font-size:12px;">'+h.t("设置默认")+"</span>",text:['<div class="APP-editor-ico-color-default">','<b class="APP-editor-ico-color" style="float:none;display: inline-block;position: relative;top:3px;margin-right:5px;"></b>',"<span>"+h.t("默认颜色")+"</span>","</div>"].join(" "),value:"setDefault",click:function(c){if(a((c.target||c.srcElement).parentNode).hasClass("APP-editor-ico-color-default")){var d=l.findDefault()||"#000";b.exec("forecolor",d),l.updateSelectedColorOnBtn(d);var e=b.editMode,f=b[e+"ForecolorMenu"];return j.each(f.items,function(a,b){b.checked&&b.setChecked(!1),b.rawConfig.color===d&&b.setChecked(!0)}),void 0}b.log("setDefaultForecolor"),b.plugin.SetDefault.selected.call(b)}}),d.groups.push(e)}return d}function e(b){return a.Array.map(b,function(a,b){return{text:'<b class="APP-editor-ico-color" style="background:'+b.val+";"+'"></b>',value:b.code,code:b.code,color:b.val,checked:!1}})}function f(){var b=a.Ud.get({field:"ntes_buzz",flag:"def_forecolor"}),c="",d=l.config.groups[0].items,e=l.config.groups[1].items;return a.Array.each(d,function(a,d){d.code===b&&(c=d.color)}),a.Array.each(e,function(a,d){d.code===b&&(c=d.color)}),c}function g(b){l.selectedColor=b;var c=a(".APP-editor-commond-forecolor");c&&c.find(".APP-editor-color-preview").css({backgroundColor:b})}var h=new $I18N("component.editor.plugin.Forecolor"),i=a.Object,j=a.Array,k=a.getClass($N("component.Menu")),l=i.extend(a.createClass($N("component.editor.plugin.Forecolor")),{init:b,selectedColor:"",findDefault:f,selected:c,initMenuConf:d,updateSelectedColorOnBtn:g,getColorBlocks:e,keyStart:65,config:{},rawConfig:{mainColor:[{val:"#9e0f30",code:""},{val:"#dd4032",code:""},{val:"#fe840f",code:""},{val:"#fff566",code:""},{val:"#77c94b",code:""},{val:"#8d9440",code:""},{val:"#97dedf",code:""},{val:"#174e85",code:""},{val:"#9896a4",code:""},{val:"#90a6d2",code:""}],subColor:[{val:"#ffffff",code:""},{val:"#808080",code:""},{val:"#fff2cc",code:""},{val:"#fff7e6",code:""},{val:"#fff1f0",code:""},{val:"#e6fadc",code:""},{val:"#e6f7fa",code:""},{val:"#dce6f0",code:""},{val:"#c8dcf0",code:""},{val:"#f9efff",code:""},{val:"#f4f5f8",code:""},{val:"#595959",code:""},{val:"#ffe598",code:""},{val:"#fdd5b4",code:""},{val:"#e7b8b7",code:""},{val:"#c4e0b2",code:""},{val:"#92ccde",code:""},{val:"#b8cde5",code:""},{val:"#8eb2e5",code:""},{val:"#cbc0db",code:""},{val:"#d8d8d8",code:""},{val:"#3f4140",code:""},{val:"#ffd865",code:""},{val:"#f4b183",code:""},{val:"#da9593",code:""},{val:"#a8d08c",code:""},{val:"#92ccde",code:""},{val:"#94b1d9",code:""},{val:"#538bd7",code:""},{val:"#b3a1c7",code:""},{val:"#a6a6a6",code:""},{val:"#262626",code:""},{val:"#d4b106",code:""},{val:"#c55c0f",code:""},{val:"#963732",code:""},{val:"#528135",code:""},{val:"#006c73",code:""},{val:"#355e93",code:""},{val:"#15365f",code:""},{val:"#60487b",code:""},{val:"#808080",code:""},{val:"#000000",code:"",checked:!0},{val:"#876700",code:""},{val:"#843c0b",code:""},{val:"#642421",code:""},{val:"#375622",code:""},{val:"#00474e",code:""},{val:"#243e62",code:""},{val:"#0d2340",code:""},{val:"#403053",code:""}]}}),m=l.keyStart;a.Array.each(l.rawConfig.mainColor,function(a,b){b.code=String.fromCharCode(m),m++}),a.Array.each(l.rawConfig.subColor,function(a,b){b.code=String.fromCharCode(m),m++})}($,window),function(a){function b(){var a=this,b=a.constructor.mode;a.changeMode(b.BASIC)}var c=a.Object,d=a.createClass($N("component.editor.plugin.Basic"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this,b=a.constructor.mode;a.changeMode(b.FULL)}var c=a.Object;c.extend(a.createClass($N("component.editor.plugin.Full")),{selected:b})}($,window),function(a,b){function c(c){var d=this,e=!1;d.debounceSave=d.debounce(function(){e||d.save(!0)},200),t.extend(this,{editor:c,lastKey:null,_poll:[["",null]],_pos:0}),c.openHistory&&(c.listen("iframeKeydown",function(a){d.shortcut(a),d.copyOrDelete(a)}),c.listen("iframeKeydown",function(a){if(d.autoSave){var b={16:1,17:1,18:1,37:1,38:1,39:1,40:1,46:1,8:1};b[a.keyCode]||a.ctrlKey||a.altKey||a.metaKey||a.shiftKey||a.altKey||(d.debounceSave(),setTimeout(function(){e||(d._curKeyCount++,d._curKeyCount>=d.interval&&(d._curKeyCount=0,d.save(!0)))},0))}}),a(c.doc.body).listen("compositionstart",function(){e=!0,d.save(!0)}),a(c.doc.body).listen("compositionend",function(){e=!1,d.timer&&b.clearTimeout(d.timer),d.timer=setTimeout(function(){d._curKeyCount=0,d.save(!0)},0)}))}function d(a){(a.ctrlKey||a.metaKey)&&(a.keyCode===w.Z?(u.stop(a),this.canUndo()&&this.undo()):a.keyCode===w.Y&&(u.stop(a),this.canRedo()&&this.redo()))}function e(a){var b=this;if(b._curKeyCount=0,b.editor.openHistory){var c=b._poll,d=b.editor,e=d.cmd.selection.getRange(),f=b._pos,g=c[f][0],h=d.body.innerHTML.replace(q.fillCharReg,""),i=b.getBookmark(a);return g!==h?(c=b._poll=c.slice(0,f+1),c.push([h,i]),c.length>b.maxUndoCount&&c.shift(),b._pos=c.length-1,e):e}}function f(){var a=this,b=a.editor;if(a.save(),a._pos>0){a._pos--;var c=a._poll[a._pos];b.body.innerHTML=c[0];try{a.setBookmark(c[1])}catch(d){}return!0}return!1}function g(){var a=this,b=this.editor;if(this._pos!==this._poll.length-1){this._pos++;var c=this._poll[this._pos];b.body.innerHTML=c[0];try{a.setBookmark(c[1])}catch(d){}return!0}return!1}function h(){if(this.autoSave){var a=this.editor.body.innerHTML;return Math.abs(a.length-this._removeBookMark(this._poll[this._pos][0]).length)+1>=this.interval?this.save():void 0}}function i(a){var b=a.keyCode;!this.autoSave||b!==w.BACKSPACE&&b!==w.DELETE&&b!==w.V&&w!==w.V||(((b===w.BACKSPACE||b===w.DELETE)&&this.lastKey!==b||a.ctrlKey&&b===w.V)&&this.save(!0),this.lastKey=b)}function j(){return this._pos>0}function k(a){var b=this,c=b.editor,d={};try{if(b.ieLess9&&document.selection&&a){try{c.focus()}catch(e){}var f=c.doc.selection,g=/text/i.test(f.type)?f.createRange().getBookmark():null;d.bookmark=g,d.toIE=!0}else{var h=c.cmd.selection.getRange();d.bookmark=h.createAddress(!1,!0)}}catch(e){}return d}function l(a){a=a||{};var b=this,c=b.editor,d=a.bookmark;if(d)try{if(a.toIE){var e=c.doc.body.createTextRange();"[object]"!==d&&e.moveToBookmark(d)&&e.select()}else{var e=new s(c.doc).moveToAddress(d),f=e.startContainer.nodeName.toLowerCase();e.select({body:1,ol:1,table:1,tbody:1,tr:1,ul:1}[f])}}catch(g){}}function m(){return this._pos!==this._poll.length-1}function n(a,b){return a=a.replace(/<span [^>]*id="?_webmail_bookmark_start_\d+"?[^>]*>.*?<\/span>|<span [^>]*id="?_webmail_bookmark_end_\d+"?[^>]*>.*?<\/span>/gi,"").replace(q.fillCharReg,""),b&&(a=a.replace(/\s/g,"")),decodeURI(encodeURI(a).replace(/%E2%80%8B/gi,""))}function o(a){return a=a.replace(q.fillCharReg,""),decodeURI(encodeURI(a).replace(/%E2%80%8B/gi,""))}function p(a,b){var c=null,d=(new Date).getTime();return function(){var e=(new Date).getTime();b>e-d?clearTimeout(c):c=setTimeout(function(){a()},b)}}try{var q=$L("component.editor.Util")}catch(r){return r}try{var s=$L("component.editor.Range")}catch(r){return r}var t=a.Object,u=a.Event,v=a.createClass($N("component.editor.plugin.History")),w={DELETE:46,BACKSPACE:8,C:67,V:86,Y:89,Z:90};t.extend(v.prototype,{ieLess9:a.Browser.isIE("<9"),_curKeyCount:0,autoSave:!0,interval:20,maxUndoCount:150,initialize:c,shortcut:d,copyOrDelete:i,save:e,undo:f,redo:g,smartSave:h,canUndo:j,canRedo:m,getBookmark:k,setBookmark:l,_removeBookMark:n,_removeSpecialChar:o,debounce:p,debounceSave:function(){}})}($,window),function(a,b,c){function d(b){var d=this;if(d.plugin=O,K.inited||K.init(),a.JS&&!a.JS.css["geditor.css"]&&a.Ajax.request({requestType:a.Ajax.CSS,url:[$G.environment.cacheCssPath,"geditor.css",$G.environment.isDebug?"?"+(new Date).getTime():""].join(""),call:function(){a.JS.css["geditor.css"]=!0}}),d.plugins=Q.clone(Z),d.pluginsInfo=Q.clone($),d.pluginBtn={},d.eventPoll={},d.toolbarInit={},d.toolbarInit[Y.HIDE]=d.toolbarInit[Y.TEXT]=!0,!b.noUseUdFont){var e=d.getUdInfo();Q.each(e,function(a,c){c&&(b[a]=d[a]=c)})}R.each(["editMode","tabIndex","width","height","setDefault","isMask","imageAutoSize","opacity","plugins","openHistory"],function(a,e){b[e]!==c&&(d[e]=b[e])}),b.pluginsInfo&&(d.pluginsInfo=Q.extend(d.pluginsInfo,b.pluginsInfo)),_.superClass.initialize.call(d,b),a.JS&&!a.JS.css["geditor.css"]&&setTimeout(function(){a.JS.css["geditor.css"]=a.JS.css["geditor.css"]||d.toolbarDv&&"none"!==d.toolbarDv.css("display")},3e3)}function e(){var a=this,b=a.getToolbarHtml(a.editMode),c={opacityStyle:a.opacity?'allowtransparency="true"':"",tabIndex:a.tabIndex,modeCls:"APP-editor-"+a.editMode.toLowerCase()};return c[a.editMode+"Toolbar"]=b,a.toolbarInit[a.editMode]=!0,c}function f(){function b(b){function c(c){R.each(c,function(c,e){return Q.isObject(e)?e.code==f?(d[b]=e.val,a.BREAK):void 0:void 0})}var f=a.Ud.get({field:"ntes_buzz",flag:"def_"+b});"0"!=f&&("forecolor"===b?(c(e[b].mainColor),c(e[b].subColor)):c(e[b]))}var c=this,d={},e={fontsize:c.plugin.Fontsize.config,fontname:c.plugin.Fontname.config,forecolor:c.plugin.Forecolor.rawConfig};return b("fontname"),b("fontsize"),b("forecolor"),d}function g(){var a,b,c,d=this,e=this.editDv,f=arguments.length,g=arguments[f-1],h=[].concat([].slice.call(arguments,0));
3===f&&Q.isString(arguments[0])&&h.unshift(e),a=h[0],b=h[1],d.eventPoll[b]=d.eventPoll[b]||[],4===h.length?(c=h[2],U.live(a,b,c,g),d.eventPoll[b].push({context:a,selector:c,handler:g})):3===arguments.length&&(U.listen(a,b,g),d.eventPoll[b].push({context:a,handler:g,bind:!0}))}function h(b,c,d){function e(a){return a?g[a]?g[a]:(a=f._upperChar(a),g[a]):void 0}var f=d,g=f.plugin;U.stop(b);var h=new V(c),i=h.attr("editorCmd");if(S.isIE()||(a.Menu.hideAllMenu(),a.Layer.hideAllLayer()),f.fire("focusToolbar",b),f.fire("clickToolbar",b),f.editMode!==Y.SOURCE||"source"===i){var j=e(i);if(j&&j.selected){var k=f.editMode;j.selected.call(f,b,h,i),f.log(i,k)}}S.isIE()&&(a.Menu.hideAllMenu(),a.Layer.hideAllLayer()),f.fire("selectionChanged","toolbarClick")}function i(){var c=this;c.plugin,c.addListener("click","div.APP-editor-tbar a.APP-editor-commond-btn",function(a){c.editorToolbarClick(a,this,c)}),c.addListener(c.tipsDv.find("a.nui-ico-x"),"click",function(){c.showTips()}),U.listen(c.doc,"click",function(b){a.Menu.hideAllMenu(),a.Layer.hideAllLayer(),c.fire("iframeClick",b),c.fire("selectionChanged","docClick")}),U.listen(c.doc,"mouseleave",function(a){c.fire("iframeMouseleave",a)}),c.addListener(c.doc,"keydown",function(a){c.fire("iframeKeydown",a),M.isDelete(a)&&c.fire("daleteKeydown")});var d=a.Browser.isIE()?"textinput":"input";c.addListener(c.doc,d,function(a){c.fire("iframeInput",a)}),c.addListener(c.doc,"keyup",function(a){c.fire("iframeKeyup",a),c.fire("selectionChanged","keyup")}),c.addListener(c.doc,"mousedown",function(a){c.fire("iframeMousedown",a)}),c.addListener(c.doc,"mouseup",function(a){c.fire("iframeMouseup",a),c.fire("selectionChanged","mouseup")}),c.addListener(c.doc,"mousemove",M.throttle(function(a){c.fire("iframeMousemove",a)},32,{leading:!0,trailing:!0,copyEvent:a.Browser.isIE("8")})),c.addListener(c.doc.body,"contextmenu",function(a){c.fire("iframeContextmenu",a)}),c.addListener(b,"resize",M.throttle(function(a){c.fire("iframeReszie",a)},50)),S.ie()?(U.listen(c.iframe,"beforedeactivate",function(a){c.fire("iframeBlur",a),c.fire("selectionChanged","beforedeactivate")}),U.listen(c.iframe,"activate",function(a){c.fire("iframeFocus",a),c.fire("selectionChanged","activate")})):(U.listen(c.doc,"focusout",function(a){c.fire("iframeBlur",a),c.fire("selectionChanged","focusout")}),U.listen(c.win,"focus",function(a){c.fire("iframeFocus",a),c.fire("selectionChanged","focus")}),U.listen(c.win,"blur",function(a){c.fire("iframeBlur",a),c.fire("selectionChanged","blur")}))}function j(a){var b=this,c=b.rawConfig;return["<head>","<title>"+P.t("编辑邮件正文")+"</title>",'<meta name="referrer" content="origin" />',"<style>","html{word-wrap:break-word;}","body{color:",a.forecolor||b.forecolor,";font-size:",b.fontsize||b.fontsize,";font-family:",a.fontname||b.fontname,";line-height:1.7;padding:8px 10px;margin:0;background-color:#fff;}","pre{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;font-family:arial;}","span.typoRed{border-bottom:2px dotted #ff0000;cursor:pointer;}","*, *::after, *::before {-webkit-user-drag: none;-webkit-app-region: no-drag;}",".nui-scroll{overflow:auto}",".nui-scroll::-webkit-scrollbar{width: 8px;height:8px}",".nui-scroll::-webkit-scrollbar-track{border-radius:10px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0);}",".nui-scroll::-webkit-scrollbar-track:hover{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.4);background-color:rgba(0,0,0,0.01)}",".nui-scroll::-webkit-scrollbar-track:active{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,0.4);background-color:rgba(0,0,0,0.05)}",".nui-scroll::-webkit-scrollbar-thumb{background-color: rgba(0, 0, 0, 0.05);border-radius:10px;-webkit-box-shadow:inset 1px 1px 0 rgba(0,0,0,.1)}",".nui-scroll:hover::-webkit-scrollbar-thumb{background-color: rgba(0, 0, 0, 0.2);border-radius:10px;-webkit-box-shadow:inset 1px 1px 0 rgba(0,0,0,.1)}",".nui-scroll::-webkit-scrollbar-thumb:hover{background-color:rgba(0, 0, 0, 0.4);-webkit-box-shadow:inset 1px 1px 0 rgba(0,0,0,.1)}",".nui-scroll::-webkit-scrollbar-thumb:active{background:rgba(0,0,0,0.6);}",".APP-editor-unselectable{-moz-user-select: none;-khtml-user-select: none;-webkit-user-select: none;-user-select: none;user-select: none;}",".table-cell-higlight{background-color:#E9F3FF !important}",".nui-layer{border-radius:4px;outline:none;position:absolute;z-index:500;padding:8px 12px;text-align:left;font-size:12px;line-height:1.666;border:1px solid #bbb;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.2);cursor:default;zoom:1}",".nui-layer-arr{position:absolute;overflow: hidden}",".nui-layer-arr,",".nui-layer-arrDown .nui-layer-arr,",".nui-layer-arrUp .nui-layer-arr{width:20px;height:11px;left:32px}",".nui-layer-arr,",".nui-layer-arrUp .nui-layer-arr{top:-11px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALBAMAAACNJ7BwAAAAA3NCSVQICAjb4U/gAAAAD1BMVEX////z8/Pv7++7u7v///8eMvrQAAAABXRSTlP/////APu2DlMAAAAJcEhZcwAACpwAAAqcAfTS3xIAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzbovLKMAAAAPElEQVQImT3ISw0AIAwE0cEBSQ1gAYKD4l8T9EP3sJk8Tg073ZVTfmpvO3OBROoAYxydcXQm0JhAYxIfX0wyEWiqWZjeAAAAAElFTkSuQmCC) no-repeat}",".nui-layer-arrDown .nui-layer-arr{top:auto;bottom:-11px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALBAMAAACNJ7BwAAAAA3NCSVQICAjb4U/gAAAAGFBMVEX////z8/Py8vLv7+/u7u68vLy7u7v///973HcvAAAACHRSTlP/////////AN6DvVkAAAAJcEhZcwAACpwAAAqcAfTS3xIAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzbovLKMAAAAQklEQVQImT3IMREAIAwEwR8GATRYwQEaUlPhIG+fhASu2jksZAPaQlXA3JNg7CrG2JNO3zadvm1eaiuS5Op81P0ZHTU/Hp0CkTAYAAAAAElFTkSuQmCC) no-repeat}",".nui-layer-hasClose{padding-right:24px;}",".nui-layer-close{z-index:2;right:8px;top:8px}",".APP-editor-suggestion {font-size: 18px;color: #333333;line-height: 24px;}",".APP-editor-typo-suggesction-btn {float: right;width: 48px;height: 24px;line-height: 22px;text-align: center;color: #3c79dd;border: 1px solid #3c79dd;border-radius: 12px;font-size: 14px;box-sizing: border-box;cursor: pointer;}",".APP-editor-typo-suggestion-reason{font-size: 14px;color: #555555;word-break: break-all;word-wrap: break-word;padding-top: 14px;display:none;}",".APP-editor-typo-suggestion-head{padding: 16px;min-width: 280px;max-width: 480px;box-sizing: border-box;}",".APP-editor-typo-suggestion-footer{text-align: center;font-size: 12px;color: #999999;letter-spacing: 1px;border-top: 1px solid #E1E1E1;line-height: 34px;cursor: pointer;}",".APP-editor-typo-suggestion-footer:hover{background-color: #f2f2f2;}",".nui-layer-typo-suggestion{padding:0;}",".APP-editor-typo-suggestion-text-del{text-decoration: line-through;}",".nui-layer-typo-remind-tips .nui-layer-arr{left: 50%;margin-left: -10px;}",".nui-layer-typo-remind-tips-edge .nui-layer-arr{left: 50%;margin-left: 58px;}","</style>","</head>",'<body class="nui-scroll"',c.opacity?'style="background-color: transparent;"':"",'spellcheck="false" autocorrect="false"  >',a.content||"","</body>"].join("")}function k(b){function c(a){if("|"===a||"||"===a)return e(a);if(Q.isString(a))return d(a);for(var b=a[0],c=['<div class="',"ext"===b?"APP-editor-extOpt":"APP-editor-btnGrp "+b,'">'],f=0,g=a.length;g>f;f++)0!==f&&c.push(d(a[f]));return c.push("</div>"),c.join("")}function d(b,c){if(h[b])return"";var d,e,f,i=g.pluginsInfo[b],j="APP-editor-btn APP-editor-commond-btn APP-editor-commond-"+b,k="basic"===c;if(Q.isObject(i)?(d=i.title||b,j=(i.cls||j)+" "+(i.extcls||" "),e=i.tpl):d=i,k||"fontname"!==b&&"fontsize"!==b){var l=d;f='<b class="ico ico-editor ico-editor-'+b+'">'+l+"</b>"}else f={fontname:P.t("字体"),fontsize:P.t("字号")}[b],j+=" APP-editor-btn-select";return e||(e='<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);"><span class="APP-editor-btn-rc">#{content}</span></a>'),a.Template.fastExec(e,{name:b,aCls:j,title:d,content:f})}function e(a){return'<a href="javascript:void(0);" class="APP-editor-btn APP-editor-btn-spln '+("||"===a?"APP-editor-btn-spln-l":"")+'"></a>'}if(!this.plugins)return"";var f,g=this,h=g.rawConfig.btnNoShow||{},i=[],j=[];if(b=b||Y.BASIC,b===Y.BASIC){for(var k,l=0,m=g.plugins.basic.length;m>l;l++)k=g.plugins.basic[l],"|"!==k&&"||"!==k?"fullScreen"===k?i.push('<div class="APP-editor-btnGrp APP-editor-switchFullScreen">'+d(k,"basic")+"</div>"):i.push(d(k,"basic")):i.push(e(k));return i.join("")}for(var n,l=0,m=g.plugins.full.length;m>l;l++)n=g.plugins.full[l],Q.isObject(n)?Q.each(n,function(a,b){S[a]()&&j.push(c(b))}):j.push(c(n));return f=j.join(""),b===Y.FULL?f:b===Y.SOURCE?f.replace(P.t("切换到源码功能"),"###").replace(/title=\"[^\"#]+\"/gi,"title="+P.t("源码模式下不能使用该功能")).replace(/APP-editor-btn\s+APP-editor-btn-switchSource/,"APP-editor-btn APP-editor-btn-switchSource APP-editor-btn-selected").replace("###",P.t("返回可视化视图")).replace("fullsource","sourcefull"):""}function l(a){var c=this,d=c.editMode;a=a||{},a.height=a.height||c.height,a.width=a.width||c.width;var e,f=b.parseInt(a.height)-2;d!==Y.TEXT&&(e=d===Y.HIDE?0:40,f-=e),c.textarea.css({height:f+"px"}),c.innerDv.css({height:f+"px",width:a.width}),c.height=a.height,c.width=a.width}function m(a){var b=this,c=b.editMode;if(a=a,c===a)return!1;if(!b.toolbarInit[a]&&"source"!==a){var d=b.getToolbarHtml(a);b[a+"TBDv"].html(d),b.toolbarInit[a]=!0,b.pluginBtn={}}var e,f,g=b.innerDv,h="";g.replaceClass("APP-editor-"+c,"APP-editor-"+a),b.editMode=a;var i=[Y.HIDE,Y.FULL,Y.BASIC];R.has(i,c)&&R.has(i,a)?b.focus():(e=c===Y.TEXT||c===Y.SOURCE?c:Y.FULL,f=a===Y.TEXT?"text":"html",h=b.getContent(e,f),b.setContent(h),b.focus(!1)),b.setSize();var j=b.doc.body.firstChild.innerHTML;if(""===j||"<br>"===j){var k=b.cmd.selection.getRange();k.setStart(b.doc.body.firstChild,0).setEnd(b.doc.body.firstChild,0).setCursor(!0)}b.fire("modeChanged")}function n(){return this.editMode===Y.SOURCE}function o(b){var c=this;return a(c.body).find(b)}function p(a,b){var c=this;if(!c.rendered)return"";var d="";try{a=a||Y.FULL,b=b||"html";var d="",e=c.body;if(a===Y.TEXT||a===Y.SOURCE)d=c.textarea.dom.value,"html"===b&&a!==Y.SOURCE?d=M.textToHtml(d):"text"===b&&a===Y.SOURCE&&(d=T.trim(M.htmlToText(d)));else{var f=e;if(e.querySelector("#typoMenuDv")){f=e.cloneNode(!0);var g=f.querySelector("#typoMenuDv");f.removeChild(g)}d="text"===b?M.getDomText(f,!0):f.innerHTML}d=d.replace(M.fillCharReg,""),"html"===b&&(d=M.filterHtml(d)),a===Y.SOURCE&&(/^[\s\n\r]*<div>/.test(d)||(d="<div>"+d+(S.ie()?"":"<br>")+"</div>"))}catch(h){}return d}function q(a,b){var c=this;if(!c.rendered)return c.listen("afterRender",function(){c.setContent(a,b)}),void 0;b=b||c.editMode,c.changeMode(b);try{b===Y.TEXT||b===Y.SOURCE?c.textarea.dom.value=a:(a=M.filterHtml(a),c.body.innerHTML=a)}catch(d){}}function r(a,b){var c,d=this;return a!==Y.TEXT?(c=d.getContent(a,b),c=['<div style="line-height:1.7;color:',d.forecolor,";font-size:",d.fontsize,";font-family:",d.fontname,'">',c,"</div>"].join("")):c=d.getContent(a,b),c}function s(a,b){var c=this;return c.getIframeHtml({content:this.getFinalContent(a,b)})}function t(){return this.cmd.selection.getText()}function u(){var a=M.htmlToText(this.cmd.selection.getText());return T.trim(a,!0)}function v(a){for(var b="",c='<p style="margin: 0;"><br></p>';a>0;)b+=c,a--;return b}function w(a){var b=this;return a===!1?(this.maskDv.hide(),this.isMask=!1):(this.maskDv.dom.style.display="block",this.isMask=!0,Q.isNumber(a)&&setTimeout(function(){b.maskDv.hide(),b.isMask=!1},a)),b}function x(a){var c=this;try{if(a&&Q.isObject(a)){var d=a.name||"win";"win"==d?c.win.focus():"doc"==d?c.doc.focus():"body"==d&&c.doc.body.focus();var e=a.element;if(a.id&&(e=c.doc.getElementById(a.id)),e){e=e.dom||e;var f=+a.pos;isNaN(f)&&(f=0);var g;if(b.getSelection){var h=c.win.getSelection();if(!h)return!1;h.rangeCount>0&&h.removeAllRanges();var i=e.firstChild||e;g=c.doc.createRange(),g.selectNode(i),g.setStart(i,f),g.collapse(!0),h.addRange(g)}else g=(e.createTextRange?e:c.doc.body).createTextRange(),g.moveToElementText(e),g.moveStart("character",f),g.collapse(!0),g.select()}}else c.editMode===Y.SOURCE||c.editMode===Y.TEXT?c.textarea.focus():c.cmd.focus(a)}catch(j){}return c}function y(){var a=this;return a.history?a.history.save():void 0}function z(a){var d=this;if(a===c||null===a)return d.tipsDv.hide(),d.tipsSpan.html(""),d._tipsTimer=null,void 0;d.editMode;var e=40;Q.isString(a)&&(a={content:a});var f=a.content||"";d._tipsTimer&&b.clearTimeout(d._tipsTimer),d.tipsSpan.html(f),d.tipsDv.css({top:e+"px"}).show()}function A(a){var b=this;if(b.cmd[a]){var c=!/focus|Value|State/.test(a);c&&b.history.save();var d=b.cmd[a].apply(b.cmd,[].slice.call(arguments,1));return c&&b.cmd.selection.getRange().select(),d}}function B(a){var b=this;return b.exec("insertHtml",a),b}function C(){var a=this;return a.insertPortrait("http://mimg.127.net/p/js5/lib/img/currenttime.png",P.t("写信时会自动替换为当天日期"))}function D(c,d,e,f,g){function h(){e=b.parseInt(k.width),f=b.parseInt(k.height);var c=i.doc.getElementById(j.id);if(c){try{c.removeAttribute("id")}catch(d){c.id=""}c.setAttribute("orgwidth",e),c.setAttribute("orgheight",f),c.setAttribute("data-image",1);var g=.8*i.getEl().width();if(i.imageAutoSize&&g){var h=b.parseInt(g>=e?e:g),l=b.parseInt(f*h/e);if(c.style.width=h+"px",c.style.height=l+"px",h!==e){var m=a.Link.html({text:P.t("显示原始尺寸大小"),extcls:"nui-txt-link",click:function(){try{c.style.width=e+"px",c.style.height=f+"px"}catch(a){}i.showTips()}});i.showTips(P.t("图片尺寸过大，已为您智能缩小显示，图片质量不变 ")+m),a.Component.setEvents()}}else c.style.width=e+"px",c.style.height=f+"px"}}var i=this,j={src:c,title:d,style:{width:e?e+"px":"",height:f?f+"px":""},align:g,id:"editorInsertImg_"+i._eIndex++};i.exec("insertImage",j);var k=i.doc.createElement("IMG");k.onload=h,k.onerror=function(){var a=i.doc.getElementById(j.id);if(a)try{a.removeAttribute("id")}catch(b){a.id=""}},k.src=c}function E(a,b){var c=this;return c.exec("insertImage",{src:a,title:b}),c.win.focus(),c}function F(b){function c(){var a=document.createElement("span");return a.setAttribute("contenteditable",!0),a}function d(b){if(a.Browser.isIE()){b.setAttribute("contenteditable",!0);var d=c();e(d),b.innerHTML="",b.appendChild(d)}else b.setAttribute("contenteditable",!1),e(b);return b}function e(a){a.innerHTML="@"+i,a.style.backgroundColor=l?"#FFF777":"#E0E0E0",a.style.borderRadius="2px",a.style.padding="1px 2px",a.style.color="#333333",a.style.textDecoration="none",a.setAttribute("ntes_mm_email",h)}function f(a){var b=g.doc.createTextNode(" ");a.parentNode.insertBefore(b,a);var c=g.doc.createTextNode(" ");return a.parentNode.insertBefore(c,a.nextSibling),c}var g=this,h=b.address,i=b.name||h,j=g.cmd.selection.getRange(),k=g.cmd.selection.getNative().focusNode,l=h==$S("orgUid");if(o="SPAN"==k.tagName?k:k.parentNode,"SPAN"==o.tagName&&"@"==o.getAttribute("ntes_mm_email")){var m=d(o),n=f(m);g.focus({element:n,pos:1}),g.atLink.start=!1}else{var o=g.doc.createElement("SPAN"),m=d(o);j.insertNode(m);var n=f(m);g.focus({element:n,pos:1})}}function G(a){var b=this,c=a.element,d=a.tag,e=a.reg;if(c)c.parentNode.removeChild(c);else if(d&&e)for(var f=b.doc.getElementsByTagName(d),g=0;g<f.length;g++){var h=f[g],i=h.src;e.test(i)&&(h.parentNode.removeChild(h),g--)}}function H(a){try{var b="editor_"+a;if(b){var c={};c[b]=1,W.cache(c,function(a){a&&a.value++})}}catch(d){}}function I(a){if(a&&""!==a){var b=/(\s*)<(\/)?([\w\-:]+)((?:\s+|(?:\s+[\w\-:]+)|(?:\s+[\w\-:]+=[^\s"'<>]+)|(?:\s+[\w\-:"]+="[^"]*")|(?:\s+[\w\-:"]+='[^']*'))*)(\/)?>(\s*)/g;return a=a.replace(b,function(a,b,c,d,e,f,g){return b=b||"",c=c||"",e=e||"",f=f?" "+f:"",g=g||"",e&&(e=e.replace(/display\:\s*none;?/gi,"")),b+"<"+c+d+e+f+">"+g})}}function J(a){return a?a.replace(/./,function(a){return a.toUpperCase()}):a}try{var K=$L("component.editor.Dtd")}catch(L){return L}try{var M=$L("component.editor.Util")}catch(L){return L}try{$L("component.editor.Range")}catch(L){return L}try{$L("component.editor.Selection")}catch(L){return L}try{var N=$L("component.editor.Cmd")}catch(L){return L}var O=a.getClass($N("component.editor.plugin"));try{$L("component.editor.plugin.Fontname")}catch(L){return L}try{$L("component.editor.plugin.Fontsize")}catch(L){return L}try{$L("component.editor.plugin.Forecolor")}catch(L){return L}try{$L("component.editor.plugin.Basic")}catch(L){return L}try{$L("component.editor.plugin.Full")}catch(L){return L}try{$L("component.editor.plugin.History")}catch(L){return L}try{$L("component.editor.plugin.AutoLink")}catch(L){return L}try{$L("component.editor.plugin.AtLink")}catch(L){return L}try{$L("component.editor.plugin.ImageResize")}catch(L){return L}try{$L("component.editor.plugin.EnterLine")}catch(L){return L}try{$L("component.editor.plugin.Tab")}catch(L){return L}try{$L("component.editor.plugin.CurrentTime")}catch(L){return L}try{$L("component.editor.plugin.FormatMatch")}catch(L){return L}try{$L("component.editor.plugin.Bold")}catch(L){return L}try{$L("component.editor.plugin.Italic")}catch(L){return L}try{$L("component.editor.plugin.Underline")}catch(L){return L}try{$L("component.editor.plugin.Backcolor")}catch(L){return L}try{$L("component.editor.plugin.Copy")}catch(L){return L}try{$L("component.editor.plugin.Cut")}catch(L){return L}try{$L("component.editor.plugin.Dict")}catch(L){return L}try{$L("component.editor.plugin.Indent")}catch(L){return L}try{$L("component.editor.plugin.InsertHorizontalRule")}catch(L){return L}try{$L("component.editor.plugin.InsertTable")}catch(L){return L}try{$L("component.editor.plugin.InsertTime")}catch(L){return L}try{$L("component.editor.plugin.Justify")}catch(L){return L}try{$L("component.editor.plugin.Lineheight")}catch(L){return L}try{$L("component.editor.plugin.Link")}catch(L){return L}try{$L("component.editor.plugin.List")}catch(L){return L}try{$L("component.editor.plugin.Paste")}catch(L){return L}try{$L("component.editor.plugin.Redo")}catch(L){return L}try{$L("component.editor.plugin.RemoveFormat")}catch(L){return L}try{$L("component.editor.plugin.SetDefault")}catch(L){return L}try{$L("component.editor.plugin.Source")}catch(L){return L}try{$L("component.editor.plugin.Typo")}catch(L){return L}try{$L("component.editor.plugin.Typo2")}catch(L){return L}try{$L("component.editor.plugin.Undo")}catch(L){return L}try{$L("component.editor.plugin.OrderList")}catch(L){return L}try{$L("component.editor.plugin.UnorderList")}catch(L){return L}try{$L("component.editor.plugin.CutIndent")}catch(L){return L}try{$L("component.editor.plugin.AddIndent")}catch(L){return L}try{$L("component.editor.plugin.StrikeThrough")}catch(L){return L}try{$L("component.editor.plugin.Find")}catch(L){return L}try{$L("component.editor.plugin.FindAndReplace")}catch(L){return L}try{$L("component.editor.plugin.More")}catch(L){return L}var P=new $I18N("component.editor.Editor"),Q=a.Object,R=a.Array,S=a.Browser,T=a.String,U=a.Event,V=a.Element,W=b.Log||a.Log,X=a.getClass("netease.mail.component.Component"),Y={BASIC:"basic",FULL:"full",SOURCE:"source",TEXT:"text",HIDE:"hide"},Z={basic:["undo","redo","removeFormat","formatMatch","|","fontname","fontsize","bold","italic","underline","strikeThrough","|","forecolor","backcolor","|","justify","unorderList","orderList","addIndent","cutIndent","lineheight","|","image","insertTable","sign","|","insertHorizontalRule","portrait","source","link","|","find","findAndReplace","|","typo","typo2","translate","dict","notary","more","fullScreen"],full:[]},$={fontname:{title:P.t("选择字体"),tpl:['<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);">','<span class="APP-editor-btn-rc">','<b class="ico ico-editor ico-editor-fontname">#{title}</b>',"</span>",'<span class="ico-editor-arrowDown-active"></span>',"</a>"].join(" ")},fontsize:{title:P.t("字号"),tpl:['<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);">','<span class="APP-editor-btn-rc">','<b class="ico ico-editor ico-editor-fontsize">#{title}</b>',"</span>",'<span class="ico-editor-arrowDown-active"></span>',"</a>"].join(" ")},forecolor:{title:P.t("选择字体颜色"),tpl:['<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);">','<span class="APP-editor-btn-rc">','<b class="ico ico-editor ico-editor-forecolor">#{title}</b>','<span class="APP-editor-color-preview" style="height:2px;"></span>',"</span>",'<span class="ico-editor-arrowDown-active"></span>',"</a>"].join(" ")},backcolor:{title:P.t("选择字体背景"),tpl:['<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);">','<span class="APP-editor-btn-rc">','<b class="ico ico-editor ico-editor-backcolor">#{title}</b>','<span class="APP-editor-color-preview" style="height:2px;"></span>',"</span>",'<span class="ico-editor-arrowDown-active"></span>',"</a>"].join(" ")},formatMatch:P.t("格式刷"),lineheight:{title:P.t("设置行高"),tpl:['<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);">','<span class="APP-editor-btn-rc">','<b class="ico ico-editor ico-editor-lineheight">#{title}</b>','<span class="ico-editor-arrowDown-active"></span>',"</span>","</a>"].join(" ")},indent:P.t("设置缩进"),justify:{title:P.t("选择对齐方式"),tpl:['<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);">','<span class="APP-editor-btn-rc">','<b class="ico ico-editor ico-editor-justify">#{title}</b>','<span class="ico-editor-arrowDown-active"></span>',"</span>","</a>"].join(" ")},sign:{title:P.t("签名"),tpl:['<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);">','<span class="APP-editor-btn-rc">','<b class="ico ico-editor ico-editor-sign">#{title}</b>','<span class="ico-editor-arrowDown-active"></span>',"</span>","</a>"].join(" ")},more:{title:P.t("更多"),tpl:['<a editorcmd="#{name}" class="#{aCls}" title="#{title}" href="javascript:void(0);">','<span class="APP-editor-btn-rc">','<b class="ico ico-editor ico-editor-more">#{title}</b>','<span class="ico-editor-arrowDown-active"></span>',"</span>","</a>"].join(" ")},list:P.t("设置列表"),bold:P.t("加粗"),italic:P.t("斜体"),underline:P.t("下划线"),link:P.t("插入/删除链接"),portrait:P.t("添加表情"),image:P.t("添加图片"),insertHorizontalRule:P.t("插入横线"),insertTable:P.t("添加表格"),insertTime:P.t("添加日期"),currentTime:P.t("当前日期(自动更新)"),copy:P.t("复制"),cut:P.t("剪切"),capture:P.t("截图"),editImage:P.t("编辑图片"),paste:P.t("粘贴"),removeFormat:P.t("清除格式"),setDefault:P.t("设置默认"),stationery:P.t("添加信纸"),microphone:P.t("语音输入"),backspace:P.t("退格"),typo:{title:P.t("拼写检查")},typo2:{title:P.t("英文智能检查")},dict:{title:P.t("查词典")},source:{title:P.t("切换到源码功能"),extcls:"APP-editor-btn-switchSource "},undo:{title:P.t("撤销"),extcls:"APP-editor-btn-dis"},redo:{title:P.t("重做"),extcls:"APP-editor-btn-dis"},translate:P.t("网易专业翻译，轻松读写英文邮件"),notary:P.t("邮件存证"),fullScreen:{tpl:'<a editorcmd="fullScreen" class="APP-editor-commond-btn APP-editor-switchFullScreen-toFull" title="'+P.t("写信全屏")+'" href="javascript:void(0);"><b class="ico ico-editor ico-editor-toFullScr"></b></a>'},toFullScr:{title:P.t("写信全屏")},toMiniScr:{title:P.t("取消全屏")},find:{title:P.t("查找")},findAndReplace:{title:P.t("查找替换")},strikeThrough:P.t("删除线"),orderList:P.t("有序列表"),unorderList:P.t("无序列表"),cutIndent:P.t("减少缩进"),addIndent:P.t("增加缩进")},_=a.createClass($N("component.editor.Editor"));Q.mix(_,X,{xtype:"editor",mode:Y,_cssClass:{baseclass:{cls:"APP-editor",tpl:['<div style="position:relative;" class="">','<div class="APP-editor #{modeCls}">','<div class="APP-editor-tbar" style="z-index:2;">','<div class="APP-editor-tbar-basic">#{basicToolbar}</div>',"</div>",'<div class="APP-editor-edtr" style="position:relative;">','<div class="APP-editor-edtr-mask" style="display:none"></div>','<iframe frameBorder="0" tabIndex="#{tabIndex}" class="APP-editor-iframe" style="position:absolute" #{opacityStyle}></iframe>','<textarea tabIndex="#{tabIndex}" class="APP-editor-textarea"></textarea>',"</div>","</div>",'<div class="APP-editor-autoReduceWp" style="display:none;">','<div class="APP-editor-autoReduce nui-assistBlock">',"<span></span>",'<a href="javascript:void(0);" class="nui-ico nui-ico-x" title="'+P.t("关闭")+'"></a>',"</div>","</div>","</div>"].join("")}},_listeners:[{name:"render",handler:function(){var a=this,b=a.getEl();a.editDv=b,a.innerDv=b.find("div.APP-editor"),a.toolbarDv=b.find("div.APP-editor-tbar"),a.basicTBDv=b.find("div.APP-editor-tbar-basic"),a.fullTBDv=b.find("div.APP-editor-tbar-full"),a.sourceTBDv=b.find("div.APP-editor-tbar-source"),a.editAreaDv=b.find("div.APP-editor-edtr"),a.maskDv=b.find("div.APP-editor-edtr-mask"),a.tipsDv=b.find("div.APP-editor-autoReduceWp"),a.tipsSpan=a.tipsDv.find("span"),a.iframe=b.find("iframe.APP-editor-iframe"),a.textarea=b.find("textarea.APP-editor-textarea");var c=a.iframe.dom;a.doc=V.getIframeDoc(c),a.win=V.getWin(a.doc),a.doc.open("text/html","replace"),a.doc.write(a.getIframeHtml(a.rawConfig)||""),a.doc.close(),S.ie()?(a.doc.body.disabled=!0,a.doc.body.contentEditable=!0,a.doc.body.disabled=!1):a.doc.body.contentEditable=!0,S.isIE("<9")&&a.basicTBDv.addClass("APP-editor-tbar-ie8"),a.body=a.doc.body,a.doc.body.innerHTML&&"<br>"!==a.doc.body.innerHTML||(a.doc.body.innerHTML=S.ie()?'<p style="margin:0;"></p>':'<p style="margin:0;"><br></p>'),a.isMask&&a.maskDv.show(),a.setSize(),a.initEvents(),a.cmd=new N(a.doc),a.history=new a.plugin.History(a),a.history.smartSave(),a.focus()},custom:!0},{name:"afterRender",handler:function(){var a=this;try{for(var b=["AutoLink","AtLink","ImageResize","EnterLine","Tab","CurrentTime","FormatMatch","Bold","Italic","Underline","Backcolor","Copy","Cut","Dict","Indent","InsertHorizontalRule","InsertTable","InsertTime","Justify","Lineheight","Link","List","Paste","Redo","RemoveFormat","SetDefault","Source","Typo","Typo2","Undo","OrderList","UnorderList","CutIndent","AddIndent","StrikeThrough","Find","FindAndReplace","More"],c=0,d=b.length;d>c;c++)$L("component.editor.plugin."+b[c],a)}catch(e){return e}try{a.plugin.AutoLink.selected.call(a),a.plugin.AtLink.selected.call(a),a.plugin.ImageResize.selected.call(a),a.plugin.EnterLine.selected.call(a),a.plugin.Tab.selected.call(a),a.plugin.More.init.call(a),a.plugin.Fontname.init.call(a),a.plugin.Fontsize.init.call(a),a.plugin.Forecolor.init.call(a),a.plugin.Backcolor.init.call(a),a.plugin.InsertTable.init.call(a),a.plugin.Typo.init.call(a),a.plugin.Typo2.init.call(a),a.plugin.Paste.init.call(a)}catch(e){}},custom:!0},{name:"destroy",handler:function(){var b=this;b.history&&(b.history._poll.length=0,delete b.history),Q.each(b.eventPoll,function(a,b){R.each(b,function(b,c){c.bind?U.unlisten(c.context,a,c.handler):U.die(c.context,a,c.selector,c.handler)}),b.length=0}),a.Object.each(b.plugin,function(a,c){c.destroy&&"function"==typeof c.destroy&&c.destroy(b)}),delete b.eventPoll,delete b.pluginBtn,R.each(["editDv","innerDv","toolbarDv","basicTBDv","fullTBDv","sourceTBDv","editAreaDv","maskDv","iframe","textarea","doc","win","body"],function(){b[sName]=null})},custom:!0},{name:"iframeBlur",handler:function(){var a=this;a.innerDv.removeClass("APP-editor-active")},custom:!0},{name:"iframeFocus",handler:function(){var a=this;a.innerDv.addClass("APP-editor-active")},custom:!0},{name:"selectionChanged",handler:function(b){var c,d,e,f,g,h=this,i=h.editMode,j=["bold","italic","underline","strikeThrough"],k=["undo","redo"];for(e=0,f=j.length;f>e;e++)g=j[e],h.pluginBtn[g]||(h.pluginBtn[g]=h.toolbarDv.find("a.APP-editor-commond-"+g)),c=!h.cmd[g.toLowerCase()+"State"]()||i!==Y.BASIC&&i!==Y.FULL?"removeClass":"addClass",h.pluginBtn[g]&&h.pluginBtn[g][c]("APP-editor-btn-on");if("docClick"===b||"keyup"===b){var l=h.exec("fontfamilyValue").replace(/['"]/g,""),m=h.exec("fontsizeValue").replace(/['"]/g,""),n=h.plugin.Fontname.getName(l),o=a(h.getEl().dom).find(".ico-editor-fontname"),p=a(h.getEl().dom).find(".ico-editor-fontsize");o&&o.html(n),p&&p.html(m.replace("px",""))}for(e=0,f=k.length;f>e;e++)g=k[e],h.pluginBtn[g]||(h.pluginBtn[g]=h.toolbarDv.find("a.APP-editor-commond-"+g)),d="undo"===g?"canUndo":"canRedo",c=h.history[d]()?"removeClass":"addClass",h.pluginBtn[g]&&h.pluginBtn[g][c]("APP-editor-btn-dis");if(j.length=0,k.length=0,!h.doc.body.innerHTML||"<br>"===h.doc.body.innerHTML){h.doc.body.innerHTML=S.ie()?'<p style="margin:0;"></p>':"<p><br></p>";var q=h.cmd.selection.getRange();q.setStart(h.doc.body.firstChild).setCursor(!0)}},custom:!0}]},{editMode:Y.BASIC,tabIndex:1,_eIndex:1,width:"100%",height:"500px",fontsize:"14px",forecolor:"#000000",fontname:"Arial",imageAutoSize:!0,content:"",setDefault:!0,opacity:!1,isMask:!1,openHistory:!0,inputType:!1,initialize:d,_getData:e,getUdInfo:f,addListener:g,initEvents:i,editorToolbarClick:h,getIframeHtml:j,getToolbarHtml:k,setSize:l,changeMode:m,getIframeEl:o,getContent:p,setContent:q,getFinalContent:r,getPreviewContent:s,getSelectHtml:t,getSelectText:u,getBreakLine:v,showMask:w,focus:x,historySave:y,showTips:z,exec:A,insertHtml:B,insertCurrentTime:C,insertImage:D,insertPortrait:E,insertAtNode:F,del:G,log:H,filterDisplayNone:I,isSourceMode:n,_upperChar:J})}($,window),function(a){function b(){var a=this;a.editMode,a.exec("indent","indent")}new $I18N("component.editor.plugin.Indent");var c=a.Object;a.getClass($N("component.Menu"));var d=a.createClass($N("component.editor.plugin.AddIndent"));c.extend(d,{selected:b})}($,window),function(a){function b(a){var b=this;b.editor=a,b.start=!1,b.atList=[]}function c(){var b=this;if(a.Ext.composeAt){var c=b.atLink;c||(c=new g(b),b.atLink=c),b.listen("iframeKeydown",function(e){var f=8;if(c.start){var g=b.cmd.selection.getNative();b.composeEditor.at.fireKeydown(g.focusNode,e)}if((e.keyCode===f||e.code===f)&&a.Browser.firefox()){var h=b.cmd.selection.getRange();if(h.collapsed){var i=b.doc.querySelector("span[ntes_mm_email]");if(i){var j=document.createElement("div");j.id="_ntes_mm_email_position_marker_",h.insertNode(j);var k=j.previousSibling;if(k&&3===k.nodeType&&""===k.nodeValue){var l=k;k=k.previousSibling,d.remove(l)}return k&&k.getAttribute&&k.getAttribute("ntes_mm_email")&&(h.setStartBefore(k).collapse(),d.remove(k)),d.remove(j),void 0}}}if(e.shiftKey&&("50"==e.keyCode||"Digit2"==e.code||e.char&&"@"==e.char||e.keyIdentifier&&"U+0040"==e.keyIdentifier)){c.start=!0;var g=b.cmd.selection.getNative(),h=g.getRangeAt(0).cloneRange(),j=b.doc.createElement("SPAN");if(j.innerHTML="@",j.setAttribute("ntes_mm_email","@"),/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&229===e.keyCode){if(h&&h.endContainer){var m=h.endContainer,n=m.wholeText.indexOf("@");if(-1!==n&&n===m.wholeText.length-1){var o=m.wholeText.split("");o.pop();var p=o.join("");m.nodeValue=p}h.setStart(m,m.wholeText.length)}}else a.Browser.isIE()&&a.Event.stop(e);h.insertNode(j),h.setStart(j,1),h.collapse(!0),g.removeAllRanges(),g.addRange(h),a.Event.cancel(e)}}),b.listen("iframeInput",function(){if(c.start){var a=b.cmd.selection.getNative(),d=a.getRangeAt(0).cloneRange(),e=a.focusNode;e&&"@@"==e.wholeText&&(e.nodeValue="@",d.setStart(e,1),d.collapse(!0),a.removeAllRanges(),a.addRange(d))}}),b.listen("iframeKeyup",function(a){var d=a.keyCode||a.which;if(c.start){if(27==d)return c.start=!1,void 0;var e,f=b.cmd.selection.getNative(),g=f.focusNode;g&&g.wholeText?e=g.wholeText||"":"SPAN"==g.tagName&&"@"==g.getAttribute("ntes_mm_email")&&(e="@"),e&&0==e.indexOf("@")||(c.start=!1),b.composeEditor.at.fireKeyup(f.focusNode,a)}})}}try{var d=$L("component.editor.Util")}catch(e){return e}var f=a.Object;a.Browser;var g=a.createClass($N("component.editor.plugin.AtLink"));f.extend(g,{selected:c}),f.extend(g.prototype,{initialize:b})}($,window),function(a){function b(){if(!f.ie()){var b=this;b.listen("iframeKeydown",function(d){var e=d.keyCode||d.which;if(32==e||13==e){for(var f,g,h,i=b.cmd.selection.getNative(),j=i.getRangeAt(0).cloneRange(),k=j.startContainer;1==k.nodeType&&j.startOffset>0&&(k=j.startContainer.childNodes[j.startOffset-1]);)j.setStart(k,1==k.nodeType?k.childNodes.length:k.nodeValue.length),j.collapse(!0),k=j.startContainer;do{if(0==j.startOffset){for(k=j.startContainer.previousSibling;k&&1==k.nodeType;)k=k.lastChild;if(!k||c.isFillChar(k))break;f=k.nodeValue.length}else k=j.startContainer,f=j.startOffset;j.setStart(k,f-1),g=j.toString().charCodeAt(0)}while(160!=g&&32!=g);if(0==j.toString().indexOf("@"))return;
if(j.toString().replace(new RegExp(c.fillChar,"g"),"").match(/(?:https?:\/\/|(mailto:)?[a-zA-Z0-9-_\.]+@[a-zA-Z0-9-\.]+\.[a-zA-Z]+$|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){for(;j.toString().length&&!/^(?:https?:\/\/|(mailto:)?[a-zA-Z0-9-_\.]+@[a-zA-Z0-9-\.]+\.[a-zA-Z]+$|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(j.toString());)try{j.setStart(j.startContainer,j.startOffset+1)}catch(l){for(var k=j.startContainer;!(h=k.nextSibling);){if(c.isBody(k))return;k=k.parentNode}j.setStart(h,0)}if(c.findParentByTagName(j.startContainer,"a",!0))return;var m,n=b.doc.createElement("a"),o=b.doc.createTextNode(" ");n.appendChild(j.extractContents());var p=n.innerHTML.replace(/<[^>]+>/g,"");p=a.String.decodeHTML(p),n.href=n.innerHTML=p,m=n.getAttribute("href").replace(new RegExp(c.fillChar,"g"),""),m=/^(?:https?:\/\/)/gi.test(m)?m:/^(?:mailto?:)/gi.test(m)?m:/^(?:[a-zA-Z0-9-_\.]+@[a-zA-Z0-9-\.]+\.[a-zA-Z]+$)/gi.test(m)?"mailto:"+m:m,n.setAttribute("_src",m),n.href=m,j.insertNode(n),n.parentNode.insertBefore(o,n.nextSibling),j.setStart(o,0),j.collapse(!0),i.removeAllRanges(),i.addRange(j)}}})}}try{var c=$L("component.editor.Util")}catch(d){return d}var e=a.Object,f=a.Browser,g=a.createClass($N("component.editor.plugin.AutoLink"));e.extend(g,{selected:b})}($,window),function(a){function b(){var a=k[1];j.updateSelectedColorOnBtn(a),j.selectedColor=a}function c(b,c){var d=this,e=d.editMode;if(!a(b.target||b.srcElement).hasClass("ico-editor-arrowDown-active"))return d.exec("backcolor",j.selectedColor),!1;var f=d[e+"BackcolorMenu"];if(!f){var g=j.initMenuConf(d);f=new i(g),f.attachTo({clickFrom:a(c).find(".ico-editor-arrowDown-active"),delegateTo:"self"}),f.fire("attachToShow"),d[e+"BackcolorMenu"]=f}setTimeout(function(){var a=(d.exec("backcolorValue")||"").replace(/'/g,"");"transparent"!==a&&a||(a=j.selectedColor||k[1]);var b=!1;h.each(f.items,function(c,d){d.checked&&d.setChecked(!1),d.value===a&&(d.setChecked(!0),b=!0)}),!b&&f.items&&"setDefault"!==a&&f.items[0].setChecked(!0)},0)}function d(a){var b=this,c={xtype:"menu",groups:[{items:b.getColorBlocks(k),checkType:"radio"},{items:b.getColorBlocks(l),checkType:"radio"}],extcls:"APP-editor-color-picker",onItemClick:function(b){"setDefault"!==b.value&&(a.exec("backcolor",b.value),j.selectedColor=b.value,j.updateSelectedColorOnBtn(b.value))},width:"220px"};return b.config=c,c}function e(b){return a.Array.map(b,function(a,b){return{text:'<b class="APP-editor-ico-color" style="background:'+b+";"+'"></b>',value:b,code:b,checked:"#ffffff"===b}})}function f(b){j.selectedColor=b;var c=a(".APP-editor-commond-backcolor");c&&c.find(".APP-editor-color-preview").css({backgroundColor:b})}new $I18N("component.editor.plugin.Backcolor");var g=a.Object,h=a.Array,i=a.getClass($N("component.Menu")),j=g.extend(a.createClass($N("component.editor.plugin.Backcolor")),{init:b,selectedColor:"",selected:c,initMenuConf:d,updateSelectedColorOnBtn:f,getColorBlocks:e,config:{}}),k=["#9e0f30","#dd4032","#fe840f","#fff566","#77c94b","#8d9440","#97dedf","#174e85","#9896a4","#90a6d2"],l=["#ffffff","#808080","#fff2cc","#fff7e6","#fff1f0","#e6fadc","#e6f7fa","#dce6f0","#c8dcf0","#f9efff","#f4f5f8","#595959","#ffe598","#fdd5b4","#e7b8b7","#c4e0b2","#92ccde","#b8cde5","#8eb2e5","#cbc0db","#d8d8d8","#3f4140","#ffd865","#f4b183","#da9593","#a8d08c","#92ccde","#94b1d9","#538bd7","#b3a1c7","#a6a6a6","#262626","#d4b106","#c55c0f","#963732","#528135","#006c73","#355e93","#15365f","#60487b","#808080","#000000","#876700","#843c0b","#642421","#375622","#00474e","#243e62","#0d2340","#403053"]}($,window),function(a){function b(){var a=this;a.exec("bold")}var c=a.Object,d=a.createClass($N("component.editor.plugin.Bold"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this;a.cmd.copy()}var c=a.Object,d=a.createClass($N("component.editor.plugin.Copy"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this,b="//mimg.127.net/p/js5/lib/img/currenttime.png",d="//mimg.127.net/p/js5/lib/img/currenttime-en.jpg",e=$G.environment.isCh?b:d;a.exec("insertHtml",'<img title="'+c.t("写信时会自动替换为当天日期")+'" src="'+e+'"/>')}var c=new $I18N("component.editor.plugin.CurrentTime"),d=a.Object,e=a.createClass($N("component.editor.plugin.CurrentTime"));d.extend(e,{selected:b})}($,window),function(a){function b(){var a=this;a.exec("cut")}var c=a.Object;c.extend(a.createClass($N("component.editor.plugin.Cut")),{selected:b})}($,window),function(a){function b(){var a=this;a.editMode,a.exec("outdent","outdent")}new $I18N("component.editor.plugin.Indent");var c=a.Object;a.getClass($N("component.Menu")),c.extend(a.createClass($N("component.editor.plugin.CutIndent")),{selected:b})}($,window),function(a){function b(){a.Log.cache({cl_dict:1},a.EMPTYFUNC);try{var b=$L("product.Translate",this)}catch(c){return c}b.change()}var c=a.Object;c.extend(a.createClass($N("component.editor.plugin.Dict")),{selected:b})}($,window),function(a){function b(){var b,d=this,e=d.doc;d.listen("iframeKeyup",function(a){if(13==a.keyCode){var g=d.cmd.selection.getRange(),h=g.startContainer;if("h1"===b||"h2"===b||"h3"===b||"h4"===b||"h5"===b||"h6"===b)if(c.gecko()){var i=c.findParentByTagName(h,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0);i||e.execCommand("formatBlock",!1,"<div>")}else if(1==h.nodeType){var j,k=e.createTextNode("");if(g.insertNode(k),j=c.findParentByTagName(k,"div",!0)){for(var l=e.createElement("div");j.firstChild;)l.appendChild(j.firstChild);j.parentNode.insertBefore(l,j),c.remove(j),g.setStartBefore(k).setCursor()}c.remove(k)}f.opera()&&g.select()}}),d.listen("iframeKeydown",function(g){if(13==g.keyCode){try{if("false"==d.cmd.selection.getNative().focusNode.previousSibling.getAttribute("contenteditable"))return}catch(h){}b="";var i=d.cmd.selection.getRange();if(!i.collapsed){var j=i.startContainer,k=i.endContainer,l=c.findParentByTagName(j,"td",!0),m=c.findParentByTagName(k,"td",!0);if(l&&m&&l!==m||!l&&m||l&&!m)return a.Event.stop(g),void 0}j=c.findParentByTagName(i.startContainer,["ol","ul","div","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),j||f.opera()?(b=j.tagName,"div"==j.tagName.toLowerCase()&&c.gecko()&&c.removeDirtyAttr(j)):(e.execCommand("formatBlock",!1,"<div>"),c.gecko()&&(i=d.cmd.selection.getRange(),j=c.findParentByTagName(i.startContainer,"div",!0),j&&c.removeDirtyAttr(j)))}})}try{var c=$L("component.editor.Util")}catch(d){return d}var e=a.Object,f=a.Browser,g=a.createClass($N("component.editor.plugin.EnterLine"));e.extend(g,{selected:b})}($,window),function(a,b,c){function d(a,b,c){var d=b.searchStr;-1==b.dir&&(a=a.split("").reverse().join(""),d=d.split("").reverse().join(""),c=a.length-c);for(var e,f=new RegExp(z.escapeRegChars(d),"g"+(b.casesensitive?"":"i"));e=f.exec(a);)if(e.index>=c)return-1==b.dir?a.length-e.index-b.searchStr.length:e.index;return-1}function e(a,b,c){var d,e,f=c.all||1==c.dir?"getNextDomNode":"getPreDomNode";u.isBody(a)&&(a=a.firstChild);for(var g=1;a;){if(d=3==a.nodeType?a.nodeValue:u.getDomText(a),e=z.findTextInString(d,c,b),g=0,-1!=e)return{node:a,index:e};for(a=u[f](a);a&&A[a.nodeName.toLowerCase()];)a=u[f](a,!0);a&&(b=-1==c.dir?(3==a.nodeType?a.nodeValue:u.getDomText(a)).length:0)}}function f(a,b,c){for(var d,e=0,f=a.firstChild||a,g=0;f;){if(3==f.nodeType){if(g=f.nodeValue.replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length,e+=g,e>=b)return{node:f,index:g-(e-b)}}else if(!s.empty[f.tagName]&&(g=u.getDomText(f).replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length,e+=g,e>=b&&(d=z.findNTextInBlockElm(f,g-(e-b),c))))return d;f=u.getNextDomNode(f)}}function g(a,b){var d,e=a.cmd.selection.getRange(),f=b.searchStr,g=a.doc.createElement("span");if(g.innerHTML="$$ntes_findandrepalce_marker$$",e.shrinkBoundary(!0),!e.collapsed){e.select();var h=a.cmd.selection.getText();if(new RegExp("^"+z.escapeRegChars(b.searchStr)+"$",b.casesensitive?"":"i").test(h)){if(b.replaceStr!=c)return z.replaceText(e,b.replaceStr),e.select(),!0;e.collapse(-1==b.dir)}}e.insertNode(g),e.enlargeToBlockElm(!0),d=e.startContainer;var i=u.getDomText(d).indexOf("$$ntes_findandrepalce_marker$$");e.setStartBefore(g),u.remove(g);var j=z.findTextBlockElm(d,i,b);if(j){var k=z.findNTextInBlockElm(j.node,j.index,f),l=z.findNTextInBlockElm(j.node,j.index+f.length,f);return e.setStart(k.node,k.index).setEnd(l.node,l.index),b.replaceStr!==c&&z.replaceText(e,b.replaceStr),e.select(),!0}e.setCursor()}function h(a,b){b=z.editor.doc.createTextNode(b),a.deleteContents().insertNode(b)}function i(){var b=this;z.editor=b;var c=z.getDialogHtml();a.Msgbox.show({contentType:"custom",content:c,noFooter:!0}),a("#search-input").dom.focus(),a("#search-input").listen("focus",function(){z.clearError()}),a("#search-input").listen("keyup",function(b){13===b.keyCode?z.search({searchStr:a("#search-input").dom.value,dir:1}):z.counter=0,z.toggleButtons(!!(b.target||b.srcElement).value)}),a("#search-prev").listen("click",function(){1!==z.counter&&z.search({searchStr:a("#search-input").dom.value,dir:-1})}),a("#search-next").listen("click",function(){(z.counter!==z.totalMatch||0===z.totalMatch)&&z.search({searchStr:a("#search-input").dom.value,dir:1})})}function j(b){var c=a("#APP-editor-search-dialog-content .nui-mainBtn");b?c.removeClass("nui-btn-disabled"):c.addClass("nui-btn-disabled")}function k(){var b=a("#search-input").dom.value;b!==z.preSearch&&(z.preSearch=b,z.counter=0,z.totalMatch=0)}function l(a){var b=z.getDocText(),c=new RegExp(z.escapeRegChars(a),"g"),d=0,e=null,f=0;do if(e=c.exec(b),e&&d++,f++,f>1e3)return d;while(e);return d}function m(){var a=z.editor,b=a.doc;return b.body[x.ie()?"innerText":"textContent"]}function n(b){a("#search-input-wrapper").addClass("nui-ipt-err"),a("#error-text").show().html(b)}function o(){a("#search-input-wrapper").removeClass("nui-ipt-err"),a("#error-text").hide().html("")}function p(b){var c=z.editor,d=0;if(b.searchStr&&!z.isSearching){if(z.isSearching=!0,b.casesensitive=!0,0===z.counter){var e=c.cmd.selection.getRange();e.setStart(c.doc.body.firstChild,0),e.setCursor(!1,c.doc.body.firstChild)}else{var e=c.cmd.selection.getRange();e.setCursor(1===b.dir,!0)}z.tryUpdateSearch();var f=z.findMatchCount(b.searchStr);if(z.totalMatch=f,!f)return z.isSearching=!1,z.setError(v.t("查找不到该内容")),a(".APP-editor-search-match").html(""),void 0;if(b.all){var e=c.cmd.selection.getRange(),g=c.doc.body.firstChild;for(g&&1==g.nodeType?(e.setStart(g,0),e.shrinkBoundary(!0)):3==g.nodeType&&e.setStartBefore(g),e.collapse(!0).select(!0);z.searchReplace(c,b);)d++,z.counter+=b.dir}else{var h=z.searchReplace(c,b);h?(d++,z.counter+=b.dir,z.clearError()):z.setError(0===z.counter?v.t("查找不到该内容"):v.t("没有更多内容了"))}z.isSearching=!1,x.ie()||(c.win.top.focus(),a("#APP-editor-search-dialog-hidden-input").dom.focus()),a(".APP-editor-search-match").html(z.counter+"/"+f)}}function q(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function r(){return['<div id="APP-editor-search-dialog-content">','<div class="form-item" style="padding:20px;font-size:14px;">','<label for="" style="color:#555;">'+v.t("查找内容")+"</label>",'<div class="nui-ipt" id="search-input-wrapper" style="display: block;margin-top:8px;position: relative;">','<input type="text" class="nui-ipt-input" id="search-input" style="width:100%;" placeholder="'+v.t("输入查找内容")+'" />','<span class="APP-editor-search-match" style="position:absolute;right:10px;top:4px;"></span>',"</div>",'<div id="error-text" style="color:#E55C5D;line-height:2em;display:none;font-size:12px;"></div>',"</div>",'<div style="width: 100%;height: 1px;background-color: #EFEFEF;margin-top:20px;"></div>','<div class="form-btns" style="padding:10px 20px;text-align:right;">',"<div",'role="button"','class="nui-mainBtn nui-btn nui-btn-disabled" id="search-prev">','<span class="nui-btn-text">'+v.t("上一个")+"</span>","</div>","<div",'role="button"','class="nui-mainBtn nui-btn nui-btn-disabled" id="search-next">','<span class="nui-btn-text">'+v.t("下一个")+"</span>","</div>",'<input type="input" id="APP-editor-search-dialog-hidden-input" style="position: absolute;left:-999999px;" />',"</div>","</div>"].join(" ")}try{var s=$L("component.editor.Dtd")}catch(t){return t}try{var u=$L("component.editor.Util")}catch(t){return t}var v=new $I18N("component.editor.plugin.FindAndReplace"),w=a.Object,x=a.Browser,y={isSearching:!1,counter:0,totalMatch:0,preSearch:"",selected:i,getDialogHtml:r,search:p,clearError:o,setError:n,tryUpdateSearch:k,findMatchCount:l,getDocText:m,escapeRegChars:q,findTextInString:d,findTextBlockElm:e,findNTextInBlockElm:f,searchReplace:g,replaceText:h,toggleButtons:j},z=w.extend(a.createClass($N("component.editor.plugin.Find")),y),A={table:1,tbody:1,tr:1,ol:1,ul:1}}($,window),function(a,b,c){function d(a){var b=3==a.nodeType?a.nodeValue:a[x.ie()?"innerText":"textContent"];return b}function e(a,b,c){var d=b.searchStr;-1==b.dir&&(a=a.split("").reverse().join(""),d=d.split("").reverse().join(""),c=a.length-c);for(var e,f=new RegExp(A.escapeRegChars(d),"g"+(b.casesensitive?"":"i"));e=f.exec(a);)if(e.index>=c)return-1==b.dir?a.length-e.index-b.searchStr.length:e.index;return-1}function f(a,b,c){var d,f,g=c.all||1==c.dir?"getNextDomNode":"getPreDomNode";v.isBody(a)&&(a=a.firstChild);for(var h=1;a;){if("undefined"!=typeof c.replaceStr)for(;a.firstChild&&a.children.length;)a=a.firstChild;if(d=3==a.nodeType?a.nodeValue:a[x.ie()?"innerText":"textContent"],f=e(d,c,b),h=0,-1!=f)return{node:a,index:f};for(a=v[g](a);a&&B[a.nodeName.toLowerCase()];)a=v[g](a,!0);a&&(b=-1==c.dir?(3==a.nodeType?a.nodeValue:a[x.ie()?"innerText":"textContent"]).length:0)}}function g(a,b,c){for(var d,e=0,f=a.firstChild||a,h=0;f;){if(3==f.nodeType){if(h=f.nodeValue.replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length,e+=h,e>=b)return{node:f,index:h-(e-b)}}else if(!t.empty[f.tagName]&&(h=f[x.ie()?"innerText":"textContent"].replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length,e+=h,e>=b&&(d=g(f,h-(e-b),c))))return d;f=v.getNextDomNode(f)}}function h(a,b){var d,e=a.cmd.selection.getRange(),h=b.searchStr,j=a.doc.createElement("span");if(j.innerHTML="$$ntes_findandrepalce_marker$$",e.shrinkBoundary(!0),!e.collapsed){e.select();var k=a.cmd.selection.getText();if(new RegExp("^"+A.escapeRegChars(b.searchStr)+"$",b.casesensitive?"":"i").test(k)){if(b.replaceStr!=c)return i(e,b.replaceStr),e.select(),!0;e.collapse(-1==b.dir)}}e.insertNode(j),e.enlargeToBlockElm(!0),d=e.startContainer;var l=d[x.ie()?"innerText":"textContent"].indexOf("$$ntes_findandrepalce_marker$$");e.setStartBefore(j),v.remove(j);var m=f(d,l,b);if(m){var n=g(m.node,m.index,h),o=g(m.node,m.index+h.length,h);return e.setStart(n.node,n.index).setEnd(o.node,o.index),b.replaceStr!==c&&i(e,b.replaceStr),e.select(),!0}e.setCursor()}function i(a,b){b=A.editor.doc.createTextNode(b),a.deleteContents().insertNode(b)}function j(){var b=this;A.editor=b;var c=A.getDialogHtml();a.Msgbox.show({contentType:"custom",content:c,noFooter:!0}),a("#search-input").dom.focus(),a("#search-input").listen("focus",function(){A.clearError()}),a("#search-input").listen("keyup",function(b){13===b.keyCode?A.search({searchStr:a("#search-input").dom.value,dir:1}):A.counter=0,A.toggleButtons(!!(b.target||b.srcElement).value)}),a("#search-prev").listen("click",function(){1!==A.counter&&A.search({searchStr:a("#search-input").dom.value,dir:-1})}),a("#search-next").listen("click",function(){(A.counter!==A.totalMatch||0===A.totalMatch)&&A.search({searchStr:a("#search-input").dom.value,dir:1})}),a("#replace").listen("click",function(){var b=a("#replace-input").dom.value,c=a("#search-input").dom.value;b!==c&&A.search({replaceStr:b,searchStr:c,dir:1,casesensitive:!0})}),a("#replace-all").listen("click",function(){var b=a("#replace-input").dom.value,c=a("#search-input").dom.value;b!==c&&A.search({all:!0,replaceStr:b,searchStr:c,dir:1,casesensitive:!0})})}function k(b){var c=a("#APP-editor-search-dialog-content .nui-mainBtn");b?c.removeClass("nui-btn-disabled"):c.addClass("nui-btn-disabled")}function l(){var b=a("#search-input").dom.value;b!==A.preSearch&&(A.preSearch=b,A.counter=0,A.totalMatch=0)}function m(a){var b=A.getDocText(),c=new RegExp(A.escapeRegChars(a),"g"),d=0,e=null,f=0;do if(e=c.exec(b),e&&d++,f++,f>100)return d;while(e);return d}function n(){var a=A.editor,b=a.doc;return b.body[x.ie()?"innerText":"textContent"]}function o(b){a("#search-input-wrapper").addClass("nui-ipt-err"),a("#error-text").show().html(b)}function p(){a("#search-input-wrapper").removeClass("nui-ipt-err"),a("#error-text").hide().html("")}function q(b){var d=A.editor,e=0;if(b.searchStr&&!A.isSearching){if(A.isSearching=!0,b.casesensitive=!0,0===A.counter){var f=d.cmd.selection.getRange();f.setStart(d.doc.body.firstChild,0),f.setCursor(!1,d.doc.body.firstChild)}else{var f=d.cmd.selection.getRange();b.replaceStr?f.setCursor(!1,!0):f.setCursor(1===b.dir,!0)}A.tryUpdateSearch();var g=A.findMatchCount(b.searchStr);if(A.totalMatch=g,!g)return A.isSearching=!1,A.setError(y.t("查找不到该内容")),a(".APP-editor-search-match").html(""),void 0;if(b.all){var f=d.cmd.selection.getRange(),h=d.doc.body.firstChild;for(h&&1==h.nodeType?(f.setStart(h,0),f.shrinkBoundary(!0)):3==h.nodeType&&f.setStartBefore(h),f.collapse(!0).select(!0);A.searchReplace(d,b);){var f=d.cmd.selection.getRange();if(f.collapse().select(!0),e++,A.counter+=b.dir,e>20)break}A.counter=0,g=0}else{var i=A.searchReplace(d,b);if(i){if(A.counter+=b.dir,"undefined"!=typeof b.replaceStr)if(g-=1,A.counter>g)if(0!==g){A.counter=0;var f=d.cmd.selection.getRange();f.setStart(d.doc.body.firstChild,0),f.setCursor(!1,d.doc.body.firstChild),b.replaceStr=c,A.isSearching=!1,A.search(b)}else A.counter=0;else A.counter=Math.max(A.counter-1,0),b.replaceStr=c,A.isSearching=!1,A.search(b);A.clearError()}}A.isSearching=!1,g?a(".APP-editor-search-match").html(A.counter+"/"+g):a(".APP-editor-search-match").html(""),x.ie()||(d.win.top.focus(),a("#APP-editor-search-dialog-hidden-input").dom.focus())}}function r(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function s(){return['<div id="APP-editor-search-dialog-content">','<div class="form-item" style="padding:20px;font-size:14px;">','<label for="" style="color:#555;">'+y.t("查找内容")+"</label>",'<div class="nui-ipt" id="search-input-wrapper" style="display: block;margin-top:8px;position: relative;">','<input type="text" class="nui-ipt-input" id="search-input" style="width:100%;" placeholder="'+y.t("输入查找内容")+'" />','<span class="APP-editor-search-match" style="position:absolute;right:10px;top:4px;"></span>',"</div>",'<div id="error-text" style="color:#E55C5D;line-height:2em;display:none;font-size:12px;"></div>',"</div>",'<div class="form-item" style="padding:0 20px;font-size:14px;">','<label for="" style="color:#555;">'+y.t("替换为")+"</label>",'<div class="nui-ipt" id="search-input-wrapper" style="display: block;margin-top:8px;">','<input type="text" class="nui-ipt-input" id="replace-input" style="width:100%;" placeholder="'+y.t("输入替换内容")+'" />',"</div>","</div>",'<div style="width: 100%;height: 1px;background-color: #EFEFEF;margin-top:20px;"></div>','<div class="form-btns" style="padding:10px 20px;text-align:right;">',"<div",'role="button"','class="nui-mainBtn nui-btn nui-btn-disabled" id="search-prev">','<span class="nui-btn-text">'+y.t("上一个")+"</span>","</div>","<div",'role="button"','class="nui-mainBtn nui-btn nui-btn-disabled" id="search-next">','<span class="nui-btn-text">'+y.t("下一个")+"</span>","</div>","<div",'role="button"','class="nui-mainBtn nui-btn nui-btn-disabled" id="replace">','<span class="nui-btn-text">'+y.t("替换")+"</span>","</div>","<div",'role="button"','class="nui-mainBtn nui-btn nui-btn-disabled" id="replace-all">','<span class="nui-btn-text">'+y.t("全部替换")+"</span>","</div>",'<input type="input" id="APP-editor-search-dialog-hidden-input" style="position: absolute;left:-999999px;" />',"</div>","</div>"].join(" ")}try{var t=$L("component.editor.Dtd")}catch(u){return u}try{var v=$L("component.editor.Util")}catch(u){return u}var w=a.Object,x=a.Browser,y=new $I18N("component.editor.plugin.FindAndReplace"),z={counter:0,totalMatch:0,preSearch:"",selected:j,getDialogHtml:s,search:q,clearError:p,setError:o,tryUpdateSearch:l,findMatchCount:m,getDocText:n,escapeRegChars:r,findTextInString:e,findTextBlockElm:f,findNTextInBlockElm:g,searchReplace:h,replaceText:i,toggleButtons:k,getTextContent:d},A=w.extend(a.createClass($N("component.editor.plugin.FindAndReplace")),z),B={table:1,tbody:1,tr:1,ol:1,ul:1}}($,window),function(a){function b(a){var b=this;b.editor=a,b.formatmatchState=0,b.formatmatchList=[]}function c(a,b){function c(a){if(d.webkit()){var i=h.getTarget(a);"IMG"!=i.tagName&&(i=null)}var k=e.cmd.selection.getRange(),m=i||k.getClosedNode();if(l&&m&&"IMG"==m.tagName)m.style.cssText+=";float:"+(l.style.cssFloat||l.style.styleFloat||"none")+";display:"+(l.style.display||"inline"),l=null;else if(!l){var n=k.collapsed;if(n){var o=e.doc.createTextNode("match");k.insertNode(o).select()}var p=f.options.removeFormatAttributes;f.options.removeFormatAttributes="",e.cmd.removeFormat(),f.options.removeFormatAttributes=p,k=e.cmd.selection.getRange();try{j.length&&(o&&k.selectNode(o),k.applyInlineStyle(j[j.length-1].tagName,{"class":""},j))}catch(q){}o&&k.setStartBefore(o).collapse(!0),k.select(),o&&d.remove(o)}h.unlisten(e.doc,"mouseup",c),g.formatmatchState=0,b.removeClass("APP-editor-btn-on")}var e=this;e.constructor.mode;var g=e.formatMatch;g||(g=new i(e),e.formatMatch=g);var j=g.formatmatchList;if(g.formatmatchState)return g.formatmatchState=0,j.length=0,h.unlisten(e.doc,"mouseup",c),b.removeClass("APP-editor-btn-on"),void 0;e.historySave(),b.addClass("APP-editor-btn-on");var k=e.cmd.selection.getRange(),l=k.getClosedNode();if(!l||"IMG"!=l.tagName){k.collapse(!0).shrinkBoundary();var m=k.startContainer;j=d.findParents(m,!0,function(a){return!d.isBlockElm(a)&&1==a.nodeType});for(var n=j.length-1;n>=0;n--){var o=j[n];if("A"==o.tagName){j.splice(n,1);break}}g.formatmatchList=j}h.listen(e.doc,"mouseup",c),g.formatmatchState=1}try{var d=$L("component.editor.Util")}catch(e){return e}try{var f=$L("component.editor.Cmd")}catch(e){return e}var g=a.Object,h=a.Event,i=a.createClass($N("component.editor.plugin.FormatMatch"));g.extend(i,{selected:c}),g.extend(i.prototype,{initialize:b})}($,window),function(a){function b(){function b(){c.imageResizeToolbar&&(c.imageResizeToolbar.style.display="none"),c.mediaCtrToolbar&&(c.mediaCtrToolbar.style.display="none");var a=c.editImage;a&&a.getAttribute("data-image")&&(a.style.border="none")}var c=this;c.addListener(c.doc,"mouseup","IMG",function(b){var d=a(this);if(this.getAttribute("data-image")||this.getAttribute("data-media"))if(c.editImage=this,this.getAttribute("data-image")){n.initResizeToolbar(c,b);var e=c.cmd.selection.getRange();e.selectNode(this),d.css({border:"1px solid #999"})}else this.getAttribute("data-media")&&n.initMediaToolbar(c,b)}),c.listen("iframeKeydown",b),c.listen("iframeClick",function(c){var d=a.Event.getTarget(c);d.tagName&&"img"==d.tagName.toLowerCase()&&(d.getAttribute("data-image")||d.getAttribute("data-media"))||b()}),c.listen("clickToolbar",b),c.addListener(document,"click",b)}function c(b,c){var d=a.Event.getTarget(c),e=b.imageResizeToolbar;e||(e=document.createElement("DIV"),e.className="APP-editor-picReset",e.style.display="none",e.innerHTML=['<div class="nui-btnGroup">','<div class="nui-btn" func="big"><span class="nui-btn-text"><b class="ico ico-editor ico-editor-zoomIn"></b></span></div>','<div class="nui-btn" func="original"><span class="nui-btn-text"><b class="ico ico-editor ico-editor-zoomNo"></b></span></div>','<div class="nui-btn" func="small"><span class="nui-btn-text"><b class="ico ico-editor ico-editor-zoomOut"></b></span></div>','<div class="nui-btn" func="delete"><span class="nui-btn-text"><b class="ico ico-editor ico-editor-delete"></b></span></div>',"</div>"].join(""),b.editDv.append(e),b.addListener(e,"click","div.nui-btn",function(a){n.dealImage(a,b,this,e)}),b.imageResizeToolbar=e);var f=n.getImageCtrPos(b,d);e.style.left=f.left+"px",e.style.top=f.top+"px",setTimeout(function(){e.style.display="block"},25)}function d(b,c){var d=a.Event.getTarget(c),e=b.mediaCtrToolbar;e||(e=document.createElement("DIV"),e.className="APP-editor-imgEditBar bdr-light",e.style.width="135px",e.style.display="none",e.innerHTML=['<a href="javascript:void(0)" class="media-ctr-btn" func="play">'+l.t("播放")+"</a>&nbsp;-&nbsp;",'<a href="javascript:void(0)" class="media-ctr-btn" func="delete">'+l.t("删除")+"</a>&nbsp;&nbsp;[",'<a href="javascript:void(0)" class="media-ctr-btn" func="close">'+l.t("关闭")+"</a>]"].join(""),b.editDv.append(e),b.addListener(e,"click",".media-ctr-btn",function(a){n.dealMedia(a,b,this,e)}),b.mediaCtrToolbar=e);var f=n.getMediaCtrPos(b,d);e.style.left=f.left+"px",e.style.top=f.top+"px",setTimeout(function(){e.style.display="block"},25)}function e(b,c,d,e){var f=this;a.Event.stop(b);var g=c.editImage,h=d.getAttribute("func"),i=+g.getAttribute("orgwidth"),k=+g.getAttribute("orgheight"),l=+g.width,m=+g.height;if(i&&k&&l&&m&&h){if("delete"===h){var o=g.parentNode;try{var p=o.childNodes[1];"a"!==o.tagName.toLowerCase()||p&&(3!=p.nodeType||p.nodeValue!=j.fillChar)?o.removeChild(g):o.parentNode.removeChild(o)}catch(q){}return e.style.display="none",f.saveHistory(c),void 0}if("original"===h)g.style.width=i+"px",g.style.height=k+"px";else{var r,s,t,u,v={big:.1,small:-.1}[h];if(!v)return;i>k?(s=2*i,r=.1*i,t=l*(1+v),t=r>t?r:t>s?s:t,u=Math.round(t*m/l)):(s=2*k,r=.1*k,u=m*(1+v),u=r>u?r:u>s?s:u,t=Math.round(u*l/m)),g.style.width=t+"px",g.style.height=u+"px"}var w=n.getImageCtrPos(c,g);e.style.left=w.left+"px",e.style.top=w.top+"px",f.saveHistory(c)}}function f(b,c,d,e){a.Event.stop(b);var f=c.editImage,g=d.getAttribute("func"),h=f.getAttribute("data-media");"delete"===g?c.fire("related",{action:"deleteAttach",id:h}):"close"===g&&(e.style.display="none")}function g(b,c){var d=a(c).offset(),e=28,f=d.y,g="hide"===b.editMode?4:b.toolbarDv.height()-2,h=b.editDv.height(),i=f-b.doc.body.scrollTop+g;return i=g>i?g:i+e>h?h-e:i,{left:d.x+1,top:i}}function h(b,c){var d=a(c).offset(),e=c.offsetHeight,f=d.y,g="hide"===b.editMode?4:b.toolbarDv.height()+1,h=b.editDv.height(),i=f-b.doc.body.scrollTop+g+e;return i=g>i?g:i>h?h-e:i,{left:d.x,top:i}}function i(a){a.editImage&&(a.editImage.style.border="none"),a.historySave(),a.editImage&&(a.editImage.style.border="1px solid #999")}try{var j=$L("component.editor.Util")}catch(k){return k}var l=new $I18N("component.editor.plugin.ImageResize"),m=a.Object,n=m.extend(a.createClass($N("component.editor.plugin.ImageResize")),{selected:b,initResizeToolbar:c,initMediaToolbar:d,dealImage:e,dealMedia:f,getImageCtrPos:g,getMediaCtrPos:h,saveHistory:i})}($,window),function(a){function b(a,b){var d=this,f=d.editMode,g=d[f+"IndentMenu"];g||(g=new e({items:[{text:c.t("增加缩进"),icon:{extcls:"ico-editor ico-editor-addIndent"},click:function(){d.exec("indent","indent")}},{text:c.t("减少缩进"),icon:{extcls:"ico-editor ico-editor-cutIndent"},click:function(){d.exec("outdent","outdent")}}],width:"150px"}),g.attachTo({clickFrom:b,delegateTo:"self"}),g.fire("attachToShow"),d[f+"IndentMenu"]=g)}var c=new $I18N("component.editor.plugin.Indent"),d=a.Object,e=a.getClass($N("component.Menu")),f=a.createClass($N("component.editor.plugin.Indent"));d.extend(f,{selected:b})}($,window),function(a){function b(){var a=this;a.exec("horizontal")}var c=a.Object,d=a.createClass($N("component.editor.plugin.InsertHorizontalRule"));c.extend(d,{selected:b})}($,window),function(a,b,c){function d(){var b=this;qb.editor=this,b.listen("selectionChanged",function(){qb.util.isRangeInTable()?qb.util.disable():qb.util.enable()}),b.listen("beforePaste",function(){var c=a(b.doc.body).find("table");c&&c.each(function(b,c){a(c).addClass("ntes_not_fresh_table")})}),b.listen("afterPaste",function(){var c=a(b.doc.body).find("table");c&&c.each(function(b,c){if(!a(c).hasClass("ntes_not_fresh_table")){var d=qb.generateTableId();a(c).attr({id:d}),new e(c).reset()}})}),b.listen("iframeContextmenu",function(b){qb.hideAllMenu(b);var c=a.Event.getTarget(b),d=qb.util.getTableByElement(c);(!d||d.hasClass("ntes_editor_table"))&&qb.util.isInTableCell(c)&&qb.handleContextMenu(b)}),b.listen("iframeMousedown",function(c){qb.editor=b,qb.mouseUtil.isLeft(c)&&qb.tableSelection.clearAllTableHiglight(),qb.util.isInTableCell(a.Event.getTarget(c))&&qb.HandleMouseDown(c)}),b.listen("iframeMouseup",function(a){qb.HandleMouseUp(a)}),b.listen("iframeMouseleave",function(){qb.offMouseMove()}),b.listen("iframeMousemove",function(a){qb.docMousemoveHandler(a)})}function e(a){this.table=a}function f(){}function g(a){this.cssClass=a}function h(b){this.tryAddId(b),this.id=a(b).attr("id"),this._virtualTable=this.createVirtual(b)}function i(a){this.x=a.x,this.y=a.y,this.colSpan=a.colSpan,this.rowSpan=a.rowSpan,this.isEmpty=a.isEmpty,this.parentY=a.parentY,this.parentX=a.parentX,this.virtualX=a.virtualX,this.virtualY=a.virtualY}function j(){this._dic={}}function k(a){this._layer=this.createPanel(a),this.bindEvent()}function l(a){this.higlightCssKlass=a,this.startPoint=null,this.endPoint=null,this.table=null}function m(){this._isPressing=!1,this._isDraging=!1,this.startPointer=null,this.endPointer=null}function n(){this.startRect=null,this.rangeType=""}function o(){this._indicator=null}function p(a){this._indicator=this.createIndicator(),this.updatePosition(a),this.render()}function q(a){this._indicator=this.createIndicator(),this.updatePosition(a),this.render()}function r(b){var c=a.Event.getTarget(b);qb.util.getTableByElement(c),a.Event.cancelBubble(b),qb.hideAllMenu(b),qb.util.isInTableCell(c)&&(a.Event.stop(b),qb.tableSelection.isCellHiglight(c)||qb.tableSelection.saveSelectionStart(c),qb.showTableMenu(c,b),qb.tableSelection.isCellHiglight(c)||qb.tableSelection.clearAllTableHiglight(),qb.updateTableIndex(c))}function s(b){a.Menu.hideAllMenu(b)}function t(){var b=qb.tableSelection.table;b&&a(qb.tableSelection.table).unlisten("mousemove"),qb.mouseUtil.reset()}function u(b){var c=a.Event.getTarget(b);if(qb.mouseUtil.isPressing()){var d=qb.tableSelection.getSelectionRect();(1!==d.width||1!==d.height)&&(a.Event.stop(b),qb.editor.cmd.selection.clearRange(),qb.editorSelectable(!0)),qb.tableSelection.saveSelectionEnd(c),qb.tableSelection.tryHiglightRect()}}function v(b){var c=qb.mouseUtil.getRangeType(b);if(qb.mouseUtil.isDraging())return qb.mouseUtil.recordMousePosition(b),qb.tableCellResize.updateIndicatorPosition(b),qb.editor.cmd.selection.clearRange(),void 0;if(c&&c!==m.RANGE_TYPE.body){var d=a.Event.getTarget(b),e=qb.util.getTableByElement(d);if(e.hasClass("ntes_editor_table"))return qb.tableCellResize.setCursor(c),void 0}qb.tableCellResize.removeCursor()}function w(b){var c=a.Event.getTarget(b),d=qb.util.getTableByElement(c);if((!d||d.hasClass("ntes_editor_table"))&&qb.util.isInTableCell(a.Event.getTarget(b))&&qb.mouseUtil.isLeft(b)){qb.updateTableIndex(c);var e=qb.mouseUtil.getRangeType(b);e&&"body"!==e?(qb.mouseUtil.startDraging(b),qb.tableCellResize.start(b,e)):(qb.mouseUtil.setPressing(!0),qb.tableSelection.start(c))}}function x(b){var c=a.Event.getTarget(b),d=qb.util.getTableByElement(c);if((!d||d.hasClass("ntes_editor_table"))&&qb.mouseUtil.isLeft(b)){if(qb.mouseUtil.isDraging()){var e=qb.mouseUtil.getDragDistance();(0!==e.x||0!==e.y)&&qb.tableCellResize.resize(e),qb.tableCellResize.end(),qb.save()}else qb.util.isInTableCell(c)&&(qb.tableSelection.saveSelectionEnd(c),qb.editorSelectable(!1));qb.offMouseMove()}}function y(b){var c=qb.editor;return a(c.doc.body).find("#"+b)}function z(c,d){var e=qb.editor,f=d.clientX,g=d.clientY,h=qb.util.getTableByElement(c);if(h.hasClass("ntes_editor_table")){var i=a(e.iframe).offset();f+=50,g+=i[1],g+210>=b.innerHeight&&(g-=210);var j=[];j.push({items:[{text:jb.t("在上方插入行"),click:function(){qb.insertRowBefore(c),qb.save(),a.Log.count({editor_table_insertRowAbove:1}),qb.updateTableIndex(c)}},{text:jb.t("在下方插入行"),click:function(){qb.insertRowAfter(c),qb.save(),a.Log.count({editor_table_insertRowBelow:1}),qb.updateTableIndex(c)}},{text:jb.t("删除整行"),click:function(){var b=qb.util.getTableByElement(c),d=qb.deleteRow(c);qb.save(),a.Log.count({editor_table_deleteRow:1}),"table"!==d&&qb.updateTableIndex(b)
}}]}),j.push({items:[{text:jb.t("在左侧插入列"),click:function(){qb.insertColBefore(c),qb.save(),a.Log.count({editor_table_insertColLeft:1}),qb.updateTableIndex(c)}},{text:jb.t("在右侧插入列"),click:function(){qb.insertColAfter(c),qb.save(),a.Log.count({editor_table_insertColRight:1}),qb.updateTableIndex(c)}},{text:jb.t("删除整列"),click:function(){var b=qb.util.getTableByElement(c),d=qb.deleteCol(c);qb.save(),a.Log.count({editor_table_deleteCol:1}),"table"!==d&&qb.updateTableIndex(b)}}]}),qb.tableSelection.isCellHiglight(c)&&!qb.util.isMergeCell(c)&&j.push({items:[{text:jb.t("合并单元格"),click:function(){var b=qb.util.getTableByElement(c);qb.mergeCell(c),qb.save(),a.Log.count({editor_table_mergeCells:1}),qb.updateTableIndex(b)}}]}),j.push({items:[{text:jb.t("删除整个表格"),click:function(){qb.deleteTable(c),qb.save(),a.Log.count({e_table_deleteTable:1})}}]}),qb.editor.tableContextMenu&&qb.editor.tableContextMenu.destroy(),qb.editor.tableContextMenu=new a.Menu({extcls:"APP-editor-table-menu",width:$G.environment.isCh?"128px":"auto",top:g+"px",left:f+"px",renderTo:top.window.document.body,groups:j,reverse:!0,verticalReverse:!0})}}function A(a){qb.insertCol("after",a)}function B(a){qb.insertCol("before",a)}function C(b,c){function d(a,b){var c=j.getCell(b.parentX,b.parentY);return c.parentX<=a&&a<=c.parentX+c.colSpan-1}var e=qb.tableSelection.getSelectionRect(),f="",g=null,h=qb.tableSelection.getHiglightDimension(),i=0;"before"===b?(i=-1,g=h.leftTop,f="prepend"):"after"===b&&(i=1,g=h.rightTop,f="append");var j=qb.virtualTables.get(c),k=-1,l=j.getRows();if(k=g?j.getCell(g.x,g.y).virtualX:j.getVirtualCellByReal(c).virtualX,qb.tableSelection.startPoint.isInMerge()){var m=qb.tableSelection.startPoint;"after"===b&&(k=m.virtualX+m.colSpan-1)}var n=k+i,o={},p=qb.util.getTableByElement(c);a.Array.each(l,function(c){var g=j.getCell(k,c),h=20,l=0;if(g.isInMerge()&&d(n,g)){var m=g.x+"_"+g.y;o[m]=j.getTableCellByVirtual(p,{x:g.parentX,y:g.parentY})}else{for(var q=e?e.width:1,r=b,s=g;s.isEmpty&&g.virtualX>=0;){var t=s.virtualX+-i,u=s.virtualY;if(s=j.getCell(t,u),l+=1,l>h)break}if(s.isEmpty)for(var v=p.dom.rows[c],w=0;q>w;w++){var x=qb.calcColWidth(j.getWidth());a(v)[f](qb.createCellEle(x))}else for(var y=j.getTableCellByVirtual(p,s),w=0;q>w;w++){var x=qb.calcColWidth(j.getWidth());a(y)[r](qb.createCellEle(x))}}}),a.Object.each(o,function(b,c){a(c).dom.colSpan+=e.width})}function D(b,c,d,e){for(var f=qb.util.getTableCellsNum(e),g=qb.calcColWidth(f),h=0;h<b.width;h++)a(d)[c](qb.createCellEle(g))}function E(a){qb.insertRow("after",a)}function F(a){qb.insertRow("before",a)}function G(a,b){var c=qb.tableSelection.getSelectionRect();qb.insertMultiRows(c,a,b)}function H(b,c,d){var e=null,f=0,g=a(d).findParent("tr").dom;"before"===c?(f=-1,e=qb.tableSelection.getHiglightDimension().leftTop):"after"===c&&(f=1,e=qb.tableSelection.getHiglightDimension().leftBottom);var h=e?e.y:g.rowIndex;if(qb.tableSelection.startPoint.isInMerge()){var i=qb.tableSelection.startPoint;"after"===c&&(h=i.y+i.rowSpan-1)}var j=qb.util.getTableByElement(d).dom.rows[h],k=h+f,l=qb.virtualTables.get(d),m=qb.util.getTableByElement(d),n=0,o={},p=l.getRows();0>k||k>p.length-1?n=l.getWidth():a.Array.each(p[k],function(a,b){if(b.isInMerge())if(b.isInRowRange(k)&&!b.isInRowRange(h))n+=1;else{var c=b.parentX+"_"+b.parentY;o[c]={x:b.parentX,y:b.parentY}}else n+=1});for(var q=0;q<b.height;q++){var r=qb.createRowElement(n);a(j)[c](r)}var s=a.Object.keys(o);s.length&&a.Object.each(o,function(c,d){var e=l.getCell(d.x,d.y),f=a(m).dom.rows[e.y].cells[e.x];a(f).dom.rowSpan+=b.height})}function I(a){var b=qb.createRowEle(a);return b}function J(){var a=document.createElement("tr");return a.innerHTML=qb.createCell(),a.childNodes[0]}function K(b){var c=a(b).findParent("tr"),d=qb.virtualTables.getTableIndexByElement(b),e=qb.util.getTableByElement(b),f=qb.tableSelection.getHiglightDimension().leftTop,g=qb.tableSelection.getHiglightDimension().rightBottom,h=a(c).dom.rowIndex,i=h,j=h;if(f&&(i=f.y,j=g.y),j-i+1===d.getRows().length)return qb.deleteTable(b),"table";for(var k=[],l={},m=[],n={},o=a(b).findParent("tbody").find("tr"),p=i;j>=p;p++){var q=o.doms[p],r=d.getMergeCellsByRow(p);a.Array.each(r,function(a,b){if(1!==b.rowSpan&&(b.parentY!==i||b.parentY+b.rowSpan-1!==j)){var c=b.parentX+"_"+b.parentY;l[c]||(l[c]={cell:b,changeSpan:0}),l[c].changeSpan-=1}}),k.push(qb.getDeleteAction(q))}a.Object.each(l,function(b,c){var f=d.getTableCellByVirtual(e,c.cell);qb.util.changeCellSpan(f,{rowSpan:c.changeSpan});var g=20;if(i<=c.cell.parentY&&c.cell.parentY<=j){for(var h=c.cell.parentX-1,k=c.cell.parentY+Math.abs(c.changeSpan),l=0,o=o=d.getCell(h,k);h>=0&&o&&o.isInMerge()&&(h=o.virtualX-1,o=d.getCell(h,k),l++,!(l>g)););if(o){var p=d.getTableCellByVirtual(e,o);m.push(function(){a(p).after(f)})}else n[k]||(n[k]=document.createElement("tr")),m.push(function(){a(n[k]).append(f)})}}),qb.reverseInvokeQueue(m),a.Object.each(n,function(b,c){for(var d=e.dom.rows[Number(b)];c.children.length;)a(d).prepend(c.children[0])}),qb.invokeQueue(k)}function L(b){var c=qb.tableSelection.getSelectionRect(),d=a(b).findParent("tbody").find("."+qb.cellHiglightCls),e=d?d.doms[0]:b,f=qb.virtualTables.get(b),g=f.getVirtualCellByReal(e),h=g.virtualX,f=qb.virtualTables.get(b);if(c.width===f.getRow(0).length)return qb.deleteTable(b),"table";var i={},j=[],k=qb.util.getTableByElement(b),l=h+c.width-1;a.Array.each(f.getRows(),function(a,b){for(var c=h;l>=c;c++){var d=b[c];if(d.isInMerge()&&1!==d.colSpan){var e=d.parentX+"_"+d.parentY,g=f.getCell(d.parentX,d.parentY);i[e]=f.getTableCellByVirtual(k,g)}else{var m=f.getTableCellByVirtual(k,d);j.push(qb.getDeleteAction(m))}}}),qb.invokeQueue(j),a.Object.each(i,function(a,b){b.colSpan+=-c.width})}function M(b){return function(){a(b).remove()}}function N(b){a(b).findParent("table").remove()}function O(b,c,d){var e=this;a.Browser.isIE()?setTimeout(function(){qb.inserTableSelected.call(e,b,c,d)},0):qb.inserTableSelected.call(e,b,c,d)}function P(a,b){var c=this;qb.editor=c,qb.util.isEnabled()&&(qb.editor.tableLayer&&qb.editor.tableLayer.destroy(),qb.editor.tableLayer=new k(b))}function Q(b){var c=b?"addClass":"removeClass";a(qb.editor.doc.body)[c]("APP-editor-unselectable")}function R(a,b){var c=qb.createTable(a,b),d=qb.editor;qb.save(),qb.breakLineIfIE(),d.exec("insertHtml",c.html),qb.setCursorAfterInsert(c.id),qb.save(),qb.updateTableIndex(qb.getTableById(c.id))}function S(){if(a.Browser.isIE()){var b=qb.editor.cmd.selection.getRange(),c=b.startContainer,d=b.endContainer;3===c.nodeType&&(c=c.parentNode),3===d.nodeType&&(d=d.parentNode);var e=c.tagName.toLowerCase();(c===d&&"p"===e||"div"===e)&&b.setStartAfter(c).setEndAfter(c).setCursor(!1,!0)}}function T(b){var c=qb.getTableById(b),d=a(c).find("td"),e=qb.editor.cmd.selection.getRange();a.Browser.isIE()?e.selectNode(d.dom.childNodes[0]).setCursor(!1,!0):e.selectNode(d.dom.childNodes[0]).setCursor(!1,!0)}function U(a,b){var c=qb.generateTableId();qb.editor;var d="overflow: hidden;";lb.isIE()&&(d="");for(var e='<table class="ntes_editor_table" id="'+c+'" style="border-collapse:collapse;color:inherit;table-layout: auto;font-size: inherit;border: 1px solid #A7A7A6;'+d+'"><tbody>',f=0;a>f;f++)e+=qb.createRows(b);return e+="</tbody></table>",e+=qb.editor.getBreakLine(1),{id:c,html:e}}function V(){return qb.tablePrex+"_"+qb.uniqueId++}function W(a){for(var b='<tr style="border:1px solid #A7A7A6">',c=qb.calcColWidth(a),d=0;a>d;d++)b+=qb.createCell(c);return b+="</tr>"}function X(b){return['<td style="border-right:1px solid #A7A7A6;border-bottom:1px solid #A7A7A6;padding:3px 8px;height: 36px;word-break: break-all; word-wrap: break-word; width:'+b+'px;">',"<div>"+(a.Browser.isIE()?"&nbsp;":"<br>")+"</div>","</td>"].join("")}function Y(a){for(var b=document.createElement("tr"),c=qb.calcColWidth(a),d=0;a>d;d++)b.appendChild(qb.createCellEle(c));return b}function Z(a){var b=document.createElement("td");b.style.border="1px solid #A7A7A6",b.style.padding="3px 8px",b.style.height="36px",a&&(b.style.width=a+"px"),b.style.wordBreak="break-all",b.style.wordWrap&&(b.style.wordWrap="word-wrap");var c=document.createElement("br");return b.appendChild(c),b}function $(a){return Math.ceil(.8*qb.editor.doc.body.offsetWidth/a)}function _(){setTimeout(function(){qb.editor.history.save()},10)}function ab(a){var b=new h(qb.util.getTableByElement(a));qb.virtualTables.set(b.id,b)}function bb(b){var c=qb.util.getTableByElement(b),d=qb.virtualTables.getTableIndexByElement(c),e=a(b).findParent("tbody").find("."+qb.cellHiglightCls),f=qb.tableSelection.getSelectionRect(),g=qb.tableSelection.getSelectionRectLeftTop(),h=qb.tableSelection.getSelectionRectRightBottom(),i=[],j=[];if(e){e.each(function(b,c){var d=a.String.trim(hb.getDomText(c)),e=a(c).html();(d&&e||a(c).find("img"))&&i.push(e),0!==b&&j.push(qb.createRemoveAction(c))}),qb.invokeQueue(j);var k=g.y,l=h.y,m=h.x-g.x+1,n=h.y-g.y+1,o=0,p=d.getRow(0).length,q=d.getRows().length;if(m===p)var o=qb.clearEmptyRow(c,k,l);e.doms[0].colSpan=n===q?1:f.width,e.doms[0].rowSpan=f.height-o,a(e.doms[0]).html("").append(i.join(""))}}function cb(b,c,d){for(var e=[],f=c;d>=f;f++){var g=b.dom.rows[f];g.cells.length||e.push(g)}var h=e.length;return a.Array.each(e,function(b,c){a(c).remove()}),h}function db(b){return function(){a(b).remove()}}function eb(b){a.Array.each(b,function(a,b){"function"==typeof b&&b()})}function fb(a){for(var b=a.length-1;b>=0;b--){var c=a[b];"function"==typeof c&&c()}}function gb(a,b){var c=qb.virtualTables.get(a);return c.getMergeCellsByRow(b)}try{var hb=$L("component.editor.Util")}catch(ib){return ib}var jb=new $I18N("component.editor.plugin.InsertTable"),kb=a.Object,lb=a.Browser;a.Event;var mb=new j,nb=new l("table-cell-higlight"),ob=new m,pb={tablePrex:"ntes_editor_table",cellHiglightCls:"table-cell-higlight",enabled:!0,uniqueId:10010,editor:null,virtualTables:mb,tableSelection:nb,mouseUtil:ob,util:new f,higligthSwitcher:new g("table-cell-higlight"),tableCellResize:new n,init:d,selected:O,inserTableSelected:P,insert:R,createRows:W,createCell:X,createTable:U,createRowEle:Y,createCellEle:Z,insertRowAfter:E,insertRowBefore:F,insertRow:G,insertMultiRows:H,insertColAfter:A,insertColBefore:B,insertCol:C,insertMultiCols:D,deleteTable:N,deleteRow:K,deleteCol:L,getDeleteAction:M,showTableMenu:z,createRowElement:I,createCellElement:J,generateTableId:V,handleContextMenu:r,HandleMouseDown:w,HandleMouseUp:x,offMouseMove:t,docMousemoveHandler:v,tableMousemoveHandler:u,hideAllMenu:s,getTableById:y,calcColWidth:$,setCursorAfterInsert:T,editorSelectable:Q,updateTableIndex:ab,mergeCell:bb,clearEmptyRow:cb,createRemoveAction:db,invokeQueue:eb,reverseInvokeQueue:fb,getMergeCellsByRow:gb,save:_,breakLineIfIE:S},qb=a.createClass($N("component.editor.plugin.InsertTable"));kb.extend(qb,pb),e.prototype.reset=function(){this.table.style.borderCollapse="collapse",this.table.style.borderSpacing="0"},f.prototype.getTableByElement=function(b){if("table"===a(b).dom.tagName.toLowerCase())return a(b);var c=a(b).findParent("table");return c?c:null},f.prototype.getTableCellsNum=function(b){var c=this,d=this.getTableByElement(b).find("tbody tr"),e=a(d.doms[0]).find("td"),f=0;return a(e).each(function(a,b){c.isMergeCell(b)?f+=Number(b.colSpan):f++}),f},f.prototype.isMergeCell=function(a){var b=this.getCell(a),c=b.dom,d=c.colSpan,e=c.rowSpan;return d&&e&&(Number(d)>1||Number(e)>1)?!0:!1},f.prototype.getCell=function(b){return"td"===a(b).dom.tagName.toLowerCase()?a(b):a(b).findParent("td")},f.prototype.getCellCoordinate=function(a){var b=this.getCell(a),c=b.dom.cellIndex,d=b.dom.parentNode.rowIndex;return{cellIndex:c,rowIndex:d}},f.prototype.getCellByCoordinate=function(b,c){return a(b).dom.rows[c.y].cells[c.x]},f.prototype.betweenEach=function(b,c,d){for(var e=c[0],f=c[1],g=b[0],h=b[1],i=g;h>=i;i++)for(var j=e;f>=j;j++)if(d(i,j)===a.BREAK)return},f.prototype.isRangeInTable=function(){var b=qb.editor,c=b.cmd.selection.getRange(),d=c.startContainer,e=c.endContainer,f=a(d).findParent("table"),g=a(e).findParent("table");return f||g},f.prototype.disable=function(){qb.enabled=!1;var a=qb.editor.toolbarDv;a&&a.find(".APP-editor-commond-insertTable").addClass("APP-editor-btn-dis")},f.prototype.enable=function(){qb.enabled=!0;var a=qb.editor.toolbarDv;a&&a.find(".APP-editor-commond-insertTable").removeClass("APP-editor-btn-dis")},f.prototype.isEnabled=function(){return qb.enabled},f.prototype.changeCellSpan=function(a,b){b.colSpan&&(a.colSpan+=b.colSpan),b.rowSpan&&(a.rowSpan+=b.rowSpan)},f.prototype.isInTableCell=function(b){return a(b).findParent("td")||"td"===b.tagName.toLowerCase()},f.prototype.getScroll=function(){return a.Browser.isIE()?{x:qb.editor.doc.documentElement.scrollLeft,y:qb.editor.doc.documentElement.scrollTop}:{x:qb.editor.win.scrollX,y:qb.editor.win.scrollY}},g.prototype.turnOn=function(a){return this.getCell(a).addClass(this.cssClass)},g.prototype.turnOff=function(a){return this.getCell(a).removeClass(this.cssClass)},g.prototype.isOn=function(a){return this.getCell(a).hasClass(this.cssClass)},g.prototype.isOff=function(a){return!this.getCell(a).hasClass(this.cssClass)},g.prototype.getCell=function(a){return qb.util.getCell(a)},h.prototype.tryAddId=function(b){if(!a(b).attr("id")){var c=qb.generateTableId();a(b).dom.id=c}},h.prototype.rowEach=function(b){a.Array.each(this._virtualTable,b)},h.prototype.each=function(b){this.rowEach(function(c,d){a.Array.each(d,function(a,e){b(c,d,a,e)})})},h.prototype.getRow=function(a){return this._virtualTable[a]},h.prototype.getRows=function(){return this._virtualTable},h.prototype.getWidth=function(){return this._virtualTable[0].length},h.prototype.getCell=function(a,b){var c=this._virtualTable[b],d=c[a];return d},h.prototype.getNotMergeCellInRow=function(a){for(var b=this.getRow(a),c=null,d=0;d<b.length;d++)if(!b[d].isInMerge()){c=b[d];break}return c},h.prototype.getNotMergeCellInCol=function(b){var c=this.getRows(),d=null;return a.Array.each(c,function(c,e){var f=e[b];return f.isInMerge()?void 0:(d=f,a.BREAK)}),d},h.prototype.getVirtualCellByReal=function(b){var c=qb.util.getCell(b),d=c.dom.cellIndex,e=c.dom.parentNode.rowIndex,f=this.getRow(e),g=null;return a.Array.each(f,function(b,c){return c.x===d&&c.y===e?(g=c,a.BREAK):void 0}),g},h.prototype.getTableCellByVirtual=function(b,c){var d=a(b).dom;return d.rows[c.y].cells[c.x]},h.prototype.isVirtualMerge=function(a){return 1!==a.colSpan||1!==a.rowSpan},h.prototype.isEmptyCell=function(a){return a.isEmpty},h.prototype.getTableCellCoordinate=function(b){var c=qb.util.getCellCoordinate(b),d=this.getRow(c.rowIndex),e=null;return a.Array.each(d,function(b,d){return d.x===c.cellIndex?(e=b,a.BREAK):void 0}),{x:e,y:c.rowIndex}},h.prototype.getMergeCellsByRow=function(b){var c={};a.Array.each(this.getRow(b),function(a,b){if(b.isInMerge()){var d=b.parentX+"_"+b.parentY;c[d]||(c[d]=b)}});var d=[];return a.Object.each(c,function(a,b){d.push(b)}),d},h.prototype.createVirtual=function(a){var b=qb.util.getTableByElement(a),c=qb.util.getTableCellsNum(a),d=b.find("tr").doms,e=d?d.length:0;if(e&&c){for(var f=[],g=0;e>g;g++){f.push([]);for(var h=0;c>h;h++)f[g].push(null)}for(var j=0;e>j;j++)for(var k=0,l=0;c>l;l++){var m=f[j][l];if(null===m||m.isEmpty!==!0){var n=d[j].cells[l-k];if(qb.util.isMergeCell(n))for(var o=n.colSpan,p=n.rowSpan,q=j;j+p>q;q++)for(var r=l;l+o>r;r++)f[q][r]=r===l&&q===j?new i({x:n.cellIndex,y:j,isEmpty:!1,colSpan:o,rowSpan:p,parentX:l,parentY:j,virtualX:r,virtualY:q}):new i({x:n.cellIndex,y:j,isEmpty:!0,colSpan:o,rowSpan:p,parentX:l,parentY:j,virtualX:r,virtualY:q});else f[j][l]=new i({x:n.cellIndex,y:j,isEmpty:!1,colSpan:1,rowSpan:1,virtualX:l,virtualY:j})}else k++}var s=b.dom.id;return s||(b.dom.id=qb.generateTableId(),s=b.dom.id),f}},i.prototype.isMerge=function(){return 1!==this.colSpan||1!==this.rowSpan},i.prototype.isInMerge=function(){return this.parentX!==c&&this.parentX!==c},i.prototype.isInFirstLine=function(){return this.isInMerge()&&this.virtualY===this.parentY},i.prototype.isInLastLine=function(){return this.isInMerge()&&this.virtualY===this.parentY+this.rowSpan-1},i.prototype.isInRowRange=function(a){return this.isInMerge()&&this.parentY<=a&&a<=this.parentY+this.rowSpan-1},i.prototype.isParent=function(){return this.isInMerge()&&!this.isEmpty},j.prototype.get=function(a){return"string"==typeof a?this.getById(a):this.getTableIndexByElement(a)},j.prototype.getById=function(a){return this._dic[a]},j.prototype.getTableIndexByElement=function(b){var c=qb.util.getTableByElement(b);if(c){var d=a(c).attr("id");return this.getById(d)}return null},j.prototype.set=function(a,b){this._dic[a]=b},k.cellKlassName="table-cell",k.prototype.createPanel=function(b){return new a.Layer({content:this.createMatrix(10,10),params:"arrUp",pointTo:b,renderTo:document.body,popupRenderTo:document.body})},k.prototype.createMatrix=function(a,b){for(var c='<div class="table" style="">',d=0;a>d;d++){c+='<div class="table-row" style="overflow: hidden;">';for(var e=0;b>e;e++)c+=['<div class="table-cell" style="float:left;padding:2px;height: 8px;width: 8px;">','<div style="height:100%;width:100%;border:1px solid #eee;"></div>',"</div>"].join("");c+="</div>"}return c+="</div>",c+="<p class='desc' style='text-align:center;padding-top:2px;'>0"+jb.t("行")+"×0"+jb.t("列")+"</p>"},k.prototype.bindEvent=function(){var b=this;b._layer.getEl().find(".table-cell").listen("mousemove",function(a){var c=a.currentTarget||a.srcElement,d=b.higlightUtil(c);b.updateSelectNums({x:d.x+1,y:d.y+1})}),b._layer.getEl().find(".table").listen("mouseout",function(){b.clearHiglight(),b.updateSelectNums({x:0,y:0})}),b._layer.getEl().find(".table").listen("click",function(c){var d=a.Event.getTarget(c),e=b.isTableCell(d)?a(d):a(d).findParent("."+k.cellKlassName),f=b.getCoordinate(e.dom);f&&(qb.insert(f.y+1,f.x+1),b._layer.hide())})},k.prototype.higlight=function(a){a.style.border="1px solid #73B5FE",a.style.background="#E9F3FF"},k.prototype.removeHiglight=function(a){a.style.border="1px solid #E7E7E7",a.style.background="#F5F5F5"},k.prototype.getCoordinate=function(b){var c=-1;if(!this.isTableCell(b))return null;var b=a(b).hasClass(k.cellKlassName)?b:a(b).findParent("."+k.cellKlassName).dom;if(this._layer.getEl().find(".table-cell").each(function(a,d){d===b&&(c=a)}),-1===c)return null;var d=c%10,e=Math.floor(c/10),f={x:d,y:e};return f},k.prototype.higlightUtil=function(b){var c=this,d=this.getCoordinate(b);if(d){var e=this._layer.getEl().find(".table-row");return e.each(function(b,e){a(e).find(".table-cell").each(function(a,e){a<=d.x&&b<=d.y?c.higlight(e.childNodes[0]):c.removeHiglight(e.childNodes[0])})}),d}},k.prototype.updateSelectNums=function(a){this._layer.getEl().find(".desc").dom.innerHTML=a.y+jb.t("行")+"×"+a.x+jb.t("列")},k.prototype.clearHiglight=function(){var a=this;this._layer.getEl().find(".table-cell").each(function(b,c){a.removeHiglight(c.childNodes[0])})},k.prototype.destroy=function(){this._layer.destroy()},k.prototype.isTableCell=function(b){return a(b).hasClass(k.cellKlassName)||a(b).findParent("."+k.cellKlassName)},l.prototype.start=function(a){this.saveSelectionStart(a),qb.util.getTableByElement(a).listen("mousemove",qb.tableMousemoveHandler)},l.prototype.end=function(a){this.saveSelectionEnd(a),qb.util.getTableByElement(a).unlisten("mousemove",qb.tableMousemoveHandler)},l.prototype.reset=function(a){this.startPoint=this.endPoint=null,this.table=null,qb.util.getTableByElement(a).unlisten("mousemove",qb.tableMousemoveHandler)},l.prototype.getPoint=function(a){var b=qb.util.getCell(a);if(!b)return null;var c=qb.virtualTables.getTableIndexByElement(b);return c.getVirtualCellByReal(b)},l.prototype.saveSelectionStart=function(a){this.setTable(a),this.clearAllTableHiglight(),this.startPoint=this.endPoint=this.getPoint(a)},l.prototype.saveSelectionEnd=function(a){this.endPoint=this.getPoint(a)},l.prototype.clearHiglightEditorTableCell=function(b){a(qb.util.getCell(b)).removeClass(this.higlightCssKlass)},l.prototype.higlightEditorTableCell=function(b){a(qb.util.getCell(b)).addClass(this.higlightCssKlass)},l.prototype.isCellHiglight=function(b){var c=qb.util.getCell(b);return c&&a(c).hasClass(this.higlightCssKlass)},l.prototype.clearAllTableHiglight=function(){var b=this;if(this.table){var c=a(this.table).find("td."+this.higlightCssKlass);return c?(c.each(function(a,c){b.clearHiglightEditorTableCell(c)}),void 0):null}},l.prototype.setTable=function(b){this.table=a(b).findParent("table")},l.prototype.getSelectionRectLeftTop=function(){var a=this.startPoint.virtualX,b=this.startPoint.virtualY,c=this.endPoint.virtualX,d=this.endPoint.virtualY,e=Math.min(a,c),f=Math.min(b,d);return{x:e,y:f}},l.prototype.getSelectionRectRightBottom=function(){var a=this.startPoint.virtualX,b=this.startPoint.virtualY,c=this.endPoint.virtualX,d=this.endPoint.virtualY,e=Math.max(a,c),f=Math.max(b,d);return{x:e,y:f}},l.prototype.getSelectionLeftBottom=function(){var a=this.startPoint.virtualX,b=this.startPoint.virtualY,c=this.endPoint.virtualX,d=this.endPoint.virtualY,e=Math.min(a,c),f=Math.max(b,d);return{x:e,y:f}},l.prototype.getSelectionRightTop=function(){var a=this.startPoint.virtualX,b=this.startPoint.virtualY,c=this.endPoint.virtualX,d=this.endPoint.virtualY,e=Math.max(a,c),f=Math.min(b,d);return{x:e,y:f}},l.prototype.getSelectionRect=function(){var a=qb.tableSelection.getSelectionRectLeftTop(),b=qb.tableSelection.getSelectionRectRightBottom();return{width:b.x-a.x+1,height:b.y-a.y+1}},l.prototype.tryHiglightRect=function(){function b(a){return function(){qb.tableSelection.higlightEditorTableCell(a)}}var c=[];if(this.clearAllTableHiglight(),this.startPoint!==this.endPoint){var d=this.table,e=qb.virtualTables.get(d),f=this.getSelectionRectLeftTop(),g=this.getSelectionRectRightBottom();qb.util.betweenEach([f.y,g.y],[f.x,g.x],function(f,g){var h=e.getCell(g,f),i=qb.util.getCellByCoordinate(d,h);return h.isMerge()?(c=[],a.BREAK):(c.push(b(i)),void 0)}),qb.invokeQueue(c)}},l.prototype.getHiglightDimension=function(){var b=a(this.table).find("."+qb.cellHiglightCls),c={x:-1,y:-1},d={x:-1,y:-1};if(!b)return{leftTop:null,leftBottom:null,rightTop:null,rightBottom:null};var e=qb.tableSelection,c={x:-1,y:-1},d={x:-1,y:-1};return c.x=Math.min(e.startPoint.x,e.endPoint.x),c.y=Math.min(e.startPoint.y,e.endPoint.y),d.x=Math.max(e.startPoint.x,e.endPoint.x),d.y=Math.max(e.startPoint.y,e.endPoint.y),{leftTop:{x:c.x,y:c.y},rightTop:{x:d.x,y:c.y},leftBottom:{x:c.x,y:d.y},rightBottom:{x:d.x,y:d.y}}},m.BUTTON_KEY={Left:0,Wheel:1,Right:2},m.RANGE_TYPE={right:"right",bottom:"bottom",body:"body"},m.prototype.isLeft=function(a){return m.BUTTON_KEY.Left===a.button},m.prototype.isRight=function(a){return m.BUTTON_KEY.Right===a.button},m.prototype.setPressing=function(a){this._isPressing=a},m.prototype.isPressing=function(){return this._isPressing},m.prototype.getRangeType=function(b){var c=a.Event.getTarget(b);if(!qb.util.isInTableCell(c))return"";var d=qb.util.getCell(c),e=d.dom.getBoundingClientRect(),f={x:b.pageX,y:b.pageY},g=qb.util.getScroll(),h=e.right+g.x-f.x,i=e.bottom+g.y-f.y;return h>=0&&10>=h?"right":i>=0&&10>=i?"bottom":"body"},m.prototype.startDraging=function(a){this._isDraging=!0,this.startPointer={x:a.pageX,y:a.pageY},this.endPointer=null},m.prototype.stopDraging=function(){this._isDraging=!1,this.startPointer=null},m.prototype.recordMousePosition=function(a){this.endPointer={x:a.pageX,y:a.pageY}},m.prototype.isDraging=function(){return this._isDraging},m.prototype.getDragDistance=function(){return this.endPointer?{x:this.endPointer.x-this.startPointer.x,y:this.endPointer.y-this.startPointer.y}:{x:0,y:0}},m.prototype.reset=function(){this.setPressing(!1),this.stopDraging(),this.startPointer=null,this.endPointer=null},n.prototype.start=function(b,c){var d=qb.util.getCell(a.Event.getTarget(b)),e=d.dom.getBoundingClientRect();this.startRect={height:e.height,width:e.width},this.rangeType=c,this._cell=a.Event.getTarget(b),this.createIndicator(b),this.setCursor()},n.prototype.end=function(){this.removeCursor(),this.indicator.destroy(),this.startRect=null,this._cell=null,this.indicator=null},n.prototype.disableSelect=function(){a(qb.util.getTableByElement(this._cell)).addClass("APP-editor-unselectable")},n.prototype.enableSelect=function(){a(qb.util.getTableByElement(this._cell)).removeClass("APP-editor-unselectable")},n.prototype.setCursor=function(a){var b=a||this.rangeType;b===m.RANGE_TYPE.right?qb.editor.doc.body.style.cursor="col-resize":b===m.RANGE_TYPE.bottom&&(qb.editor.doc.body.style.cursor="row-resize")},n.prototype.removeCursor=function(){qb.editor.doc.body.style.cursor="auto"},n.prototype.resize=function(a){"right"===this.rangeType?this.setWidth(this._cell,a.x):"bottom"===this.rangeType&&this.setHeight(this._cell,a.y)},n.prototype.setWidth=function(b,c){var d=qb.util.getCell(b),e=qb.util.getTableByElement(b),f=qb.virtualTables.getTableIndexByElement(b),g=f.getVirtualCellByReal(d),h=g.virtualX;if(g.isMerge()){h=g.virtualX+g.colSpan-1;var i=f.getNotMergeCellInCol(h);i&&this.updateRect(f,i,e)}var j=this;a.Array.each(f.getRows(),function(a,b){var d=b[h];if(!d.isMerge()){var g=f.getTableCellByVirtual(e,d),i=j.startRect.width+c;g.style.width=Math.round(i)+"px"}});var k=e.width();e.width(k+c)},n.prototype.setHeight=function(b,c){var d=qb.util.getCell(b),e=qb.util.getTableByElement(b),f=qb.virtualTables.getTableIndexByElement(b),g=f.getVirtualCellByReal(d),h=g.virtualY,i=this;if(g.isMerge()){h=g.virtualY+g.rowSpan-1;var j=f.getNotMergeCellInRow(h);j&&this.updateRect(f,j,e)}a.Array.each(f.getRow(h),function(a,b){if(!b.isMerge()){var d=f.getTableCellByVirtual(e,b),g=i.startRect.height+c;d.style.height=Math.round(g)+"px"}})},n.prototype.updateRect=function(a,b,c){var d=a.getTableCellByVirtual(c,b),e=d.getBoundingClientRect();this.startRect={height:e.height,width:e.width}},n.prototype.createIndicator=function(a){"right"===this.rangeType?this.indicator=new q(a):"bottom"===this.rangeType&&(this.indicator=new p(a))},n.prototype.updateIndicatorPosition=function(a){this.indicator.updatePosition(a),this.log()},n.prototype.log=function(){this.rangeType===m.RANGE_TYPE.right?a.Log.count({editor_table_resize_width:1}):this.rangeType===m.RANGE_TYPE.bottom&&a.Log.count({editor_table_resize_height:1})},o.prototype.render=function(){a(qb.editor.doc.body).append(this._indicator)},o.prototype.createElement=function(){var a=document.createElement("div");return a.style.position="absolute",a.contentEditable="false",a},o.prototype.createIndicator=function(){throw new Error("createIndicator must be overwrite by child class")},o.prototype.updatePosition=function(){throw new Error("updatePosition must be overwrite by child class")},o.prototype.destroy=function(){a(this._indicator).remove(),this._indicator=null},a.Object.extend(p.prototype,o.prototype),a.Object.extend(p.prototype,{createIndicator:function(){var a=this.createElement();return a.style.height="1px",a.style.left="0px",a.style.width=qb.editor.doc.body.scrollWidth+"px",a.style.borderBottomStyle="dashed",a.style.borderBottomWidth="1px",a.style.cursor="row-resize",a},updatePosition:function(a){this._indicator.style.top=a.pageY+"px"}}),a.Object.extend(q.prototype,o.prototype),a.Object.extend(q.prototype,{createIndicator:function(){var a=this.createElement();return a.style.width="1px",a.style.top="0px",a.style.height=qb.editor.doc.body.scrollHeight+"px",a.style.borderLeftStyle="dashed",a.style.borderLeftWidth="1px",a.style.cursor="col-resize",a},updatePosition:function(a){this._indicator.style.left=a.pageX+"px"}})}($,window),function(a,b){function c(){var c=this;c.exec("insertHtml",a.Date.format(new b.Date,"yyyy-MM-dd"))}var d=a.Object,e=a.createClass($N("component.editor.plugin.InsertTime"));d.extend(e,{selected:c})}($,window),function(a){function b(){var a=this;a.exec("italic")}var c=a.Object,d=a.createClass($N("component.editor.plugin.Italic"));c.extend(d,{selected:b})}($,window),function(a){function b(a,b){var d=this,f=d.editMode,g=d[f+"JustifyMenu"];g||(g=new e({extcls:"APP-editor-menu-justify",items:[{text:c.t("左对齐"),icon:{extcls:"ico-editor ico-editor-justifyLeft"},click:function(){d.exec("justify","left")}},{text:c.t("居中对齐"),icon:{extcls:"ico-editor ico-editor-justifyCenter"},click:function(){d.exec("justify","center")}},{text:c.t("右对齐"),icon:{extcls:"ico-editor ico-editor-justifyRight"},click:function(){d.exec("justify","right")}}],width:"150px"}),g.attachTo({clickFrom:b,delegateTo:"self"}),g.fire("attachToShow"),d[f+"JustifyMenu"]=g)}var c=new $I18N("component.editor.plugin.Justify"),d=a.Object,e=a.getClass($N("component.Menu")),f=a.createClass($N("component.editor.plugin.Justify"));d.extend(f,{selected:b})}($,window),function(a){function b(a,b){var d=this,f=d.editMode,g=d[f+"LineheightMenu"];g||(g=new e({extcls:"APP-editor-menu-lineheight",items:[{text:c.t("1.5(默认)"),click:function(){d.exec("lineheight","1.5em")}},{text:"1.0",click:function(){d.exec("lineheight","1em")}},{text:"1.5",click:function(){d.exec("lineheight","1.5em")}},{text:"1.75",click:function(){d.exec("lineheight","1.75em")}},{text:"2.0",click:function(){d.exec("lineheight","2em")}},{text:"3.0",click:function(){d.exec("lineheight","3em")}}],width:"150px"}),g.attachTo({clickFrom:b,delegateTo:"self"}),g.fire("attachToShow"),d[f+"LineheightMenu"]=g)}var c=new $I18N("component.editor.plugin.Lineheight"),d=a.Object,e=a.getClass($N("component.Menu")),f=a.createClass($N("component.editor.plugin.Lineheight"));d.extend(f,{selected:b})}($,window),function(a){function b(){var b=this,d=b.cmd.selection.getRange(),f=b.exec("linkValue");if(f)try{d.selectNode(f);var g=d.createBookmark();b.cmd.unlink(),d.moveToBookmark(g),d.select()}catch(h){}else{var i=!0,j=d.cloneContents();if(j){var k=b.doc.createElement("DIV");k.appendChild(j),i=!!c.getElementsByTagName(k,"IMG").length,k=null}else i=!1;var l=b.getSelectText(),m=new a.Input({value:l,width:"400px"}),n=new a.Input({value:"http://",width:"400px"}),o=[i?"":'<div class="nui-txt-s14 nui-txt-normal" style="padding:10px 0 5px"><strong>'+e.t("请输入链接标题")+"</strong></div><div>"+m.html()+"</div>",'<div class="nui-txt-s14 nui-txt-normal" style="padding:10px 0 5px"><strong>'+e.t("请输入链接")+"</strong>"+e.t("（"+e.t("如")+"：http://www.163.com）")+"</div>","<div>",n.html(),"</div>"].join("");new a.Msgbox({type:"confirm",contentType:"normal",content:o,ok:function(){var c=n.getValue();if(!i&&""===a.String.trim(m.getValue()))return m.showTips(e.t("链接标题不能为空"),"err"),!0;if(!c||"http://"==c)return n.showTips(e.t("链接地址无效"),"err"),!0;var f={href:n.getValue()};if(""===l)f.textValue=m.getValue();else if(l!==m.getValue()){var g=d.createBookmark();d.select(),b.cmd.insertHtml(m.getValue()),d.moveToBookmark(g),d.select()}b.exec("link",f),d.collapse()}}),a.Component.setEvents()}}try{var c=$L("component.editor.Util")}catch(d){return d}var e=new $I18N("component.editor.plugin.Link"),f=a.Object,g=a.createClass($N("component.editor.plugin.Link"));f.extend(g,{selected:b})}($,window),function(a){function b(a,b){var d=this,f=d.editMode,g=d[f+"ListMenu"];g||(g=new e({items:[{text:c.t("符号列表"),icon:{extcls:"ico-editor ico-editor-cList"},click:function(){d.exec("insertunorderedlist")}},{text:c.t("数字列表"),icon:{extcls:"ico-editor ico-editor-nList"},click:function(){d.exec("insertorderedlist")}}],width:"150px"}),g.attachTo({clickFrom:b,delegateTo:"self"}),g.fire("attachToShow"),d[f+"ListMenu"]=g)}var c=new $I18N("component.editor.plugin.List"),d=a.Object,e=a.getClass($N("component.Menu")),f=a.createClass($N("component.editor.plugin.List"));d.extend(f,{selected:b})}($,window),function(a){function b(){var b=this;b.intervalCheckToolbarRender=new c(function(){return a.JS.css["geditor.css"]&&(e(b),b.intervalCheckToolbarRender=null),a.JS.css["geditor.css"]},{fail:function(){b.intervalCheckToolbarRender=null}}),b.listen("iframeReszie",n.resize)}function c(b,c){this.cb=b,this.failCb=c.fail||function(){},this.counter=0,a.Object.extend(this,{interval:300,maxTimes:10,autoTry:!0}),c.maxTimes&&(this.maxTimes=c.maxTimes),c.interval&&(this.interval=c.interval),"undefined"!=typeof c.autoTry&&(this.autoTry=c.autoTry),this.autoTry&&this.tryDo()
}function d(){var a=this;e(a)}function e(b){var c=0,d=!1,e=a(b.getEl().dom).find(".APP-editor-commond-more"),f=a(b.getEl().dom).find(".APP-editor-btn"),f=a(b.getEl().dom).find(".APP-editor-btn");f&&f.each(function(b,f){var g=a(f).offset();c||(c=g.y),g.y-c>20&&0!==g.y&&(d=!0,e&&(e.dom.style.display="block"))}),d?e&&(e.dom.style.display="block"):e&&e.hide()}function f(a,b,c){var d,e,f,g,h=0;c||(c={});var i=function(){h=c.leading===!1?0:(new Date).getTime(),d=null,g=a.apply(e,f),d||(e=f=null)},j=function(){var j=(new Date).getTime();h||c.leading!==!1||(h=j);var k=b-(j-h);return e=this,f=arguments,0>=k||k>b?(d&&(clearTimeout(d),d=null),h=j,g=a.apply(e,f),d||(e=f=null)):d||c.trailing===!1||(d=setTimeout(i,k)),g};return j.cancel=function(){clearTimeout(d),h=0,d=e=f=null},j}function g(a,b){var c;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}function h(b){return a(b.getEl().dom).find(".APP-editor-tbar-basic").width()}function i(b,c){var d=this;if(d.__moreMenu__)j(d);else{var e=new a.Menu({groups:[],reverse:!0,extcls:"APP-editor-more-menu"});d.__moreMenu__=e,e.attachTo({clickFrom:c,delegateTo:"self"}),e.fire("attachToShow"),setTimeout(function(){j(d)},0)}a(c).hasClass("APP-editor-btn-on")?a(c).removeClass("APP-editor-btn-on"):a(".APP-editor-commond-typo2").removeClass("APP-editor-btn-on"),d.typoTipsLayer&&(d.typoTipsLayer.destroy(),d.typoTipsLayer=null)}function j(b){var c=0,d=0,e=b.__moreMenu__;if(e){var f=a(b.getEl().dom).find(".APP-editor-btn");a(e.getEl().dom).empty(),f&&f.each(function(e,f){var g=a(f).offset();if(c){if(g.y-c>20){var h=f.cloneNode(!0),h=f.cloneNode(!0);if(a(h).hasClass("APP-editor-btn-spln")&&0===d)return;a(b.__moreMenu__.getEl().dom).append(h),h.onclick=function(a){b.editorToolbarClick(a,this,b)},d++}}else c=g.y}),e.setPosition()}}function k(a){a.unlisten("iframeReszie",n.resize)}var l=a.Object,m={init:b,getToolbarWidth:h,resize:d,selected:i,decounce:g,throttle:f,destroy:k},n=l.extend(a.createClass($N("component.editor.plugin.More")),m);c.prototype.tryDo=function(){this.counter++;var a=this.cb(),b=this;!a&&this.counter<this.maxTimes?this.timer=setTimeout(function(){b.tryDo()},this.interval):this.failCb()}}($,window),function(a){function b(){var a=this;a.exec("insertorderedlist")}new $I18N("component.editor.plugin.List");var c=a.Object,d=a.createClass($N("component.editor.plugin.OrderList"));c.extend(d,{selected:b})}($,window),function(a){function b(){}function c(){var a=this;a.exec("paste"),setTimeout(function(){a.fire("afterPaste")},0)}var d=a.Object;d.extend(a.createClass($N("component.editor.plugin.Paste")),{outSideDiv:null,bookMark:null,init:b,selected:c})}($,window),function(a){function b(){var a=this;a.history.canRedo()&&a.history.redo()}var c=a.Object,d=a.createClass($N("component.editor.plugin.Redo"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this,b=this,c=b.cmd.selection.getRange();c.collapsed||a.exec("removeFormat")}var c=a.Object,d=a.createClass($N("component.editor.plugin.RemoveFormat"));c.extend(d,{selected:b})}($,window),function(a){function b(){function b(){f(this,"fontname","fontFamily")}function c(){f(this,"fontsize","fontSize")}function d(){var a=f(this,"forecolor","color");a.find("icon")[0].getEl().css({background:this.rawConfig.color})}function f(b,c,d){var e=b.rawConfig,f=j["_"+c]=e.val;a.fly("#setDefPre").dom.style[d]="color"===d?e.color:f;var g=q.find("#"+c);return g.setText("fontsize"===c?e.val:e.text),g}function h(b,c,d){var e,f,h=k[b],m=[],n="",o=0,p=0;g.each(h,function(a,c){return"split"===c.type?(p=1,m.push({type:"split"}),void 0):(a-=p,f={text:i.getMenuItemText(b,c),icon:null,val:c.val,click:l[b]},c.val===d&&(n="fontsize"===b?c.val:c.name,o=a),m.push(f),void 0)});var r={xtype:"menu",checkType:"radio",groups:[{type:"scroll",items:m}],extcls:{fontname:"",forecolor:"APP-editor-color-picker"}[b]};if("forecolor"===b){var s=k.forecolor.groups[0].items,t=k.forecolor.groups[1].items,u=[{items:[]},{items:[]}];a.Array.each(s,function(a,c){u[0].items.push({click:l[b],text:c.text,val:c.value,code:c.value,color:c.color,checked:c.checked})}),a.Array.each(t,function(a,c){u[1].items.push({click:l[b],text:c.text,val:c.value,code:c.value,color:c.color,checked:c.checked})}),r={xtype:"menu",checkType:"radio",groups:u,extcls:"APP-editor-color-picker",width:"220px"}}e={id:b,text:n,subclass:"dropdownBtn ",extcls:"forecolor"===b?"APP-editor-default-color-btn":"",xtype:"button",renderTo:c,menu:r,icon:"forecolor"===b?"color-":null},q.add(e),"forecolor"===b&&setTimeout(function(){var b=a.Ud.get({field:"ntes_buzz",flag:"def_forecolor"}),c=!1,d=j.plugin.Forecolor.config,e=[].concat(d.groups[0].items,d.groups[1].items);a.Array.each(e,function(d,e){e.code===b&&(a(".APP-editor-default-color-btn").find(".nui-ico").css({background:e.color}),c=!0)}),c||a(".APP-editor-default-color-btn").find(".nui-ico").css({background:"#000"})},0)}var j=this,k=i.config={fontname:j.plugin.Fontname.config,fontsize:j.plugin.Fontsize.config,forecolor:j.plugin.Forecolor.config},l={fontname:b,fontsize:c,forecolor:d},m=j.fontsize,n=j.fontname,o=j.plugin.Forecolor.findDefault();j._fontname=j._fontsize=j._forecolor=null;var p=['<div class="APP-editor-setDft nui-fClear">','<ul class="APP-editor-setDft-form">','<li id="setDefFn" class="item">','<span class="item-name">'+e.t("字体")+"</span>","</li>",'<li id="setDefFs" class="item">','<span class="item-name">'+e.t("字号")+"</span>","</li>",'<li id="setDefFc" class="item item-color">','<span class="item-name">'+e.t("颜色")+"</span>","</li>","</ul>",'<div class="APP-editor-setDft-pre">','<div class="APP-editor-setDft-pre-tit">'+e.t("预览")+"</div>",'<div id="setDefPre" class="APP-editor-setDft-pre-cont" style="font-family:',n,";font-size:",m,";color:",o,'">','<table style="height:100%;width:100%">',"<tbody>","<tr>",'<td style="height:100%;width:100%" align="center" valign="middle">'+e.t("网易免费邮")+"<br>NetEase</td>","</tr>","</tbody>","</table>","</div>","</div>","</div>"].join(""),q=new a.Msgbox({header:e.t("设置编辑器默认值"),type:"confirm",contentType:"wide",content:p,ok:a.Function.bind(i.setDef,j)});h("fontname","setDefFn",n),h("fontsize","setDefFs",m),h("forecolor","setDefFc",o)}function c(a,b){switch(a){case"fontname":return'<span style="font-family:'+b.val+'">'+b.name+"</span>";case"fontsize":return b.val;case"fontcolor":return b.name;default:return b.name}}function d(){function b(b,c){if(c){var f=c.code;if(f===a.S_OK){var g=d.doc.body;return j&&(d.fontname=j,g.style.fontFamily=j),k&&(d.fontsize=k,g.style.fontSize=k),l&&(d.forecolor=l,g.style.color=l),a.Tips.show({succ:!0,text:e.t("默认字体设置成功")}),void 0}a.Tips.show({text:e.t("设置失败，请稍候再试")})}}function c(c,e,j){if(e){var k=i.config[c];g.each(k,function(b,c){return f.isObject(c)?c.val===e?(e=c.code,a.BREAK):void 0:void 0}),a.Ud.set({field:"ntes_buzz",flag:"def_"+c,value:e,notPost:!j,forcePost:j,call:h.bind(b,d,c)})}}var d=this,j=d._fontname,k=d._fontsize,l=d._forecolor;c("fontname",j,!(k||l)),c("fontsize",k,!l),c("forecolor",l,!0)}var e=new $I18N("component.editor.plugin.SetDefault"),f=a.Object,g=a.Array,h=a.Function,i=a.createClass($N("component.editor.plugin.SetDefault"));f.extend(i,{selected:b,setDef:d,getMenuItemText:c})}($,window),function(a){function b(){var b=this;b.constructor.mode;var d=['<div class="APP-editor-source-code-layer">','<div class="APP-editor-source-code-mask">',"</div>",'<span class="APP-editor-source-code-exit">',c.t("退出源码模式"),"</span>","</div>"].join(" ");a(b.getEl().dom).find(".APP-editor-tbar-basic").append(d),a(b.getEl().dom).find(".APP-editor-source-code-exit").dom.onclick=function(){a(b.getEl().dom).find(".APP-editor-source-code-layer").remove(),b.changeMode("basic")},b.changeMode("source"),b.typoTipsLayer&&(b.typoTipsLayer.destroy(),b.typoTipsLayer=null)}var c=new $I18N("component.editor.plugin.Source"),d=a.Object,e=a.createClass($N("component.editor.plugin.Source"));d.extend(e,{selected:b})}($,window),function(a){function b(){var a=this;a.exec("strikethrough")}var c=a.Object,d=a.createClass($N("component.editor.plugin.StrikeThrough"));c.extend(d,{selected:b})}($,window),function(a){function b(){}var c=a.Object;a.Event;var d=a.createClass($N("component.editor.plugin.Tab"));c.extend(d,{selected:b})}($,window),function(a,b,c){function d(){var b=this,c=a.Browser.isIE("<10");a.Browser.ie()&&c||a(b.getDom()).find(".APP-editor-commond-typo").hide()}function e(){function b(){var b=a("#typoMenuDv");b&&b.hide()}var c=this;v.doc=c.doc;var d=c.editMode,e=c.constructor.mode;d==e.TEXT||d==e.SOURCE?new a.Msgbox({type:"confirm",content:q.t("拼写检查需要切换到富文本编辑模式，是否切换？"),okText:q.t("是"),cancelText:q.t("否"),ok:function(){c.changeMode(e.BASIC),v.check.apply(c)}}):v.check.apply(c),c._bindTypoEvent||(c.addListener(c.doc,"click",".typoRed",function(){v.showMenu.call(this,c)}),c.listen("iframeClick",b),a.Event.listen(document,"click",b),c._bindTypoEvent=!0)}function f(){function b(a){var b=e.doc.getElementById(a);b&&(o.remove(b),g=!0)}function c(){e.showMask(5e3),e._isTypoChecking=!0;var b=$I("core.DataAction");(new b).request({data:{url:u.getUrl("compose_typo"),method:a.Ajax.POST,body:"text="+encodeURIComponent(h),call:a.Function.bind(v.showError,e)}})}function d(){var a=i.getEl().find("#editorTypoChk");a.dom.checked&&t.set({field:"ntes_buzz",flag:"typo_prompt",value:"1"})}var e=this;if(e._isTypoChecking)return a.Tips.show({text:q.t("正在进行拼写检查，请稍后再试")}),void 0;v.ignoreAll(e);var f=e.getContent(),g=!1;f.indexOf("\n")>=0&&(f=f.replace(/\n/g,""),g=!0),b("isReplyContent"),b("isForwardContent");var h=o.getDomText(e.body,!0);g&&e.setContent(f);var i,j=1!=t.get({field:"ntes_buzz",flag:"typo_prompt"});/[a-zA-z]+/.test(h)?j&&/[\u4E00-\u9FA5]+/.test(h)?i=new a.Msgbox({type:"confirm",title:q.t("拼写检查暂不支持中文。不过，我们仍可以检查您邮件中的所有英文拼写。")+'<br><br><input id="editorTypoChk" type="checkbox"/>'+q.t("&nbsp;不再提示"),okText:q.t("检查"),cancelText:q.t("不检查"),ok:function(){d(),c()},cancel:d}):c():a.Msgbox.show({title:q.t("对不起，拼写检查暂时只支持英文。")})}function g(b){var d=this;d.showMask(!1);var e=b.responseText,f=a.Eval.get(e);f=f.res;var g=d.cmd.selection.getRange();g.setEnd(d.body,0).collapse();var h=d.doc.createElement("span");h.className="typoRed";var i=0;d.typoData={},s.each(f,function(a,b){var e=v._findRangeText(g,b,i);if(e){i=b.pos+b.src.length;var j=h.cloneNode(),k=e.cloneRange(),l=k.extractContents();j.appendChild(l),k.insertNode(j).selectNode(j),e.setEndAfter(j),g=e;var m=(new Date).getTime()+Math.random()+"";j.setAttribute("evId",m),j.id=m,d.typoData[m]=f[a]}else i=c}),d._isTypoChecking=!1,a.Tips.show({text:q.t("检查成功"),succ:!0})}function h(b){function c(a){var b='<div class="nui-menu-item"><div class="nui-menu-item-link"><span class="nui-menu-item-text">'+a+"</span>"+"</div>"+"</div>";return b}var d=b.constructor.mode,e=this,f=a("#typoMenuDv"),g=e.getAttribute("evId");b.curTypoSpan=e;var h=!1;if(f?f=f.dom:(h=!0,f=document.createElement("DIV"),f.id="typoMenuDv",f.className="nui-menu",f.style.display="none",b.editDv.append(f),b.addListener(f,"click",function(a){v.clickMenu.call(this,a,b)})),h||f.getAttribute("typoId")!=g){a(f).empty(),f.setAttribute("typoId",g);var i=b.typoData[g];if(!i)return;var j=i.list;(!j||0==j.length&&i["case"])&&(j=[i["case"]]);for(var k="",l=0,m=j.length;m+2>l;l++)0==m&&0==l&&(k+=c(q.t("暂无提示"))),l==m&&(k+='<div class="nui-menu-split nui-split"></div>'),k+=c(m>l?j[l]:l==m?q.t("忽略"):q.t("忽略全部"));f.innerHTML=k}var n=a(e).offset();f.style.left=n[0]+"px";var o=n[1],p=b.doc.body.scrollTop;f.style.top=o-p+e.offsetHeight+31+(b.editMode==d.FULL?27:0)+"px",o-p>b.innerDv.dom.offsetHeight/2&&(o=o-p+31+(b.editMode==d.FULL?27:0)-f.offsetHeight,f.style.top=o+"px");var r=a(f).find(".nui-menu-item");r.each(function(b,c){var d=a(c);d.listen("mouseover",function(){d.addClass("nui-menu-item-hover")}),d.listen("mouseout",function(){d.removeClass("nui-menu-item-hover")})}),setTimeout(function(){if(f.style.display="block",a.Browser.isIE("<9")){var b=a(f),c=0,d=b.find(".nui-menu-item-text");if(d&&d.doms)for(var e,g,h=d.doms,i=0,j=h.length;j>i;i++){var e=h[i];g=Math.max(e.offsetWidth,e.clientWidth)||120,c=Math.max(g,c)}b.dom.style.width=c+100+"px"}},0)}function i(b,c){var d=this,e=a.Event.getTarget(b);d.getAttribute("typoId");var f=c.curTypoSpan,g=e.innerHTML;return g.indexOf(q.t("全部"))>=0?(v.ignoreAll(c),!1):(g.indexOf(q.t("忽略"))>=0?v.clear(f,c.doc):g&&g.indexOf(q.t("暂无提示"))<0&&g.indexOf("nui-menu-split nui-split")<0&&a(f).replace(g,c.doc),!1)}function j(a,b){var c,d=a.typoData;return!d||r.isEmpty(d)?!1:(b?(c=a.ignoreTypoDv,c||(c=a.ignoreTypoDv=document.createElement("DIV"),c.style.display="none",a.editAreaDv.append(c)),c.innerHTML=a.getContent()):c=a.body,function(c){if(c.childNodes)for(var d=c.childNodes,e=0;e<d.length;e++)arguments.callee.call(null,d[e]);"SPAN"==c.tagName&&"typoRed"==c.className&&v.clear(c,b?document:a.doc)}(c),b?c.innerHTML:void 0)}function k(a){var b=v.reg,c=v.doc.createElement("DIV");c.appendChild(a.cloneNode(!0)),b.test(c.innerHTML)?(a.removeAttribute("class"),a.removeAttribute("id"),a.removeAttribute("evId")):o.remove(a,!0)}function l(a,b,d){try{for(var e=b.src,f=b.pos-(d==c?v._getRangePos(a):d),g=e.length,h=0,i=0,j=!0;5>h;){if(f+i>=0){var k=a.cloneRange();v._rangeMove(k,f+i),k.collapse(!0),v._rangeMove(k,g,!0)}if(k.toString()==e)return k;j?(h++,i=h,j=!1):(i=0-h,j=!0)}return!1}catch(l){return!1}}function m(a){var b=a.document;a=a.cloneRange(),a.setStartAtFirst(b.body);var c=a.cloneContents();return c?o.getDomText(c).length:0}function n(a,b,c){function d(){for(;e;){var a=e.nextSibling;if(a){e=a,f=0;break}e=e.parentNode}}var e,f,g,h=c?a.cloneRange():a,e=h.endContainer,f=h.endOffset;for(1==e.nodeType&&f==e.childNodes.length&&(d(),h.setEnd(e,f));b>=0;)if(3==e.nodeType){if(!(b>0))break;var i=e.nodeValue;i.indexOf("\n")>=0&&(i=i.replace(/\n/g,""),e.nodeValue=i);var g=e.nodeValue.length;if(g>b||c&&g==b){f+=b;break}b-=g,d()}else{if(g=o.getDomText(e).length,0!=f)for(var j=0;f>j;j++)g-=o.getDomText(e.childNodes[j]).length;if(g>b||c&&g==b){var k=e.childNodes;e=k.length<=f?e.lastChild:k[f],f=0}else d(),b-=g}a[c?"setEnd":"setStart"](e,f)}try{var o=$L("component.editor.Util")}catch(p){return p}var q=new $I18N("component.editor.plugin.Typo"),r=a.Object,s=a.Array;a.Function,a.Log;var t=a.Ud,u=a.Uri,v=a.createClass($N("component.editor.plugin.Typo"));r.extend(v,{init:d,selected:e,check:f,showError:g,showMenu:h,clickMenu:i,ignoreAll:j,clear:k,_findRangeText:l,_getRangePos:m,_rangeMove:n,reg:/^<[^>]*style=[^>]*>/i})}($,window),function(a,b,c){function d(){var b=this,c=a.Browser.isIE("<10");return a.Browser.ie()&&c?(a(b.getDom()).find(".APP-editor-commond-typo2").hide(),void 0):$G.environment.isCh?($G.environment.isCh||a(b.getDom()).find(".APP-editor-commond-typo2").hide(),S.tips.tryDisplayFirstShowTips(b),void 0):(a(b.getDom()).find(".APP-editor-commond-typo2").hide(),void 0)}function e(a,b){var c=this,d=c.getContent("","text");if(d.length>S.letterMaxThreshold)return S.showTooLongMsgBox(),void 0;S.doc=c.doc;var e=c.editMode,f=c.constructor.mode;e==f.TEXT||e==f.SOURCE?S.switchEditorModeConfirm(c,f):S.check.apply(c),c._bindTypoEvent||(S.fixMenuClick(c),c._bindTypoEvent=!0),c.typoTipsLayer&&S.tips.hideTips(c,b)}function f(b,c){new a.Msgbox({type:"confirm",content:K.t("拼写检查需要切换到富文本编辑模式，是否切换？"),okText:K.t("是"),cancelText:K.t("否"),ok:function(){b.changeMode(c.BASIC),S.check.apply(b)}})}function g(){a.Tips.loadingTips&&a.Tips.loadingTips.hide()}function h(b){b.addListener(b.doc,"click",".typoRed",function(){S.showMenu.call(this,b)}),b.listen("iframeClick",function(a){S.handleClick(a,b)}),a.Event.listen(document,"click",function(a){S.handleClick(a,b)})}function i(b){var c=a(b.doc.body).find("#typoMenuDv");c&&c.hide()}function j(){var b=this;if(b._isTypoChecking)return a.Tips.show({text:K.t("正在进行拼写检查，请稍后再试")}),void 0;S.ignoreAll(b);var c=b.getContent(),d=!1,e=S.filterNode(b,"isReplyContent"),f=S.filterNode(b,"isForwardContent"),g=S.filterNode(b,"spnEditorSign"),h=S.filterNode(b,"divNeteaseMailCard"),h=S.filterNode(b,"typoMenuDv");d||(d=e||f||g||h);var i=I.getDomText(b.body,!0);i=i.replace(/^\n$/gm,""),"\n"===i[0]&&(i=i.replace("\n","")),b.setContent(c),i&&/[a-zA-z]+/.test(i)?S.request(b,i):(a.Msgbox.show({title:K.t("检查失败，没有找到需要检查的英文内容，建议写完邮件后再使用英文智能检查功能")}),N.count({editor_typo2_error_noEnglish:1}))}function k(a,b){var c=a.doc.getElementById(b);return c?(I.remove(c),!0):!1}function l(b,c){b.showMask(5e3),b._isTypoChecking=!0;var d="content="+encodeURIComponent(c),e=P.getUrl("compose_typo_2"),f=function(){b._isTypoChecking=!1,S.response(b,this),S.hideLoading()},g=function(){b._isTypoChecking=!1,b.showMask(!1),S.showCheckFailTips(),S.hideLoading()},h=function(){S.hideLoading()};if(a.Tips.loading(K.t("加载中..")),a.Ext.editorNewTypo)if(a.Browser.ie()){var i=new XMLHttpRequest;i.open("post",e),i.withCredentials=!0,i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onload=f,i.onerror=g,i.onabort=h,i.send(d)}else{var j=a.Ajax._xmlHttpRequest({url:e,requestType:a.Ajax.CORS,method:a.Ajax.POST,body:d,call:function(a){b._isTypoChecking=!1,S.response(b,a)}},!0);j.onerror=g}}function m(b,c){if(c&&200===c.status&&4===c.readyState){b.showMask(!1);var d=c.response,e=a.Eval.get(d);if(b._isTypoChecking=!1,S.hideLoading(),e["ce-code"]===Q.notEnglish)S.sorryForEnglishOnlyAlert(),N.count({editor_typo2_error_apiNoEnglish:1});else if(e.code===R.requestTimesDailyLimit)a.Tips.show({text:K.t("当前检查人数过多，请稍后再试"),succ:!1}),a.Log.count({editor_typo2_error_requestTimesDailyLimit:1});else if(e.code===R.requestTooFast)S.showCheckFailTips(),a.Log.count({editor_typo2_error_requestTooFast:1});else if(e.code===R.sizeOverLimit)a.Msgbox.show({title:K.t("检查失败，当前检查文本过长，建议删减文本内容后重试")}),a.Log.count({editor_typo2_error_sizeOverLimit:1});else if(200===e.code){var f=e.result.alerts;S.showCheckSuccessTips(f),S.showError(b,f)}else S.showCheckFailTips(),a.Log.count({editor_typo2_error_unknown:1})}}function n(b){var c="",d={};b.length?(c="检查成功，请点击红色划线部分进行修改",d.editor_typo2_checkSuccess_hasError=1):(c="检查成功，此次没有错误",d.editor_typo2_checkSuccess_noError=1),a.Tips.show({succ:!0,text:c}),a.Log.count(d)}function o(){a.Tips.show({text:K.t("检查失败，请稍后重试"),succ:!1})}function p(){a.Msgbox.show({title:K.t("检查失败，当前英文内容较少，建议确认内容后再使用英文智能检查功能")})}function q(a){var b=a.getEl().find("#editorTypoChk");b.dom.checked&&O.set({field:"ntes_buzz",flag:"typo_prompt",value:"1"})}function r(b,d){var e=null,f=d.response;"string"==typeof f?(e=a.Eval.get(f),e=e.res):e=d;var g=b.cmd.selection.getRange();g.setEnd(b.body,0).collapse();var h=b.doc.createElement("span");h.className="typoRed";var i=0;b.typoData={},M.each(e,function(a,d){var f=S._findRangeText(g,d,i);if(f){i=d.pos+d.src.length;var j=h.cloneNode(),k=f.cloneRange(),l=k.extractContents();j.appendChild(l),k.insertNode(j).selectNode(j),f.setEndAfter(j),g=f;var m=(new Date).getTime()+Math.random()+"";j.setAttribute("evId",m),j.id=m,b.typoData[m]=e[a]}else i=c})}function s(b){function c(a,b,c){var d=!a,e=a||c,f=a||"",g=d?"删除":"替换",h=['<div class="APP-editor-suggestion">','<span class="APP-editor-typo-suggesction-btn" index="'+b+'" suggestion="'+f+'">',K.t(g),"</span>",'<div class="APP-editor-typo-suggestion-text">',d?'<div class="APP-editor-typo-suggestion-text-del">':"",e,d?"</div>":"","</div>","</div>"].join("");return h}b.constructor.mode;var d=this,e=a(b.doc.body).find("#typoMenuDv"),f=d.getAttribute("evId");b.curTypoSpan=d;var g=!1;if(e?e=e.dom:(g=!0,e=document.createElement("div"),e.id="typoMenuDv",e.className="nui-layer nui-layer-hasArr  nui-layer-arrUp nui-layer-typo-suggestion",e.style.display="none",e.contentEditable=!1,a.Browser.ie()&&(e.onselectstart=function(){return!1},e.onmousedown=function(){return!1},e.oncontextmenu=function(){return S.moveSelection(b),!1}),b.doc.body.appendChild(e)),g||e.getAttribute("typoId")!=f){a(e).empty(),e.setAttribute("typoId",f);var h=b.typoData[f];if(!h)return;var i=h.list;(!i||0==i.length&&h["case"])&&(i=[h["case"]]);for(var j="",k=0,l=i.length;l>k;k++)0==l&&0==k&&(j+=c(K.t("暂无提示"))),k==l&&(j+='<div class="nui-menu-split nui-split"></div>'),j+=c(i[k],k,h.src);var m=h.resson?['<div class="APP-editor-typo-suggestion-reason">',h.resson,"</div>"].join(""):"",n=['<div class="APP-editor-typo-suggestion-footer typo-suggestion-ignore" >',K.t("忽略"),"</div>"].join(""),o=['<b class="nui-layer-arr"></b>','<div class="nui-layer-normal">','<div class="APP-editor-typo-suggestion-head">',j,m,"</div>",n,"</div>"].join("");e.innerHTML=o}setTimeout(function(){e.style.display="block";var c=a(e).find(".APP-editor-typo-suggestion-head").width();a(e).find(".APP-editor-typo-suggestion-head").width(c),a(e).find(".APP-editor-typo-suggestion-reason").dom.style.display="block",S.fixMenuPosition(b,d,e)},0)}function t(b,c,d){var e=a(c).offset(),f=c.getClientRects(),g=a(c).height(),h=b.win.innerHeight,i=11,j=b.doc.body.scrollWidth,k=a(d).height()+i,l=a(d).width(),m=0;f[0].y+k+g>h?(d.style.top=e[1]-k+"px",a(d).removeClass("nui-layer-arrUp").addClass("nui-layer-arrDown")):(a(d).removeClass("nui-layer-arrDown").addClass("nui-layer-arrUp"),d.style.top=e[1]+g+11+"px"),m=e[0]+l>=j?j-l-10:e[0]-l<0?10:e[0]-l/2,d.style.left=m+"px";var n=e[0]-m-10;20>n&&(n=20),a(d).find(".nui-layer-arr").css({left:n})}function u(b,c){var d=a.Event.getTarget(b),e=c.curTypoSpan;if(!S.isClickInMenu(b))return S.hideMenu(c),void 0;if(S.isIgnore(b))S.clear(e,c.doc),S.hideMenu(c),N.count({editor_typo2_ignore:1});else if(S.isReplace(b)){var f=d.getAttribute("suggestion");a(e).replace(f,c.doc),S.hideMenu(c),f?N.count({editor_typo2_replace:1}):N.count({editor_typo2_del:1})}}function v(b){var c=a(b.doc.body).find("#typoMenuDv");c&&(c.dom.blur(),b.cmd.selection.clearRange())}function w(b){var c=a.Event.getTarget(b),d=a(c).findParent(".nui-layer-typo-suggestion");return d?!0:!1}function x(b){var c=a.Event.getTarget(b);return a(c).hasClass("APP-editor-typo-suggesction-btn")}function y(b){var c=a.Event.getTarget(b);return a(c).hasClass("typo-suggestion-ignore")}function z(a,b){var c,d=a.typoData;return!d||L.isEmpty(d)?!1:(b?(c=a.ignoreTypoDv,c||(c=a.ignoreTypoDv=document.createElement("DIV"),c.style.display="none",a.editAreaDv.append(c)),c.innerHTML=a.getContent()):c=a.body,function(c){if(c.childNodes)for(var d=c.childNodes,e=0;e<d.length;e++)arguments.callee.call(null,d[e]);"SPAN"==c.tagName&&"typoRed"==c.className&&S.clear(c,b?document:a.doc)}(c),b?c.innerHTML:void 0)}function A(a){var b=S.reg,c=S.doc.createElement("DIV");c.appendChild(a.cloneNode(!0)),b.test(c.innerHTML)?(a.removeAttribute("class"),a.removeAttribute("id"),a.removeAttribute("evId")):I.remove(a,!0)}function B(a,b,d){try{for(var e=b.src,f=b.pos-(d==c?S._getRangePos(a):d),g=e.length,h=0,i=0,j=!0;5>h;){if(f+i>=0){var k=a.cloneRange();S._rangeMove(k,f+i),k.collapse(!0),S._rangeMove(k,g,!0)}if(k.toString()==e)return k;j?(h++,i=h,j=!1):(i=0-h,j=!0)}return!1}catch(l){return!1}}function C(a){var b=a.document;a=a.cloneRange(),a.setStartAtFirst(b.body);var c=a.cloneContents();if(c){var d=I.getDomText(c);return d.replace(/^x\n$/gm,"").length}return 0}function D(a,b,c){function d(){for(;e;){var a=e.nextSibling;if(a){e=a,f=0;break}e=e.parentNode}}var e,f,g,h=c?a.cloneRange():a,e=h.endContainer,f=h.endOffset;for(1==e.nodeType&&f==e.childNodes.length&&(d(),h.setEnd(e,f));b>=0;)if(3==e.nodeType){if(!(b>0))break;var i=e.nodeValue;i.indexOf("\n")>=0&&(i=i.replace(/\n/g,""),e.nodeValue=i);var g=e.nodeValue.length;if(g>b||c&&g==b){f+=b;break}b-=g,d()}else{if(g=S.removeEmptyLine(I.getDomText(e,!0)).length,0!=f)for(var j=0;f>j;j++)g-=S.removeEmptyLine(I.getDomText(e.childNodes[j],!0)).length;if(g>b||c&&g==b){var k=e.childNodes;e=k.length<=f?e.lastChild:k[f],f=0}else d(),b-=g}a[c?"setEnd":"setStart"](e,f)}function E(a){a.typoTipsLayer=null}function F(){return N.count({editor_typo2_error_textOverLimit:1}),new a.Msgbox({title:"检查失败，当前检查文本过长，建议删减文本内容后重试"})}function G(a){return a.replace(/\n{2,}/gm,"\n").replace(/^\n$/gm,"")}function H(){}try{var I=$L("component.editor.Util")}catch(J){return J}var K=new $I18N("component.editor.plugin.Typo"),L=a.Object,M=a.Array,N=a.Log,O=a.Ud,P=a.Uri,Q={notEnglish:"102"},R={forbidden:401,sizeOverLimit:414,requestTimesDailyLimit:451,requestTooFast:452},S=L.extend(a.createClass($N("component.editor.plugin.Typo2")),{doc:null,letterMinThreshold:40,letterMaxThreshold:5e3,mark:{firstShow:"editor_plugin_typo_firstShow_"+$S("uid")},tips:new H,init:d,selected:e,check:j,showError:r,showMenu:s,fixMenuPosition:t,hideMenu:i,fixMenuClick:h,handleClick:u,isClickInMenu:w,isReplace:x,isIgnore:y,moveSelection:v,ignoreAll:z,clear:A,_findRangeText:B,_getRangePos:C,_rangeMove:D,reg:/^<[^>]*style=[^>]*>/i,filterNode:k,removeEmptyLine:G,request:l,response:m,showTooLongMsgBox:F,sorryForEnglishOnlyAlert:p,setUdForMixChineseAlert:q,showCheckSuccessTips:n,showCheckFailTips:o,switchEditorModeConfirm:f,hideLoading:g,destroy:E});H.status={SHOWED:"1"},H.prototype.showTips=function(b,c,d){var e=this;if(!b.typoTipsLayer){var f=b.getDom(),g=a(f).find(".APP-editor-commond-typo2"),h=a(f).find(".APP-editor-commond-more"),i=a(f).find(".APP-editor-commond-undo"),j=null,k=this.isTypoBtnVisiable(g,i);if(j=k?g:h,k||!h||"none"!==h.dom.style.display){this.focus(j),this.focus(g),b.typoTipsLayer=this.createLayer(j,f),b.typoTipsLayer.listen("closeclick",function(){c&&c(),b.typoTipsLayer=null,e.blur(j)});var l={};l[d]=1,N.count(l)}}},H.prototype.hideTips=function(a,b){a.typoTipsLayer&&(this.blur(b),a.typoTipsLayer.destroy(),a.typoTipsLayer=null)},H.prototype.tryDisplayFirstShowTips=function(b){var c=a.Storage.get(S.mark.firstShow),d=1e3,e=this;this.isShowed(c)||setTimeout(function(){e.setShowed(S.mark.firstShow),e.showTips(b,function(){N.count({editor_typo2_firstShow_close:1})},"editor_typo2_firstShow")},d)},H.prototype.isTypoBtnVisiable=function(a,b){return a.offset().y===b.offset().y},H.prototype.isShowed=function(a){return a===H.status.SHOWED},H.prototype.setShowed=function(b){a.Storage.set(b,H.status.SHOWED)},H.prototype.focus=function(a){a.addClass("APP-editor-btn-on")},H.prototype.blur=function(a){a.removeClass("APP-editor-btn-on")},H.prototype.createLayer=function(c,d){var e=b.innerWidth;return new a.Layer({content:'<div style="width:220px;font-size:14px;color: #555;line-height: 24px;">'+K.t("点击“英文智能检查”，可开启英文自动检查和纠错功能，省时高效")+"</div>",extcls:1520>=e?"nui-layer-typo-remind-tips-edge":"nui-layer-typo-remind-tips",params:"arrUp",pointTo:c,renderTo:d,popupRenderTo:d,hasClose:!0,doNotHide:!0,fixY:-11,fixX:1520>=e?8:0})}}($,window),function(a){function b(){var a=this;a.exec("underline")}var c=a.Object,d=a.createClass($N("component.editor.plugin.Underline"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this;a.history.canUndo()&&a.history.undo()}var c=a.Object,d=a.createClass($N("component.editor.plugin.Undo"));c.extend(d,{selected:b})}($,window),function(a){function b(){var a=this;a.exec("insertunorderedlist")}var c=a.Object,d=a.createClass($N("component.editor.plugin.UnorderList"));c.extend(d,{selected:b})}($,window),function(a){var b=new $I18N("config.Appcenter");$G.set("appCenterConfig",{gotoApp:function(b){function c(a){var b=a.appId||a.id;return a.id=b,a.text=a.name,a.name=b,a.fullScreen=!0,a.isAppcenterApp=!0,a.url&&0!==a.url.indexOf("http")&&(a.name=a.url),a}a.AppManager.startApp(c(b));try{a.Msgbox.msgbox&&"appcenterMsg"===a.Msgbox.msgbox.rawConfig.indentityType&&a.Msgbox.msgbox.hide()}catch(d){}},showMsg:function(b){(b||{}).indentityType="appcenterMsg",a.Msgbox.show(b)},showTips:function(b){a.Tips.show(b)},addApp:function(c){var d=a.AppManager,e=c.id;d.resetDataSource(),d.getAppsList({call:function(){d.addDockApp(e,function(){try{var d=$L("init.Dock",this)}catch(f){return f}c.onlyShowDock?d.showAddedAnimation(e):a.Msgbox.show({icon:"suc",title:b.t("应用添加成功！"),content:b.t("应用已成功添加至邮箱触点。"),okText:b.t("立即使用"),cancelText:b.t("继续添加"),ok:function(){$G.get("appCenterConfig").gotoApp(c),d.showAddedAnimation(e)},close:function(){d.showAddedAnimation(e)},cancel:function(){d.showAddedAnimation(e)}}),d.show()})}})},changeApp:function(){var b=a.AppManager;b.resetDataSource(),b.getAppsList({call:function(){a.Listener.fire("appmanager:modify"),a.Listener.fire("tab:reset")}})},frameClick:function(){a.Event.fire(document,"click"),a.Event.fire(document.body,"click")},extLink:""})}($,window),function(){function a(a){var b;b=l.signFilter?{filterHtml:!0}:{},this.wmsvr({func:"user:getSignatures",body:b,call:function(b){var c=b["var"];a(c)},error:function(){a(!1)}})}function b(a,b){var c=this,d=function(d){if(d["var"].length>=a.limit)return b({overflow:!0}),void 0;var e={items:[{name:a.name,disabled:!1,"continue":!0,condictions:[{field:"from",disabled:!1,operator:"contains",operand:a.operand,ignoreCase:!1},{field:"accounts",disabled:!1,operator:"contains",operand:a.accounts}],actions:[{type:"move",disabled:!1,target:a.fid}]}]};c.wmsvr({func:"user:addMailRules",body:e,call:b})};c.wmsvr({func:"user:getMailRules",body:{},call:d})}function c(a){var b=this;b.wmsvr({func:"user:getMailRules",body:{},call:function(b){a&&a(b["var"])}})}function d(a){this.wmsvr({func:"global:sequential",body:{items:[{func:"user:getAttrs","var":{attrIds:["autorepmode","autoreptext"]}},{func:"user:getMailRules","var":{category:"autoreply"}}]},call:a})}function e(a){$.Ajax.jsonp(m.getUrl("getMobileServiceNo")+"&product=fw",function(b){a(b)})}function f(a,b){var c=m.getUrl("smsPushVerifyCode"),d="mobile="+a+"&product=fw";$G.environment.isCh||(d="mobile="+a+"&product=fw_international"),c=$.String.uriAddParam(c,d),$.Ajax.jsonp(c,function(a){b(a)})}function g(a,b,c){var d=m.getUrl("smsVerifyCode"),e="mobile="+a+"&product=fw&vcode="+b;$G.environment.isCh||(e="mobile="+a+"&product=fw_international&vcode="+b),d=$.String.uriAddParam(d,e),$.Ajax.jsonp(d,function(a){c(a)})}function h(a,b,c){var d=m.getUrl("mobile_bind_send");d="lotteryPopup"==c?$.String.uriAddParam(d,"mobile="+a+"&from=webmail_web_cphongbao"):$.String.uriAddParam(d,"mobile="+a+"&from=webmail_wel_sectips"),$.Ajax.jsonp(d,function(a){b(a)},"cb")}function i(a,b,c,d){var e=m.getUrl("mobile_bind_verify");e="lotteryPopup"==d?$.String.uriAddParam(e,"mobile="+a+"&vcode="+b+"&from=webmail_web_cphongbao"):$.String.uriAddParam(e,"mobile="+a+"&vcode="+b+"&from=webmail_wel_sectips"),$.Ajax.jsonp(e,function(a){c(a)},"cb")}var j=$I("core.DataAction"),k=$.createClass($N("support.OptionSupportAction")),l=$.Ext,m=$.Uri;$.Object.inherit(k,j),$.Object.extend(k.prototype,{getPhoneStatue:e,sendPhoneVerifyCode:f,verifyCode:g,getSignList:a,addMailFilter:b,getMailFilter:c,getAutoReply:d,sendMobileCode:h,verifyMobileCode:i})}(),function(a,b,c){function d(a){var b=$S("attrs").user,c={},d=c.antispamlevel=b.junkfilter||0,e=b.keepspamdays;d=d>-1?d:1,e=e>-1?e:-1,c.spammailhandle=e>0&&0==d?0:0==e?1:0,c.mailpic=b.junkpic;var f=H.get({field:"ntes_option",flag:"deliver"})-0;c.subautopost=J.getBit(f,0),c.adautopost=J.getBit(f,1),c.spamautopost=J.getBit(f,2),c.spamkeepperiod=E.get(5)?E.get(5).keepPeriod:null,c.adkeepperiod=E.get(7)?E.get(7).keepPeriod:null,c.subkeepperiod=E.get(18)?E.get(18).keepPeriod:null,c.popkeepperiod=E.get(15)?E.get(15).keepPeriod:null,a&&a(c)}function e(b){a.Ajax.request({url:a.Uri.getUrl("optimizer_getdetail"),requestType:a.Ajax.SCRIPT,paddingFunc:function(a){b(a)}})}function f(b){return $S("sslSecondauth")?b($S("sslSecondauth")):(a.Ajax._xmlHttpRequest({url:G.getUrl("secondauth_api",!0),requestType:a.Ajax.XMLHTTP,method:a.Ajax.POST,body:{username:$S("orgUid")},head:[{name:"Accept",value:"application/json"}],call:function(a){if(a&&200===a.status)try{var c=JSON.parse(a.response);200===c.code&&"boolean"==typeof c.sms&&($S("sslSecondauth",c.sms),b(c.sms))}catch(d){throw d}}},!0),void 0)}function g(b){function d(){g[b.field]=f,b.callback&&b.callback(b),b.call&&b.call(b);var a=b.module;if(a&&!b.noFire?I.fire("options:"+a+"Modify",[b]):I.fire("options:modify",[b]),b.relModule&&b.relModule.length>0)for(var c=0,d=b.relModule.length;d>c;c++)I.fire("options:"+b.relModule[c]+"Modify",[b])}function e(){g[b.field]=j,b.err&&b.err(b),b.errcallback&&b.errcallback(b)}var f,g=$S("attrs").user,h=a.Object.clone(b),i=!1,j=g[h.field];if(h&&h.flag)if("translate"==h.flag){var f=j.substr(0,2)+h.value+j.substr(3);
g.ntes_labs=f,($S("is126")||$S("is163"))&&g.ntes_labs!==c&&(F.readTran=g.ntes_labs.charAt(2)-0>0,a.Ajax.request({url:"http://lab.mail."+$S("domain")+"/labweb/lab.do?m=submit&id=2&act="+(F.readTran?"enable":"disable")+"&uid="+$S("uid")+"&sid="+$S("sid")+"&host="+$S("host"),requestType:a.Ajax.SCRIPT,paddingParam:"jsonp",paddingFunc:function(){}}))}else f=H.set({field:h.field,flag:h.flag,value:h.value,notPost:!0});else f=h.value;if(f!=j&&(i=!0),i){var k={};k[h.field]=f,this.action.wmsvr({func:"user:setAttrs",body:{attrs:k},call:d,error:e})}}function h(a,b){function c(b){if(b&&(M.signList=b,!F.signFilter))for(var c=0;c<M.signList.length;c++)M.signList[c].content=M.signList[c].content.replace(/<iframe.+?<\/iframe>/i,"");a(b)}b||!M.signList?M.action.getSignList(c):a(M.signList)}function i(b,c){function d(a){return/^\S+\.\S+$/.test(a)||G.matchEmail(a)}function e(b){if(b.length>0){for(var c,e=b.split(","),f=[],g=e.length-1;g>=0;g--)c=a.String.trim(e[g]),d(c)&&f.push(c);return f}return[]}var f,g=b.name,h=b.value,i=$S("attrs").user[g]||"",j=[];f="refuselist"==g?$S("attrs").user.safelist:$S("attrs").user.refuselist;for(var k,l=e(i),m=e(f),n=e(h),o=!0,p=A.t("添加失败。"),q=0;q<n.length;q++)if(k=n[q],d(k)){if(a.Array.has(l,k))p+=k+A.t("已经存在。")+"<br/>";else if((i+k).length>4e3){var r="safelist"==g?A.t("白"):A.t("黑");p+=r+A.t("名单超过限制。")+"<br/>"}else if("refuselist"!=g||k!=$S("uid")){if(a.Array.has(m,k)){if(!b.forceAdd){var r="safelist"==g?A.t("黑"):A.t("白");return new a.Msgbox({title:a.String.escapeHTML(k)+A.t("已经存在于")+r+A.t("名单中，请先在")+r+A.t("名单中删除后再添加。")}),c&&c(!1),void 0}M.removeList({name:"refuselist"==g?"safelist":"refuselist",value:k})}l.push(k),j.push(k),o=!1}}else p+=k+A.t("不是合法的Email地址或域名。")+"<br/>";return o?(b.noErr||new a.Msgbox({title:p}),"function"==typeof c&&c(!1,p),void 0):(i=l.join(","),H.set({field:g,value:i,call:function(b){b.code==L.S_OK?($S("attrs").user[g]=i,"refuselist"==g&&a.Log.cache({refuseEmailAdr:h}),c(!0,j.join(","))):c(!1)}}),void 0)}function j(b,c){var d=b.name,e=b.value,f=$S("attrs").user[d],g=function(b,c){c=a.String.trim(c);for(var d=f.length>0?f.split(","):[],e=0,g=d.length;g>e;e++)if(a.String.trim(d[e])==c){d.splice(e,1);break}f=d.join(",")};f.length>0&&e.length>0&&a.Array.each(e.split(","),g),H.set({field:d,value:f,call:function(b){b.code==L.S_OK?($S("attrs").user[d]=f,"refuselist"==d&&a.Log.cache({removeRefuseEmailAdr:e}),c(!0)):c(!1)}})}function k(a){return D.getDefined(a)}function l(a,b){$E(["module.options.CommonAction"],function(c){c.setAttrs({attrs:{true_name:a,displaysender:0},call:function(){var c=$S("attrs").user;c.true_name=a,c.displaysender=0,b(!0)},error:function(){b(!1)}})})}function m(b,c){var d={},e=0===$S("attrs").user.displaysender;e?d.true_name=b:d.nick_name=b,this.action.wmsvr({func:"user:setAttrs",body:{attrs:d},call:function(){var d=$S("attrs").user;e?d.true_name=b:d.nick_name=b,a.Listener.fire("options:displayNameModify"),c()},error:function(){}})}function n(a,b){H.set({field:"ntes_defaultsender",value:a,call:function(c){c.code==L.S_OK?($S("attrs").user.ntes_defaultsender=a,b&&b(!0)):b&&b(!1)}})}function o(b){function c(c){if(c.overflow)return new a.Msgbox({type:"confirm",title:A.t("设置出错"),content:A.t("抱歉，来信分类规则条数达到上限，无法收取指定联系人邮件到此文件夹。")+"<br/>"+A.t("建议您进行整理，删除可能无用的规则。"),okText:A.t("立即整理"),ok:function(){$E(["interface.OptionInterface"],function(a){a.goFilter()})}}),void 0;var d=a.JS.modules["options.MailFilterModule"];c.code==L.S_OK&&d&&d.isLoaded&&d.getData(d.list.bind(d)),b.callback&&b.callback({code:c.code})}var d=this;d.action.addMailFilter({name:b.name,fid:b.fid,operand:b.email,accounts:b.accounts||[$S("uid")],limit:d.getFliterLimit()},c)}function p(){if($S("isCorp"))return 80;var a=$G.user.cosid||"",b="";switch($S("domain")){case"vip.163.com":b=",72,6,213,73,7,91,90,";break;case"188.com":b=",93,34,251,211,210,94,35,";break;case"vip.126.com":b=",26,25,104,28,27,30,29,"}return b.length>0&&b.indexOf(","+(a+","))>-1?60:30}function q(a){this.action.wmsvr({func:"user:getMailRules",body:{},call:a})}function r(b,c){var d=a.JS.modules["options.MailFilterModule"],e=function(d){var e,f=[];a.Array.each(d,function(c,d){switch(e=d.actions,b.type){case"forward":a.Array.each(e,function(b,c){if("forward"===c.type)throw f.push(d.id),a.$.BREAK})}}),c(f)};d&&d.data?e(d.data):this.action.getMailFilter(e)}function s(a){function b(a){return e.indexOf(a)}var c,d,e=$S("attrs").user.refuselist;return"string"==typeof a?(c=a,d=c.substring(c.indexOf("@"))):(c=a.address,d=a.domain),d="*"+d,0===b(c)||b(","+c)>=0||b(" "+c)>=0||b(d)>=0}function t(){var a=$S("attrs").user;return 1!=a.forwardactive&&2!=a.forwardactive?null:a.forwarddes}function u(a){function b(b){var d=b["var"],e=d[0]["var"]||[],f=d[1]["var"]||[],g=null,h=f.length;if(1==h)g=f[0];else if(h>1){for(var i=null,j=0,h=f.length;h>j;j+=1)i=f[j],i.disabled||(g=i);g=g?g:i}var k,l,m=0;if(1!=e.autorepmode&&g){var n=g.condictions[0]||{},o=g.actions[0]||{};m="boolean"!=typeof g.disabled?1:g.disabled?0:1;var p=o.content;if(1==m&&p&&(c.autoReplayCont=p),"undefined"!=typeof n&&"undefined"!=typeof n.operand){var q=n.operand;if(c.operator=n.operator,1==m)switch(n.operator){case"between":k=q[0],l=q[1];break;case">":k=q;break;case"<":l=q}}}else{m=e.autorepmode||0;var r=e.autoreptext;1==m&&r&&(c.autoReplayCont=r)}0===m?c.autoReplyActive=!1:(c.autoReplyActive=!0,c.start=k,c.end=l),a&&"function"==typeof a.call&&a.call(c)}var c={};M.action.getAutoReply(b)}function v(){var b=$S("attrs").user,c=!1;null===b.junkfilter&&(b.junkfilter=0);var d=b.keepspamdays;d=d>=-1?d:-1;var e=b.junkfilter;if(e=e>-1?e:1,d>0&&0===e&&(c=!0),!c&&F.deliver){var f=H.get({field:"ntes_option",flag:"deliver"})-0;(0!==a.Number.getBit(f,0)||0!==a.Number.getBit(f,1)||0!==a.Number.getBit(f,2))&&(c=!0)}return c}function w(c){function d(){var c;do c="padding"+a.Number.random((new Date).getTime());while(b[c]);return c}var e,f,g,h,i=!1,j=$I("init.Avatar");c&&(e=c.uploader,f=c.cancel,H.getProxy({field:["product.vipMember"],call:function(a){i=a["product.vipMember"]}}),h=d(),b[h]=function(b){a("#dvAvatarFalsh").hide(),a.Msgbox.msgbox.hide(),"ok"==b?(delete a.Ud.udProxy["mail.avt"],a.Listener.fire("user:avatarChanged"),e&&e()):"cancel"==b&&f&&f()},j.get($S("orgUid"),180,function(b){if(a.Browser.isIE()){var c="http://config."+$S("fullDomain")+"/settings/face/uploadSelfOne.do";g='<div id="dvAvatarFalsh" style="padding: 20px 0 0 20px;"><embed class="" src="/js6/h/AvatarUploader.swf" flashvars="baseurl='+c+"&amp;callback="+h+"&amp;sid="+$S("sid")+"&amp;imgurl="+encodeURIComponent(b)+'" '+'quality="high" wmode="transparent" allowscriptaccess="always" type="application/x-shockwave-flash" height="420x" width="710px">'+"</embed></div>"}else{if(i)var c=a.Uri.getUrl("avatar_upload")+"&callback="+h+"&domain="+$S("domain")+"&identify=plus";else var c=a.Uri.getUrl("avatar_upload")+"&callback="+h+"&domain="+$S("domain");g='<div id="dvAvatarFalsh" style="padding-left:20px"><iframe allow="camera;microphone;" src="'+c+'" frameborder="0" scrolling="no" height="426x" width="710px">'+"</div>"}a.Msgbox.show({header:A.t("修改头像"),contentType:"custom",content:g,height:"452px",width:"730px",noFooter:!0,close:function(){f&&f(),a("#dvAvatarFalsh").hide()}})}))}function x(c){function d(a){e(!!a["exten.publicMail"])}function e(a){a?f({},a):n.getPhoneStatue(function(b){f(b,a)})}function f(c,d){function e(c){m.randomId=(new Date).getTime();var e=(d?"":'<div class="nui-msgbox-title"><strong>'+A.t("为了避免自动转发可能造成的重要信息泄露，需进行手机短信验证")+"</strong></div>")+'<div class="nui-simpleForm nui-form rX1">'+"<table>"+"<tbody>"+"<tr>"+'<th class="nui-form-title">'+A.t("转发到邮箱")+"</th>"+'<td class="nui-form-cont">'+a.Input.html({id:"oCompForwardAddress_"+m.randomId,width:"240px",value:o})+'<div class="nui-item">'+a.Checkbox.html({id:"oCompKeepLocal_"+m.randomId,text:A.t("保留原邮件"),checked:p})+"</div>"+(l||$S("isFree")?"":'<div class="nui-txt-tips nui-item">'+A.t("提示：最多可设置两个转发地址，用英文逗号(,)隔开即可。")+"</div>")+"</td>"+"</tr>"+(d?"":'<tr><th class="nui-form-title">'+A.t("验证码")+"</th>"+'<td class="nui-form-cont">'+a.Input.html({id:"oCompVerifyCode_"+m.randomId,width:"110px"})+a.Button.html({extcls:"nui-inputBtn",text:A.t("免费获取短信验证码"),click:function(){var d=a.Component.find("#oCompVerifyCode_"+m.randomId),e=this,f=60;d.hideTips(),n.sendPhoneVerifyCode(c,function(a){d.hideTips(),200==a.code?d.hideTips():400==a.code?d.showTips(A.t("验证短信发送失败")):407==a.code?d.showTips(A.t("请求次数过多")):408==a.code&&d.showTips(A.t("请求次数过于频繁"))}),e.setDisabled(!0),m.codeTimer=b.setInterval(function(){return f--,0>=f?(e.setDisabled(!1),e.setText(A.t("免费获取短信验证码")),m.codeTimer&&b.clearInterval(m.codeTimer),void 0):(e.setText(f+A.t("秒后可重新获取...")),void 0)},1e3)}})+'<div class="nui-item">'+A.t("接收验证码的手机号：")+(3===c.length?"********"+c:c.slice(0,3)+"*****"+c.slice(8,11))+a.Link.html({text:A.t("修改手机号"),click:function(){if(h(),$S("isVip")){var b="vipsms",c=A.t("手机服务");$E("interface.OutlinkInterface",function(a){a.goOutlink({key:b,title:c})}),a.Msgbox.msgbox.hide()}else $S("isFree")&&($E("interface.OptionInterface",function(a){a.goOutlink("urs_update_phone")}),a.Msgbox.msgbox.hide())}})+"</div>"+"</td>"+"</tr>")+"</tbody>"+"</table>"+"</div>";a.Msgbox.show({header:A.t("自动转发设置"),icon:{type:"info",extcls:"nui-ico-info-l"},width:"550px",content:e,type:"confirm",ok:function(){var e=a.Component,f="",h=!1,k="";try{var l=e.find("#oCompForwardAddress_"+m.randomId),o=e.find("#oCompKeepLocal_"+m.randomId);if(f=l.getValue(),h=o.getChecked(),!g(f,l))return!0;if(i&&!m.preSubmited&&(m.preSubmited=!0,i({forwardAddress:f,keepLocal:h})),d)j&&j({forwardAddress:f,keepLocal:h}),m.codeTimer&&b.clearInterval(m.codeTimer),delete m.preSubmited,a.Msgbox.msgbox.hide();else{var p=e.find("#oCompVerifyCode_"+m.randomId);if(k=p.getValue(),""==k)return p.showTips(A.t("请输入验证码")),!0;n.verifyCode(c,k,function(d){200==d.code?(j&&j({msas_sig:d.data.msas_sig,msas_ts:d.data.msas_ts,ms_mobile:c,forwardAddress:f,keepLocal:h}),m.codeTimer&&b.clearInterval(m.codeTimer),delete m.preSubmited,a.Msgbox.msgbox.hide()):201==d.code?p.showTips(A.t("验证码错误")):407==d.code?p.showTips(A.t("验证错误次数过多")):p.showTips(A.t("鉴权失败"))})}return!0}catch(q){}},listeners:{render:function(){a.Component.setEvents()},close:h,cancel:h}})}if(d)return e(),void 0;var f,q;return 200!=c.code?(a.Msgbox.show({content:A.t("网络繁忙，请稍后再试")}),void 0):(f=c.data.mobile,q=c.data.count,f&&-1!==f.indexOf("@")&&(f=f.split("@")[0]||""),f?e(f):a.Msgbox.show({header:A.t("自动转发设置"),title:A.t("为了避免自动转发可能造成的重要信息泄露，请先关联手机号码，并进行短信验证。"),type:"confirm",okText:A.t("立即进行手机验证"),ok:function(){if($S("isFree"))$E("interface.OptionInterface",function(a){a.goOutlink("urs_setting_phone")});else if($S("isVip")){var a="vipsms",b=A.t("手机服务");$E("interface.OutlinkInterface",function(c){c.goOutlink({key:a,title:b})})}k&&k()},cancel:function(){k&&k()}}),void 0)}function g(b,c){for(var d=G.getEmails(b),e=d.match,f=e.length,g=[],h=0;f>h;h++)g.push(e[h].address);return""==b?(c.showTips(A.t("请输入转发的邮箱地址")),!1):0!=d.wrong.length?(c.showTips(A.t("请输入正确的邮箱地址")),!1):a.Array.has(g,$S("uid"))||a.Array.has(g,$S("orgUid"))?(c.showTips(A.t("不能输入自己的邮箱地址")),!1):f>1&&($S("isFree")||l)?(c.showTips(A.t("您只能填写一个自动转发地址。")),!1):f>2?(c.showTips(A.t("您只能填写一到两个自动转发地址。")),!1):a.String.len(b)>248?(c.showTips(A.t("转发地址长度超过250个英文字符的限制。")),!1):!0}function h(){m.codeTimer&&b.clearInterval(m.codeTimer),k&&k()}var i,j,k,l,m=this,n=m.action,o="",p=$S("isCorp")?!0:!1;c&&(o=c.forwardAddress,p=c.keepLocal,i=c.preSubmit,j=c.submit,k=c.cancel,l=c.mailRule),$S("isFree")?a.Ud.getProxy({field:["exten.publicMail"],call:d}):e()}function y(b,c){a.Ajax.request({url:a.Uri.getUrl("settingwithdraw_set")+"&withdrawconfig="+(b?"on":"off"),requestType:"script",paddingFunc:function(b){"200"==b.code?(a.Listener.fire("options:readModify",[{field:"recall",value:b.data.enable}]),F.letterRecall=b.data.enable):a.Tips.show({text:A.t("设置失败"),succ:!1}),c(b)}})}function z(c){function d(){g.bindCodeTimer&&b.clearInterval(g.bindCodeTimer)}var e,f=M.action,g=this;g.randomId=(new Date).getTime();var h=("lotteryPopup"==c?'<p style="font-size:16px;margin-bottom:10px;font-weight:bold">'+A.t("红包数量有限，每个用户限领一次，请输入手机号码验证")+"</p>":"")+'<div class="nui-simpleForm nui-form Av0"><table><tbody>'+'<tr><th class="nui-form-title">'+A.t("您的手机号码")+"</th>"+'<td class="nui-form-cont">'+a.Input.html({id:g.randomId+"oCompBindPhone",width:"140px"})+a.Button.html({extcls:"nui-inputBtn",text:A.t("免费获取短信验证码"),width:"100px",click:function(){var d=this,h=60,i=a.Component.find("#"+g.randomId+"oCompBindPhone");if(i){if(e=i.getValue(),""==e)return i.showTips(A.t("请填写手机号码")),!1;if(!K.checkMobile(e))return i.showTips(A.t("手机号码无效")),!1;f.sendMobileCode(e,function(a){0==a.code?(d.setDisabled(!0),g.bindCodeTimer=b.setInterval(function(){return h--,0>=h?(d.setDisabled(!1),d.setText(A.t("免费获取短信验证码")),g.bindCodeTimer&&b.clearInterval(g.bindCodeTimer),void 0):(d.setText(h+A.t("秒后可重新获取...")),void 0)},1e3)):"-1"==a.code?i.showTips(A.t("手机号码无效")):"-2"==a.code&&("times over"==a.desc?i.showTips(A.t("已达到次数上限")):i.showTips(A.t("验证码过于频繁")))},c)}"lotteryPopup"==c?a.Log.cache({lotterySendBindMobileCode:"1"}):a.Log.cache({sendBindMobileCode:"1"})}})+"</td></tr>"+'<tr><th class="nui-form-title">'+A.t("验证码")+"</th>"+'<td class="nui-form-cont">'+a.Input.html({id:g.randomId+"oCompBindVerifyCode",width:"271px"})+"</td></tr></tbody></table></div>";a.Msgbox.show({header:A.t("验证手机号码"),width:"550px",content:h,type:"confirm",contentType:"custom",extcls:"Av0 "+("lotteryPopup"==c?"Ax0":""),ok:function(){var d=a.Component.find("#"+g.randomId+"oCompBindPhone"),e=a.Component.find("#"+g.randomId+"oCompBindVerifyCode");try{var h=d.getValue(),i=e.getValue();if(""==h)return d.showTips(A.t("请填写手机号码")),!0;if(!K.checkMobile(h))return d.showTips(A.t("手机号码无效")),!0;if(""==i)return e.showTips(A.t("请输入您手机短信中的验证码")),!0;f.verifyMobileCode(h,i,function(f){"1"==f.code?"lotteryPopup"==c?a.Msgbox.show({header:A.t("验证成功"),icon:"suc",title:A.t("恭喜，你已获得118元彩票红包资格，")+a.Link.html({text:A.t("请马上领取"),href:"http://caipiao.163.com/activity/crazy118.html?from=tanchuang",target:"_blank"}),ok:function(){b.open("http://caipiao.163.com/activity/crazy118.html?from=tanchuang")}}):a.Msgbox.show({header:A.t("验证手机号码"),icon:"suc",title:A.t("还差一步"),okText:A.t("下一步"),type:"confirm",ok:function(){b.open("https://reg.163.com/mibao/mob/bindIndex.do?noheader=0&url=")},content:A.t("请进入在新打开的页面中按提示操作，完成手机号码验证。")}):"3"==f.code?d.showTips(A.t("手机号码邮箱已被绑定")):"-1"==f.code?e.showTips(A.t("验证码错误")):"-6"==f.code&&e.showTips(A.t("验证码错误次数过多"))},c)}catch(j){}return"lotteryPopup"==c?a.Log.cache({lotteryVerifyBindMobileCode:"1"}):a.Log.cache({verifyBindMobileCode:"1"}),!0},listeners:{render:function(){a.Component.setEvents()},close:d,cancel:d}})}var A=new $I18N("support.OptionSupport");try{var B=$L("support.OptionSupportAction")}catch(C){return C}var D=$I("init.SenderList"),E=$I("init.Folder"),F=a.Ext,G=a.Uri,H=a.Ud,I=a.Listener,J=a.Number,K=$I("util.Email"),L=$I("core.DataAction"),M=a.createClass($N("support.OptionSupport"));a.Object.extend(M,{action:new B,setAttr:g,getSignList:h,addList:i,removeList:j,getDefinedSenders:k,setName:l,setDisplayName:m,setDefSender:n,addMailFilter:o,getFliterLimit:p,getFliterData:q,searchFilter:r,isRefuse:s,getForwardAddr:t,getAutoReply:u,isLowAntiSpamLevel:v,avatarUploader:w,forwardVerify:x,setWithDraw:y,bindMobile:z,getHealth:e,getSecondauth:f,getAntiSpamData:d})}($,window),function(a){function b(a){var b=a.param,c={ids:b.ids},d={func:"user:syncPOPAccount",body:c,call:function(b){a.callback(b)},error:a.error,wmsvrlog:{action:"syncPOPAccounts"}};this.wmsvr(d)}function c(a){var b=a.param,c={ids:b.ids,stats:!0},d={func:"user:getPOPAccounts",body:c,call:function(b){a.callback(b)},error:a.error,wmsvrlog:{action:"getPOPAccounts"}};this.wmsvr(d)}function d(a){var b=a.param,c={items:[b]},d={func:"user:updatePOPAccounts",body:c,call:function(b){a.callback(b)}};this.wmsvr(d)}try{var e=$L("core.DataAction")}catch(f){return f}var g=e,h=a.createClass($N("support.MailCenterAction"));a.Object.mix(h,g,{},{sync:b,getStatus:c,update:d})}($,window),function(a,b){function c(b){var c,d,e=$S("attrs").popAccounts;b.type?(c=b.type,d=b.value):b.id?(c="id",d=b.id):b.fid?(c="fid",d=b.fid):b.username&&(c="username",d=b.username);var f=null;return a.Array.each(e,function(b,e){return e[c]&&e[c]==d?(f=e,a.BREAK):void 0}),f}function d(){return $S("attrs").popAccounts}function e(){return C.getPop3()}function f(b){var c=this,d=c.get(b),e=d.id;if(e&&!a.Array.has(c.syncIds,e)){c.syncIds.push(e);var f={param:{ids:[e]},callback:function(){c.syncStart()},error:function(){c.syncError()}};c.action.sync(f),A.setReceiveIcon(d.fid,"receiving")}}function g(b){var c=this,d=$S("attrs").popAccounts,e=[];if(a.Array.each(d,function(d,f){return a.Array.has(c.syncIds,f.id)?a.CONTINUE:b&&b.auto&&!f.autoSync?a.CONTINUE:"none"==f.type?a.CONTINUE:(e.push(f.id),void 0)}),0!==e.length){c.syncIds=c.syncIds.concat(e);var f={param:{ids:e},callback:function(){c.syncStart()},error:function(){return c.syncError()}};c.action.sync(f),A.setReceiveIcon(null,"receiving")}}function h(){var b=this;if(0!==b.syncIds.length){b.show("begin");var c={param:{ids:b.syncIds},callback:a.Function.bind(b.syncEnd,b),error:function(){return b.syncError()}};b.action.getStatus(c)}}function i(c){var d=this,e=c["var"],f=0,g=0,h=0,i=0,j=[];a.Array.each(e,function(b,c){var e=c.stats;return(!e||e.endTime&&"PENDING"!=e.code)&&(a.Array.remove(d.syncIds,c.id),d.sessionUpdate(c),A.setReceiveIcon(c.fid,"receive"),e&&e.receivedMessageCount>0&&x.request(),"FA_BAD_PASSWORD"==e.code&&j.push([c.username,c.id])),e?(e.messageCount>=0&&(f+=e.messageCount,g+=e.receivedMessageCount,h+=e.skippedMessageCount),e.spamMessageCount&&(i+=e.spamMessageCount),void 0):a.CONTINUE}),d.show("run",{all:f,received:g,skip:h,spam:i}),d.syncIds.length>0?b.setTimeout(a.Function.bind(d.syncStart,d),3e3):(d.show("end",{received:g,skip:h,error:j}),A.setReceiveIcon(null,"receive"))}function j(){var b=this;return b.syncIds.length>0&&(a.Array.each(b.syncIds,function(a,b){var c=E.get({id:b});c&&A.setReceiveIcon(c.fid,"receive")}),b.syncIds=[]),A.setReceiveIcon(null,"receive"),!0}function k(b,c){var d;switch(b){case"begin":d=y.t("邮件收取中.."),a.Tips.loading(d);break;case"run":d=y.t("正在收取"),d+=c.all>0?c.received+c.skip+"/"+c.all+y.t(" 封邮件..."):y.t("邮件..."),a.Tips.show(d);break;case"end":a.Tips.loading(),d=y.t("收取完成！共收到")+c.received+y.t("封邮件"),c.skip&&(d+=y.t("，")+c.skip+y.t("封邮件不在收取范围内，已跳过&nbsp;"),d+=B?"":'<a href="'+D.getUrl("pop3_skip_info",!0)+'"  target="_blank">'+y.t("查看详情&gt;&gt;")+"</a>");var e=5e3,f=[];if(c.error&&c.error.length>0){var g=c.error.length;e=12e3,d+=y.t("，部分帐号收取失败，");for(var h,i='<div class="nui-simpleTable nui-table nui-scroll">',j=0;g>j;j++)i+='<table><tbody class="nui-table-body"><tr class="nui-table-row"><td class="nui-table-cell">'+y.t("邮箱：")+"<strong>"+c.error[j][0]+"</strong>&nbsp;&nbsp;&nbsp;&nbsp;"+("options.AccountCenterModule"==a.Context.module.mtype?"":new a.Link({text:y.t("编辑"),cls:"nui-txt-link",click:a.Function.bind(function(){h&&h.hide(),a.JS.go({module:"options.AccountCenterModule"})},null,c.error[j][1])}).html())+"</td>"+"</tr>"+"</tbody>"+"</table>"+'<div class="nui-table-footerTips nui-normalTips nui-tips nui-normalTips-err">'+y.t("对方服务器拒绝、或用户名密码不正确，收取失败")+"</div>",i+=j==g-1?"":'<div class="nui-split nui-split-cDark nui-split-dotted"></div>';i+="</div>",f=[{xtype:"link",text:y.t("查看详情"),click:function(){a.Tips.show({}),h?h.show():h=a.Msgbox.show({extcls:"sW0",header:y.t("查看详情"),contentType:"wide",content:i,listeners:[{name:"render",handler:function(){a.Component.setEvents()}}]})}}]}a.Tips.show({succ:!0,text:d,items:f,expires:e})}}function l(b,c,d){function e(b){var e=b.code;e==a.DataAction.S_OK&&a.Object.each(c,function(a,b){g[a]=b}),d&&d(b)}var f=this,g=f.get(b);if(g){var h={id:g.id};a.Object.each(c,function(a,b){h[a]=b});var i={param:h,callback:e};f.action.update(i)}}function m(b,c){function d(a){a&&a.length>0?g(a):g(null)}var e=this,f=b,g=c;if(f&&"function"==typeof g){var h=e.POP3_SERVER[f],i=[],j={};if(h)j.pop=h,j.port=a.Array.has(e.SSL_SERVER,h)?995:110,i.push(j),g(i);else{var k=D.getUrl("pop3_server",!0)+"?email=abc@"+f;a.Ajax.jsonp(k,d)}}}function n(b){var c=$S("attrs").popAccounts;return a.Array.has(c,function(a){return a.username.toLowerCase()==b&&"none"==a.type?!0:void 0})}function o(b){var c,d=$S("attrs").popAccounts;return a.Array.each(d,function(a,d){d.username.toLowerCase()==b&&(c=d.id)}),c}function p(b){var c=this,d=$S("attrs").popAccounts,e=!1;e=a.Array.has(d,function(a){return a.id==b.id}),e?c.sessionUpdate(b):(d.push(b),this.dataChange=!0)}function q(b,c){var d=$S("attrs").popAccounts,e=!1;return a.Array.each(d,function(d,f){return f.id==b.id?(c?f=b:a.Object.each(b,function(a,b){f[a]=b}),e=!0,a.BREAK):void 0}),this.dataChange=!0,e}function r(b){var c=$S("attrs").popAccounts,d=null,e=-1;return a.Array.each(c,function(c,f){return f.id==b.id?(e=c,d=b,a.BREAK):void 0}),e>=0&&c.splice(e,1),this.dataChange=!0,d}function s(b){var c=$S("attrs").popAccounts;return a.Array.has(c,function(a){return a.username.toLowerCase()==b?!0:void 0})}try{var t=$L("support.MailCenterAction")}catch(u){return u}try{var v=$L("init.Nav")}catch(u){return u}try{var w=$L("init.SenderList")}catch(u){return u}try{var x=$L("init.Sync")}catch(u){return u}var y=new $I18N("support.MailCenter"),z=t,A=v,B=$S("isCorp"),C=w,D=a.Uri,E=a.createClass($N("support.MailCenter"));a.Object.extend(E,{action:new z,POP3_SERVER:{"163.com":"pop.163.com","126.com":"pop.126.com","188.com":"pop.188.com","netease.com":"pop.netease.com","yeah.net":"pop.yeah.net","vip.163.com":"pop.vip.163.com","vip.126.com":"pop.vip.126.com","sina.com":"pop3.sina.com","sina.cn":"pop3.sina.cn","vip.sina.com":"pop3.vip.sina.com","sohu.com":"pop3.sohu.com","vip.sohu.com":"pop3.vip.sohu.com","china.com":"pop.china.com","21cn.com":"pop.21cn.com","21cn.net":"pop.21cn.net","tom.com":"pop.tom.com","163.net":"pop.163.net","263.net":"263.net","domain.com":"pop.yourdomain.com","eyou.com":"pop3.eyou.com","qq.com":"pop.qq.com","vip.qq.com":"pop.qq.com","foxmail.com":"pop.foxmail.com","gmail.com":"pop.gmail.com","yahoo.com":"pop.mail.yahoo.com.cn","msn.com":"pop3.live.com","msn.cn":"pop3.live.com","live.cn":"pop3.live.com","live.com":"pop3.live.com","hotmail.com":"pop3.live.com","qiye.163.com":"pop.qiye.163.com"},SSL_SERVER:["pop.gmail.com","pop3.live.com","pop.mail.yahoo.com.cn"],syncIds:[],get:c,getAll:d,getSender:e,receive:f,receiveAll:g,syncStart:h,syncEnd:i,syncError:j,show:k,update:l,searchPop3:m,isNone:n,getId:o,sessionAdd:p,sessionUpdate:q,sessionDel:r,sessionHas:s})}($,window),function(a,b,c){function d(b){function d(){var a=new m,b={func:"mbox:emptyFolder",body:{id:h,permanently:l},call:f,error:e};a.wmsvr(b)}function e(a){var b=a.code;return s.has(b,"FS_")?p.t("清空文件夹出错"):void 0}function f(){a.Tips.show({succ:!0,text:p.t("成功清空文件夹")}),a.Listener.one("sync:request",function(){t.fire("folder:empty",h)}),o.request(c,{listen:!0})}var g,h=b.fid,i=k.get(h),j=i.name,l=!1,q=p.t("确定删除“")+j+p.t("”的所有邮件到已删除文件夹吗?");if(r.has($G.common.nolistids,h)){var u="";if($S("isVip")&&!($S("cos").pref_mail_preserving_days>0)){var v=p.t("文件恢复"),w=new a.Link({text:v,click:function(){n.goOutLink("recovery",v),g.close()}});u=p.t("&nbsp;[开启")+w.html()+p.t("，邮件双重备份]")}l=!0,q=p.t("您确定要彻底删除“")+j+p.t("”中的所有邮件吗？")+u}g=a.Msgbox.show({type:"confirm",content:q,title:p.t("文件夹清空"),ok:d}),a.Component.setEvents()}function e(b){function c(a){var b=a.code,c=null;switch(b){case"FA_HAS_CHILD":c=p.t("有子文件夹，无法删除此文件夹");break;case"FA_HAS_MAIL":c=p.t("文件夹中还有邮件，请先清空");break;case"FA_FORBIDDEN":c=p.t("不允许删除此文件夹")}return c}function d(){for(var b=$S("attrs").folders,c=0,d=b.length;d>c;c++)if(f.id===b[c].id){b.splice(c,1);break}k.init(!0),t.fire("folder:remove",e),a.Tips.show({succ:!0,text:p.t("成功删除文件夹")})}var e=b.fid,f=k.get(e);f.name;var g,h="";if(f.flags.pop?(h=p.t("要删除该文件夹，请先到邮箱设置的邮箱中心里删除该邮箱帐号。"),g=function(){try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"AccountCenterModule"})}):k.getInfo(e)>0&&(h=p.t("请先将文件夹中所有的邮件全部删除后再操作。")),h)return a.Msgbox.show({type:"confirm",content:h,title:p.t("删除文件夹"),ok:g}),void 0;var i=new m,j={func:"mbox:deleteFolders",body:{ids:[e]},call:d,error:c};i.wmsvr(j)}function f(b){function c(b){function c(a){var b=a.code,c=null;switch(b){case"FA_ID_NOT_FOUND":c=p.t("找不到指定文件夹");break;case"FA_PARENT_NOT_FOUND":c=p.t("找不到指定文件夹的父文件夹");break;case"FA_INVALID_PARENT":c=p.t("错误的父文件夹");break;case"FA_NAME_EXISTS":c=p.t("文件夹重名");break;case"FA_NAME_INVALID":c=p.t("非法的文件夹名称");break;case"FA_FORBIDDEN":c=p.t("不允许修改此文件夹");break;case"FA_NAME_RESERVED":c=p.t("文件夹名和系统保留名重复")}return c}function d(){g.name=f,k.init(!0),t.fire("folder:modify",e,f),a.Tips.show({succ:!0,text:p.t("成功修改文件夹")})}f=b;var h=new m,i={func:"mbox:updateFolders",body:{items:[{id:e,name:f}]},call:d,error:c};h.wmsvr(i)}var d=this,e=b.fid,f=b.newFolderName,g=k.get(e),h=g.name;f?c(f):d.showMsg({defaultValue:h,fid:e,callback:c})}function g(c){function d(a,b){b?e(a):f(a)}function e(c){function d(b){var c=s.trim(i.value);return c.length>0?(f(b,c),void 0):(a.fly("#addrErrTr").show(),!0)}var e,g='<div class="nui-simpleForm nui-form rQ0"><table><tbody><tr><th class="nui-form-title">'+p.t("输入联系人名称：")+"</th>"+'<td class="nui-form-cont"><div class="nui-ipt"><input class="nui-ipt-input" type="text"/></div></td>'+"</tr>"+'<tr id="addrErrTr" style="display:none;">'+'<th class="nui-form-title"></th>'+'<td class="nui-form-cont">'+p.t("请输入正确的联系人")+"</div></td>"+"</tr>"+"<tr>"+'<th class="nui-form-title"></th>'+'<td class="nui-form-cont" id="addrSelTd"></td>'+"</tr>"+"</tbody>"+"</table>"+"</div>";e=a.Msgbox.show({type:"confirm",header:p.t("设置来信分类"),content:g,contentType:"normal",noIcon:!0,ok:a.Function.bind(d,b,c)});var h=e.getEl().find("input"),i=h.dom;try{var j=$L("support.AddressSupport",this)}catch(k){return k}j.contactSelector({call:function(a){i.value=a.email||a.name},renderTo:a("#addrSelTd")})}function f(b,c){function d(a){var b=a.code,c=null;switch(b){case"FA_OVERFLOW":c=p.t("超过最大文件夹个数限制");break;case"FA_PARENT_NOT_FOUND":c=p.t("找不到指定文件夹的父文件夹");break;case"FA_NAME_EXISTS":c=p.t("文件夹重名");break;case"FA_NAME_INVALID":c=p.t("非法的文件夹名称");break;case"FA_NAME_RESERVED":c=p.t("文件夹名和系统保留名重复")}return c}function e(d){var e=d["var"][0];if($S("attrs").folders.push({id:e,name:b,stats:{messageCount:0,messageSize:0,unreadMessageCount:0,unreadMessageSize:0,threadCount:0,unreadThreadCount:0}}),k.init(!0),t.fire("folder:add",e,b,c),i&&i(e),a.Tips.show({succ:!0,text:p.t("成功添加文件夹")}),c){try{var f=$L("support.OptionSupport",this)}catch(g){return g}f.addMailFilter({name:c,fid:e,email:c})}}var f=new m,g={func:"mbox:createUserFolders",body:{items:[{name:b}]},call:e,error:d};f.wmsvr(g)}var g=this;c||(c={});var h=c.folderName,i=c.callback;h?d(h):g.showMsg({callback:d})}function h(a){function b(){for(var a={},b=0,c=d.length;c>b;b++){var f=d[b],g=f.id,h=f.keepPeriod,i=k.get(g);i&&(i.flags||(i.flags={}),i.keepPeriod=h,a[g]=h)}t.fire("folder:keep",a),e&&e()}function c(){f&&f()}var d=a.list,e=a.callback,f=a.error,g=new m;g.wmsvr({func:"mbox:updateFolders",body:{items:d},call:b,error:c})}function i(a,b){if(!a||""===a)return p.t("请输入文件夹名称");if(s.len(a)>($S("isCorp")?40:20))return p.t("长度不能大于"+($S("isCorp")?20:10)+"个汉字(或"+($S("isCorp")?40:20)+"个字符)");if(s.check(a)||s.check(a,/[\&\.\*]/))return p.t("请不要输入 ＂, % ' \" \\ / ；| &.*＂ 等特殊字符");var c=!1,d=k.getByName(a);return d&&d.id!==b&&(c=!0),c?p.t("同名文件夹已存在"):void 0}function j(b){function c(a){a=s.trim(a).replace(/\s+/gi," ");var b=e.checkName(a,g);return b?b:(h(a,i),void 0)}function d(){var a=m.find("button")[0];i=l.getChecked();var b;b=i?p.t("下一步"):p.t("确 定"),a.update({text:b})}var e=this,f=b.defaultValue,g=b.fid,h=b.callback,i=!1,j=g?p.t("修改文件夹"):p.t("新建文件夹"),k={type:"prompt",inputLabel:p.t("输入文件夹名称"),inputValue:f,header:j,ok:c};if(!g){var l=new a.Checkbox({text:p.t("收取指定联系人邮件到该文件夹"),checkedchange:d});k.footer=l}var m=a.Msgbox.show(k)}try{var k=$L("init.Folder")}catch(l){return l}try{var m=$L("core.DataAction")}catch(l){return l}try{var n=$L("init.CustomAppManager")}catch(l){return l}try{var o=$L("init.Sync")}catch(l){return l}var p=new $I18N("support.Folder"),q=a.Object,r=a.Array,s=a.String,t=a.Listener,u=a.createClass($N("support.Folder"));q.extend(u,{empty:d,remove:e,rename:f,add:g,keep:h,checkName:i,showMsg:j})}($,window),function(a,b,c){function d(b){function c(a){var c=e&&p.has(e,a);b.callback(c,a)}var d,e=b.tag,f={reverse:!0,groups:[]},g=s.list(),h=f.groups;o.count(g)>0&&(d=[],o.each(g,function(a,b){var f=e&&p.has(e,b.name),g=b.name,h=b.alias,i=b.color,j=d.length;d.push({text:h,icon:{xtype:"icon",type:"tag",subtype:i,group:"tagitem"},checked:f,click:function(){c(g,j)}})}),h.push({items:d,type:"scroll",checkType:"checkbox"})),o.count(e)>0&&(d=[],d.push({text:n.t("取消所有标签"),click:function(){b.remove()}}),h.push({items:d}));var i=a.Context.getModule();return d=[],d.push({text:n.t("新建标签并标记"),click:function(){i.log("tag","new"),v.add({callback:function(a){b.callback(!1,a)}})}}),d.push({text:n.t("管理标签"),click:function(){i.log("tag","manage");try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"FolderTagModule"})}}),h.push({items:d}),f}function e(b){function d(b){function d(){}function e(){$S("attrs").tags.push([g,{color:i,alias:h}]),s.init(!0),u.fire("tag:add",g),f&&f(g),a.Tips.show({succ:!0,text:n.t("成功添加标签")})}var g=b.name,h=b.alias,i=b.color,j=new t,k={func:"mbox:manageTags",body:{add:[[g,{color:i,alias:g===h?c:h}]]},call:e,error:d};j.wmsvr(k)}var e=this;b||(b={});var f=b.callback;e.showMsg({callback:d})}function f(b){function d(b){function d(){}function e(){for(var b=$S("attrs").tags,c=!1,d=0,e=b.length;e>d;d++){var k=b[d];if(g===k[0]){k[1].color=j,c=(k[1].alias||g)!==i,k[1].alias=i;break}}s.init(!0),u.fire("tag:modify",g,c),f&&f(h),a.Tips.show({succ:!0,text:n.t("成功编辑标签")})}var g=b.name,i=b.alias,j=b.color,l=new m,o={func:"mbox:manageTags",body:{replace:[[g,{color:j,alias:i===g?c:i,show:k.show}]]},call:e,error:d};l.wmsvr(o)}var e=this;b.tag;var f=b.callback,g=b.onlyName,h=b.name,i=b.alias,j=b.color,k=s.get(h);h&&i&&j>-1?d({name:h,color:j,alias:i}):e.showMsg({data:k,onlyName:g,callback:d})}function g(b){function c(){function b(){}function c(b){for(var c=$S("attrs").tags,f=0,g=c.length;g>f;f++)if(d===c[f][0]){c.splice(f,1);break}s.init(!0),u.fire("tag:remove",d),e&&e(b),a.Tips.show({succ:!0,text:n.t("成功删除标签")})}var f=new m,g={func:"mbox:manageTags",body:{"delete":[d]},call:c,error:b};f.wmsvr(g)}var d=b.name,e=b.callback,f=s.get(d),g=f.alias,h=[],i=s.getInfo(d);h[h.length]='<h4 class="g-dialogBox-title txt-impt">'+n.t("确定删除“")+g+n.t("”这个标签？")+"</h4>",i>0&&(h[h.length]='<p class="txt-12 txt-info">'+n.t("该标签将从 ")+i+n.t(" 封邮件中删除，但是不会删除邮件")+"</p>"),a.Msgbox.show({type:"confirm",content:h.join(""),title:n.t("删除标签"),ok:c})}function h(a,b){function d(){}function e(){for(var c=$S("attrs").tags,d=0,e=0,g=c.length,i=a.length;g>d&&i>e;d++){var j=c[d],k=j[0];p.has(a,k)&&(j[1].show=b,h[k].show=b,e++)}f()}function f(){u.fire("tag:setshow",a,b)}for(var g=[],h={},i=0,j=a.length;j>i;i++){var k=a[i],l=s.get(k);if(l.show!==b){var n=l.alias;n===l.name&&(n=c),g.push([k,{show:b,color:l.color,alias:n}]),h[k]=l}else a.splice(i,1),i--,j--}if(g.length>0){var o=new m,q={func:"mbox:manageTags",body:{replace:g},call:e,error:d};o.wmsvr(q)}else f()}function i(b,c){if(!b||""===b)return n.t("请输入标签名称");if(r.len(b)>20)return n.t("长度不能大于10个汉字(或20个字符)");if(r.check(b)||r.check(b,/[\&\.\*]/))return n.t("请不要输入 ＂, % ' \" \\ / ；| &.*＂ 等特殊字符");var d=!1,e=s.list();return o.each(e,function(e,f){return f.alias===b?(d=c!==f.name,a.BREAK):void 0}),d?n.t("同名标签已存在"):void 0}function j(b){function c(a){a=r.trim(a).replace(/\s+/gi," ");var b=i.checkAlias(a,f);return b?b:(k({name:e(f,a),alias:a,color:h}),void 0)}function d(){var a=s.list(),b={},c=0,d=!1;if(o.each(a,function(a,c){var e=c.color;b[e]||(b[e]=0),b[e]++,d=!0}),d)for(var e=-1,f=0;f<s.colorCount;f++){var g=b[f]||0;if(0===g){c=f;break}(e>g||-1===e)&&(e=g,c=f)}return c}function e(a,b){if(!a){var c=0;do a=b,c>0&&(a+=c),c++;while(s.get(a,"tags"))
}return a}var f,g,h,i=this,j=b.data,k=b.callback,l=b.onlyName;j?(f=j.name,g=j.alias,h=j.color):h=d();var m=0===o.count(s.list())?'<h4 class="g-dialogBox-title">'+n.t("您还没有邮件标签，创建后可以更加方便管理邮件")+'</h4><p class="txt-info txt-12" style="margin-bottom:20px">'+n.t("您可以给一封邮件设置多个标签，并为不同标签设置不同颜色...")+"</p>":"",p=null;if(!l){for(var t={groups:[{items:[],type:"inlineItemList"}],width:"142px"},u=0;20>u;u++)t.groups[0].items.push({text:new a.Tag({type:u,subclass:"iconTag"}).html(),click:q.bind(function(a){h=a,v.find("icon")[0].update({subtype:h})},this,u)});p=[{html:'<div class="nui-simpleForm nui-form"><table><tr><th class="nui-form-title">'+n.t("选择标签颜色")+'</th><td class="nui-form-cont" id="tdTagMenuButton"></td></tr></table></div>'}]}if(a.Msgbox.show({type:"prompt",items:p,inputLabel:n.t("输入标签名称"),content:m,inputValue:g,header:j?n.t("修改标签"):n.t("添加标签"),ok:c}),!l)var v=new a.Button({subclass:"dropdownBtn",text:n.t("选择颜色"),icon:{type:"tag",subtype:h},menu:t,renderTo:"tdTagMenuButton"})}try{var k=$L("init.Tag")}catch(l){return l}try{var m=$L("core.DataAction")}catch(l){return l}var n=new $I18N("support.Tag"),o=a.Object,p=a.Array,q=a.Function,r=a.String,s=k,t=m,u=a.Listener,v=a.createClass($N("support.Tag"));o.extend(v,{getMenu:d,add:e,modify:f,remove:g,setShow:h,checkAlias:i,showMsg:j})}($,window),function(a,b,c){function d(a){var b=g,c=a.defer,d=a.flags&&a.flags.deferHandle,e="",f="";return d&&c?(f=c<b.getDate("today")?i.t("尚未"):c<b.getDate("tomorrow")?i.t("今日"):c<k.addDate(b.getDate("tomorrow"),1)?i.t("明日"):k.format(a.defer,i.t("yyyy年M月d日")),e=i.t("已设为待办邮件，")+f+i.t("处理")):e=i.t("设置待办"),e}function e(b){var c,d=b.data,e=b.left||0,f=b.top||0,g=b.modify,h=b.modifyMemo,j=b.modifySms,k=b.complete,m=b["delete"],n=d.id,o=d.defer,p=d.flags.deferHandle;if(p&&o){c={reverse:!0,groups:[],extcls:"nui-menu-todosetting",extOffset:{left:e,top:f}};var q=c.groups,r=[],s=[];if(s.push('<b class="nui-layer-arr" style="left:auto;right:37px"></b><div class="nui-menu-item"><span class="nui-menu-item-icon"><b class="nui-ico nui-ico-todo nui-ico-todo-selected"></b></span>'),s.push('<div class="nui-menu-text">'),s.push("<span>"+l.expireNote(d)+"</span>"),s.push(new a.Link({text:i.t("修改"),extcls:"nui-txt-link",click:g}).html()),s.push("</div>"),s.push(new a.Button({subclass:"smallMainBtn",text:i.t("设为完成"),extcls:"nui-btn-done",icon:{type:"done",subtype:"white"},click:k}).html()),s.push("</div>"),r.push({html:s.join(""),xtype:"component"}),q.push({items:r}),a.Ext.scheduleRead)if($S("schedule")&&$S("schedule")[n]){var t=new a.Link({text:i.t("修改"),cls:"nui-txt-link",click:function(){try{var a=$L("product.Schedule",this)}catch(b){return b}a.edit(n)}}),u=[],v=[];v.push('<div class="nui-menu-item"><span class="nui-menu-item-icon"><b class="nui-ico nui-ico-smsRemind"></b></span>'),v.push('<div class="nui-menu-text">'+i.t("已设置短信提醒 ")+($G.environment.isCh?t.html():"")+"</div>"),v.push("</div>"),u.push({html:v.join(""),xtype:"component"}),q.push({items:u})}else{var w=new a.Link({text:i.t("添加短信提醒"),extcls:"nui-txt-link",click:j||g});q.push({items:[{html:'<p><span class="nui-menu-text">'+w.html()+"</span></p>",xtype:"component"}]})}var x=d.memo;if(x){var y=[],z=[];z.push('<div class="nui-menu-item nui-menu-todosetting-remark"><span class="nui-menu-item-icon"><b class="nui-ico nui-ico-remark-xs"></b></span>'),z.push('<p><span class="nui-menu-text">'+x+"</span></p>"),z.push(new a.Link({text:i.t("修改"),extcls:"nui-txt-link",click:g}).html()),z.push("&nbsp;"),z.push(new a.Link({text:i.t("删除"),extcls:"nui-txt-link",click:function(){a.Msgbox.show({type:"confirm",content:i.t("您确定要删除备注吗？"),title:i.t("删除确认"),ok:m})}}).html()),z.push("</div>"),y.push({html:z.join(""),xtype:"component"}),q.push({items:y})}else{var A=new a.Link({text:i.t("添加备注"),extcls:"nui-txt-link",click:h||g});q.push({items:[{html:'<p><span class="nui-menu-text">'+A.html()+"</span></p>",xtype:"component"}]})}}return c}function f(d){function e(){h(),A.getChecked()&&B.fire("show");try{if(V){for(var a,b=0,c=G.length;c>b;b++)if(G[b].getChecked()){a=F[b].date;break}a&&V.setValue(k.format(a,"yyyy-MM-dd"))}}catch(d){}}function f(b){if(b){z.date=b;var c=z.text=k.format(b,"yyyy-MM-dd"),d=A.getEl(),e=d.find(".nui-chk-text"),f=e.dom;f.innerHTML=c;var g=a(d.dom.parentNode);g.removeClass("nui-chk-someday"),g.addClass("nui-chk-thatday");try{V&&V.setValue(k.format(b,"yyyy-MM-dd"))}catch(i){}}A.getChecked()||(A.setChecked(!0,!0),h())}function h(){for(var b=0,c=G.length;c>b;b++){var d=G[b],e=a(d.getEl().dom.parentNode);d.getChecked()?e.addClass("selected"):e.removeClass("selected")}}function j(){for(var c,d=0,e=G.length;e>d;d++)if(G[d].getChecked()){c=F[d].date,a.Context.getModule().log("defer","date",d);break}var f;if(_&&_.getChecked()&&V&&X&&Y)try{var g=V.getValue(),h=g.split("-");f=new b.Date(h[0],h[1]-1,h[2]),f.setHours(X.getValue()),f.setMinutes(Y.getValue())}catch(j){}var k,l=ab.getChecked()?fb.value:"";return c?f&&C>f?k=i.t("短信提醒时间已过期"):l.length>x&&(k=i.t("请输入 ")+x+i.t(" 个字符")):k=i.t("请选择需要提醒的时间"),k?(a("#deferMsgboxInfo").html('<span class="nui-txt-err">'+k+"</span>"),!0):(w({defer:c,smsDate:f,memo:l}),void 0)}function l(){var b=x,c=fb.value.length,d=b-c,e="";ab.getChecked()&&(e=d>=0?i.t("还能输入&nbsp;")+"<strong>"+d+"</strong>"+i.t("&nbsp;字"):'<span class="nui-txt-err">'+i.t("请删除&nbsp;")+"<strong>"+-d+"</strong>"+i.t("&nbsp;字")+"</span>"),a("#deferMsgboxInfo").html(e)}function m(b){function c(){var c=this;c.calendar||(c.calendar=new a.Calendar({filterFn:function(a,b){return b>=a},onselect:function(a){c.setValue(k.format(a,"yyyy-MM-dd")),c.focus()},focus:b}),c.calendar.el=c.getEl()),setTimeout(function(){c.calendar.getLayer().show()},0)}var d=k.format(b,"yyyy-MM-dd");return new a.Input({width:"100px",placeholder:"yyyy-MM-dd",value:d||"",iconBtn:"calendar",iconbtnclick:c})}function n(b,c){var d=[];if("hour"===c)for(var e=0;24>e;e++)d.push({text:e+i.t("时"),value:e,checked:e===b});else for(var f=[0,15,30,45],e=0,g=f.length;g>e;e++){var h=f[e];d.push({text:h+i.t("分"),value:h,checked:h===b})}return new a.Select({options:d})}var o,p,q,r,s,t,u,v=(d.type,d.data),w=d.callback,x=a.Memo.maxLength,y=a.Context.getModule();v&&(o=v.defer,p=v.memo,q=v.mid,r=!!p||v.memoShow,s=!!q&&a.Ext.scheduleRead,t=s&&($S("schedule")&&$S("schedule")[q]||v.smsShow),u=s&&$S("schedule")&&$S("schedule")[q]&&!a("isVip"),o&&(o=new b.Date(o.getFullYear(),o.getMonth(),o.getDate())));var z,A,B,C=a.Misc.getTime(0),D=g,E=D.getDate("today"),F=[{text:i.t("今天"),date:E},{text:i.t("明天"),date:k.addDate(E,1)},{text:i.t("后天"),date:k.addDate(E,2)},{text:i.t("这周末"),date:function(){var a=E.getDay(),b=0;return a>0&&(b=6-a),k.addDate(E,b)}()},{text:i.t("下个月"),date:function(){return new b.Date(E.getFullYear(),E.getMonth()+1,1)}()},{text:i.t("某一天"),date:null}],G=[],H='<b class="nui-ico nui-ico-todo nui-ico-todo-transparent"></b>'+i.t("待办邮件设置"),I=[];I[I.length]='<div class="nui-simpleForm nui-form">',I[I.length]='<div class="nui-form-title"><b class="nui-ico nui-ico-todo nui-ico-todo-selected"></b><span>'+i.t("您希望什么时候处理这封邮件呢？")+"</span></div>",I[I.length]='<div class="nui-form-cont">';for(var J=!1,K=0,L=F.length;L>K;K++){var M=F[K],N=M.date,O=M.text,P=!1;o?N?o.getTime()===N.getTime()&&(P=!J,J=!0):J||(P=!0,O=k.format(o,"yyyy-MM-dd"),M.date=o):1===K&&(P=J=!0);var Q=K===L-1,R=new a.Radio({value:N,checked:P,text:O,checkedchange:e,listeners:{click:Q?e:c}});Q&&(z=M,A=R,B=new a.Calendar({onselect:f,focus:o,forbidMonth:!0,filterFn:function(a,b){return b>=a}}));var S=[];Q&&(P?S.push("nui-chk-thatday"):S.push("nui-chk-someday")),P&&S.push("selected"),I[I.length]='<label class="'+S.join(" ")+'">'+R.html()+(B?B.html():"")+"</label>",G.push(R)}if(a.Radio.group(G),I[I.length]="</div>",q){if(I[I.length]='<div style="'+(t?"":"display:none;")+'" id="deferMsgboxSms">',I[I.length]='<div class="nui-menu-split nui-split"></div>',I[I.length]='<div class="nui-form-title"><b class="nui-ico nui-ico-smsRemind"></b><span style="color:#555555;font-weight:bold;">'+i.t("短信提醒我处理邮件")+"</span></div>",u){var T=new a.Link({text:i.t("修改提醒时间")+"&gt;&gt;",cls:"nui-txt-link",click:function(){try{var a=$L("product.Schedule",this)}catch(b){return b}cb.close(),a.edit(q)}});I[I.length]="<div>"+i.t("您已设置过短信提醒 ")+T.html()+"</div>"}else{I[I.length]='<div class="nui-form-cont"><table class="nui-form-table"><tbody><tr><th class="nui-form-cont-title">'+i.t("提醒时间：")+'</th><td class="nui-form-cont-list">';var U=o?o:k.addDate(C,1),V=m(U);I[I.length]=V.html();var W=U.getHours();0===W?W=8:23>W&&W++;var X=n(W,"hour");I[I.length]=X.html();var Y=n(0,"minute");I[I.length]=Y.html(),I[I.length]="														</td>													</tr>							";var Z=new a.Link({text:i.t("修改手机号码")+"&gt;&gt;",cls:"nui-txt-link",click:function(){y.log("defer","mobile");try{var c=$L("interface.OutlinkInterface",this)}catch(d){return d}cb.close();var e;$S("isFree")?e={key:"sms",title:i.t("随身邮")}:$S("isVip")?e={key:"dxyycharge",title:i.t("手机服务")}:$S("isCorp")&&(e={key:"apps_mibao",title:i.t("密保平台")}),$S("isCorp")?b.open(a.Uri.getUrl(e.key),"_blank"):c.goOutlink(e)}});I[I.length]='													<tr>														<th class="nui-form-cont-title">&nbsp;</th>														<td class="nui-form-cont-ext">															'+i.t("将发送短信至您绑定的手机号码 ")+Z.html()+"														</td>													</tr>												</tbody>											</table>										</div>"}I[I.length]="</div>"}I[I.length]='<div style="'+(r?"":"display:none;")+'" id="deferMsgboxMemo">',I[I.length]='<div class="nui-menu-split nui-split"></div>',I[I.length]='<div class="nui-form-title"><b class="nui-ico nui-ico-remark-xs"></b><span style="color:#555555;font-weight:bold;">'+i.t("备注")+"</span></div>",I[I.length]='								<div class="nui-form-cont">									<div class="nui-multiLineIpt nui-ipt"><textarea class="nui-ipt-input" style="width:400px;height:40px;">'+(p?p:"")+"</textarea></div>								</div>",I[I.length]="</div>",I[I.length]="</div>";var $=[];if(s){var _=new a.Checkbox({text:i.t("短信提醒我处理邮件"),checked:!!t,checkedchange:function(){y.log("defer","sms"),a("#deferMsgboxSms")[this.getChecked()?"show":"hide"](),l()}});$.push(_.html())}var ab=new a.Checkbox({text:i.t("设置备注"),checked:!!r,checkedchange:function(){y.log("defer","memo"),a("#deferMsgboxMemo")[this.getChecked()?"show":"hide"](),l()}});$.push("&nbsp;"),$.push(ab.html()),$.push("&nbsp;"),$[$.length]='<span id="deferMsgboxInfo" class="nui-msgbox-todosetting-hint"></span>';var bb={contentType:"normal",header:H,extcls:"nui-msgbox-todosetting",content:I.join(""),footer:$.join(""),ok:j,cancel:function(){}},cb=a.Msgbox.show(bb),db=cb.getEl(),eb=db.find("TEXTAREA"),fb=eb.dom;eb.listen("keyup",l),eb.listen("paste",l),eb.listen("cut",l),a.Component.setEvents(),setTimeout(l,0),eb.destroy()}try{var g=$L("init.Defer")}catch(h){return h}var i=new $I18N("support.Defer"),j=a.Object,k=a.Date,l=a.createClass($N("support.Defer"));j.extend(l,{expireNote:d,getMenu:e,showMsgbox:f})}($,window),function(a,b){function c(){6!=a.Browser.ie()&&"standard"==$G.mailPattern.currentPattern&&s.getSkinConf(function(){var a=s.getCurrentSkin(),b=s.isUseHoliday();a.apply&&(b?a.apply.use({isHoliday:!0}):a.apply.use(a))})}function d(c){if(b.oSkinConf||$G.environment.skinConf)c(b.oSkinConf||$G.environment.skinConf);else{var d=$G.environment,e=d.cacheThemePath+"/"+d.themeJsFile;a.Ajax.request({url:e,requestType:a.Ajax.SCRIPT,call:function(){var a=b.oSkinConf||$G.environment.skinConf;a&&(s._orgiSkin=s._formatSkinData(a),c(a))}})}}function e(a){s.getSkinConf(function(c){var d=[];for(var e in c){var f=c[e];f instanceof b.Array?p.each(f,function(a,b){b.topshow&&d.push(b)}):f instanceof b.Object&&o.each(f,function(a,b){b.topshow&&d.push(b)})}a(d)})}function f(b,c){function d(b,c){function d(b){if(b){var c=b.code;c==a.S_OK?($S("skin",{name:g,color:h}),a.Tips.show({succ:!0,text:n.t("邮箱皮肤设置成功")}),a.Listener.fire("options:skinChange"),s.updateIframeSkin(),e.apply&&e.apply.use(e)):a.Tips.show({text:n.t("设置失败，请稍候再试")})}}var e=s.getSkin(b);if(e){var f=s.getCurrentSkin(),b=e.value,g=e.name,h=e.color,i=(b+"").split("");(c||!f||f.value!==b)&&(f.apply&&f.apply.unuse(e),$G.user.color=h,$G.user.css=g,$G.user.skin=b,i.length<2&&i.unshift(0),c||(r.set({field:"ntes_skin",flag:"jsSkin_units",value:i[1],notPost:!0}),r.set({field:"ntes_skin",flag:"jsSkin_tens",value:i[0],call:d,forcePost:!0})))}}6==a.Browser.ie()?s.noSupportTheme():s.getSkinConf(q.bind(d,this,b,c))}function g(a){try{return s._orgiSkin.skin_index[a]}catch(b){return null}}function h(){var a,c,d=(s._orgiSkin.skin_data,"0"),e=$S("attrs").user,f=b.oSkinConf||$G.environment.skinConf,g=$S("domain");return"string"==typeof e.ntes_skin?d=parseInt(e.ntes_skin.substr(4,2),10)||"":e.ntes_skin="0000000000000000",g.indexOf("188")>=0&&(g="188.com"),a=f.defaultSkin[g]||f.defaultSkin["163.com"],0===d-0&&(d=a.value),c=s.getSkin(d),c||(c=s.getSkin(a.value)),c}function i(c){var d=[],e={},f=$S("domain");for(var g in c){var h=c[g];if("otherSkin"==g)for(var d=[],i=0;i<h.length;i++){var j=h[i];j.domain.indexOf(f)>=0&&(d.push(j),e[j.value]=j)}else if(h instanceof b.Array)d=d.concat(h),a.Array.each(d,function(a,b){e[b.value]=b});else if(h instanceof b.Object)for(var i in h)d.push(h[i]),e[h[i].value]=h[i]}return{skin_data:d,skin_index:e}}function j(){function b(a,b,c){return a.replace(new RegExp("(^|&)"+b+"=([^&]*)(&|$)"),"")+"&"+b+"="+c}for(var c,d,e=[{domain:["vip.163.com","188.com"],id:"ifrmvipmsg",operator:"<",type:1},{domain:["vip.163.com"],id:"welcomeIfr",operator:"<"}],f=$S("domain"),g=!0,h=0,i=e.length;i>h;h+=1){if(c=e[h],d=a(c.id),!d)return;d=d.dom;for(var j=0,i=c.domain.length;i>j;j+=1){if(c.domain[j]==f&&">"===c.operator){g=!1;break}j==i&&c.domain[j]!=f&&"<"===c.operator&&(g=!1)}g&&(d.src=1===c.type?b(b(d.src,"skin",$G.user.css),"color",$G.user.color):d.src)}}function k(){var b="&product=js6&domain="+$S("domain")+"&uid="+$S("uid")+"&area=welcome"+a.Browser.ie(),c="https://count.mail.163.com/statistics/5xS5rC.do?"+b;a.Msgbox.show({icon:"alert",title:n.t("您的浏览器版本过低，无法支持邮箱换肤特性。"),content:n.t("如需使用邮箱换肤功能，")+'<a target="_blank" href="'+c+'" >'+n.t("请升级浏览器")+"</a>",okText:n.t("我知道了")})}function l(){return $G.environment.isHolidayTheme?""===a.Cookie.get("forceHideHoliday")?!0:!1:!1}function m(){$G.environment.holidayDays&&a.Cookie.set("forceHideHoliday","sjb",{expires:$G.environment.holidayDays-0})}var n=new $I18N("support.Theme"),o=a.Object,p=a.Array,q=a.Function;a.String;var r=a.Ud,s=a.createClass($N("support.Theme"));o.extend(s,{init:c,getSkinConf:d,_formatSkinData:i,changeSkin:f,getSkin:g,getCurrentSkin:h,getTopConf:e,updateIframeSkin:j,noSupportTheme:k,isUseHoliday:l,notUseHoliday:m})}($,window),function(a,b,c){function d(b,c){var d=this;$S("fullDomain");var e=$S("domain"),f=$S("orgUid"),g=d.product[e],h=a.Uri.getUrl("backurl",!0);if(!$S("isMailMasterLogined")){try{var i=a.Cookie.get("MAIL_MISC");if(i||(i=a.Cookie.get("S_INFO").split("|")[3]||""),i=i.replace(/\'/g,"")){var k=i.split("#");if(1===k.length)return d.hasRelateAccount=!1,void 0;d.hasRelateAccount=!0}}catch(m){}var o=a.Uri.getUrl("getRelateAccount",!0)+"?username={0}&product={1}";o=a.Support.format(o,f,g),a.Ajax.paddingGetRelateAccount=function(d){for(var e=d.substr(1).split("&"),f=["type","username","relateUsernames","relateUserStatus"],g={},h=0,i=e.length;i>h;h++)for(var k=e[h].split("="),m=0,o=f.length;o>m;m++)if(f[m]===k[0]){g[f[m]]=decodeURIComponent(k[1]);break}if(g.type&&200===g.type-0){var p=[],q=[],r=!1;p=g.relateUsernames.split(","),q=g.relateUserStatus.split(","),n.emRelateAccounts={};for(var s=p.length-1;s>-1;s--)p[s]+=-1===p[s].indexOf("@")?"@163.com":"",n.emRelateAccounts[p[s]]=0|q[s],p[s]===$S("orgUid")&&(p.splice(s,1),r=!0);if(p=r?p:[],p.length>0){a.Ext.accountRelate=!0;var t=$G.attrs.user.ntes_labs;if(t&&"0"===t.substr(20,1)){var u="https://lab.mail."+$S("domain")+"/labweb/lab.do?m=submit&id=20&act=enable&uid="+$S("orgUid")+"&sid="+$S("sid")+"&host="+$S("host");a.Ajax.jsonp(u,function(){},"jsonp")}}n.relateAccount=p,c&&c(),a.Listener.listen("accountRelate:getCount",function(b,c){if(b&&(n.relateAccountCount[b]=c,c.newCount>0)){var d=document.getElementById("_account_"+b);d&&a(d).html("<strong>("+c.newCount+")</strong>")}var e=0,f=0;for(var g in n.relateAccountCount)e+=n.relateAccountCount[g].newCount,f++;e+=j.getTotal("unread");try{e>0?a(document.getElementById("_account_"+$G.user.uid)).html("<strong>("+e+")</strong>"):a(document.getElementById("_account_"+$G.user.uid)).html("")}catch(h){}var i=a.fly("#spnUid");i&&(i.dom.title=l.t("您已关联")+f+l.t("个网易邮箱，共有")+e+l.t("封未读邮件"))}),n.getAllAccountCount(),a.Listener.listen("accountRelate:unRelate",function(a){delete n.relateAccountCount[a]})}else b||a.Msgbox.show({title:l.t("获取关联帐号信息失败，请退出登录重试")}),a.Log.cache({account_related_error:g.type||"unknow"},!0)},h+="parent.$.Ajax.paddingGetRelateAccount&contact=location.search",a.Ajax.request({method:"post",requestType:a.Ajax.IFRAME,url:o,body:{loginCookie:a.Misc.getMailSess(),url:h}})}}function e(a){n.switchUid=a,n.switchAccount($S("orgUid"))}function f(c,d){function e(b,c){var d={loginCookie:a.Misc.getMailSess()};c&&(d.password=c,$S("sSwitchAccountPwd",c)),a.Ajax.request({method:"post",requestType:a.Ajax.IFRAME,url:b,body:d})}function f(){a.Msgbox.show({header:l.t("密码验证"),title:l.t("您已设置&nbsp;")+a.Support.trimAccount(d)+l.t("&nbsp;为所有关联邮箱中的重要邮箱，需要输入该邮箱密码才能进行切换："),type:"prompt",inputLabel:l.t("邮箱密码："),inputType:"password",ok:function(b){return""===a.String.trim(b)?l.t("请输入密码！"):(e(u,h.encode(b)),!0)}}),a.Event.fire(document.body,"click")}var g=this;try{var h=$L("util.MD5",this)}catch(i){return i}if(d)return n.beforeSwitch(d),void 0;(new a.DataAction).wmsvr({func:"user:getAttrs"});var j=n.relateAccount,k=c;if(k===$S("orgUid")||a.Array.has(j,k)){d=n.switchUid;var m,o=d.split("@")[1];a.Uri.getUrl("errorpage",!0);var p=this.product[o],q=7,r=q,s={"163.com":"https://mail.163.com/entry/coremail/fcg/ntesdoor2?lightweight%3D1%26verifycookie%3D1%26language%3D-1%26style%3D"+q+"%26df%3Dwm_switch","126.com":"https://mail.126.com/entry/cgi/ntesdoor?hid%3D10010102%26lightweight%3D1%26verifycookie%3D1%26language%3D0%26style%3D"+q+"%26df%3Dwm_switch","yeah.net":"https://mail.yeah.net/entry/cgi/ntesdoor?lightweight%3D1%26verifycookie%3D1%26style%3D"+q+"%26df%3Dwm_switch","vip.163.com":"https://reg.vip.163.com/enterMail.m?style%3D"+r+"%26language%3D0%26enterVip%3Dtrue%26verifycookie%3D1%26username%3D"+d,"188.com":"https://reg.mail.188.com/servlet/enter?verifycookie=1&enterWebmail=1&language=0&style="+r+"&username="+d,"vip.126.com":"https://reg.vip.126.com/enterMail.m?style%3D"+r+"%26language%3D0%26enterVip%3Dtrue%26verifycookie%3D1%26username%3D"+d};m=m||s[o];var t=m+encodeURIComponent("&related=true&MAIL_MISC="+a.Cookie.get("MAIL_MISC").replace(/\'/g,"").replace(/#/g,"%23"));"https:"==$G.environment.protocol&&(t+=encodeURIComponent("&allssl=true"));var u=a.Uri.getUrl("accountRelate",!0)+"?chgUsername={0}&url={1}&url1={2}&url2={3}&url3={4}&product={5}&remind=1&noRedirect=1",v=encodeURIComponent(a.Uri.getUrl("backurl",!0)+"parent.$.Ajax.paddingAccountSwitch&contact=location.search");u=a.Support.format(u,d,v+encodeURIComponent("&result=success"),v+encodeURIComponent("&result=failed"),v,v,p),a.Ajax.paddingAccountSwitch=function(c){for(var e,h,i,j,k,m=c.substr(1).split("&"),n=0,q=m.length;q>n;n++){var r=m[n].split("=");"errorType"===r[0]&&(e=r[1]-0),"result"===r[0]&&(i=decodeURIComponent(r[1])),"url"===r[0]&&(j=decodeURIComponent(r[1])),"errorUsername"===r[0]&&(k=decodeURIComponent(r[1]))}if(i&&"success"===i||"failed"===i){b.gAd.getBiz=null;var s=!1,u=a.Browser.getVersion()||[0,0];if(a.Browser.chrome()&&u[0]>=80&&(s=!0),!s||$S("is163")||t.indexOf($S("fullDomain"))>-1)top.location.href=decodeURIComponent(t);else{var v;v=$S("isVip")?$S("host").replace(/vip.163.com|vip.126.com|vip.188.com/,"mail.163.com"):$S("host").replace(/126.com|yeah.net/,"163.com");var w=encodeURIComponent("https://"+v+"/js6/switch_account.jsp?nextHost=mail."+o+"&goUrl="+t);w=a.Support.format(a.Uri.getUrl("accountRelate",!0)+"?chgUsername={0}&url={1}&url1={2}&url2={3}&url3={4}&product={5}&remind=1&noRedirect=1",d,w,w,w,w,p);var x={loginCookie:a.Misc.getMailSess()};$S("sSwitchAccountPwd")&&(x.password=$S("sSwitchAccountPwd"));var y=document.createElement("form");y.action=w,y.method="post";for(var z in x)if(x.hasOwnProperty(z)){var A=x[z],B=document.createElement("input");B.type="hidden",B.name=z,B.value=A,y.appendChild(B)}document.body.appendChild(y),y.submit()}return $S("sSwitchAccountPwd",""),void 0}if(402===e)return a.Support.relogin(),void 0;if(461===e)return f(),void 0;if(428===e)return b.gAd.getBiz=null,top.location.href=j+"&url="+t,void 0;if(425!==e){h=g.errorCode[e];try{a.Msgbox.msgbox&&a.Msgbox.msgbox.input?a.Msgbox.msgbox.input.showTips(h):a.Msgbox.show({title:h})}catch(C){return C}}else{var D,E=/\@/.test(k)?k:k+"@163.com";D=E===$S("uid")?l.t("您的当前账号存在安全风险，暂时无法切换，建议您马上修改密码。"):l.t("您的 ")+E+l.t(" 账号存在安全风险，暂时无法切换账号，建议您马上修改密码或者解除账号关联。");try{a.Msgbox.msgbox&&a.Msgbox.msgbox.input?a.Msgbox.msgbox.input.showTips(D):a.Msgbox.show({title:D})}catch(C){return C}}},e(u)}else a.Support.relogin(l.t("您已登录网易其他帐号，请重新登录。"))}function g(){var b=this,c=n.relateAccount,d=b.product[$S("domain")];a.Ajax.jsonp("https://msg."+$S("fullDomain")+"/cgi/mc?funcid=getallmsgcnt&fid=0&username="+$S("uid")+"&product="+d,function(b){if(b)for(var d=0;d<c.length;d++){var e=c[d],f=b[e];if(f){var g=f.UNREAD,h=f.MSGCOUNT;if(-1===h)continue;g=Math.max(g,0),h=Math.max(h,0);var i={total:h,newCount:g};a.Listener.fire("accountRelate:getCount",e,i)}}})}function h(){var b={"163.com":"mail.163.com","126.com":"mail.126.com","yeah.net":"mail.yeah.net","vip.163.com":"vip.163.com","vip.126.com":"vip.126.com","188.com":"vip.188.com"},c=n.relateAccount;j.getTotal("unread");for(var d=0;d<c.length;d++){var e=c[d];a.Ajax.jsonp("//msg."+b[e.split("@")[1]]+"/cgi/mc?funcid=getusrnewmsgcnt&fid=0&addSubFdrs=1&language=0&style=0&template=newmsgres_setcookie.htm&cuslog=true&username="+e,function(b,c,d){b-=0,b=Math.max(b,0),c=Math.max(c,0);var e={total:c,newCount:b};a.Listener.fire("accountRelate:getCount",d,e)})}}function i(b){var c="",d=b.split("@")[1],e=!1;if(("163.com"===d||"126.com"===d||"yeah.net"===d)&&(e=!0),e){var f="mail"+d.split(".")[0],g={"126.com":"https://mail.126.com/entry/cgi/ntesdoor?","163.com":"https://mail.163.com/entry/coremail/fcg/ntesdoor2?","yeah.net":"https://mail.yeah.net/entry/cgi/ntesdoor?"},h="df=webmail&from=web&funcid=loginone&passtype=1&style=5&product="+f+"&"+"uid="+b;"hw"===a.Cookie.get("mail_dist")&&(h+="&mail_dist=hw"),c=g[d]+h}else{var i={"vip.163.com":"https://reg.163.com/logins.jsp?product=mailvip&type=1&url={0}&url2={1}","188.com":"https://reg.mail.188.com/servlet/login?verifycookie=1&enterWebmail=1&language=0&style=1%26df%3Dwebmail_relogin","vip.126.com":"https://reg.163.com/logins.jsp?product=mailvip&type=1&url=https://reg.vip.126.com/enterMail.m?style%3D9%26language%3D0%26enterVip%3Dtrue%26verifycookie%3D1%26username%3D"+b+"&url2=https://reg.vip.126.com/logon.m?style%3D9%26language%3D0%26enterVip%3Dtrue%26verifycookie%3D1%26df%3Dwebmail_relogin%26username%3D"+b};c=i[d]}return c}try{var j=$L("init.Folder")}catch(k){return k}var l=new $I18N("product.AccountRelate"),m=a.Object,n=a.createClass($N("product.AccountRelate"));m.extend(n,{isMailMasterLogined:!1,hasRelateAccount:c,init:d,beforeSwitch:e,switchAccount:f,getCount:h,getAllAccountCount:g,relateAccountCount:{},relateAccount:[],product:{"126.com":"mail126","163.com":"mail163","yeah.net":"mailyeah","188.com":"mail188","vip.163.com":"mailvip","vip.126.com":"mailvip"},switchUid:null,errorCode:{401:l.t("URL语法错误或参数值非法"),402:l.t("超时了，请您重新登录！"),412:l.t("您尝试的次数已经太多,请过一段时间再试"),414:l.t("您的IP登录失败次数过多,请稍后再试"),415:l.t("您今天登录错误次数已经太多,请明天再试"),416:l.t("您的IP今天登录过于频繁，请稍后再试"),417:l.t("您的IP今天登录次数过多，请明天再试"),418:l.t("您今天登录次数过多,请明天再试"),419:l.t("您的登录操作过于频繁，请稍候再试"),420:l.t("用户名不存在"),422:l.t("帐号锁定或靓号服务已到期"),423:l.t("VIP或188帐号已到期，请续费！"),460:l.t("密码错误"),461:l.t("重要帐号，需要验证密码"),464:l.t("帐号无关联关系"),500:l.t("系统繁忙，请您稍后再试！"),503:l.t("系统维护，请您稍后再试！")},emRelateAccounts:{},_getLoginUrl:i})}($,window),function(a,b){function c(b){if(b.length&&b.length>0)for(var c=0;c<b.length;c++)arguments.callee(b[c]);else if(b.data){var d;"string"==typeof b.data&&(b.data=a.Eval.get(b.data)),d="string"==typeof b.data.event?b.data.event:(b.data.event||[])[0],d&&l._customEvent.fire(d,b.data)}}function d(){i.request()}function e(){var a=new k.base.CustomEvent;this._customEvent=a;var b=this._events;for(var c in b){var d=b[c];a.listen(c,function(a){return function(b){a&&(b=a(b))}}(d,c))}k.comet.App.create({baseUrl:this._baseUrl,pushType:"jsonp-pull",product:"all",call:function(b){a.fire("global",b)},service:"push"})}function f(){k.comet.App.init()}function g(){b.MailMsg.listen()}function h(){b.MailMsg.publish({uid:b.MailMsg.uid,event:"push_login",product:l._product})}try{var i=$L("init.Sync")}catch(j){return j}var k=b.netease.mail,l=a.createClass($N("product.PushMail"));a.Object.extend(l,{_baseUrl:"https://push.mail."+$G.environment.domain+"/cometd",_product:"webmail",_events:{global:c,push_login:null,print:null,pushmail:d,imageUpload:function(b){a.Listener.fire("compose:imageUpload",b),a.Listener.fire("compose:imageUpload")},logout:function(b){a.Listener.fire("global:sweeplogout",b)}},_customEvent:null,init:e,subscribe:f,listen:g,login:h})}($,window),function(a,b){function c(){A.list()}function d(b){if(b){if(0===b.code){for(var c={},d=b.list,e=0,f=d.length;f>e;e++)c[d[e]]=!0;A.info=c,$S("schedule",c),a.Listener.fire("schedule:list")}}else{var g=A.getUrl("list");a.Ajax.jsonp(g,A.list,"call")}}function e(){}function f(a,b){var c=A.getUrl("add",a);b&&(c+="&subject="+encodeURIComponent(b)),c+="#add";try{var d=$L("interface.OutlinkInterface",this)}catch(e){return e}d.goOutlink({key:"schedule",url:c,title:z.t("日程管理")})}function g(a){var b=A.getUrl("edit",a)+"#edit";try{var c=$L("interface.OutlinkInterface",this)}catch(d){return d}c.goOutlink({key:"schedule",url:b,title:z.t("日程管理")})}function h(a){var b=A.getUrl("view",a)+"#view";try{var c=$L("interface.OutlinkInterface",this)}catch(d){return d}c.goOutlink({key:"schedule",url:b,title:z.t("日程管理")})}function i(b,c){if("string"==typeof b){c=b;var d=A.getUrl("remove",c);a.Ajax.jsonp(d,function(a){A.remove(a,c)},"call"),a.JS.cleanCache("outlink.OutlinkModule",{key:"schedule"})}else 0===b.code&&(A.info[c]=!1,a.Listener.fire("schedule:remove",c))}function j(b,c,d){if("string"==typeof b){var e=b,f=A.getUrl("insert",c,e,d);a.Ajax.jsonp(f,function(a){A.insert(a,c)},"call")}else if(0===b.code){A.info[c]=!0,a.Listener.fire("schedule:insert",c);var g=b.hasMobile,h=b.hasSms;if(!g||!h){var i,j;g?(i=z.t("已经没有短信条数，立刻免费领取或者充值"),j=z.t("立刻领取")):(i=z.t("使用短信提醒，需开通随身邮才可以收到通知短信"),j=z.t("立即开通")),a.Msgbox.show({title:i,okText:j,ok:function(){try{var a=$L("interface.OutlinkInterface",this)}catch(b){return b}var c;$S("isFree")?c={key:"sms",title:z.t("随身邮")}:$S("isVip")&&(c={key:"dxyycharge",title:z.t("手机服务")}),a.goOutlink(c)},cancel:function(){}})}}else try{a.Msgbox.show({header:z.t("设置短信提醒出错"),title:z.t("错误信息：")+b.message})}catch(k){}}function k(){try{$L("module.mbox.MboxModule",this)}catch(b){return b}a.Listener.fire("letter:schedule"),A.list()}function l(a){try{var b=$L("interface.ReadInterface",this)}catch(c){return c}b.entry({mid:a})}function m(b,c,d,e){var f,g,h="",i="uid="+$S("orgUid"),j=[];switch(b){case"remove":b="delete";case"list":case"detail":f=A.mailUrl,g="opt="+b,j.push("rq=1");break;case"insert":f=A.mailUrl,g="opt=add",j.push("rq=1"),j.push("title="+(d?encodeURIComponent(d):z.t("(无主题)"))),j.push("time="+a.Date.format(e,"yyyyMMddHHmm"));break;case"add":case"edit":case"view":f=A.scheduleUrl,g="opt=index",h="mop="+b}return j.push(g),j.push(i),c&&j.push("mid="+encodeURIComponent(c)),h&&j.push(h),A.baseUrl+f+j.join("&")}function n(b,c){var d=this,e=d._getIcsManagerUrl("organizerAdd"),f={icsUid:d.icsUid,calUid:b.uid,sequence:b.sequence,tos:a.JSON.stringify(b.tos||[]),ccs:a.JSON.stringify(b.ccs||[]),bccs:a.JSON.stringify(b.bccs||[]),schedule:d._genIcsSchedule(b.oIcs)};a.Ajax.request({url:e,method:"post",body:f,call:function(b){var d;try{d=a.JSON.parse(b.responseText)}catch(e){d={code:-1,err_msg:z.t("未知错误")}}"function"==typeof c&&c(d)}})}function o(c){function d(a){var b=new Date(a);return+new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds(),b.getUTCMilliseconds())}function e(a,b){var c=b.split(":"),d=[a];return c[0]!==c[1]&&d.push(";CN="+c[0]),d.push(":mailto:"+c[1]),d.join("")}function f(a,b){var c=["seconds","minutes","hours","days","weeks"],d={};d[c[b]]=a;var e="-";return e+="P",d.weeks&&(e+=d.weeks+"W"),d.days&&(e+=d.days+"D"),(d.hours||d.minutes||d.seconds)&&(e+="T",d.hours&&(e+=d.hours+"H"),d.minutes&&(e+=d.minutes+"M"),d.seconds&&(e+=d.seconds+"S")),e}function g(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);a[14]="4",a[19]=b.substr(8|3&a[19],1),a[8]=a[13]=a[18]=a[23]="-";var d=a.join("");return d}var h=this,i=c.oIcs||{};i.organizer=h.icsUid,i.attendList=a.Array.union(c.tos||[],c.ccs||[],c.bccs||[]);try{if(!a.Object.isObject(i))throw"ICAL.stringify: oData is not object";if(!a.String.trim(i.summary))throw"ICAL.stringify: oData.summary is illegal";if(!a.Object.isNumber(i.start)||!a.Object.isNumber(i.end))throw"ICAL.stringify: oData.start|end is illegal";var j=["DTSTART"],k=["DTEND"];if(i.allday?(j.push(";VALUE=DATE"),j.push(a.Date.format(new Date(i.start),":yyyyMMdd")),k.push(";VALUE=DATE"),k.push(a.Date.format(new Date(i.end+864e5),":yyyyMMdd"))):(j.push(a.Date.format(new Date(d(i.start)),":yyyyMMddTHHmmssZ")),k.push(a.Date.format(new Date(d(i.end)),":yyyyMMddTHHmmssZ"))),!a.Object.isString(i.organizer)||i.organizer.split(":").length<2)throw"ICAL.stringify: oData.organizer is illegal";var l=e("ORGANIZER",i.organizer),m=[];if(i.attendList)for(var n=0;n<i.attendList.length;n++){if(!a.Object.isString(i.attendList[n])||i.attendList[n].split(":").length<2)throw"ICAL.stringify: oData.attendList is illegal";m.push(e("ATTENDEE",i.attendList[n]))}var o=[],p=(i.valarmList||[])[0];p&&(o=["BEGIN:VALARM","SUMMARY:"+(p.summary||i.summary),"ACTION:"+p.action,"TRIGGER:"+f(p.interval,p.unit),"REPEAT:1","END:VALARM"]);var q=[],r=g();a.Array.each(["BEGIN:VCALENDAR","PRODID:-//Netease//"+($S("isCorp")?"QiyeMail":"WebMail"),"VERSION:2.0","METHOD:REQUEST","BEGIN:VEVENT","SUMMARY:"+i.summary,i.location&&"LOCATION:"+i.location,j.join(""),k.join(""),"UID:"+r,"SEQUENCE:0","STATUS:CONFIRMED",l,m.length?m.join("\n"):"",o.length?o.join("\n"):"","END:VEVENT","END:VCALENDAR"],function(a,b){!!b&&q.push(b)});var s=q.join("\n"),t=new Date,u=t.getTime(),v=new Blob([s],{lastModified:u,lastModifiedDate:u,type:"text/calendar"});return v.name="ATT"+u+".ics",{blob:v,base64:b.btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)})),uid:r,sequence:0}}catch(w){return null}}function p(b,c){for(var d=this,e=d._getIcsManagerUrl("organizerInfo"),f=[],g=0;g<b.attendList.length;g++)f.push(x(b.attendList[g]));var h={icsUid:d.icsUid,calUid:b.uid,sequence:b.sequence,attendees:a.JSON.stringify(f),schedule:d._genIcsSchedule(b)};a.Ajax.request({url:e,method:"post",body:h,call:function(d){var e=a.JSON.parse(d.responseText);if(200===e.code)b.extended.data=e.data,"function"==typeof c&&c(b);else{if(408===e.code)return a.Support.relogin(),void 0;a.Msgbox.show({title:e.err_msg})}}})}function q(b,c){var d=this,e=d._getIcsManagerUrl("attendeeInfo"),f={icsUid:d.icsUid,calUid:b.uid,sequence:b.sequence};a.Ajax.request({url:e,method:"post",body:f,call:function(d){var e=a.JSON.parse(d.responseText);if(200===e.code)b.extended.data=e.data,"function"==typeof c&&c(b);else{if(408===e.code)return a.Support.relogin(),void 0;a.Msgbox.show({title:e.err_msg})}}})}function r(b,c){function d(d){if(200===d.status&&"string"==typeof d.responseText){var h=d.getResponseHeader("Content-Type")||"";if(h.match(/charset=gb/i)&&2>f)return e(b,c),f++,void 0;var i=[];try{if(0===f)i=g._parseIcs(d.responseText).veventList;else{var j=a.JSON.parse(d.responseText.toString());if(200===j.code){for(var k=0;k<j.result.veventList.length;k++)j.result.veventList[k].method=j.result.method;
i=j.result.veventList}}}catch(l){}if(!i||0===i.length)return"function"==typeof c&&c(m),void 0;for(var k=0;k<i.length;k++){var m=i[k];if(!a.Ext.ics2schedule)return c(m),void 0;var n=[].concat(m.organizer||[],m.attendList||[]);a.Array.each(n,function(a,b){n[a]=b.split(":")[1].toLowerCase()});var o=a.Array.indexOf(n,$S("uid").toLowerCase());if(0===o)if(m.extended={type:"organizer"},"reply"===m.method.toLowerCase()){var p=m.uid,q=m.sequence,r=new a.Uri(b.from),s=r.address;r.name;for(var t="",u=["","ACCEPTED","DECLINED","","TENTATIVE"],v="",w=0;w<m.attendList.length;w++){var x=m.attendList[w].split(":")[1];if(s===x){t=m.attendList[w],v=a.Array.indexOf(u,m.attendList[w].split(":")[2]);break}}p&&s&&t&&g.syncOrganizer({sIcsUid:p,nIcsSequence:q,sAttendee:t,sReply:v},c,m)}else g._getOrganizerInfo(m,c);else"publish"!==m.method.toLowerCase()?(m.extended={type:"attendee"},g._getAttendeeInfo(m,c)):"function"==typeof c&&c(m)}}}function e(b){var c=a.Uri.getUrl("read_attach_ics_parse",!0),e={sid:$S("sid"),mid:encodeURIComponent(b.sMid),partId:b.sPartid,domain:$G.environment.domain,_:+new Date};c=a.Location.addParam(e,c),a.Ajax.request({url:c,call:d})}var f=0,g=this,h="//"+$S("host")+"/js6/s?func=mbox:getMessageData&sid="+$S("sid")+"&mid="+b.sMid+"&mode=text&part="+b.sPartid;b.pwd&&(h="//"+$S("host")+"/js6/s?func=mbox:decryptMessagePart&sid="+$S("sid")+"&mid="+b.sMid+"&mode=text&part="+b.sPartid+"&password="+b.pwd),a.Ajax.request({url:h,call:d})}function s(b,c){var d=this,e=d._getIcsManagerUrl(b.sReply),f={icsUid:d.icsUid,calUid:b.oIcs.uid,sequence:b.oIcs.sequence,organizer:b.oIcs.organizer,schedule:d._genIcsSchedule(b.oIcs)};a.Ajax.request({url:e,method:"post",body:f,call:function(b){var d=a.JSON.parse(b.responseText);if(200===d.code)"function"==typeof c&&c(d.data);else{if(408===d.code)return a.Support.relogin(),void 0;a.Msgbox.show({title:d.err_msg})}}})}function t(b,c,d){var e=this,f=e._getIcsManagerUrl("attendeeResp"),g={icsUid:e.icsUid,calUid:b.sIcsUid,sequence:b.nIcsSequence,attendee:x(b.sAttendee),operate:b.sReply};a.Ajax.request({url:f,method:"post",body:g,call:function(b){var e=a.JSON.parse(b.responseText);if(200===e.code)d.extended.data=e.data,"function"==typeof c&&c(d);else{if(408===e.code)return a.Support.relogin(),void 0;a.Msgbox.show({title:e.err_msg})}}})}function u(b){function c(b,c){var f=d(b,c);f.key;var g=f.value,i=f.param;switch(c){case"DTSTART":case"DTEND":var j=e(g,i.VALUE);a.Browser.isIE("<9")&&(j=j.replace(/\-/g,"/").replace(/T/," "));var k=+new Date(j)-("DATE"==i.VALUE&&"DTEND"==c?864e5:0);try{if(i.TZID&&h.timeZone&&h.timeZone[i.TZID.replace(/['"]/g,"")]){var l=h.timeZone[i.TZID.replace(/['"]/g,"")],m=l.match(/([\+\-])(\d{2})(\d{2})/);m&&(k+=("+"==m[1]?-1:1)*(1e3*60*60*+m[2]+1e3*60*+m[3]))}}catch(n){}return k;case"ORGANIZER":case"ATTENDEE":var o=g.replace(/^mailto:/i,""),p=[i.CN||o,o];return i.PARTSTAT&&p.push(i.PARTSTAT),p.join(":");case"SEQUENCE":case"REPEAT":return+g;default:return g}}function d(b,c){var d=new RegExp(c+"[:;]{1}([\\w\\W]*?)\\n(?!\\s)","i");"ATTENDEE"==c&&(d=new RegExp(c+"[:;]{1}(.+)","i"));var e=b.match(d);if(!e)return{};var f=a.String.decodeHTML(e[0].replace(/[\r\n\t]\ */g,"")),g=f.split(":");if(2>g)return{};var h=g.shift(),i=g.join(":"),j={},k=h.split(";");if(k.length>1)for(var l=1;l<k.length;l++){var m=k[l].split("=");j[m.shift()]=m.join("=")}return{key:h,value:i,param:j}}function e(a,b){if(b=b||"DATE-TIME","DATE"===b)return a.substr(0,4)+"-"+a.substr(4,2)+"-"+a.substr(6,2);if("DATE-TIME"===b){var c=a.substr(0,4)+"-"+a.substr(4,2)+"-"+a.substr(6,2)+"T"+a.substr(9,2)+":"+a.substr(11,2)+":"+a.substr(13,2);return c+="Z"}return 0/0}function f(a){for(var b=/([PDWHMTS]{1,1})/,c=0,d={},e=0;-1!==(c=a.search(b));){var f=a[c],h=a.substr(0,c);a=a.substr(c+1),e+=g(f,h,d)}return 2>e?{}:d}function g(a,b,c){var d;switch(a){case"P":c.isNegative=b&&"-"===b?!0:!1;break;case"D":d="days";break;case"W":d="weeks";break;case"H":d="hours";break;case"M":d="minutes";break;case"S":d="seconds";break;default:return 0}if(d){if(!b&&0!==b)throw new Error('invalid duration value: Missing number before "'+a+'"');var e=parseInt(b,10);if(isNaN(e))throw new Error('invalid duration value: Invalid number "'+b+'" before "'+a+'"');c[d]=e}return 1}var h={method:null,veventList:[]};if(!b||"string"!=typeof b)return h;var i=b.match(/BEGIN:VCALENDAR([\w\W]*?)END:VCALENDAR/i);if(!i)return h;var j=i[1];h.method=c(j,"METHOD"),h.timeZone={};try{var k=b.match(/BEGIN:VTIMEZONE([\w\W]*?)END:VTIMEZONE/gi);if(k&&k.length)for(var l=0;l<k.length;l++){sTimeZone=k[0];var m,n=c(sTimeZone,"TZID"),o=sTimeZone.match(/BEGIN:STANDARD([\w\W]*?)END:STANDARD/i);o&&(m=c(o[0],"TZOFFSETTO")),h.timeZone[n]=m}}catch(p){}var q=b.match(/BEGIN:VEVENT([\w\W]*?)END:VEVENT/gi);if(!q||0===q.length)return h;for(var l=0;l<q.length;l++){var r=q[l],s={};s.method=h.method,s.startTime=c(r,"DTSTART"),s.endTime=c(r,"DTEND"),s.summary=c(r,"SUMMARY"),s.location=c(r,"LOCATION"),s.organizer=c(r,"ORGANIZER"),s.uid=c(r,"UID");var t=c(r,"SEQUENCE");s.sequence=isNaN(t)?-1:t,s.status=c(r,"STATUS");var u=d(r,"DTSTART"),v=d(r,"DTEND");s.allday="DATE"===u.param.VALUE&&"DATE"===v.param.VALUE?1:0,s.attendList=[];var w=r.match(/ATTENDEE[:;]{1}([\w\W]*?)\n(?!\s)/gi);if(w&&w.length)for(var x=0;x<w.length;x++)s.attendList.push(c(w[x].replace(/\s/g,""),"ATTENDEE"));s.valarmList=[];var y=r.match(/BEGIN:VALARM([\w\W]*?)END:VALARM/gi);if(y&&y.length)for(var x=0;x<y.length;x++){var z={action:c(y[x],"ACTION"),trigger:c(y[x],"TRIGGER"),repeat:c(y[x],"REPEAT"),unit:0,interval:0},A=d(r,"TRIGGER");if("DATE-TIME"===A.param.VALUE){var B=e(z.trigger,A.param.VALUE);z.unit=1,z.interval=(s.startTime-+new Date(B))/6e4}else for(var C=f(z.trigger),D=["seconds","minutes","hours","days","weeks"],E=0;E<D.length;E++){var F=D[E];if(F in C){E?(z.unit=E,z.interval=C[F]):(z.unit=1,z.interval=Math.ceil(C[F]/60));break}}s.valarmList.push(z)}h.veventList.push(s)}return h}function v(a){return this.baseUrl+this.icsUrl+"opt="+a+"&uid="+$S("uid")+"&rq=1&_="+ +new Date}function w(b){var c={};if(c.subject=b.subject||b.summary||z.t("日程"),c.location=b.location||z.t("地点待定"),c.description=b.description||"",c.start=b.start||b.startTime,c.end=b.end||b.endTime,c.allday=b.allday||0,b.valarmList&&b.valarmList.length){c.valarmList=b.valarmList;for(var d=0;d<b.valarmList.length;d++)b.valarmList[d]}return a.JSON.stringify(c)}function x(a){var b=a.split(":");return b.length>2?[b[0],b[1]].join(":"):a}try{$L("module.mbox.MboxModule")}catch(y){return y}var z=new $I18N("product.Schedule"),A=a.createClass($N("product.Schedule"));a.Object.extend(A,{baseUrl:function(){var a;return $S("isFree")?a="https://daily."+$S("fullDomain")+"/schedulemanager/":$S("isVip")&&(a="//jf."+$S("fullDomain")+"/apps/notice/"),a}(),ext:$S("isFree")?".do":".m",info:{},init:c,list:d,detail:e,add:f,edit:g,view:h,remove:i,insert:j,sync:k,read:l,getUrl:m,addIcs:n,genIcs:o,getIcsInfo:r,replyAttendee:s,syncOrganizer:t,_getOrganizerInfo:p,_getAttendeeInfo:q,_parseIcs:u,_genIcsSchedule:w,_getIcsManagerUrl:v}),A.mailUrl="mail"+A.ext+"?",A.scheduleUrl="schedule"+A.ext+"?",A.icsUrl="ics"+A.ext+"?",A.icsUid=[$G.attrs.user.true_name||$S("uid"),$S("uid")].join(":"),$S("isVip")&&(A.mailUrl="callback/"+A.mailUrl)}($,window),function(a,b){function c(){var b=location.host.split(".");b.length>3&&(b=b.slice(-3)),a.Msgbox.show({extcls:"gWel-pure-msgbox",noHeader:!0,noFooter:!0,content:'<iframe src="//'+b.join(".")+"/html/181008-pure/plus_style.htm?uid="+$S("uid")+'" id="pure-advertisement" style="width:547px;height:343px;border:none;display:block"></iframe>',width:"547px",contentType:"custom",close:function(){a.Msgbox.msgbox.hide()}})}function d(c,d,e){function f(c){var d=!1;a.Array.each(n,function(b,e){return c.origin.indexOf(e)>=0?(d=!0,a.BREAK):void 0}),d&&("PageReload"===c.data?b.location.reload():"DialogClose"===c.data&&(a.Msgbox.msgbox.close(),a.Event.unlisten(b,"message",f)))}var g=location.host.split(".");g.length>3&&(g=g.slice(-3));var h=0===location.host.indexOf("t"),i=x.PRODUCT_PRARM[c],j="v-gztest.mail.163.com",k="v.gztest.mail.163.com",l="v.mail.163.com",m="mail.163.com",n=[j,k,l,m],o="",p="";if("noAd"===c){var q=e||"noAd";return b.open("//mail.163.com/huodong/web/5fdb1505d605e84a6d118e2a.html?utm_source="+q,"_blank"),void 0}"overflow"===c&&(i="pay?goodsId="+d+"&type=104&typeGroup=1&frame=0&goodsName=overflow&fromDomain="+$S("fullDomain")),"gzy"===c&&$S("isVip")?(i=x.PRODUCT_PRARM.gzy,o="//v"+(h?"-gztest.":".")+"mail.163.com/pay?"+i+"&utm_source="+e):(i="overflow"===c?i:x.PRODUCT_PRARM.plus,o="//v"+(h?"-gztest.":".")+"mail.163.com/"+i+"&utm_source="+e+"&singleGoodsType="+x.PRODUCT_ID_NEW[c]),p='<iframe src="'+o+'" id="pure-advertisement" style="width:920px;height:675px;border:none;display:block"></iframe>',a.Msgbox.show({extcls:"gWel-pure-msgbox",noHeader:!0,noFooter:!0,content:p,width:"900px",height:"675px",contentType:"custom",close:function(){a.Msgbox.msgbox.hide()}}),a.Msgbox.msgbox.el.find(".nui-msgbox-close").hide(),a.Event.listen(b,"message",f)}function e(a,b){"cloudFile"!==a||b||(b="filebox_annex"),x.showDialog(a,null,b)}function f(b,c){var d=x.PRODUCT_PRARM[b];if(d){c=c||"mailjs6";var e=a.Uri.getUrl("privileges_buy")+d+"&utm_source="+c;try{var f=$L("interface.OutlinkInterface",this)}catch(g){return g}f.goOutlink({key:"privileges_buy",url:e,title:v.t("购买支付")})}}function g(b,c){switch(b){case"cloudFile":var d=a.Uri.getUrl("privileges_cloudFile")+"&op=get";a.Ajax.request({url:d,requestType:a.Ajax.XMLHTTP,method:a.Ajax.GET,call:function(b){try{var d=a.Eval.get(b.responseText);200==d.code&&c&&c(d.data.duration)}catch(e){}}});break;case"deleteRecovery":var e=$S("attrs").subcos.split(",");$S("is163")?a.Array.has(e,"166")?c&&c(!0):c&&c(!1):$S("is126")?a.Array.has(e,"419")?c&&c(!0):c&&c(!1):$S("isyeah")&&(a.Array.has(e,"681")?c&&c(!0):c&&c(!1))}}function h(a,b){return 0===b?"<strong>"+a+"</strong>"+v.t("元 "):"<strong>"+a+"</strong>"+v.t("元 ")+"/"+b+" "}function i(b,c){var d=c.goodsId,e=this,f=this.overflowConfig[b],g=v.t(f.title);v.t(f.goodsDesc);var h=v.t(f.helpText),i=v.t(f.helpText2),j=this.getReloginButton(),k=$S("uid"),l=(new Date).getTime(),m=c.expireTime?c.expireTime/36e5:0,n=c.payTime?a.Date.format(new Date(Number(c.payTime)),v.t("yyyy年MM月dd日 HH:mm")):"",o=0,p=this.getFlowConfig(),q=p.web;b===this.OVERFLOW_TYPE.DOWNLOAD?o=p.webrcv:b===this.OVERFLOW_TYPE.UPLOAD&&(o=p.websnd);var r=v.t(f.warningText).replace(/{UploadLimit}/g,o).replace(/{DownloadLimit}/g,o).replace(/{TotalLimit}/g,q).replace(/{Time}/g,n).replace(/{Hours}/g,m),s=['<div class="eg1">','<div class="gd1">','<span class="dj1"></span>','<span class="di1">'+k+r+"</span>",'<div class="ga2">','<div class="fZ2">'+h+"</div>",'<div class="fZ2">'+i+j.html()+"。</div>","</div>",'<span class="nui-clear"></span>',"</div>","</div>"].join("");a.Msgbox.show({extcls:"ls2",header:g,content:s,width:"510px",okText:v.t("加急解封"),cancelText:v.t("暂不处理，次日解封"),contentType:"custom",close:function(){e.log("PrivilegesOverflowDialogCloseClick"),e.hideAndLogTime("PrivilegesOverflowDialogShowTime",l)},cancel:function(){e.log("PrivilegesOverflowDialogCancelClick"),e.hideAndLogTime("PrivilegesOverflowDialogShowTime",l)},ok:function(){x.showDialog("overflow",d,"traffic"),e.log("PrivilegesOverflowDialogConfirmClick")}}),this.log("PrivilegesOverflowDialogShow")}function j(b,c){var d=this,e=this.overflowConfig[b],f=v.t(e.title),g=c.expireTime?c.expireTime/36e5:0,h=c.payTime?a.Date.format(new Date(Number(c.payTime)),v.t("yyyy年MM月dd日 HH:mm")):"",i=0,j=this.getFlowConfig(),k=j.web;b===this.OVERFLOW_TYPE.DOWNLOAD?i=j.webrcv:b===this.OVERFLOW_TYPE.UPLOAD&&(i=j.websnd);var l=v.t(e.warningTextOfFirstTime).replace(/{UploadLimit}/g,i).replace(/{DownloadLimit}/g,i).replace(/{TotalLimit}/g,k).replace(/{Time}/g,h).replace(/{Hours}/g,g),m=v.t(e.warningTextOfFirstTime2).replace(/{UploadLimit}/g,i).replace(/{DownloadLimit}/g,i).replace(/{TotalLimit}/g,k).replace(/{Time}/g,h).replace(/{Hours}/g,g),n=$S("uid"),o=(new Date).getTime(),p=['<div class="eg1">','<div class="gd1">','<span class="dj1"></span>','<p class="di1">'+n+l+"</p>",'<p class="di1" style="padding-top:10px;padding-left:64px;" >'+m+"</p>",'<span class="nui-clear"></span>',"</div>","</div>"].join("");a.Msgbox.show({extcls:"ls2",header:f,content:p,width:"486px",okText:v.t("知道了"),contentType:"custom",close:function(){d.log("PrivilegesFirstOverflowDialogCloseClick"),d.hideAndLogTime("PrivilegesFirstOverflowDialogShowTime",o)},ok:function(){d.log("PrivilegesFirstOverflowDialogOKClick"),d.hideAndLogTime("PrivilegesFirstOverflowDialogShowTime",o)}}),this.log("PrivilegesFirstOverflowDialogShow")}function k(b,c){var d=(new Date).getTime()-c;a.Msgbox.msgbox.hide(),this.log(b,d)}function l(){var b=this;return new a.Link({text:v.t("重新登录"),cls:"ed1 nui-txt-link",click:function(){a.Support.relogin(),b.log("PrivilegesOverflowDialogReloginClick")}})}function m(a){var b=this;b.tryResetOverLimit(function(c){var d=c.type;d&&d===y.firstTime?(b.showFirstOverflowDialog(b.OVERFLOW_TYPE.UPLOAD,c),a&&a()):d&&d===y.hasByIn24hour&&(b.showHasBuyIn24hourDialog(b.OVERFLOW_TYPE.UPLOAD,c),a&&a())},function(a){b.showOverFlowDialog(b.OVERFLOW_TYPE.UPLOAD,a)})}function n(a){var b=this;b.tryResetOverLimit(function(c){var d=c.type;d&&d===y.firstTime?(b.showFirstOverflowDialog(b.OVERFLOW_TYPE.DOWNLOAD,c),a&&a()):d&&d===y.hasByIn24hour&&(b.showHasBuyIn24hourDialog(b.OVERFLOW_TYPE.DOWNLOAD,c),a&&a())},function(a){b.showOverFlowDialog(b.OVERFLOW_TYPE.DOWNLOAD,a)})}function o(b,c){var d=this,e=this,f=this.overflowConfig[b],g=v.t(f.title),h=0,i=d.getFlowConfig(),j=i.web,k=c.expireTime?c.expireTime/36e5:0,l=c.payTime?a.Date.format(new Date(Number(c.payTime)),v.t("yyyy年MM月dd日 HH:mm")):"";b===d.OVERFLOW_TYPE.DOWNLOAD?h=i.webrcv:b===d.OVERFLOW_TYPE.UPLOAD&&(h=i.websnd);var m=v.t(f.warningTextOf24Hour).replace(/{UploadLimit}/g,h).replace(/{DownloadLimit}/g,h).replace(/{TotalLimit}/g,j).replace(/{Time}/g,l).replace(/{Hours}/g,k),n=v.t(f.warningTextOf24Hour2).replace(/{UploadLimit}/g,h).replace(/{DownloadLimit}/g,h).replace(/{TotalLimit}/g,j).replace(/{Time}/g,l).replace(/{Hours}/g,k),o=$S("uid"),p=(new Date).getTime(),q=['<div class="eg1">','<div class="gd1">','<span class="dj1"></span>','<p class="di1">'+o+m+"</p>",'<p class="di1" style="padding-top:10px;padding-left:64px;" >'+n+"</p>",'<span class="nui-clear"></span>',"</div>","</div>"].join("");a.Msgbox.show({extcls:"ls2",header:g,content:q,width:"510px",okText:v.t("知道了"),contentType:"custom",close:function(){e.log("PrivilegesIn24HoursDialogCloseClick"),e.hideAndLogTime("PrivilegesIn24HoursDialogShowTime",p)},ok:function(){e.log("PrivilegesIn24HoursDialogOKClick"),e.hideAndLogTime("PrivilegesIn24HoursDialogShowTime",p)}}),this.log("PrivilegesIn24HoursDialogShow")}function p(b,c){var d=this,e="//textapi.1.163.com/user-notify/api/flow-reset?utm_source=mailjs6&uid="+$S("orgUid"),f="//"+$S("fullDomain")+"/fgw/user-notify/api/flow-reset?utm_source=mailjs6&uid="+$S("orgUid"),g=location.hostname,h=/^[odt]\./g.test(g)?e:f;a.Browser.isIE("<10")?c&&c():a.Ajax.jsonp(h,function(e){var f=e;200===f.code?f.result&&d.isClearFlowSuccess(f.result)?b&&b(f.result):f.result&&f.result.type===y.fail&&c&&c(f.result):-1===f.code?a.Support.relogin():c&&c({goodsId:125})})}function q(a){return a.type===y.firstTime||a.type===y.hasByIn24hour}function r(a,b){var c=new XMLHttpRequest;c.open(a.method,a.url,!0),b&&(c.withCredentials=!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4===c.readyState&&a.call&&a.call(c)},c.send(this.serializeBody(a.body))}function s(){var b=$S("attrs").cos.pref_flow_limit,c={};return a.Array.each(b.split(","),function(a,b){var d=b.split(":"),e=d[0],f=Number(d[1]);c[e]=f}),c}function t(a){if("string"!=typeof a){var b=a,c=[];w.each(b,function(a,b){c.push(a+"="+encodeURIComponent(b))}),a=c.join("&")}return a}function u(b,c){var d={};d[b]="undefined"==typeof c?1:c,a.Log.cache(d)}var v=new $I18N("product.Privileges"),w=a.Object;a.Function,a.Array;var x=a.createClass($N("product.Privileges")),y={needAuth:-1,firstTime:1,hasByIn24hour:2,fail:3},z={FREE_OVERFLOW_GOODS_ID:126,PRODUCT_ID_NEW:{cloudFile:103,cloudFileCapacity:805,cloudFileDownSpeed:803,deleteRecovery:102,noAd:101,gzy:100,mailCapacity:800,receiverAmount:801,letterCateAmount:802,pptTemplate:500,wpCapacity:804,accountRepair:105,overflow:806},PRODUCT_PRARM:{plus:"pay?goodsId=209&type=3&typeGroup=0&frame=0&isPlusSelected=1",cloudFile:"&goodsId=25&type=103&typeGroup=1&frame=0",deleteRecovery:"&goodsId=120&type=102&typeGroup=1&frame=0",noAd:"&goodsId=104&type=101&typeGroup=1&frame=0",gzy:"goodsId=3&type=100&typeGroup=1&frame=0"},OVERFLOW_TYPE:{UPLOAD:1,DOWNLOAD:2},UNIT_KEY:{0:v.t("永久"),1:v.t("页"),2:v.t("月"),12:v.t("年")},overflowConfig:{1:{warningTextOfFirstTime:"当天上传流量超过 {UploadLimit}M 或下载上传总流量超过 {TotalLimit}M，被暂停上传功能。现在，我们已为您恢复正常使用。",warningTextOfFirstTime2:"请您注意上传的频次，若再次超标将被暂停使用，需等待 24 小时后解封或加急付费解封。",warningTextOf24Hour:"当前帐户的上传量已超过 {UploadLimit}M 或下载上传总流量超过 {TotalLimit}M，您已经于 {Time} 付费解限。",warningTextOf24Hour2:"此次解限在 {Hours} 小时内有效，若 {Hours} 小时后再次出现下上传量超过 {UploadLimit}M 或下载上传总流量超过 {TotalLimit}M，则需要再次付费解限。",title:"上传流量超过限制",warningText:"的上传流量已超过当天最大限制 {UploadLimit}M 或下载上传总流量超过 {TotalLimit}M，暂停上传功能。该帐号将于次日恢复上传功能的正常使用。",helpText:"如您急需恢复，请点击【加急解封】按钮。",helpText2:"如您已付费但解封暂未生效，请尝试点击"},2:{warningTextOfFirstTime:"当天下载流量超过 {DownloadLimit}M 或下载上传总流量超过 {TotalLimit}M，被暂停下载功能。现在，我们已为您恢复正常使用。",warningTextOfFirstTime2:"请您注意下载的频次，若再次超标将被暂停使用，需等待 24 小时后解封或加急付费解封。",warningTextOf24Hour:"当前帐户的下载量已超过 {DownloadLimit}M 或下载上传总流量超过 {TotalLimit}M，您已经于 {Time} 付费解限。",warningTextOf24Hour2:"此次解限在 {Hours} 小时内有效，若 {Hours} 小时后再次出现下载量超过 {DownloadLimit}M 或下载上传总流量超过 {TotalLimit}M，则需要再次付费解限。",title:"下载流量超过限制",warningText:"的下载流量已超过当天最大限制 {DownloadLimit}M 或下载上传总流量超过 {TotalLimit}M，暂停下载功能。该帐号将于次日恢复下载功能的正常使用。",helpText:"如您急需恢复，请点击【加急解封】按钮。",helpText2:"如您已付费但解封暂未生效，请尝试点击"}},showProduct:e,_noAdShow:c,showDialog:d,getProductStatue:g,_goBuy:f,parsePrice:h,getReloginButton:l,showFirstOverflowDialog:j,showUploadOverflowDialog:m,showOverFlowDialog:i,showDownloadOverflowDialog:n,showHasBuyIn24hourDialog:o,log:u,hideAndLogTime:k,tryResetOverLimit:p,serializeBody:t,request:r,getFlowConfig:s,isClearFlowSuccess:q};a.Object.extend(x,z)}($,window),function(a){function b(a){var b=h.getModule();if(b&&b.name.indexOf("contact.ContactModule")>=0)b.cache("welcome",a);else{var c=i.get("contact.ContactModule");c?(i.go({module:"contact.ContactModule",param:{}}),c.cache("welcome",a)):i.go({module:"contact.ContactModule",param:{},__other:a})}}function c(a){var b=this;a&&b.entry({action:a})}function d(a){var b=this;if(a){var c=h.getModule()||{},d={action:"Search",key:a};return c.name&&c.name.indexOf("contact.ContactModule")>=0?(c.entryCall(d),void 0):(b.entry(d),void 0)}}function e(a){var b=this,c=h.getModule()||{},d={action:a.id?"Modify":"Add",id:a.id,data:a?{FN:a.name||"",N:";"+(a.name||"")+";;;",NICKNAME:a.nickname||"","EMAIL;PREF":a.email||"","TEL;type=CELL;type=VOICE;type=pref":a.phone||"",GROUPING:a.grouping||""}:null};return"contact.ContactModule"===c.name?(c.entryCall(d),void 0):(b.entry(d),void 0)}function f(a){if(a){var b=i.find("contact.ContactModule_0");b&&b.action.reflash({call:function(){j.update(),j.getModule(b);try{b.emptyAddList()}catch(a){}}})}}function g(a){try{h.getModule().response.mergeResponse(a)}catch(b){}}var h=a.Context,i=a.JS,j=a.Nav,k=a.Object,l=a.createClass($N("interface.AddressInterface"));k.extend(l,{entry:b,directEntry:c,search:d,contactModify:e,contactRefresh:f,mergeCall:g})}($,window),function(a,b){function c(b){var c="t2";$S("isVip")&&(c="recommend_app");var d=a.Array.findObject($G.get("multiTabConf"),"tabid",c)||{},e={};b&&b.showinfo&&(e.showinfo=b.showinfo),b&&b.name&&(d.name=b.name);try{var f=$L("interface.OutlinkInterface",this)}catch(g){return g}f.goOutlink({key:d.name,title:d.text,fullScreen:d.fullScreen,group:d.group,param:e})}function d(a){this.entry({showinfo:a})}function e(b){function c(b){var c=a.AppManager.getApp(b),e=c&&c.display;$S("isVip")&&(e=!a.Object.isEmpty(c)),e?a.AppManager.startApp(b):d.entryAndShowApp(b)}var d=this;if(a.Object.isObject(b)){var e=b,f=e.key,g=e.title,h=e.url;if(g&&h){try{var i=$L("interface.OutlinkInterface",this)}catch(j){return j}i.goOutlink(e)}else c(f)}else c(b)}function f(a){a=a||{},a.name="msgcenter",a.text=j.t("消息中心");var b=a.param||{};a&&a.sysMsg&&(b.msgType="sysMsg");try{var c=$L("interface.OutlinkInterface",this)}catch(d){return d}c.goOutlink({key:a.name,title:a.text,fullScreen:!0,param:b})}function g(c){var d=c.url||c.id,e={};if(c.newWindow){var f=a.Uri.getUrl(d);return f&&b.open(f),void 0}try{var g=$L("interface.OutlinkInterface",this)}catch(h){return h}var i={key:d,title:c.name,fullScreen:!0,param:e};c.isBeta&&(i.isBeta=!0),g.goOutlink(i)}function h(){var a=b.location.host;return a.indexOf("o.mail")>-1||a.indexOf("d.mail")>-1?62001:152e3}function i(a,b){var c=this;c.gotoApp({key:c.appIdForYiqipin(),title:j.t("一起拼"),url:b&&b.indexOf("https://")>-1?b:"https://pin.mail.163.com?utm_source=webmail&utm_medium="+a,fullScreen:!0,appId:c.appIdForYiqipin()})}var j=new $I18N("interface.AppCenterInterface"),k=a.createClass($N("interface.AppCenterInterface"));a.AppCenterInterface=k,a.Object.extend(k,{entry:c,entryAndShowApp:d,gotoApp:e,gotoCorpApp:g,goMsgCenter:f,gotoYiqipin:i,appIdForYiqipin:h})}($,window),function(a,b,c){function d(a){try{var b=$L("interface.ComposeInterface",this)}catch(c){return c}b.entry(a)}function e(a){var b="ifrmMusic";u._setBox(a,b)}function f(b){var c=b&&b.url||"https://music.163.com/musicbox?ref=mail#https://"+$S("host")+"/proxy.htm",d="music_outlink";try{var e=$L("interface.OutlinkInterface",this)}catch(f){return f}e.goOutlink({key:d,title:t.t("网易云音乐"),url:c,fullScreen:!0,group:d,removeSameModule:!0}),a.Log.cache({topNav_musicPlugin_click:1})}function g(a){var b="ifrmVipMsgCenter";u._setBox(a,b)}function h(b){try{var c=$L("interface.OutlinkInterface",this)}catch(d){return d}c.goOutlink({key:b,title:t.t("消息中心"),fullScreen:!0,group:"vipMsgCenter"}),a.Log.cache({topNav_vipMsgCenter_click:b})}function i(a){var b="ifrmMailMaster";u._setBox(a,b)}function j(a){u._previewImages(a.images)}function k(b){var c=this;b=b||{};var d=b.call;a.fly(document).listen("click",function(){d&&d(),c.changeIframeIndex(!0,!0)}),a.Listener.fire("plugin:mailmaster_photouploader_loaded")}function l(c){c=c||{};var d=c.images,e="dvIfrmMailMasterWrapper",f=a("#"+e);d&&d.length>0?(delete c.images,b.gAppInterface_MailMaster_ImageIndex=0,b.gAppInterface_MailMaster_ImageIntervel&&b.clearInterval(b.gAppInterface_MailMaster_ImageIntervel),1===d.length?f.css({background:d[b.gAppInterface_MailMaster_ImageIndex]}):b.gAppInterface_MailMaster_ImageIntervel=b.setInterval(function(){b.gAppInterface_MailMaster_ImageIndex++,b.gAppInterface_MailMaster_ImageIndex===d.length&&(b.gAppInterface_MailMaster_ImageIndex=0),f.css({background:d[b.gAppInterface_MailMaster_ImageIndex]})},400)):b.gAppInterface_MailMaster_ImageIntervel&&b.clearInterval(b.gAppInterface_MailMaster_ImageIntervel),c.cursor||(c.cursor="pointer"),c.zIndex&&c.zIndex>0?(this.changeIframeIndex(!0),delete c.zIndex):this.changeIframeIndex(!1),f.css(c)}function m(b,c){var d="dvIfrmMailMasterWrapper",e="cachedvIfrmMailMasterWrapper",f=$S(e);if(!f){if(f=a("#"+d),!f)return;$S(e,f.findParent("li"))}if(b){var g=$S("ifrmMailMasterTop");if(!g&&!c){var h=a("#ifrmMailMaster");h&&h.css({top:"-15px"}),$S("ifrmMailMasterTop",!0)}f.addClass("hj1")}else f.removeClass("hj1")}function n(){$S("accountMenu")&&$S("accountMenu").hide(),a.Menu&&a.Menu.hideAllMenu(),this.changeIframeIndex(!1),a.Log.cache({topNav_mailmaster_photoloader_click:!0})}function o(b,c){var d=(b.height||20)+"px",e=(b.width||20)+"px",f=c,g=a("#"+f),h={height:d,width:e};if(b.left&&a.Object.isNumber(parseInt(b.left,10))){var i=b.left+"px";h.left=i}a.Browser.chrome()&&"$.AppInterface.cloudmusic.setMusicBox"===b.xcall&&(h.width=Math.max(parseInt(b.width),392)+"px"),g.css(h)}function p(a){var b=r,c=new b;a=a||{};var d=a.call,e=a.wmsvrData;if(d&&e){var f=function(a){d(a)},g=function(){};e.call=f,e.error=g,c.wmsvr(e)}}function q(d){var e=this,f=b.Preview;return d=d||[],0!==d.length?f?(f.init({mustArr:!1,data:d}),void 0):(a.Ajax.request({requestType:a.Ajax.SCRIPT,url:"https://mimg.127.net/xm/all2/preview/preview-1.6.min.js",call:function(){b.Preview!==c&&e._previewImages(d)}}),void 0):void 0}try{var r=$L("core.DataAction")}catch(s){return s}var t=new $I18N("interface.AppInterface"),u=a.createClass($N("interface.AppInterface"));a.AppInterface=u,a.Object.extend(u,{meitu:{compose:d},cloudmusic:{setMusicBox:e,goMusicBox:f},vipMsgCenter:{setBox:g,gotoPage:h},mailmaster:{setBox:i,bodyClick:k,setWrapperStyle:l,changeIframeIndex:m,previewImages:j,frameClick:n},bridge:{wmsvr:p},_previewImages:q,_setBox:o})}($,window),function(a){function b(a){try{var b=$L("module.compose.ComposeManager",this)}catch(c){return c}b.entry(a)}function c(a,b){var c=this;c.entry({type:"reply",param:a,history:b})}function d(a,b){var c=this;c.entry({type:"forward",param:a,history:b})}function e(a){var b=this;if(a&&a.folderData&&a.folderData.flags&&a.folderData.flags.locked){try{var c=$L("product.MailUnlock",this)}catch(d){return d}c.unlockMail(function(){b.entry({type:"draft",param:a})},function(){})}else b.entry({type:"draft",param:a})}function f(a,b){var c=this;c.entry({type:"edit",param:a,history:b})}function g(){var b=a.Context.module;b&&b.mtype&&"compose.ComposeModule"==b.mtype&&b.base.connectBreak()}function h(){var b=a.Context.module;b&&b.mtype&&"compose.ComposeModule"==b.mtype&&b.base.sessionBreak()}function i(b,c,d){var e=a.Context.module;e&&e.mtype&&"compose.ComposeModule"==e.mtype&&e[b][c](d)}function j(a){try{var b=$L("module.compose.ComposeManager",this)}catch(c){return c}b.quickReply(a)}function k(a){try{var b=$L("module.compose.ComposeManager",this)}catch(c){return c}b.quickForward(a)}var l=a.Object,m=a.createClass($N("interface.ComposeInterface"));l.extend(m,{compose:b,entry:b,reply:c,forward:d,draft:e,edit:f,connectBreak:g,sessionBreak:h,currentCall:i,quickReply:j,quickForward:k})}($,window),function(a){function b(b){"string"==typeof b&&(b={type:b}),b.section="mailcenter";var c=a.JS.get("options.AccountCenterModule",{});if(c)try{c._var.extra=b}catch(d){}a.JS.go({module:"options.AccountCenterModule",param:{},extra:b})}function c(b){"string"==typeof b&&(b={type:b});var c=a.JS.get("options.AccountCenterModule",{});if(c)try{c._var.extra=b}catch(d){}a.JS.go({module:"options.AccountCenterModule",param:{},extra:b,reset:!1})}var d=a.createClass($N("interface.MailCenterInterface"));a.Object.extend(d,{entry:b,related:c})}($,window),function(a,b,c){function d(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.data;d.flags.read^a.isRead&&(a.data=[d],b.setRead(a)),$S("lastRead",d.id)}function e(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}a.data.label0^a.flag&&(a.data=[a.data],b.setFlag(a))}function f(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.data.tag,e=a.tag,f=!1;f=a.isAdd?!(d&&E.has(d,e)):!e||d&&E.has(d,e),f&&(a.data=[a.data],b.setTag(a))}function g(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.type,e=a.defer,f=!1;switch(d){case"add":case"modify":f=!!e;break;case"complete":case"delete":f=!0}f&&(a.data=[a.data],b.setDefer(a))}function h(a){try{var b=$L("module.mbox.ListModule",this)}catch(c){return c}var d=a.isTop,e=a.data;!!d^!!e.flags.top&&(a.data=[e],b.setTop(a))}function i(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.memo,e=a.data;e.memo!==d&&b.setMemo({memo:d,data:[e]})}function j(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.ruleConditions,e=a.fids,f=a.attrs,g=a.callback;b.setFilter({ruleConditions:d,fids:e,attrs:f,callback:g})}function k(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=$I("init.Thread"),e=a.fid,f=d.check(e);b.setAllRead({area:"normal",body:{search:{fid:e,filter:{flags:{read:!1}}},action:{flags:{read:!0}},isThread:f}})}function l(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}var d=a.data,e=a.moveToId;d.fid!==e&&(a.data=[d],b.move(a))}function m(a){try{var b=$L("module.mbox.MboxModule",this)}catch(c){return c}a.isSpam;var d=a.data;a.data=[d],b.setSpam(a)}function n(a,b){$S("refw")||$S("refw",{});var c={};$S("refw")[a]?c=$S("refw")[a]:$S("refw")[a]=c,c[b]=!0}function o(b,c){if(b&&c?($S("brandAd",b),$S("brandData",c)):(b=$S("brandAd"),c=$S("brandData")),b&&c)try{setTimeout(function(){a.Context.getModule().initBrand&&a.Context.getModule().initBrand()},0)}catch(d){}else a.Ajax.jsonp("https://mimg.127.net/m/subs/brands_"+$G.environment.domain.split(".")[0]+".js")}function p(a,b,c){try{var d=b&&"search"===b.type?"SearchAction":"ListAction",e=$L("module.mbox."+d,this)}catch(f){return f}(new e).getList(a,b,c)}function q(b){function c(){function a(){var a,c;c=Math.floor(d/p),r&&(a=c-1),s&&(a=c+1),k.autoGetData(a,b)}function b(){c=k.data;var a={pos:d};if(!i&&d>0){var b=D.clone(m),g=d-1;b.index=Math.floor(g/p),a.pre={moduleName:k.name,moduleParam:l,moduleExtend:b,folderData:c[g]}}if(!j&&f-1>d){var h=D.clone(m),n=d+1;h.index=Math.floor(n/p),a.next={moduleName:k.name,moduleParam:l,moduleExtend:h,folderData:c[n]}}e(a)}if(k&&k.data){for(var c=k.data,d=-1,f=k.getTotal(),g=0,n=c.length;n>g;g++){var q=c[g];if(q&&q.id===o){d=g;break}}if(d>-1){var r,s;!i&&d>0&&!c[d-1]&&(r=!0),!j&&f-1>d&&!c[d+1]&&(s=!0),r||s?a():b()}else h()}else h()}function d(){function a(){var a,c;c=Math.floor(f/p),s&&(a=c-1),t&&(a=c+1),k.autoGetData(a,b)}function b(){var a=k.result["var"],b={pos:f};if(!i&&f>0){var c=D.clone(m),d=f-1;c.index=Math.floor(d/p),b.pre={moduleName:k.name,moduleParam:l,moduleExtend:c,folderData:a[d]}}if(!j&&g-1>f){var h=D.clone(m),n=f+1;h.index=Math.floor(n/p),b.next={moduleName:k.name,moduleParam:l,moduleExtend:h,folderData:a[n]}}e(b)}var c=k.result;if(k&&c){for(var d=c["var"],f=-1,g=d.length,n=0,q=g;q>n;n++){var r=d[n];if(r===o||r.id===o){f=n;break}}if(f>-1){var s,t;!i&&f>0&&"string"==typeof d[f-1]&&(s=!0),!j&&g-1>f&&"string"==typeof d[f+1]&&(t=!0),s||t?a():b()}else h()}else h()}function e(a){function b(a){a.pre&&a.pre.folderData.fid!==e?F.getPosition({moduleName:f,data:a.pre.folderData,voidNext:!0,callback:function(b){a.pre=b.pre,c(a)}}):c(a)}function c(a){a.next&&a.next.folderData.fid!==e?F.getPosition({moduleName:f,data:a.next.folderData,voidPre:!0,callback:function(b){a.next=b.next,d(a)}}):d(a)}function d(a){h(a)}var e=k.param("fid");"folder"===k.extend("subtype")&&(k.extend("forceReplace")||k.extend("forceRequest")||k.extend("forcePage"))?b(a):d(a)}var f=b.moduleName,g=b.data,h=b.callback,i=b.voidPre,j=b.voidNext,k=a.JS.find(f);if(!k)return h(),void 0;var l=D.clone(k.param()),m=D.clone(k.extend()),n=k.extend("type"),o=g.id,p=m.limit;"search"===n?d():c()}function r(a){function b(a){h(a)}function c(a){return h(null,a),!0}try{var d=$L("module.mbox.MboxModule",this)}catch(e){return e}var f=a.mid,g=a.isThread,h=a.callback;d.action.getLetterInfo({id:f,isThread:g,callback:b,error:c})}function s(a){try{var b=$L("module.mbox.Letter",this)}catch(c){return c}var d=new b(null,a);return d.getSendLogo(a)}function t(b,c){var d=b.action,e=b.value,f=!1;switch(d){case"read":f=c.flags.read!==e,c.flags.read=e;break;case"flag":f=c.label0!==e,c.label0=e;break;case"tag":var g=b.isAdd,h=e,i=c.tag;
if(g)i||(c.tag=i=[]),a.Array.has(i,h)||(i.push(h),f=!0);else if(h){for(var j=0,k=i.length;k>j;j++)if(i[j]===h){i.splice(j,1),f=!0;break}}else c.tag=i=[],f=!0;break;case"defer":f=c.flags.deferHandle!==e.deferHandle,c.flags.deferHandle=!!e.defer,e.deferHandle!==!1&&(f=f||c.defer!==e.defer||c.memo!==e.memo,c.defer=e.defer,c.memo=e.memo);break;case"memo":f=c.memo!==e,c.memo=e;break;case"top":f=c.flags.top!==e,c.flags.top=e;break;case"move":f=c.fid!==e,c.fid=e}return f}function u(){var a=$I("init.Folder").getFids();this.entry({fids:a,order:"deferredDate",desc:!1,filter:{defer:"19700101:"}},{type:"list",subtype:"defer"})}function v(a,b){if(a){var c;if(c="string"==typeof a?a:$I("init.Contacts").parseEmail(a)){b||(b={});var d={filter:{}},e=d.filter;if("from"===b.type)e.fromAddress=c;else if("to"===b.type){var f=$I("init.SenderList").getList(),g=[];E.each(f,function(a,b){g.push(b.address)}),e.fromAddress=g.join(),e.toAddress=c}else e.chatWithAddress=c;b.read===!1&&(e.flags={read:!1}),b.from&&(d.from=b.from),b.cid&&(d.cid=b.cid),this.entry(d,{type:"list",subtype:"contacts",systemContacts:b.systemContacts})}}}function w(){var a=[],b={};try{for(var d=$I("support.AddressSupport").getMarkData(),e=d.contact,f=0,g=e.length;g>f;f++){var h=e[f];if("group"!==h.ctype){var i=h.emails?h.emails:h.email?[h.email]:c;if(i)for(var j=0,k=i.length;k>j;j++){var l=i[j].toLowerCase();b[l]||(a.push(l),b[l]=!0)}}}}catch(m){}this.entry({filter:{chatWithAddress:a.join()||"",flags:{read:!1}},order:"from"})}function x(b){if(a.Ext.smart){var c,d=$I("init.Tag"),e=[];if(b)c=d.get(b,"smart",!0),c&&e.push(c.name);else for(var f in d.smarts)c=d.get(f,"smart",!0),c&&e.push(c.name);e.length>0&&this.entry({tag:e})}}function y(a){try{var b=$L("module.mbox.Field",this)}catch(c){return c}$I("init.Folder");var d=a.isFullSearch,e=a.isForceFullSearch,f=a.keyword,g={};if(e&&$S("_preSearchAllCount",null),d&&!e){var h=$I("init.Folder").total.messageCount,i=$S("searchIndexed");if(i>=0)try{.9>i/h&&(d=!1)}catch(c){}!$S("isCorp")&&!$S("isVip")&&h>48e3&&(d=!1),f.indexOf("@")>-1&&(d=!1)}d?(g.pattern=f,g["fts.ext"]=!0,g["fts.fields"]=b.getField(),g.groupings={fromAddress:"",fid:"",sentDate:"","flags.attached":"","flags.read":""}):(g.operator="or",g.conditions=[{field:"subject",operator:"contains",ignoreCase:!0,operand:f},{field:"from",operator:"contains",ignoreCase:!0,operand:f},{field:"to",operator:"contains",ignoreCase:!0,operand:f}]),this.entry(g,{viewLayout:"full"})}function z(a){var b={};b.conditions=[{field:"subject",operator:"contains",operand:a,ignoreCase:!0}],this.entry(b)}function A(b,d,e){var f=b.fid,g=b.tag,h=b.filter,i=h?h.flags:c,j=d.subtype;if(!j){var j;b.fid>0?j="folder":b.fids&&(g?j="tag":h&&(h.defer?j="defer":"string"==typeof h.fromAddress||"string"==typeof h.chatWithAddress||"string"==typeof h.toAddress?j="date"!==b.order?"emails":"contacts":D.has(h,"label0")?j="flag":h.sentDate?j="calendar":i&&D.has(i,"read")&&(j="read"),j||(j="filter"))),j&&(d.subtype=j)}var k=!1;if(a.Ext.brand)if("folder"===j)18===b.fid&&(k=!0);else if("tag"===j){var l=$I("init.Tag").get(b.tag[0],"brand");l&&(k=!0)}d.brand=k;var m=!1;if(a.Ext.smart&&"tag"===j){var l=$I("init.Tag").get(b.tag[0],"smart");l&&(m=!0)}d.smart=m;var n=!1;if(a.Ext.defer&&"folder"===j){var o=d.area,p=$I("init.Defer");"archive"!==o&&p.showTop(f)&&(n=!0)}d.expire=n;var q;q=i&&D.has(i,"read")?i.read:c,d.read=q;var r;r=h&&D.has(h,"label0")?h.label0:c,d.flag=r,$E("module.mbox.ListModule",function(a){if(!d.calendar){var c;if(h&&D.has(h,"sentDate")){var f=h.sentDate.split(":"),g=(a.parseSentDate(f[1]).getTime()-a.parseSentDate(f[0]).getTime())/1e3/60/60/24;c=0===g?"date":6===g?"week":"month"}d.calendar=c}a.entry(b,d,e)})}function B(a,b,c){b.subtype||(b.subtype=a.pattern?"full":"normal"),$E("module.mbox.SearchModule",function(d){d.entry(a,b,c)})}function C(b,c,d){var e=this;b||(b={});var f,g=!1;b.conditions||b.pattern||b.operator?(f="search",g=!0):f="list";var h,i=b.moduleName;i&&(h=a.JS.find(i)),h||!b||c||(h=a.JS.get("mbox."+(g?"SearchModule":"ListModule"),b)),h&&(b=h.param(),c=h.extend(),c.moduleName=h.name),c||(c={}),c.type||(c.type=f),b.order||(b.order="date"),"undefined"==typeof b.desc&&(b.desc="date"===b.order?!0:!1),b.desc=b.desc?!0:!1,c.index||(c.index=0);var j=$S("attrs").user.maxlist;if(a.Ext.limit_max){var k=20;j>k&&(j=k)}if(j!==c.limit&&(c.limit=j),!c.area){var l;switch(!b.mboxa&&a.Ext.archive&&g&&(b.mboxa="0"),b.mboxa){case"0":l="all";break;case"2":l="archive";break;default:l="normal"}c.area=l}if(!b.fid){var m=b.fids;if(!m){var n=c.exceptFids;n||(n=g?[4]:$G.common.unnormalids),m=$I("init.Folder").getFids(n),b.fids=m}}if(g?(c.viewLayout="full",e.search(b,c,d)):e.list(b,c,d),c.receive){var o=$I("init.Sync");o.request(),$E("support.MailCenter",function(a){a.receiveAll()}),delete c.receive}3===b.fid&&$I("init.Sent").reset()}new $I18N("interface.MboxInterface");var D=a.Object,E=a.Array,F=a.createClass($N("interface.MboxInterface"));D.extend(F,{setRead:d,setFlag:e,setTag:f,setDefer:g,setTop:h,setMemo:i,setFilter:j,setAllRead:k,move:l,setSpam:m,setReFw:n,brandLoad:o,getList:p,getPosition:q,getLetterData:r,getSendInfo:s,syncData:t,defer:u,contacts:v,emails:w,smarts:x,find:y,title:z,list:A,search:B,entry:C})}($,window),function(){function a(a){$E(["module.options.MailFilterModule"],function(b){b.checkOverLimit(a)})}function b(a){try{var b=$L("module.options.NavConf",this);$L("util.MD5",this)}catch(c){return c}var d,e=typeof a,f=b.oldModConfig.subModules;if("string"==e){if(a.indexOf("optionOutLink.")>=0||a.indexOf("LinkModule.")>=0){var g=a.replace("optionOutLink.","").replace("LinkModule.","");a={linkName:g}}else if(d=a,"options.MainModule"==d||"MainModule"==d?d="BaseSetModule":("options.AccountManage"==d||"AccountManage"==d)&&(d="AccountManageModule"),a=arguments.length>1?arguments[1]:{},d.indexOf("#")>=0){var h=d.split("#");if(d=h[0],h.length>1){h=h[1].split("&");for(var i,j=0,k=h.length;k>j;j++)i=h[j].split("="),a[i[0]]=i[1]}}}else"undefined"==e?d="BaseSetModule":(d=a.module,delete a.module);if(a&&a.link&&(a.subModName=d,d="LinkModule"),a&&a.linkName){var l=a.linkName;delete a.linkName;var m=l.split("#");if(a.subModName=m[0],m.length>1&&(a.linkext=m[1]),!f[a.subModName])for(var n in f)if(f[n].link&&f[n].link==a.subModName){a.subModName=n;break}f[a.subModName]&&(a.link=f[a.subModName].link),d="LinkModule"}d.indexOf(".")<0&&(d="options."+d);var o;a&&"exit"in a&&(o=a.exit,delete a.exit),$.Listener.fire("option:entry",{sModuleName:d}),$.JS.go({module:d,param:a,exit:o})}function c(a){$E(["module.options.RecommendSignlist"],function(b){b.show(a)})}function d(a){var b=7;"js6"==a&&(b=7),("jy6"==a||"jy6s"==a)&&(b=6),"jy3"==a&&(b=10),"js4"==a&&(b=8),"js5"==a&&(b=5),"qn"==a&&(b=2);var c=function(){if("student"===$G.mailPattern.currentPattern){var b=window;if("js6"==a){var c=b.location.href+"&rnd="+Math.random();c=c.replace("df=qingning",""),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}}else var b=top;if("jy3"==a){var c=b.location.href+"&rnd="+Math.random();c=c.replace("js6/main.jsp","jy3/main.jsp"),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}else if("js4"==a){var c=b.location.href+"&rnd="+Math.random();c=c.replace("js6/main.jsp","js4/main.jsp"),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}else if("jy6"==a||"jy6s"==a){var d="jy6s"==a?b.location.href.replace(/http[s]?:\/\/[a-z0-9A-Z\.]*mail\./,"https://ssl.mail."):b.location.href.replace(/https:/,"http:"),c=d+"&rnd="+Math.random();c=c.replace("js6/main.jsp","jy6/main.jsp"),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}else if("js5"==a){var c=b.location.href+"&rnd="+Math.random();c=c.replace("js6/main.jsp","js5/main.jsp"),top.location.href=c.replace(/rnd=.+/,"rnd="+Math.random())}else if("qn"==a){var c="//18.mail.163.com/login.do?from=mailin&sid="+$S("sid");top.location.href=c}};(new k).wmsvr({func:"user:changeStyle",body:{style:b,language:parseInt($S("attrs").user.langauge,0)||0},call:c})}function e(a){var b;if("string"==typeof a)b={link:a};else{if("object"!=typeof a)return;b=a,b.link=b.url}$.JS.go({module:"options.LinkModule",param:b})}function f(a){a?(a.type="edit",a.id&&(a.type="modify")):a={type:"list"};var b=l.getModule();b&&"options.MailFilterModule"==b.name?b.nav(a):$.JS.go({module:"options.MailFilterModule",param:a})}function g(){var a=l.getModule();a&&"options.MailFilterModule"==a.name&&a.resetDependPart()}function h(a){$.JS.go({module:"options.SearchModule",param:{type:a}})}function i(){window.open("https://reg.163.com/setinfo/ChangePwd_1.jsp")}function j(a){"string"==typeof a&&(a={type:a});var b="options.AccountCenterModule",c=$.JS.get(b,{});if(c)try{c._var.extra=a}catch(d){}$.JS.go({module:b,param:{},extra:a,reset:!1})}var k=$I("core.DataAction"),l=$.Context,m=$.createClass($N("interface.OptionInterface"));$.Object.extend(m,{entry:b,showSignList:c,changeStyle:d,goOutlink:e,goFilter:f,refreshFilter:g,goSearch:h,checkFilterLimit:a,changePassword:i,related:j})}(),function(a,b){function c(c){var d=this;if("apps_blog"===c.key)return b.open(c.url),void 0;if("apps_shop"===c.key)return b.open(c.url),void 0;if("nf_center"===c.key&&(!c.group||"nf_center"===c.group)){try{var e=$L("product.FileCenter",this)}catch(f){return f}return e.entry("nf_center"),c.url&&(c.url+="&redirect=false&retype=0",a.Ajax.request({requestType:a.Ajax.IFRAME,url:c.url})),void 0}try{$L("module.outlink.OutlinkModule",this)}catch(f){return f}c.url&&c.url.indexOf("$")>-1&&(c.url=a.Uri.getUrl(c.url,!0));var g={module:"outlink.OutlinkModule",param:c,useParam:{key:!0,url:!0,cross:!0}};g.call=function(b){if(b.container){if(c.group&&c.removeSameModule){var e=d._groupModuleMap[c.group];e&&e.name!==b.name&&a.JS.remove(e)}c.group&&(d._groupModuleMap[c.group]=b)}},a.JS.go(g);var h=a.Context.getModule();if(c._call&&c._call(h),"weibo"===c.key)try{var i=a("#spnDockNew"),k=a("#dvDock").find("#dvNew_22");i&&i.hide(),k&&k.hide();var l=(a.Component.find("$title$"+j.t("邮箱应用"))||[])[0];l&&l.getEl().find(".nui-tabs-item-status").hide(),a.Cookie.set("checkWeibo","1",{path:"/",domain:$S("fullDomain"),expires:new Date((new Date).valueOf()+3e5)})}catch(f){}}function d(c){var d=this;if(c.lockid){var e=$S("advLock");if(e[c.lockid]&&!e.authenticated2){var f={};return a.Object.extend(f,c),delete f.lockid,a.AdvLock.show(a.Function.bind(k.goOutlink,k,f)),void 0}}var g,i=!1,l=$G.get("uriConf"),m=l.free;if($S("isVip")){var n=a.AppManager.getAppsList(),o=a.Array.findObject(n,"name",c.key);if(!$S("AppDataPrepared")&&!d._waitingDataComeback)return d._waitingDataComeback=!0,b.setTimeout(function(){d.goOutlink(c)},1e3),void 0;o&&o.url&&"nf_center"!==o.name&&(g=o.url,i=!0),o&&"music_outlink"===o.name&&(c.url=o.name,i=!1,c.title=j.t("网易云音乐")),m=l.vip}var p=c.key+""||"outlink",q=$Fix.titlesFix&&$Fix.titlesFix[p]||c.title||(l.all[p]||m[p]||l[$S("domain")]&&l[$S("domain")][p]||[])[1]||j.t("其它"),r=(c.listen,c.param);i?g=a.Uri.getUrl(g):(c.url&&c.url.indexOf("$")>-1&&(c.url=a.Uri.getUrl(c.url,!0)),g=c.url||a.Uri.getUrl(p)),-1===g.indexOf("http")&&"about:blank"!=g&&(g=a.Uri.getUrl(g));var s=!1,t=c.isAppCenter;if(c.appId===a.AppCenterInterface.appIdForYiqipin()&&(t=!1),t&&c.isAppCenter&&-1===g.indexOf("appgo.do?")){if(!g){var n=h.getAppsList(),o=a.Array.findObject(n,"id",c.appId);o&&(g=o.url),g&&-1!==g.indexOf("http")||(g="")}var u="https:";0===g.indexOf("http://")&&(u="http:");var v=u+"//"+$S("host")+"/appcenter/appgo.do?sid="+$S("sid");$S("isyeah")&&(v=u+"//appcenter.mail."+$S("domain")+"/appgo.do?sid="+$S("sid")),g=v+"&func="+"mapp:appgo"+"&appId="+c.appId+"&url="+encodeURIComponent(g),r&&r.log||(r=r||{},r.log=JSON.stringify({AppCenter_AppId:c.appId,uid:$S("uid")})),("23004"==c.appId+""||c.title===j.t("斗地主"))&&(s=!0)}if(r&&(g=a.Location.addParam(r,g)),$S("isVip")&&"recommend_app"===p&&(c.group="appMoudle"),"https:"===location.protocol&&0===g.indexOf("http://"))return b.open(g),void 0;var w={url:g,key:p,title:q,group:c.group,cross:c.cross,fullScreen:c.fullScreen,isAppCenter:c.isAppCenter,appId:c.appId,pureUrl:c.pureUrl,showDefTree:c.showDefTree,_call:function(a){c.call&&c.call(a)}};s&&(w.hideDock=!0),c.removeSameModule&&(w.removeSameModule=!0),c.isBeta&&(w.isBeta=!0),k.entry(w)}function e(b){if(b){var c=b.substr(3),d=a.JS.find(c);if(d)return d.frame}}function f(a){try{return netease.mail.js6.module.outlink.OutlinkModule.modules[a]}catch(b){return!1}}function g(b){var c=this;try{b=b.replace(/'/g,'"');var d=a.Misc.parseJson(b);c.goOutlink(d)}catch(e){}}try{var h=$L("init.CustomAppManager")}catch(i){return i}var j=new $I18N("interface.OutlinkInterface"),k=a.createClass($N("interface.OutlinkInterface"));a.Object.extend(k,{entry:c,goOutlink:d,getFrame:e,getModule:f,edmLink:g,_groupModuleMap:{}})}($,window),function(a,b,c){function d(b){var d,e,f,g,h,i,j,k,l,m=this;if("string"==typeof b&&(b={id:b}),"mid"in b&&(b.id=b.mid,delete b.mid),"moduleName"in b&&(d=b.moduleName,delete b.moduleName),"moduleParam"in b&&(e=b.moduleParam,delete b.moduleParam),"moduleExtend"in b&&(f=b.moduleExtend,b.area=f.area,delete b.moduleExtend),"isRead"in b&&(l=b.isRead,delete b.isRead),"call"in b&&(i=b.call,delete b.call),"hiddenCall"in b&&(k=b.hiddenCall,delete b.hiddenCall),b.hidden&&(j=b.hidden,delete b.hidden),g=b.group,h=b.folderData,delete b.folderData,h!==c&&(b.id=b.id||h.id,b.fid=b.fid||h.fid,h.flags&&(b.locked=h.flags.locked)),j||$S("lastRead",b.id),b.isThread)if(b.viewType)a.SM.go({parent:d,module:"thread.ThreadModule",param:b,listModule:d,listUnstable:l,folderData:h,viewType:b.viewType,sharebar:!0,group:g,hidden:j,call:i,hiddenCall:k});else{var n,o,p;if(h!==c&&(n=h.threadMessageCount,o=!h.flags.read),p=m._goCacheModule({id:b.id,group:g,isThread:!0,count:n,unread:o,listParam:e,listExtend:f}),p===!0)return;"string"==typeof p&&(g=p),a.JS.go({module:"thread.ThreadModule",param:b,listModule:d,listParam:e,listExtend:f,listUnstable:l,folderData:h,group:g,hidden:j,call:i,hiddenCall:k})}else if(b.viewType)m.preload(b),a.SM.go({parent:d,module:"read.ReadModule",param:b,listModule:d,listUnstable:l,folderData:h,viewType:b.viewType,sharebar:!0,group:g,hidden:j,call:i,hiddenCall:k,speed:m.needSpeed});else{if(b.part)return a.JS.go({module:"read.ReadModule",listModule:d,param:b,folderData:h,group:g,call:i}),void 0;if(m._goCacheModule({id:b.id,group:g,folderData:h,listParam:e,listExtend:f},j))return;m.preload(b),a.JS.go({module:"read.ReadModule",param:b,listModule:d,listParam:e,listExtend:f,listUnstable:l,folderData:h,group:g,hidden:j,call:i,speed:m.needSpeed})}}function e(a){var b=this;if(!a.locked){try{var c=$L("module.read.Turbo",this)}catch(d){return d}c.start({level:b.needSpeed?2:1,param:a})}}function f(b,d){var e,f,g,h,i=b.id,j=b.group,k=!!b.isThread;if(k?(e="thread.ThreadModule",f="tid"):(e="read.ReadModule",f="mid"),g=a.JS.modules[e])for(var l in g)if(h=g[l],h[f]===i){if(!d){if(j&&j!==h.group)return!1;if(k&&(b.unread||b.count!==a.Object.count(h.threadMessageIdMap))){var m=h._var.group||h.group;return a.JS.cleanCache(h),a.JS.remove(h),m}var n=b.folderData;try{h._var.hidden&&delete h._var.hidden}catch(o){}h.listParam=b.listParam,h.listExtend=b.listExtend,n!==c&&(h.folderData=n,h.reader!==c&&(h.reader.folderData=n)),a.JS.go(h)}return!0}}var g=a.createClass($N("interface.ReadInterface"));a.Object.extend(g,{needSpeed:a.Browser.isIE("<9"),entry:d,preload:e,_goCacheModule:f})}($,window),function(a,b,c){function d(){if(!hb.dom){var a=eb?"A":"DIV",b=document.createElement(a);hb.dom=b}}function e(a){var b=this,c=hb.dom.tagName,d=Y.clone(hb.attribute);if(Y.extend(d,b.getAttribute()),d.sign="letter",eb&&(d.href="#",d.onclick="return false;"),b.id=d.id,a){var e=[],f="";for(var g in d){var h=d[g];switch(g){case"className":e.push('class="'+h+'"');break;case"tabIndex":e.push('tabindex="'+h+'"');break;case"innerHTML":f=h;break;case"title":case"aria-label":h=$.encodeHTML(h);default:e.push(g+'="'+h+'"')}}b.html=["<",c," ",e.join(" "),eb?' href="javascript:void(0)"':"",">",f,"</",c,">"].join("")}else{var i=b.div=hb.dom.cloneNode(!0);for(g in d){var h=d[g];"aria-label"===g||"sign"===g?i.setAttribute(g,d[g]):i[g]=h}}}function f(){function d(a){var b=i.getKeyword();if(b)try{var c=new RegExp("("+b+")","ig");a=a.replace(c,'<b class="ch0">$1</b>')}catch(d){}return a}function e(a){function b(b,c){var d=[];d=a.match(b),d&&(c.count=d.length)}function c(b,c){c.count>0&&(c.handle=!0,k[k.length]=c.type+(c.count>1?"("+c.count+")":""),a=a.replace(b,""))}if(!f.isThread)return a;try{var d,e,g,h,i={type:"Re"},j={type:"Fw"};if(d=/(re|reply|回复|答复)[:|：]/gi,e=/(fw|forward|转发)[:|：]/gi,g=/^(re|reply|回复|答复)[:|：]/gi,h=/^(fw|forward|转发)[:|：]/gi,i.isFirst=g.test(a),j.isFirst=h.test(a),!i.isFirst&&!j.isFirst)return a;var k=[];b(d,i),b(e,j),(i.count>1||j.count>1)&&(c(d,i),c(e,j),j.isFirst&&k.reverse(),a=k.join(":")+":"+$.trim(a).replace(/^(&nbsp;|_)+/gi,""))}catch(l){}return a}var f=this,g=f.view,h=g.config,i=g.module;i.extend("type");var j=i.extend("subtype"),k="folder"===j,l={},m=f.components,n=i.param("fid"),o=f.data,p=o.fid,q=o.flags,r=o.id,s=f.nodes,t=o.threadMessageCount,u=f.isThread,v=[hb.attribute.className],w="full"===j,x="undefined"!=typeof o.summary,y=w,z=x&&!y,A=x?o.summary:"",B=q.deferHandle,C=f.expire,D=g.getLayout(),E=i.createId(r+(new b.Date).getTime()),F=E+"Dom";if(l.id=F,l.role="link",!n){var G=i.param("fids");1===G.length&&(n=G[0])}q.read||v.push("kw0"),q.top&&v.push("oh0"),B&&(v.push("oU1"),C&&v.push("gv0"));var H=s.drag=E+"DragDiv",I=s.dragitem=E+"DragB",J=s.checkbox=E+"CheckboxB",K=s.logo=E+"LogoB";s.trash=E+"TrashB";var L,M,N=s.flag=E+"FlagB";(!k||C)&&(L=s.folder=E+"FolderSpan",M=s.subject=E+"SubjectSpan");var O=s.tag=E+"TagDiv";s.defer=E+"DeferB";var P=s.date=E+"DateDiv",Q=s.mid=E+"MidDiv",R=s.end=E+"EndDiv";if(y)var S=s.summary=E+"SummaryDiv";var T=[];T[T.length]='<div class="nl0 hA0'+(!A||w?" ck0":"")+'">';var Y=[];Y[Y.length]='<div class="gB0" sign="start">',fb||(Y[Y.length]=['<div class="dS0" id="',H,'"><b class="nui-ico nui-ico-drag" id="',I,'"></b></div>'].join("")),Y[Y.length]=['<label aria-checked="false" sign="checkbox" class="nui-chk cS0" title="'+X.t("选中此邮件")+'" role="checkbox" tabIndex="0" aria-label="'+X.t("选中此邮件")+'"><span class="nui-chk-symbol"><b class="nui-ico nui-ico-checkbox" id="',J,'"></b></span></label>'].join("");var Z=f.getLogoInfo(),ab=Z.config;Y[Y.length]=ab.sub?['<b class="dT0 nui-ico nui-ico-hasSub nui-ico-',ab.type,'" title="',ab.title,'" tabindex="-1" aria-label="',ab.title,'" sign="logo" id="',K,'"><b class="nui-ico-sub nui-ico-sub-',ab.sub,'"></b></b>'].join(""):['<b class="dT0 nui-ico nui-ico-',ab.type,'" title="',ab.title,'" tabindex="-1" aria-label="',ab.title,'" ',ab.url?' style="background-image:url('+ab.url+')"':"",' sign="logo" id="',K,'"></b>'].join("");var bb=f.getPriorityInfo();bb&&(Y[Y.length]=['<b class="cR0 nui-ico nui-ico-mailLv nui-ico-',bb[0],'" title="',bb[1],'" tabindex="-1" aria-label="',bb[1],'"></b>'].join("")),Y[Y.length]='<div class="dP0" sign="start-from">';var cb=2===n||3===n?o.to:o.from;$.has(cb,"@netease>")&&(cb=cb.replace(/@netease>/gi,"@netease.com>"));var db=a.Uri.getEmails(cb,c,!0),eb=db.match;if(0===eb.length){var gb=db.wrong;gb.length>0?eb.push({name:cb,address:null}):eb.push({name:X.t("(未填写)"),address:null})}for(var ib=[],jb=[],kb=m.userlabel=[],lb=0,mb=eb.length;mb>lb;lb++)try{var nb=eb[lb],ob=!1;if(o.ctrls&&o.ctrls.plus){var pb=o.ctrls.plus,qb=nb.address,rb=qb.split("@")[0],sb=qb.split("@")[1],tb=pb.split("_"),ub=tb[0],vb=tb[1],wb=W.encode(rb+ub+sb);vb===wb&&(ob=!0)}var xb=new a.UserLabel({email:nb,plus:ob,extcls:"ci0",popupRenderTo:i.scroller,lazyListen:!0,noListen:!0});kb.push(xb),jb[jb.length]=xb.html(),ib.push(xb.rawConfig.name)}catch(yb){}Y[Y.length]=jb.join(X.t("，")),Y[Y.length]="</div>";var zb=o.label0;Y[Y.length]=['<div class="dU0" title="',zb>0?X.t("点击取消旗帜"):X.t("设为红旗"),'" style="',zb>0&&"l-r"==D?"visibility:visible":"",'" role="button" tabindex="-1" aria-label="',zb>0?X.t("点击取消旗帜"):X.t("设为红旗"),'" sign="flag"><b class="nui-ico nui-ico-flag nui-ico-flag-',zb,'" id="',N,'"></b></div>'].join(""),v.push("nui-txt-flag"+zb),Y[Y.length]="</div>",T[T.length]=Y.join("");var Ab=[];if(Ab[Ab.length]=['<div class="il0" id="',Q,'">'].join(""),!q.deferHandle){try{if(a.Ext.memo&&o.memo){var Bb=m.memo=new a.Memo({content:$.encodeHTML(o.memo),modify:_.bind(f.modifyMemo,f),extcls:"iu0",lazyListen:!0,noListen:!0});Ab[Ab.length]=Bb.html()}}catch(yb){}try{if(a.Ext.scheduleMbox&&$S("schedule")&&$S("schedule")[r]){var Cb=m.schedule=new a.Schedule({mid:r,extcls:"iu0",lazyListen:!0,noListen:!0});Ab[Ab.length]=Cb.html()}}catch(yb){}}var Db=d(o.subject?e($.encodeHTML(o.subject)):X.t("(无主题)"));Db=V.fix(Db);var Eb=y?$.encodeHTML($.stripTags(A)):$.stripTags(Db);if(4===o.fid&&4!==n&&(Db="<del>"+Db+"</del>"),o.ctrls&&o.ctrls.at){for(var Fb,Gb=b.decodeURIComponent(o.ctrls.at).split(","),lb=0;lb<Gb.length&&!Fb&&Gb[lb];lb++)if(Fb=Gb[lb].toLowerCase()==$S("uid").toLowerCase(),!Fb&&o.accounts)for(var Hb=0;Hb<o.accounts.length&&!Fb&&Gb[lb]&&o.accounts[Hb];Hb++)Fb=Gb[lb].toLowerCase()==o.accounts[Hb].toLowerCase();Fb&&(Db='<span class="ig1">'+X.t("@我")+"</span>"+Db)}Db=['<span class="da0"',M?' id="'+M+'"':"",">",Db,"</span>"].join("");var Ib=!k||C?['<span class="nui-txt-tips nui-txt-s12 dL0" id="',L,'">[',U.get(o.fid).name,"]</span>"].join(""):"",Jb=u&&t>1?['<span class="bL0" title="'+X.t("共 "),t,X.t(" 封会话")+'">',t,"</span>"].join(""):"",Kb=z?['<span class="dd0">',V.fix($.encodeHTML(A)),"</span>"].join(""):"";Ab[Ab.length]=[Ib,Db,Jb,Kb].join(""),Ab[Ab.length]="</div>",T[T.length]=Ab.join("");var Lb=[];if(Lb[Lb.length]=['<div class="hV0" id="',R,'">'].join(""),h.sizeShow){var Mb=a.Number.convert(o.size,1);Lb[Lb.length]=['<div class="es0" title="'+X.t("邮件大小为"),Mb,'">',Mb,"</div>"].join("")}var Nb=f.getDateInfo();Lb[Lb.length]=['<div id="',P,'" class="eO0',Nb.important?" bS0":"",'" title="',Nb.title,'">',Nb.value,"</div>"].join("");var Ob="",Pb="",Qb="";q.linkAttached||(a.Ext.newAttach?q.realAttached:q.attached)?q.linkAttached?(Ob="nui-ico-bigAtt",Pb=X.t("此邮件包含超大附件")):(Ob="nui-ico-att",Pb=X.t("此邮件包含附件")):Qb=' style="display: none"',Lb[Lb.length]=['<div class="nui-ico ',Ob,' dQ0" title="',Pb,'"',Qb,"></div>"].join(""),q.deferHandle&&o.defer&&(Lb[Lb.length]=['<b class="cC0 nui-ico nui-ico-delete fake-position"  title="'+X.t("点击删除邮件")+'"></b>','<b class="cT0 nui-ico nui-ico-todo nui-ico-todo-selected fake-position"></b>'].join("")),Lb[Lb.length]="</div>",T[T.length]=Lb.join("");try{if(a.Ext.tag){var Rb=[],Sb=$I("init.Tag"),Tb=o.tag,Ub="";if(Tb)for(var Vb=m.tag=[],lb=0,mb=Tb.length;mb>lb;lb++)try{var Wb=$.trim(Tb[lb]),Xb=Sb.get(Wb);if(Xb){var Yb=new a.Tag({text:Xb.alias,type:Xb.color,attrs:"hasClose",click:function(a){return function(){try{var b=$L("interface.MboxInterface",this)}catch(c){return c}b.entry({tag:[a]})}}(Wb),closeclick:function(a,b){return function(){g.setTag(!1,a,[b])}}(Wb,f),lazyListen:!0,noListen:!0});Rb[Rb.length]=Yb.html(),Vb.push(Yb)}}catch(yb){}else Ub=' style="display:none"';Rb.unshift(['<div class="im0" id="',O,'"',Ub,' sign="tag" tabindex="-1">'].join("")),Rb.push("</div>"),T[T.length]=Rb.join("")}}catch(yb){}if(T[T.length]="</div>",y){var Zb=[],$b=f.getSummary(A);Zb[Zb.length]='<div class="nl0 fQ0">',Zb[Zb.length]=['<div class="il0" id="',S,'">',$b,"</div>"].join(""),Zb[Zb.length]='<div class="hV0">&nbsp;</div>',Zb[Zb.length]="</div>",T[T.length]=Zb.join("")}if(l.className=v.join(" "),l.innerHTML=T.join(""),!fb){var _b=2===p||3===p?X.t("收件人"):X.t("发件人");l["aria-label"]=$.decodeHTML([Eb,_b,X.t("："),ib.join(),X.t("时间："),Nb.title].join(" "))}return l}function g(){function a(){var a=d.isTop&&f.top,c=a?["top",X.t("置顶")]:null;if(c)return c;var h=b.getSendLogo();if(h)return h;var i=f.system?["ntes",X.t("网易系统邮件")]:null;if(e.ctrls&&e.ctrls.RulesType&&!Z.has([5,7,18],e.fid)){var j=e.ctrls.RulesType.split(";")[0];j.indexOf("_")>-1?j=j.split("_")[1]:"ntessys"!==j&&(e.ctrls.RulesType=null),j&&(i="ntessys"===j?["ntes",X.t("网易诚信邮件联盟认证邮件")]:["integrity",X.t("网易诚信邮件联盟认证邮件"),hb.systemUrl+j+".gif"])}if(i)return i;var k=f.encrypted?["encrypt",X.t("加密邮件")]:null;if(k)return k;var l=f.scheduleDelivery?["regular",X.t("定时发信")]:null;if(l)return l;var m=2===g&&f.draft?["draft",X.t("草稿")]:null;if(m)return m;var n=b.getReFwLogo();if(n)return n;var o=b.getSmartLogo();if(o)return o;var p=b.getReadLogo();return p?(b.isNormalLogo=!0,p):void 0}var b=this,c=b.view,d=c.config,e=b.data,f=e.flags,g=e.fid,h=a();return h.config={type:h[0],title:h[1],url:h[2],sub:h[3]},h}function h(){var b=this,c=b.data,d=c.flags;if(3!==c.fid||b.isThread)return null;var e,f,g,h,i,j=null;if((a.Ext.letterRecall||a.Ext.letterRecall_vip)&&c.recallable){e="recall";var k=c.rclStatus,l=hb.rclStatus;k&&k>0&&(3>k?(f=l[3],g=0):3===k?(f=l[1],g=1,i="suc"):4===k?(f=l[2],g=2,i="err"):5===k&&(f=l[0],g=3,i="pause"))}if(f&&e)h="recall";else{var m=c.composeExtra,n=m&&m.showOneRcpt;e=n?"sendSeparate":"mail";var o=c.sndStatus;if("number"!=typeof o){var p=d.rcptQueued,q=d.rcptSucceed,r=d.rcptFailed;(p||q||r)&&(o=q?r?5:3:r?4:1,c.sndStatus=o)}if("number"==typeof o){var s=hb.sendStatus;3>o?(f=s[3],i="ing",g=0):3===o?(f=s[1],i=n?"sepaSucc":"suc",g=1):4===o?(f=s[2],i="err",g=2):5===o&&(f=s[0],i="part",g=3)}h="send"}return f&&e&&(j=[e,f,null,i],j.ext={status:g,type:h}),j}function i(){var a=this;if(a.isThread)return null;var b=a.data.flags,c=b.replied&&b.forwarded?["refw",X.t("回复且转发")]:null,d=b.replied?["re",X.t("已回复")]:null,e=b.forwarded?["fw",X.t("已转发")]:null;return c?c:d?d:e?e:null}function j(){var a=this,b=a.data.flags,c=a.isThread,d=b.popRead,e=b.read;return e?["read",X.t("已读")]:c?["unreadThread",X.t("未读")]:d?["unreadPop",X.t("已被邮件客户端，其他邮箱代收或手机等通过POP3协议收取")]:["unread",X.t("未读")]}function k(){var a=this,b=$I("init.Tag"),c=a.data.tag,d=null;if(c)for(var e=0,f=c.length;f>e;e++){var g=c[e],h=b.get(g,"smart");if(h){var i=b.smarts[h.alias];d=["category-"+i.index,i.name]}}return d}function l(){var a,b,c=this,d=c.data.priority;return 3>d?(a="mailLv-1",b=X.t("紧急")):d>3&&(a="mailLv-3",b=X.t("缓慢")),a&&b?[a,b]:void 0}function m(){var a,b,c,d=this,e=d.data,f=d.isDefer,g=d.expire,h=d.today,c=f&&e.defer?e.defer:e.sentDate;if(g)b=a=h?X.t("今日处理"):X.t("尚未处理");else{var i=$I("init.Defer");b=bb.format(c,X.t("yyyy年M月d日 HH:mm (星期w)"));var j=i.getDate("yesterday"),k=i.getDate("today"),l=c.getYear(),m=c.getMonth(),n=c.getDate();a=l===k.getYear()&&m===j.getMonth()&&n===j.getDate()?X.t("昨日"):l===k.getYear()?m===k.getMonth()&&n===k.getDate()?bb.format(c,"HH:mm"):bb.format(c,X.t("M月d日")):bb.format(c,"yyyy-MM-dd"),f&&(a+=X.t("处理"),b+=X.t("处理"))}return{important:g&&!h,title:b,value:a}}function n(a){return a?a.replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/&lt;b&gt;/gi,'<span class="nui-txt nui-txt-mark">').replace(/&lt;\/b&gt;/gi,"</span>"):""}function o(b){var c=this;if(!c.inited){b=c.getDiv(b);for(var d=b.getElementsByTagName("*"),e=c.nodes,f=Y.count(e),g=0,h=0,i=d.length;i>h;h++){var j=d[h],k=j.id;if(Y.each(e,function(b,c){return c===k?(e[b]=j,g++,a.BREAK):void 0}),g===f)break}c.inited=!0}}function p(){var b=this,c=b.components.memo;c||(c=b.components.memo=new a.Memo({renderTo:b.nodes.mid,renderBy:"prepend",content:$.encodeHTML(b.data.memo||""),modify:_.bind(b.modifyMemo,b),extcls:"iu0"}))}function q(c){function d(a){a.setEventListeners(),a.fireRender()}var e=this,f=e.view,g=f.module;if(g.getDom("ListDiv"),e.lazyInit(c.div),!e.componentInited){try{var h=e.nodes,i=e.components;if(a(e.div).find(".fake-position")&&a(e.div).find(".fake-position").remove(),!fb){var j=i.trash=new a.Icon({renderTo:h.end,title:X.t("删除邮件"),simple:!0,type:"delete",extcls:"cC0",popupRenderTo:g.scroller,click:function(){},lazyListen:!0,noListen:!0});j.getDom().setAttribute("sign","trash")}if(!eb){if(g.isDefer()){var k=e.data,l=T.expireNote(k),m=i.defermanage=new a.Icon({renderTo:h.end,title:l,simple:!0,type:k.flags.deferHandle?"todo-selected":"todo",extcls:"cT0",popupRenderTo:g.scroller,click:function(){e.data.flags.deferHandle?this.menu||(this.menu=new($I("component.Menu"))(e.deferManage()),this.menu.attachTo({clickFrom:this.getEl(),floatTo:this.getEl(),renderTo:g.scroller}),this.menu.fire("attachToShow")):e.gotoDefer("add")},lazyListen:!0,noListen:!0});m.getDom().setAttribute("sign","defermanage")}if(g.isTag()){var n=i.tagmanage=new a.Icon({renderTo:h.end,title:X.t("选择邮件标签"),simple:!0,subclass:"miniBtn",type:"tags",extcls:"dK0",menu:e.tagManage(),popupRenderTo:g.scroller,click:function(){this.menu||(this.menu=new($I("component.Menu"))(e.tagManage()),this.menu.attachTo({clickFrom:this.getEl(),floatTo:this.getEl(),renderTo:g.scroller}),this.menu.fire("attachToShow"))},lazyListen:!0,noListen:!0});n.getDom().setAttribute("sign","tagmanage")}}if(!fb){var o=b.netease.mail.util.DragDrop;new o({drag:f.dragDiv,trigger:h.drag,listeners:[{name:"mousedown",handler:_.bind(f.drag,f,e,"mousedown")},{name:"start",handler:_.bind(f.drag,f,e,"start")},{name:"drag",handler:_.bind(f.drag,f,e,"drag")},{name:"end",handler:_.bind(f.drag,f,e,"end")}]})}for(var p in i){var q=i[p];if(Y.isArray(q))for(var r=0,s=q.length;s>r;r++)d(q[r]);else d(q)}}catch(t){}e.componentInited=!0}}function r(a){var b=this;b.view,ab.getTarget();var c=a.sign;switch(b.data,b.lazyInit(a.div),c){case"checkbox":case"logo":case"trash":case"flag":case"tag":case"defer":case"tagmanage":case"defermanage":break;default:var d=!1,e=!1;d=d||"start-from"===c,e=e||"start"===c,(!e||d)&&b.gotoRead({preload:!0})}}function s(a){var b=this,c=b.view,d=c.module;ab.getTarget();var e=a.sign,f=b.data;switch(b.lazyInit(a.div),e){case"checkbox":b.setChecked(!b.checked);break;case"logo":var g=f.flags.read;g||(d.log("letter","read"),b.setChecked(!0),c.setRead(!g,[b]));break;case"trash":d.log("letter","remove"),b.setChecked(!0),c.remove(4===f.fid,[b]);break;case"flag":d.log("letter","flag"),b.setChecked(!0),c.setFlag(0===f.label0?1:0,[b]);break;case"tag":case"defer":case"tagmanage":case"defermanage":break;default:var h=!1,i=!1;h=h||"start-from"===e,i=i||"start"===e,(!i||h)&&b.gotoRead()}}function t(b){function c(a){return function(){d.checked||d.setChecked(!0),d.view.selectAll(),a()}}var d=this,e=d.data,f=d.view,g=f.module,h=$I("util.Contextmenu"),i=g.param("fid"),j="archive"===g.extend("area"),k=e.fid;d.lazyInit(b.div);for(var l=f.letters,m=e.id,n=!0,o=0,p=l.length;p>o;o++){var q=l[o];if(q.checked&&q.data.id!==m){n=!1;break}}var r={groups:[]},s=r.groups,t=[];if(g.isDefer()&&(e.flags.deferHandle?t.push({text:X.t("完成待办"),icon:"done",click:c(_.bind(f.setDefer,f,"complete"))}):t.push({text:X.t("设为待办"),icon:"todo",click:c(_.bind(f.setDefer,f,"add"))})),e.flags.read?t.push({text:X.t("设为未读"),icon:"unread",click:c(_.bind(f.setRead,f,!1))}):t.push({text:X.t("设为已读"),click:c(_.bind(f.setRead,f,!0))}),(i>0||n)&&U.isTop(k)&&!f.folderSelected&&(j||(e.flags.top?t.push({text:X.t("取消置顶"),click:c(_.bind(f.setTop,f,!1,null,k))}):t.push({text:X.t("置顶邮件"),click:c(_.bind(f.setTop,f,!0,null,k))}))),n&&a.Ext.memo){var u=e.memo?X.t("修改备注"):X.t("添加备注");t.push({text:u,click:c(function(){d.initMemo(),a.Memo.modify(d.components.memo)})})}if(s.push({items:t}),t=[],Z.has([4,5,7,18],i)?t.push({text:X.t("彻底删除"),icon:"trash",click:c(_.bind(f.remove,f,!0))}):t.push({text:X.t("删除邮件"),icon:"trash",click:c(_.bind(f.remove,f))}),!j&&!Z.has([2,3],i)){var v=X.t("举报垃圾邮件"),w=!0;
t.push({text:v,click:c(_.bind(f.setSpam,f,w))})}if(Z.has([5,7,18],i)){var v=X.t("信任选中邮件"),w=!1;t.push({text:v,click:c(_.bind(f.setSpam,f,w))})}s.push({items:t}),h.show(r)}function u(a){var b=this;b.lazyInit(a.div);var c=ab.get();"DIV"===c.target.tagName&&13===c.which&&b.gotoRead()}function v(b){var d=this,e=d.view,f=e.module;if(d.lazyInit(),!!d.checked!==b){d.checked=b;var g=a.fly(d.nodes.checkbox);b?g.addClass("nui-ico-checkbox-checked"):g.removeClass("nui-ico-checkbox-checked"),g.dom.parentNode.parentNode.setAttribute("aria-checked",!!b),d.setClass(),e.selectAll(b===!1?!1:c);var h=[],i=e.letters;Z.each(i,function(a,b){h.push(b)});try{$I("util.Shift").handle(d,h,function(){d.setClass()}),ab.stop()}catch(j){}try{f._child.view.changeSelect()}catch(j){}}}function w(){var b=this;b.lazyInit();var c=b.div,d=a.fly(c),e=b.nodes.checkbox;b.checked?d.addClass("ij0"):d.removeClass("ij0");var f=hb.checkboxTitle;e.title=b.checked?f[1]:f[0]}function x(b){var c=this;if(!fb){c.lazyInit();var d=c.nodes,e=d.drag,f=d.dragitem,g=a(c.div),h=a(e),i=a(f),j="nui-ico-drag",k="nui-ico-drag2",l="ik0";b?(i.replaceClass(j,k),g.addClass(l),e.title=X.t("最近阅读邮件")):(i.replaceClass(k,j),g.removeClass(l),e.title=""),g.destroy(),h.destroy(),i.destroy()}}function y(){var a=this;if(a.lazyInit(),a.isNormalLogo){var b=a.nodes.logo,c=a.getLogoInfo();b.className="dT0 nui-ico nui-ico-"+c[0],b.title=c[1]}}function z(b){var c=this;c.lazyInit();var d=c.data.flags.read;if(c.isNormalLogo||b){var e=c.nodes.logo,f=c.getLogoInfo();e.className="dT0 nui-ico nui-ico-"+f[0],e.title=f[1]}c.checked&&c.setChecked(!1);var g=a.fly(c.div);d?g.removeClass("kw0"):g.addClass("kw0")}function A(){var b=this,c=b.view;b.lazyInit();var d=b.nodes.flag,e=b.data.label0;d.className="nui-ico nui-ico-flag nui-ico-flag-"+e,d.parentNode.title=e>0?X.t("点击取消旗帜"):X.t("设为红旗");var f=c.getLayout();"l-r"===f&&e>0?a(d.parentNode).css({visibility:"visible"}):"l-r"===f&&0>=e&&a(d.parentNode).css({visibility:""}),b.checked&&b.setChecked(!1);var g=b.div;g.className=g.className.replace(/nui-txt\-flag\d{1,2}/gi,"nui-txt-flag"+e)}function B(){var b=this;b.lazyInit();for(var c=b.view,d=c.module,e=$I("init.Tag"),f=b.nodes.tag,g=b.data,h=g.tag,i=b.components,j=i.tag=[],k=[],l=0,m=h.length;m>l;l++)try{var n=h[l],o=e.get(n),p=new a.Tag({text:o.alias,type:o.color,attrs:"hasClose",click:function(a){return function(){try{var b=$L("interface.MboxInterface",this)}catch(c){return c}b.entry({fid:0,showTag:!0,tag:[a]}),ab.stop()}}(n),closeclick:function(a,b){return function(){c.setTag(!1,a,[b]),ab.stop()}}(n,b)});k[k.length]=p.html(),j.push(p)}catch(q){}f.innerHTML=k.join(""),f.style.display="";try{if(!eb){var r=i.tagmanage;delete r.menu,r.update({click:function(){this.menu||(this.menu=new($I("component.Menu"))(b.tagManage()),this.menu.attachTo({clickFrom:this.getEl(),floatTo:this.getEl(),renderTo:d.scroller}),this.menu.fire("attachToShow"))}}),r.getDom().setAttribute("sign","tagmanage")}}catch(q){}a.Component.setEvents(),b.checked&&b.setChecked(!1)}function C(){var b=this,c=b.data;b.lazyInit();var d=b.view,e=d.module,f=c.flags.deferHandle;b.nodes.defer&&b.nodes.defer.style&&(b.nodes.defer.style.display=c.defer&&f?"":"none");try{if(!eb){var g=b.components.defermanage;delete g.menu,g.update({title:T.expireNote(c),menu:b.deferManage(),type:f?"todo-selected":"todo",click:function(){b.data.flags.deferHandle?this.menu||(this.menu=new($I("component.Menu"))(b.deferManage()),this.menu.attachTo({clickFrom:this.getEl(),floatTo:this.getEl(),renderTo:e.scroller}),this.menu.fire("attachToShow")):b.gotoDefer("add")}}),g.getDom().setAttribute("sign","defermanage")}}catch(h){}var i=b.getDateInfo(),j=b.nodes.date;j.title=i.title,j.innerHTML=i.value,a.fly(j)[i.important?"addClass":"removeClass"]("bS0");var k=a.fly(b.div);f?(k.addClass("oU1"),b.expire?k.addClass("gv0"):k.removeClass("gv0")):(k.removeClass("oU1"),k.removeClass("gv0"))}function D(){var a=this;a.lazyInit(),a.initMemo();var b=a.data.memo||"",c=a.components.memo;c.show(),c.updateContent($.encodeHTML(b))}function E(){var a=this,b=a.data;a.lazyInit();var c=a.nodes,d=c.folder,e=c.subject;try{d&&(d.innerHTML="["+U.get(b.fid).name+"]")}catch(f){}try{var g=b.fid,h=4===g,i=e.getElementsByTagName("DEL").length>0;if(h^i){var j=b.subject;h&&(j="<del>"+j+"</del>"),e.innerHTML=j}}catch(f){}}function F(){var b=this,c=b.data;b.lazyInit();var d=a.fly(b.div);c.flags.top?d.addClass("oh0"):d.removeClass("oh0"),b.setRead(!0)}function G(){var a=this,b=a.data;a.formatSummary();var c=b.summary;a.lazyInit(),a.nodes.summary.innerHTML=a.getSummary(c)}function H(){var a=this,b=a.view;b.module;var c=a.data,d={};return d.data=c,d.left=38,d.top=10,d.modify=function(){a.gotoDefer("modify")},d.modifySms=function(){a.gotoDefer("modify",{smsShow:!0})},d.modifyMemo=function(){a.gotoDefer("modify",{memoShow:!0})},d.complete=function(){a.gotoDefer("complete")},d["delete"]=function(){a.gotoDefer("delete")},T.getMenu(d)}function I(){var a=this,b=a.view,c=a.data,d=c.tag||[],e={};return e.tag=d,e.callback=function(c,d){b.module.log("letter","settag"),b.setTag(!c,d,[a])},e.remove=function(){b.setTag(!1,null,[a])},R.getMenu(e)}function J(a){var b=this,c=b.view,d=c.module,e=b.data;a||(a={});var f=a.hidden,g=a.preload,h=a.call,i=a.hiddenCall;if(2!==e.fid){var j=d.extend("area");if(g){if(!b.isThread){try{var k=$L("interface.ReadInterface",this)}catch(l){return l}k.preload({id:e.id,fid:e.fid,locked:e.flags?e.flags.locked:!1,area:j})}}else if(!$I("util.TimeFlag").handle(e.id,800)){var m=c.getLayout(d);try{var k=$L("interface.ReadInterface",this)}catch(l){return l}var n=d.name,o=Y.clone(d.param()),p=Y.clone(d.extend());if(p.moduleName=n,k.entry({moduleName:n,moduleParam:o,moduleExtend:p,area:j,folderData:e,isThread:b.isThread,isRead:"read"===d.extend("subtype"),viewType:m,hidden:f,call:h,hiddenCall:i}),""!==m&&!f)try{c.markReaded()}catch(q){}}}else if(!g){try{var r=$L("interface.ComposeInterface",this)}catch(l){return l}r.draft({id:e.id,info:{subject:e.subject,priority:e.priority},folderData:e,date:e.flags.scheduleDelivery?e.sentDate:null});try{var s=$L("interface.MboxInterface",this)}catch(l){return l}s.setRead({fid:d.param("fid"),isRead:!0,data:e})}}function K(a,b){var d=this,e=d.view,f=e.module,g=d.data;switch(b||(b={}),a){case"add":g.flags.deferHandle||(f.log("letter","defer","add"),e.setDefer("add",c,[d]));break;case"complete":f.log("letter","defer","complete"),e.setDefer("complete",c,[d]);break;case"modify":f.log("letter","defer","modify"),T.showMsgbox({type:"modify",data:{defer:g.defer,memo:g.memo,mid:g.id,memoShow:b.memoShow,smsShow:b.smsShow},callback:function(a){e.setDefer("modify",a,[d])}});break;case"delete":e.setDefer("delete",{defer:g.defer},[d])}}function L(b){var c=this;try{if(b){var d=c.components;for(var e in d)try{var f=d[e];if(Y.isArray(f))for(var g=0,h=f.length;h>g;g++)f[g].destroy();else f.destroy()}catch(i){}try{var j=c.getDiv();j&&(ab.unlistenAll(j),a.fly(j).remove())}catch(i){}}}catch(i){}c.html=null,c.div=null,c.nodes=null,c.components=null,c.data=null,c.view=null}function M(a){var b=this;return b.div||(b.div=a?a:document.getElementById(b.id)),b.div}function N(){var a=this,c=a.data,d=$I("init.Defer"),e=a.view,f=e.module,g=f.extend("subtype"),h=c.threadMessageCount;if(a.isThread=h>1,"defer"===g||c.flags.expire){a.isDefer=!0;var i=c.defer,j=a.expire=i<d.getDate("tomorrow");a.today=j&&i>=d.getDate("today")}else a.isDefer=!1,delete a.expire,delete a.today;if(c.flags||(c.flags={}),c.tag||(c.tag=[]),a.isThread){var k=f.param("fid"),g=f.extend("subtype");if("flag"===g){var l=f.param("filter");c.label0=l.label0}k>0&&c.fid!==k&&(c.fid=k)}try{c.sentDate.getTime()<=0&&(c.sentDate=new b.Date(db.getTime(0)))}catch(m){}a.formatSummary(),gb&&(c.subject=c.subject.replace(/　/g," ")),c.subject=$.trim(c.subject)}function O(){var a=this,b=a.data;b.summary=b.summary?b.summary.replace(/\n|\|/g,"").replace(/(\s|　)+/g," "):c}function P(a){var b=this;b.view.setMemo(a,[b])}function Q(a,b){var c=this;c.data=b,c.view=a,c.nodes={},c.components={};try{c.format()}catch(d){}}try{var R=$L("support.Tag")}catch(S){return S}try{var T=$L("support.Defer")}catch(S){return S}try{var U=$L("init.Folder")}catch(S){return S}try{var V=$L("util.Emoji")}catch(S){return S}try{var W=$L("util.MD5")}catch(S){return S}var X=new $I18N("module.mbox.Letter"),Y=a.Object,Z=a.Array,$=a.String,_=a.Function,ab=a.Event,bb=a.Date,cb=a.Browser,db=$I("util.Misc"),eb=cb.isIE(6),fb=cb.isIE("<9"),gb=!!cb.chrome(),hb=a.createClass($N("module.mbox.Letter"));Y.extend(hb,{dom:null,attribute:{className:"rF0",tabIndex:0},checkboxTitle:[X.t("选中此邮件"),X.t("取消选中")],sendStatus:[X.t("部分成功"),X.t("发送成功"),X.t("发送不成功"),X.t("邮件发送中")],rclStatus:[X.t("部分成功"),X.t("撤回成功"),X.t("撤回不成功"),X.t("邮件撤回中")],systemUrl:"https://mimg.127.net/p/images/ibx/cx/",config:d}),Y.extend(hb.prototype,{data:null,isThread:!1,isDefer:!1,id:null,html:null,dom:null,nodes:null,components:null,inited:!1,componentInited:!1,checked:!1,today:!1,expire:!1,initDom:e,getAttribute:f,getLogoInfo:g,getSendLogo:h,getReFwLogo:i,getReadLogo:j,getSmartLogo:k,getPriorityInfo:l,getDateInfo:m,getSummary:n,lazyInit:o,initMemo:p,mouseover:q,mousedown:r,click:s,contextmenu:t,keypress:u,setChecked:v,setClass:w,setLastRead:x,setReFw:y,setRead:z,setFlag:A,setTag:B,setDefer:C,setMemo:D,setMove:E,setTop:F,setSummary:G,deferManage:H,tagManage:I,gotoRead:J,gotoDefer:K,remove:L,getDiv:M,format:N,formatSummary:O,modifyMemo:P,initialize:Q})}($,window),function(a,b,c){function d(){var a=this,b=a.view.module,c={},d=b.extend("type"),e=b.extend("subtype");return"list"===d?"tag"===e?a.getTag(c):"defer"===e?a.getDefer(c):"flag"===e?a.getFlag(c):"read"===e?a.getRead(c):"calendar"===e?a.getCalendar(c):"folder"===e?a.getFolder(c):"contacts"===e?a.getContacts(c):"emails"===e?a.getEmails(c):a.getFilter(c):"normal"===e?a.getNormal(c):a.getFull(c),c}function e(b){var d=this,e=d.view,f=e.module,g=f.param("tag"),h=y.getName(g[0]),i=f.getTotal(),j=f.param("filter");j?j.flags:c;var k=f.extend("read")===!1,l=f.extend("brand"),m=C.clone(f.param()),n=C.clone(f.extend());if(k){delete m.filter.flags.read;var o=D.bind(w.entry,w,m,n);b.path={items:[{xtype:"link",text:h,extcls:"nui-txt-link",click:o}]},b.text=B.t("未读"),b.tips=d.getAllRead(!0)}else{var p=f.getCount("unread"),q=f.extend("limit");if(p>0&&i>q){var r=new a.Link({title:B.t("点击查看未读邮件"),text:B.t("有")+" <strong>"+p+"</strong>"+B.t(" 封未读"),extcls:"nui-txt-link",click:function(){f.log("title","unread");var a;try{a=m.filter.flags}catch(b){}a||(m.filter||(m.filter={}),a=m.filter.flags={}),a.read=!1,w.entry(m,n)}}).html();b.tips=" "+r+d.getAllRead()}}if(l){var s=z.get(18);b.path={items:[{xtype:"link",extcls:"nui-txt-link",text:s.name,click:D.bind(w.entry,w,{fid:s.id},{type:"list",subtype:"folder"})}]},b.text=h}}function f(){}function g(b){var c=this,d=c.view,e=d.module,f=e.getCondition();b.text=f;var g=D.bind(w.entry,w,{exceptFids:$G.common.unnormalids,conditions:[{field:"label0",operator:">",operand:0}]},{type:"search",subtype:"normal"});b.path={items:[{xtype:"link",text:B.t("旗帜邮件"),extcls:"nui-txt-link",click:g}]};for(var h=b.extItems=[],i=a.LETTERFLAG,j=[],k=1,l=i.length;l>k;k++)i[k]&&(j[j.length]={text:i[k],icon:"flag-"+k,extcls:"nui-txt-flag"+k,click:function(a){return function(){e.log("title","otherflag"),w.entry({filter:{label0:a}},{type:"list",subtype:"flag"})}}(k)});h[h.length]={xtype:"link",extcls:"nui-txt-link",text:'<b class="nui-ico nui-ico-flag nui-ico-flag-0"></b>'+B.t("其他旗帜&nbsp;")+'<b class="nui-ico nui-ico-dArr">d</b>',listeners:{render:function(){var b=new a.Menu({groups:[{items:j}],reverse:!0});b.attachTo({clickFrom:this.getEl()})}}}}function h(b){var c=this,d=c.view,e=d.module,f=e.extend("read")===!1,g=e.param("fids"),h=g.length,i=e.getTotal(),j=f?B.t("未读"):B.t("已读"),k=[];if(h>0)if(1===h){var l,m,n=g[0],o=z.get(n),p=o.name;"unread"===e.param("from")?(l=B.t("未读邮件"),m=function(){w.entry({filter:{flags:{read:!1}}})},j=p+"&nbsp;"+j):(l=p,m=D.bind(w.entry,w,{fid:n},{type:"list",subtype:"folder"})),b.path={items:[{xtype:"link",text:l,extcls:"nui-txt-link",click:m}]}}else if(E.has(g,1))for(var q=$G.common.nolistids.concat([2]),r=z.list(),s=0,t=r.length;t>s;s++){var o=r[s],u=o.id;if(!E.has(q,u)){var v=z.getInfo(u,"unread");if(v>0){var x=new a.Link({text:v+B.t("封"),extcls:"nui-txt-link",click:function(a){return function(){w.entry({fids:[a],filter:{flags:{read:!1}},from:"unread"},{type:"list",subtype:"read"})}}(u)});k.push(o.name+"&nbsp;"+x.html())}}}else{var m=D.bind(w.entry,w,{filter:{flags:{read:!1}}},{type:"list",subtype:"read"});b.path={items:[{xtype:"link",text:j,extcls:"nui-txt-link",click:m}]};for(var y="",q=$G.common.nolistids,A=!0,s=0,t=g.length;t>s;s++)if(!E.has(q,g[s])){A=!1;break}if(A){for(var C=[],s=0,t=q.length;t>s;s++)C.push(z.get(q[s]).name);y=C.join("，")}else y=B.t("其他");j=y+j}b.text=j;var F="";f&&i>0&&(F=c.getAllRead()),b.tips=F+(k.length>0?"("+k.join("，")+")":""),c.getContactRead(b)}function i(a){var b=this,c=b.view,d=c.module,e=d.param("fids"),f=e.length;d.getTotal();var g=d.getCondition();if(f>0&&1===f){var h=e[0],i=z.get(h),j=i.name,k=D.bind(w.entry,w,{fid:h},{type:"list",subtype:"folder"});a.path={items:[{xtype:"link",text:j,extcls:"nui-txt-link",click:k}]}}a.text=g}function j(b){var c=this,d=c.view,e=d.module,f=e.param("fid"),g=e.extend("area");z.get(f),z.getPopInfo(f);var h=e.getCount("unread");if("archive"!==g&&h>0&&2!==f){var i=[],j=new a.Link({title:B.t("点击查看未读邮件"),text:B.t("有")+" <strong>"+h+"</strong>"+B.t(" 封未读"),extcls:"nui-txt-link",click:function(){e.log("title","unread","folder"),w.entry({fids:[f],filter:{flags:{read:!1}}})}});i.push(j.html()),i.push(c.getAllRead(!0));var k=new a.Link({title:B.t("邮箱清理助手"),text:B.t("邮箱清理助手"),extcls:"nui-txt-link",click:function(){try{var b=$L("interface.OptionInterface",this)}catch(c){return c}b.entry({module:"LinkModule",link:"optimizer_clean",exit:!0}),a.Log.cache({b_mboxview_title_cleanup_click:1})}});try{var l=z.getTotal()}catch(m){}l>=2e3&&i.push(k.html()),b.tips=" "+i.join(" ")}}function k(b){var d,e,f,g,h,i,j=this,k=j.view,l=k.module,m=l.param("filter"),n=m.flags&&m.flags.read===!1;m&&(d=m.chatWithAddress,e=m.fromAddress,f=m.toAddress),g=!!d,i=!!f,h=!!e&&!i;var o=g?d:i?f:e,p=o.split(","),q=A.getContact(o),r=q?q.data.name:c;if(!r)try{var s=$I("support.AddressSupport");try{var t=l.param("cid");if(t){var u=s.data.extDataMap.contact[t];r=s.getGivenName(u)}}catch(v){}if(!r)if(1===p.length)try{r=s.getAddrObj(o,!0).FN}catch(v){r=a.Uri.getName(o)||o}else r=B.t("联系人")}catch(v){r=B.t("联系人")}var x,y,z,C=!1;try{z=p[0],C=0===z.indexOf("*@")}catch(v){}var D=q&&"group"===q.ctype;C?x=z.replace(/\*@/,""):(y=new a.UserLabel({name:r,address:D?c:z,group:D?q:c,popupRenderTo:l.scroller}),x=y.html()),n||(x='<b class="nui-txt-mark">'+x+"</b>"),g?x=B.t("与 ")+x+B.t(" 的邮件往来"):i?x=B.t("发给 ")+x+B.t(" 的邮件"):h&&(x+=B.t(" 发来的邮件")),$G.environment.isCh||(x=x.replace("我","Me "));var E=l.param("from");if(n){var G,H;"emails"===E?(H=B.t("联系人邮件"),G=function(){w.emails()}):(H=x,x=B.t("未读邮件"),G=function(){w.contacts(q?q.data:o)}),b.path={items:[{xtype:"link",text:H,extcls:"nui-txt-link",click:G}]},b.text=x,b.tips=j.getAllRead()}else{if(E&&"emails"!==E)try{var I=A.getGroup(E);I&&(b.path={items:[{xtype:"link",text:F.encodeHTML(I.data.name),extcls:"nui-txt-link",click:function(){w.contacts(I.data)}}]})}catch(v){}b.extcls="qf1",b.text=x;var J=[],K=l.getTotal(),L=A.getInfo(o,"unread");if(g&&L>0){var M=new a.Link({text:L+B.t(" 封未读"),extcls:"nui-txt-link",click:function(){l.log("title","unread","contact"),w.contacts(q?q.data:o,{read:!1})}});J.push(M.html()),J.push(j.getAllRead(!0))}else J.push(B.t("共 ")+K+B.t(" 封"));if(!l.extend("systemContacts")){if(!g){var N=new a.Link({text:B.t("查看邮件往来"),extcls:"nui-txt-link",click:function(){l.log("title","contact","from"),w.contacts(q?q.data:o,{from:l.param("from")})}});J.push(N.html())}if(!i){var O=new a.Link({text:B.t("查看我发送的"),extcls:"nui-txt-link",click:function(){l.log("title","contact","to"),w.contacts(q?q.data:o,{type:"to",from:l.param("from")})}});J.push(O.html())}if(!h){var P=new a.Link({text:B.t("查看发给我的"),extcls:"nui-txt-link",click:function(){w.contacts(q?q.data:o,{type:"from",from:l.param("from")})}});J.push(P.html())}}J.length>0&&(b.tips=" ( "+J.join(" ")+" )")}q&&"group"===q.ctype&&j.getGroupContact(b,q)}function l(a){var b=this,c=b.view,d=c.module,e=d.param("filter"),f=e&&e.flags&&e.flags.read===!1;a.text=B.t("联系人")+(f?B.t("未读"):"")+B.t("邮件"),a.tips=b.getAllRead(),b.getContactRead(a)}function m(a){var b=this,c=b.view,d=c.module,e=d.param("fids");if(e&&1===e.length){var f=e[0],g=z.get(f),h=D.bind(w.entry,w,{fid:f},{type:"list",subtype:"folder"});a.path={items:[{xtype:"link",text:g.name,extcls:"nui-txt-link",click:h}]}}var i=d.getCondition();i&&(a.text=i)}function n(b){var c=this,d=c.view,e=d.module,f=e.extend(),g=e.param(),h=e.getTotal(),i=e.getCondition();i&&(i=B.t("已搜索到 ")+h+B.t(" 封")+i+B.t("的邮件"));var j="",k="";if("full"!==f.subtype&&"true"===$G.user.searchid){var l=new a.Link({title:B.t("使用全文搜索"),text:B.t("全文搜索"),extcls:"nui-txt-link",click:function(){try{var a=$L("interface.MboxInterface",this)}catch(b){return b}a.find({keyword:g.conditions[0].operand,isFullSearch:!0,isForceFullSearch:!0})}});k=B.t("，搜索更多邮件使用")+l.html()+B.t("试试")}if(h>0){var m=new a.Link({title:B.t("删除所有邮件"),text:B.t("删除所有邮件"),extcls:"nui-txt-link",click:D.bind(d.removeAll,d)});j="&nbsp;"+m.html()}b.text=B.t("搜索结果"),b.tips=" "+i+k+j;var n=e.param("fids");if(n&&1===n.length){var o=z.get(n[0]),p=D.bind(w.entry,w,{fid:n[0]},{type:"list",subtype:"folder"});b.path={items:[{xtype:"link",text:o.name,click:p}]}}}function o(b){var c=this,d=c.view,e=d.module,f=e.getTotal(),g=e.getCondition();g&&(g=B.t("已搜索到 ")+f+B.t(" 封")+g+B.t("的邮件"));var h="";if(e.hasAdditional()){var i=new a.Link({title:B.t("取消所有附加条件"),text:B.t("取消所有附加条件"),bracket:!0,extcls:"nui-txt-cLink",click:D.bind(d.additionalSearch,d)});h="&nbsp;"+i.html()}var j="";if(f>0){var k=new a.Link({title:B.t("删除所有邮件"),text:B.t("删除所有邮件"),extcls:"nui-txt-cLink",click:D.bind(d.removeAll,d)});j="&nbsp;"+k.html()}b.text=B.t("搜索结果"),b.tips=" "+g+h+j}function p(b){var c=this,d=c.view,e=new a.Link({title:B.t("全部设置为已读邮件"),text:B.t("全部设为已读"),extcls:"nui-txt-link",click:function(){d.module.log("title","setallread"),d.setAllRead()}}).html();return b||(e="&nbsp;"+e+"&nbsp;"),e}function q(b){var c=this;if(c.view.module,"l-r"!==c.view.getLayout()&&b){var d=0,e=A.contacts;if(e){var f=[];f[f.length]={text:B.t("全部联系人"),click:D.bind(w.emails,w)};for(var g=0,h=e.length;h>g;g++){var i=e[g],j=A.getInfo(i.data,"unread");d+=j,j>0&&(f[f.length]={text:F.encodeHTML(i.data.name),click:D.bind(w.entry,w,{filter:{chatWithAddress:i.str,flags:{read:!1}},from:"emails"},{type:"list",subtype:"contacts"})})}if(d>0){var k=b.extItems=[];k[k.length]={xtype:"link",extcls:"nui-txt-link",text:B.t("按星标联系人筛选&nbsp;")+'<b class="nui-ico nui-ico-dArr">d</b>',listeners:{render:function(){var b=new a.Menu({groups:[{items:f}],reverse:!0});b.attachTo({clickFrom:this.getEl()})}}}}}}}function r(b,c){var d=this;if(d.view.module,"l-r"!==d.view.getLayout()&&b){for(var e=c.data.contacts,f=[],g=c.data.cid,h=0,i=e.length;i>h;h++){var j=e[h];f[f.length]={text:F.encodeHTML(j.name),click:D.bind(w.entry,w,{filter:{chatWithAddress:j.emails.join().toLowerCase()},from:g,cid:j.cid},{type:"list",subtype:"contacts"})}}var k=b.extItems=[];k[k.length]={xtype:"link",extcls:"nui-txt-link",text:B.t("全部成员的邮件&nbsp;")+'<b class="nui-ico nui-ico-dArr">d</b>',listeners:{render:function(){var b=new a.Menu({groups:[{items:f}],reverse:!0});b.attachTo({clickFrom:this.getEl()})}}}}}function s(){var b=this,c=b.view.module,d=b.getConfig(),e=b.title=new a.Title(d),f=!c.isNone()&&C.count(d)>0?"":"display:none;",g='<div class="tb0" style="'+f+'">'+e.html()+"</div>";return g}function t(){var b=this,c=b.view.module,d=b.title,e=b.getConfig(),f=a(d.getEl().dom.parentNode);!c.isNone()&&C.count(e)>0?(d.update(e),f.show()):f.hide()}function u(){var a=this;try{a.title.destroy(),a.title=null}catch(b){}}function v(a){var b=this;b.view=a}try{var w=$L("interface.MboxInterface")}catch(x){return x}try{var y=$L("init.Tag")}catch(x){return x}try{var z=$L("init.Folder")}catch(x){return x}try{var A=$L("init.Contacts")}catch(x){return x}var B=new $I18N("module.mbox.Title"),C=a.Object,D=a.Function,E=a.Array,F=a.String,G=a.createClass($N("module.mbox.Title"));C.extend(G.prototype,{view:null,title:null,getConfig:d,getTag:e,getDefer:f,getFlag:g,getRead:h,getCalendar:i,getFolder:j,getContacts:k,getEmails:l,getFilter:m,getNormal:n,getFull:o,getAllRead:p,getContactRead:q,getGroupContact:r,get:s,update:t,destory:u,initialize:v})}($,window),function(a){function b(b){"undefined"==typeof b&&(b=a.Ud.get({field:"ntes_inbox",flag:"search_type"})-0);var c="",d=this.fields;return g.each(d,function(d,e){return b===e.value?(c=e.key,a.BREAK):void 0}),c}function c(){return h.fields}function d(){var b=h.dateDiff;if(!h._dateInited){var c=$I("util.Misc").getTime(0);a.Array.each(b,function(b,d){var e=a.Date.addDate(c,-d.diff);e.setHours(23),e.setMinutes(59),e.setSeconds(59),d.date=new Date(1e3*Math.floor(e.getTime()/1e3)+999),d.count=0}),h._dateInited=!0}return b}function e(b){function c(){for(var c,d,e=h.getFields(),f=0,g=i.length;g>f;f++){var j=i[f];if(j.checked){d=j.value,c=e[d];break}}a.Ud.set({field:"ntes_inbox",flag:"search_type",value:c.value}),b.additionalSearch("scope",d)}function d(b,c,d,e){var h=b===c-0,j=(h?"<strong>"+d+"</strong>":d)+(e?'<span class="nui-txt-mark">'+f.t("(推荐)")+"</span>":""),k=new a.Radio({text:j,value:c,name:g,checked:h});return i.push(k),k.html()+"<br/>"}var e=b.module,g=e.createId("searchFiledRadio"),i=[];a.Ud.get({field:"ntes_inbox",flag:"search_type"})-0;var j="					"+d(2,"title",f.t("主题"))+"					"+d(1,"sender",f.t("发件人+收件人"))+"					"+d(4,"sendtitle",f.t("发件人+主题"))+"					"+d(0,"default",f.t("主题+正文"),!0)+"					"+d(3,"all",f.t("主题+正文+附件"),!1,!0)+"		";a.Msgbox.show({type:"confirm",content:j,title:f.t("请选择默认搜索范围"),header:f.t("设置默认搜索范围"),ok:c}),a.Radio.group(i),a.Component.setEvents()}var f=new $I18N("module.mbox.Field"),g=a.Object,h=a.createClass($N("module.mbox.Field"));g.extend(h,{fields:{title:{key:"subj",title:f.t("主题"),value:2},sender:{key:"from,to",title:f.t("发件人+收件人"),value:1},sendtitle:{key:"from,subj",title:f.t("发件人+主题"),value:4},"default":{key:"from,to,subj,cont,aname",title:f.t("主题+正文"),value:0},all:{key:"from,to,subj,cont,aname,acont",title:f.t("主题+正文+附件"),value:3}},dateDiff:[{name:f.t("三天内"),diff:3},{name:f.t("一周内"),diff:7},{name:f.t("一月内"),diff:30},{name:f.t("三月内"),diff:90},{name:f.t("三月前"),diff:1e5}],_dateInited:!1,getField:b,getFields:c,getDateDiff:d,setDefaultFields:e})}($,window),function(a){function b(){var b=this,c=b.view.module,d=c.getEl("none_like");d&&d.click(function(){var b=c.getEl("none_div").attr("infoKey"),e=a.Storage.get("none_like")||0,f=a.Array.indexOf(l,b);if(d.hasClass("mx3")){e=a.Number.setBit(e,f,0),d.removeClass("mx3");var g="un_"+b,h={};h[g]=1,a.Log.cache(h)}else{e=a.Number.setBit(e,f,1);var g="un_"+b,h={};h[g]=1,a.Log.cache(h),d.addClass("mx3")}a.Storage.set("none_like",e)})}function c(){var b=this,c=b.view.module;b.init();var d=b.getContent(),e=c.isNone();e&&(a.fly(c.container).addClass("vH0"),setTimeout(function(){b.noneEvent()},200));var f=['<div id="',c.createId("NoneDiv"),'"',e?"":' style="display:none;"',">",d,"</div>"].join("");return f}function d(){var b=this,c=b.view.module;b.init();var d=c.isNone(),e=c.getEl("NoneDiv"),f=a.fly(c.container),g="vH0";d?(e.html(b.getContent()),e.show(),f.addClass(g)):(e.hide(),f.removeClass(g))}function e(){function b(b){var c=new a.Link({title:h.t("输入安全锁密码查看所有邮件"),text:h.t("输入安全锁密码查看所有邮件"),cls:"nui-txt-link mh1",click:function(){a.AdvLock.show(function(){d.refresh()})}});b.push(c.html())}var c=this,d=c.view,e=d.module,f=e.extend("type"),g=e.extend("subtype"),k=e.extend("systemContacts"),m="search"===f,n="flag"===g,o="tag"===g,p="defer"===g,q="folder"===g,r="calendar"===g,s="emails"===g,t="read"===g,u="contacts"===g,v=!1,w=e.getCondition(),x=$S("advLock"),y=!x.disabled&&!x.authenticated2&&(x.pop||x.folders);try{v=e.param("filter").flags.read===!1}catch(z){}var A,B,C,D,E=["wn2"],F=[];y&&b(F);var G=new a.Link({title:h.t("刷新试试看"),text:h.t("刷新试试看"),cls:"nui-txt-link mh1",click:function(){e.log("none","refresh"),e.container.style.display="none",d.refresh()}}),H=h.t("建议您：")+G.html();if(t||v){var I=e.param("filter");if(I&&""===I.chatWithAddress){C=h.t("您还没有设置星标联系人");var J=new a.Link({title:h.t("设置“星标联系人”"),text:h.t("设置“星标联系人”"),cls:"nui-txt-link mh1",click:function(){e.log("none","setcontact");try{var a=$L("interface.AddressInterface",this)}catch(b){return b}a.entry({action:"marked"})}});F.push(H),F.push(J.html()+h.t("，方便在“星标联系人邮件”中查看和他们的邮件往来")),E.push("nP1"),B="nomail_star"}else{C=h.t("没有未读邮件"),F.push(h.t("所有邮件都是“已读”状态，休息一下吧，"));var K=new a.Link({title:h.t("已删除"),text:h.t("已删除"),cls:"nui-txt-link mh1",click:function(){e.log("none","viewdeleted");try{var a=$L("interface.MboxInterface",this)}catch(b){return b}a.entry({fid:4})}});H+="，"+h.t("或去“")+K.html()+h.t("”里找找看"),F.push(H),E.push("lk1"),B="nomail_unread"}}else if(m){C=h.t("抱歉，没有搜索到关键字为“"),w&&(C+='<span class="nui-txt nui-txt-mark">'+w+"</span>"),C+=h.t("”的邮件");try{F.push(h.t("建议您检查搜索条件：关键字是否有错误，或者更换关键字搜索；去掉特殊符号重新搜索"));var L=$I("module.mbox.Field");if(e.param("pattern")&&e.param("fts.fields")!==L.getField(3)){var M=new a.Link({title:h.t("高级搜索"),text:h.t("高级搜索"),cls:"nui-txt-link mh1",click:function(){e.log("none","research"),d.additionalSearch("scope","all")}});F.push(h.t("使用")+M.html()+h.t("试试，或")+G.html())}}catch(z){}if("full"!==g&&"true"===$G.user.searchid){var N=new a.Link({title:h.t("使用全文搜索"),text:h.t("全文搜索"),extcls:"nui-txt-link",click:function(){var a=i.clone(e.param()),b=a.conditions[0].operand||a.conditions[0].conditions[0].operand;try{var c=$L("interface.MboxInterface",this)}catch(d){return d}c.find({keyword:b,isFullSearch:!0,isForceFullSearch:!0})}});F.push(h.t("使用")+N.html()+h.t("试试，或")+G.html())}E.push("pq1"),B="nomail_new"}else if(n){C=h.t("您还没有设置 ")+(w?w:h.t("旗帜"))+h.t("邮件"),F.push(h.t("将重要邮件标记为“")+(w?w:h.t("旗帜"))+"”"+h.t("，就能在“"+(w?w:h.t("旗帜"))+"邮件”中快速找到这些邮件"));for(var O=a.LETTERFLAG,P=[],Q=1,R=O.length;R>Q;Q++)O[Q]&&(P[P.length]={text:O[Q],icon:"flag-"+Q,extcls:"nui-txt-flag"+Q,click:function(a){return function(){try{var b=$L("interface.MboxInterface",this)}catch(c){return c}b.entry({filter:{label0:a}},{type:"list",subtype:"flag"})}}(Q)});var S=new a.Link({extcls:"nui-txt-link",text:'<b class="nui-ico nui-ico-flag nui-ico-flag-0"></b>'+h.t("其他旗帜&nbsp;")+'<b class="nui-ico nui-ico-dArr">d</b>',listeners:{render:function(){var b=new a.Menu({groups:[{items:P}]});b.attachTo({clickFrom:this.getEl()})}}});F.push(H+h.t("，或者点击查看")+S.html()),E.push("nN1"),B="nomail_flag"}else if(o){C=h.t("该标签下没有邮件"),F.push(H);var K=new a.Link({title:h.t("已删除"),text:h.t("已删除"),cls:"nui-txt-link mh1",click:function(){e.log("none","viewdeleted");try{var a=$L("interface.MboxInterface",this)}catch(b){return b}a.entry({fid:4})}}),T=new a.Link({title:h.t("添加标签"),text:h.t("添加标签"),cls:"nui-txt-link mh1",click:function(){e.log("none","addTag");try{var a=$L("support.Tag",this)}catch(b){return b}a.add({from:"none"})}});F.push(h.t("去“")+K.html()+h.t("”里找找看，或")+T.html()+h.t("更好地管理邮件")),E.push("nM1"),B="nomail_type"}else if(p)C=h.t("您目前没有待办邮件"),F.push(h.t("将邮件标记为“待办”并设置处理时间，到期时邮箱会提醒您处理该封邮件")),F.push(H),E.push("nL2"),B="nomail_todo";else if(s)C=h.t("没有未读的联系人邮件");else if(q){var U=e.param("fid"),V=$I("init.Folder").get(U);if(C=5==U||7==U||18==U?h.t("没有")+V.name:V.name+h.t("没有邮件哦"),F.push(H),e.isArchive()){var W=e.extend("area"),X=h.t("查看")+("archive"===W?h.t("最近"):h.t("更早"))+h.t("的邮件"),Y=new a.Link({title:X,text:X,cls:"nui-txt-link mh1",click:function(){e.log("none","viewarea"),d.goPage("archive"===W?-1:e.getPage())}});F.push(Y.html())}if((4===U||15===U)&&a.Ext.recovery&&!$S("isVip")){var Z=new a.Link({title:h.t("通过误删恢复找回邮件"),text:h.t("恢复误删的邮件"),cls:"nui-txt-link mh1",click:function(){e.log("none","recovery");try{var a=$L("interface.OutlinkInterface",this)}catch(b){return b}a.goOutlink({key:"recovery",title:h.t("误删恢复")})}});F.push(Z.html())}var $=V.flags;if(!$.system)if($.custom){var _=new a.Link({title:h.t("设置来信分类"),text:h.t("设置来信分类"),cls:"nui-txt-link mh1",click:function(){e.log("none","setfilter");try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.goFilter({folder:U})}});F.push(_.html()+h.t("，将指定的邮件分类到此文件夹"))}else if($.pop){var ab=new a.Link({title:h.t("立即收取邮件"),text:h.t("立即收取邮件"),cls:"nui-txt-link mh1",click:function(){e.log("none","receive");try{var a=$L("support.MailCenter",this)}catch(b){return b}a.receive({type:"fid",value:U})}});F.push(ab.html())}E.push("pq1"),B="nomail_new"}else if(r){if(C=w+h.t(" 没有收到邮件"),"date"===e.extend("calendar"))try{var bb=e.param("filter").sentDate,cb=e.constructor,db=bb.split(":")[0],eb=cb.parseSentDate(db),fb=new a.Link({title:h.t("查看 ")+w+h.t(" 附近七天邮件"),text:h.t("查看附近七天邮件"),cls:"nui-txt-link mh1",click:function(){e.log("none","calendar"),d.toolbar.toolbar.find("calendar")[0].fire("select",j.addDate(eb,-3),j.addDate(eb,3))}});F.push(h.t("建议您：")+fb.html()),F.push(G.html())}catch(z){}E.push("pq1"),B="nomail_new"}else u&&k?(C=h.t("系统没找到相关邮件，原因可能是:"),F.push(h.t("1.您曾经清理过相关的邮件")),F.push(h.t("2.该网站的确没给您发过邮件"))):(C=h.t("抱歉，没有找到")+w+h.t("相关邮件哦"),F.push(H));var gb;if(""!==d.getLayout()?gb="uZ1":(1===E.length&&(E.push("pq1"),B="nomail_new"),A=E.join(" ")),$S("isVip")){var hb=new a.Link({text:h.t("文件恢复"),cls:"nui-txt-link",click:function(){$I("util.CustomAppManager").goOutLink("recovery",h.t("文件恢复"))}}),ib=new a.Icon({extcls:"nui-ico-tequan"});F.push(h.t("试试")+hb.html()+ib.html())}D=F.join("<br />");var jb=a.Storage.get("none_like")||0,kb=a.Array.indexOf(l,B),lb=1==a.Number.getBit(jb,kb),mb=h.t("仔细搜索了一下，竟没有发现任何蛛丝马迹！");switch(kb){case 0:mb=h.t("穿越人群， 要做就做最明亮的星！");break;case 1:mb=h.t("把重要的时间留给重要的事情吧！");break;case 2:mb=h.t("标上了旗帜的位置， 随时可达呢!");break;case 3:mb=h.t("仔细搜索了一下，竟没有发现任何蛛丝马迹！");break;case 4:mb=h.t("休息一下吧，美食与工作都不可负！");break;case 5:mb=h.t("处女座的分类日常总是最有效 ：）")}var nb=['<div class="Bp0 ',gb,'" id="',e.createId("none_div"),'" infoKey="',B,'">','<div class="',A,'" style="background-color: #',$S("skin").color||"6A8DE5",';"></div>','<div class="pl1">','<div class="sB1">',C,"</div>",'<div class="uU0">',$G.environment.isCh?D:"","</div>","</div>"].concat($G.environment.isCh?['<div class="wb1">','<div class="pk1">','<div class="nJ1">',mb,"</div>",'<div class="pi1 ',lb?"mx3":"",'" id="',e.createId("none_like"),'"></div>',"</div>","</div>"]:[]).concat(["</div>"]).join("");return nb}function f(){var a=this,b=a.view.module;a.page=b.getPage(),a.type=b.extend("type"),a.subtype=b.extend("subtype")}function g(a){var b=this;b.view=a}var h=new $I18N("module.mbox.None"),i=a.Object,j=a.Date,k=a.createClass($N("module.mbox.None")),l=["nomail_star","nomail_todo","nomail_flag","nomail_new","nomail_unread","nomail_type"];i.extend(k.prototype,{view:null,page:0,type:null,subtype:null,get:c,update:d,getContent:e,init:f,initialize:g,noneEvent:b})
}($,window),function(a,b,c){function d(){var a=this,b=a.view.module;a.init();var c=a.getContent(),d=['<div class="te0 nui-btnGroup" id="',b.createId("PagerDiv"),'" style="display:none;">',c,"</div>"].join("");return d}function e(){var a=this,b=a.view.module;a.init();var c=b.getEl("PagerDiv");a.hidden?c.hide():(c.html(a.getContent()),c.show())}function f(){var b,d,e=this,f=e.view,g=f.module,h=e.page,i=g.extend("index"),k=g.extend("area");g.isArchive()&&(b="normal"===k,d="archive"===k);var l=[];if(!e.hidden){var m=h-1,n=i>0||d?function(){g.log("pager","previous"),f.goPage(i-1)}:c,o=!n,p=m>i||b?function(){g.log("pager","next"),f.goPage(i+1)}:c,q=!p;l[l.length]=new a.Button({xtype:"button",icon:"prev",subclass:"roundBtn",params:"hasText",disabled:o,click:n,text:j.t("上一页"),title:j.t("上一页")}).html(),l[l.length]=new a.Button({xtype:"button",icon:"next",subclass:"roundBtn",params:"hasText hasLeftText",disabled:q,click:p,text:j.t("下一页"),title:j.t("下一页")}).html()}return l.join("")}function g(){var a=this,b=a.view.module;try{a.hidden||b.getEl("PagerDiv").show()}catch(c){}}function h(){var a=this,b=a.view.module;a.page=b.getPage(),a.hidden=a.page<(b.isArchive()?1:2)}function i(a){var b=this;b.view=a}var j=new $I18N("module.mbox.Pager"),k=a.Object,l=a.createClass($N("module.mbox.Pager"));k.extend(l.prototype,{view:null,hidden:!1,page:0,get:d,update:e,getContent:f,show:g,init:h,initialize:i})}($,window),function(a,b,c){function d(d,e){var f=this,g=f.view,h=g.module,i=h.extend("subtype"),j={};if(f.inited||f.initialize(g),f.infos!==!1){for(var k,l=h.param("order"),m=d.flags.expire,n=d.flags.top,o="defer"===i?d.defer:d.sentDate,p="from"===l?a.Uri.getAddress(d.from.toLowerCase()):c,q=h.isTop(),r=f.infos,s=0,t=r.length;t>s;s++)if(k=r[s],"from"===l){if(k.email===p)break}else{if(m&&k.expire)break;if(n&&q&&k.top)break;if(o>=k.start&&o<k.end)break}if(k.div||k.id)k.count?k.count++:k.count=1;else{k.count=1;var u={},v="nn0";if(!f.once){var w=$S("isFree"),x=h.param("fid");w&&2!==x&&k.date&&(v="nn0 gU0",h.extend("smart")&&(u.style="display:none;")),f.once=!0}if(u.id=h.createId((k.start?k.start.getTime().toString():"top")+(new b.Date).getTime().toString()),u.className="tb0 "+v,u.innerHTML='<span class="jM0">'+k.name+'</span><span class="nui-title-tips nui-txt-tips"></span>',u["aria-label"]=k.name+(k.email?"&lt;"+k.email+"&gt;":""),u.tabIndex=0,e){var y=[],z="";for(var A in u){var B=u[A];switch(A){case"className":y.push('class="'+B+'"');break;case"tabIndex":y.push('tabindex="'+B+'"');break;case"innerHTML":z=B;break;default:y.push(A+'="'+B+'"')}}var C=["<div ",y.join(" "),">",z,"</div>"].join("");k.id=u.id,j.html=C}else{var D=k.div=document.createElement("DIV");for(A in u){var B=u[A];"aria-label"===A?D.setAttribute(A,B):D[A]=B}j.div=D}}}return j}function e(){for(var a=this,b=a.infos,c=0,d=b.length;d>c;c++){var e=b[c],f=e.div;if(f||(f=e.div=document.getElementById(e.id),e.id=null),f)try{var g=f.getElementsByTagName("SPAN"),h=g[g.length-1];h.innerHTML="("+e.count+")"}catch(i){}}}function f(){var a=this,b=a.infos;if(b!==!1)for(var c=0,d=b.length;d>c;c++){var e=b[c],f=e.div?e.div:e.id?document.getElementById(e.id):null;try{f&&f.parentNode.removeChild(f)}catch(g){}delete e.div,delete e.id,delete e.count}a.reinit&&(a.inited=!1),a.once=!1}function g(d){var e=this;e.view=d;var f=d.module,g=f.param("order"),i=!0;if("date"===g||"deferredDate"===g){var k,l,m,n=e.infos=[],o=1,p=a.Misc.getTime(0),q=new b.Date(-1e4,0,1),r=new b.Date(1e4,0,1),s=new b.Date(p.getFullYear(),p.getMonth(),p.getDate()+1),t=s;if("date"===g){f.extend("expire")&&(n[n.length]={name:h.t("今日需要处理的待办邮件"),expire:!0}),f.isTop()&&(n[n.length]={name:h.t("置顶"),top:!0});for(var u=0,v=p.getDay();v>=u&&!(o>-1&&u>o);u++)0===u?(k=h.t("今日"),l=n.length):k=1===u?h.t("昨日"):h.t("周")+j.getWeek(p,-u),m=new b.Date(j.addDate(t,-1)),n[n.length]={name:k,start:m,end:t,date:!0},t=m;n[n.length]={name:h.t("更早"),start:q,end:t,date:!0},n[l].end=r}else"deferredDate"===g&&(n[n.length]={name:h.t("需要处理的待办邮件"),start:q,end:s},n[n.length]={name:h.t("尚未到期的待办邮件"),start:s,end:r})}if("from"===g){var w;try{w=$I("support.AddressSupport")}catch(x){}e.reinit=!0;var y=f.getCacheData(),z={};if(y&&y.length>0)for(var n=e.infos=[],u=0,v=y.length;v>u;u++){var A=y[u],B=a.Uri.getAddress(A.from.toLowerCase());if(!z[B]){var C=a.Uri.getEmails(B,c,!0),D=C.match,k=B;try{if(1===D.length){var E=D[0];E.force=!0,k=w.getName(E)}}catch(x){}n[n.length]={name:a.String.encodeHTML(k),email:B},z[B]=!0}}else i=!1}e.inited=i}var h=new $I18N("module.mbox.Period"),i=a.Object,j=a.Date,k=a.createClass($N("module.mbox.Period"));i.extend(k.prototype,{infos:!1,view:null,once:!1,inited:!1,reinit:!1,get:d,count:e,reset:f,initialize:g})}($,window),function(a,b){function c(){var a=this,b=a.view.module,c=null;return b.extend("brand")||(c=a.selectFolder(c),c=a.defer(c),c=a.popDeleteInfo(c),c=a.popDeleteFolder(c),c=a.advLock(c),c=a.secondAuth(c),c=a.spamFolder(c),c=a.deleteFolder(c),c=a.systemDelete(c),c=a.forward(c),c=a.antiSpam(c),c=a.popInfo(c),c=a.recovery(c)),c=a.hide(c),c.subclass="tipsBlock",c.closeclick||(c.closeclick=null),c}function d(c){var d=this;if(c)return c;try{var e=d.view,f=e.module,g=a.Misc.getTime(),h=f.param("fid");if(1==h&&g<=new b.Date(2018,11,6)&&null!==$S("sslSecondauth")&&$S("sslSecondauth")===!1){var i,j=new a.Link({text:C.t("马上开启"),click:function(){f.log("mboxSecondAuth",1);try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"MailSecurityModule",linkName:"secondauth"})}});i='<i class="nui-ico nui-ico-remind"></i>'+C.t(" 邮件隐私泄露后悔莫及？您还未开启登录二次验证，邮箱存在安全隐患，赶快行动！")+j.html(),c={content:i,extcls:"nui-textBlock nui-textBlock-err",hasClose:!0}}}catch(k){}return c}function e(b){var c=this;if(b)return b;try{var d=c.view,e=d.module;if(e.isSelectFolder()&&d.allSelected){var f,g,h=!!d.folderSelected,i=e.param("fid"),j=z.get(i),k=z.getInfo(i);h?(f=new a.Link({text:C.t("清除选中"),cls:"nui-txt-link",click:function(){a.Thread.run(function(){d.setFolderSelect(!1)},0)}}),g=C.t("已选中 ")+j.name+" "+k+C.t(" 封邮件，您也可以 ")+f.html()):(f=new a.Link({text:C.t("选择所有"),cls:"nui-txt-link",click:function(){a.Thread.run(function(){d.setFolderSelect(!0)},0)}}),g=C.t("已选中当前页所有邮件，您也可以 ")+f.html()+" "+j.name+" "+k+C.t(" 封邮件")),b={content:g}}}catch(l){}return b}function f(b){var c=this;if(b)return b;try{var d=c.view.module,e=d.param("fid"),f=A.getInfo("expire");if(Thread.check()&&A.showTop(e,!0)&&f>0){var g,h=new a.Link({text:C.t("立即查看并处理"),cls:"nui-txt-link",click:function(){d.log("tips","defer"),B.defer()}});g='<span class="nui-txt-alert uT0"><b class="nui-ico nui-ico-todo nui-ico-todo-selected"></b>'+C.t(" 您有 ")+"<strong>"+f+"</strong>"+C.t(" 封待办邮件尚未处理，")+"</span>"+h.html(),b={content:g}}}catch(i){}return b}function g(c){var d=this,e=d.view,f=e.module,g=f.param("fid");if(c||1!==g)return c;try{var h=z.get(15);if(!h)return c;var i="popDeleteInfo";if($S(i))try{var j=$S(i).data,k=j.lastDelTime;if(k>j.lastCloseTipsTime){var l,m,n=new b.Date(k);l=new a.Link({text:h.name,cls:"nui-txt-link",click:function(){B.entry({fid:15},{type:"list",subtype:"folder"})}}),m=C.t("部分邮件在 ")+a.Date.format(n,"yyyy-MM-dd HH:mm")+C.t(" 被客户端收取并删除，被删邮件已备份到 ")+l.html()+C.t(" 文件夹"),c={content:m,closeclick:function(){a.Ajax.jsonp(a.Uri.getUrl("popDelSet"),function(a){$S(i,a)}),j.lastCloseTipsTime=(new b.Date).getTime(),d.update()}}}}catch(o){}else $S(i,!0),a.Ajax.jsonp(a.Uri.getUrl("popDelQuery"),function(a){$S(i,a),d.update()})}catch(o){}return c}function h(b){var c=this;if(b)return b;try{var d=c.view,e=d.module,f=e.param("fid");if(15===f){var g,h,i,j,k=z.get(f),l={cls:"nui-txt-link",click:function(){try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"options.AntiSpamModule",inputName:"keepPeriod4"}),e.cleanCache()}},m=k.keepPeriod;m>0?(l.text=C.t("修改"),i=new a.Link(l),j=C.t("自动删除")+m+C.t("天")+"("+i.html()+")"+C.t("以上邮件")):(l.text=C.t("点击设置自动清理"),i=new a.Link(l),j=i.html()),g=new a.Link({text:C.t("禁止客户端收信"),cls:"nui-txt-link",click:function(){a.Nav.entry("OptionInterface",{module:"options.OptionOutLinkModule",linkName:"smtp"})}});var n="";if($S("isFree")){var o="deleteRecovery";x.getProductStatue(o,function(b){if(!b){var c=new a.Link({text:C.t("误删恢复（开通日期之后误删的邮件10天内可恢复）"),cls:"nui-txt-link",click:function(){x.showProduct(o,"deleted_del")}});n="&nbsp;"+c.html()}})}h=C.t("被客户端收取并删除的邮件备份在此，")+j+C.t("，")+g.html()+n,b={content:h}}}catch(p){}return b}function i(b){var c=this;if(b)return b;try{var d=c.view,e=d.module,f=e.param("fid"),g=e.param("fids"),h=$S("advLock"),i=!h.disabled&&!h.authenticated2&&(h.pop||h.folders),j=!1;if(!f&&g&&1===g.length&&(f=g[0]),f>0)j=h[f];else try{var k;try{k=e.param("filter").flags.read===!1}catch(l){}var m=k?"unread":"",n=e.getTotal(),o=e.extend("subtype");if("defer"===o)j=A.getInfo("total")>n;else if("tag"===o){var p=e.param("tag");j=y.getInfo(p[0],m)>n}else if("contacts"===o){var q=e.param("filter").chatWithAddress;j=$I("init.Contacts").getInfo(q,m)>n}else for(var r=0,n=0,s=0,t=g.length;t>s;s++){var u=g[s];if(h[u])if(k){if(r+=z.getInfo(u,"unread"),r>0){j=!0;break}}else if(n+=z.getInfo(u),n>0){j=!0;break}}}catch(l){}if(i&&j){var v=new a.Link({text:C.t("输入安全锁密码"),cls:"nui-txt-link",click:function(){a.AdvLock.show(function(){d.refresh()})}}),w=v.html()+C.t(" 查看全部邮件");b={content:w}}}catch(l){}return b}function j(b){var c=this;if(b)return b;try{var d=c.view,e=d.module;e.param("fid"),e.extend("type");var f=e.extend("subtype"),g=e.extend("read"),h=e.param("fids");if("read"===f&&g===!1&&h.length>1){for(var i=$G.common.nolistids,j=!1,k=i.length-1;k>-1;k--)if(E.has(h,i[k])){j=!0;break}for(var l=0,m=[],k=i.length-1;k>-1;k--){var n=i[k],o=z.getInfo(n,"unread");l+=o,o>0&&m.push(z.get(n).name)}var p=m.join(C.t("，"));if(j){var q,r;q=new a.Link({text:C.t("点击此处查看"),cls:"nui-txt-link",click:function(){var a={exceptFids:$G.common.unnormalids.concat(1),filter:{flags:{read:!1}}},b=D.clone(e.getVar("extend"));b.index=0,B.entry(a,b)}}),r=q.html()+C.t("普通文件夹未读邮件"),b={content:r}}else if(l>0){var q,r;q=new a.Link({text:C.t("点击此处查看"),cls:"nui-txt-link",click:function(){var a={fids:i,filter:{flags:{read:!1}}},b=D.clone(e.getVar("extend"));b.index=0,B.entry(a,b)}}),r=C.t("不包含 ")+p+C.t(" 的未读邮件，")+q.html(),b={content:r}}}}catch(s){}return b}function k(b){var c=this;if(b)return b;try{var d=c.view,e=d.module,f=e.param("fids");if(f){var g,h,i=4;f.length>1&&!E.has(f,i)?z.getInfo(i)>0&&(g=new a.Link({text:C.t("点击此处查看"),cls:"nui-txt-link",click:function(){var a=D.clone(e.getVar("param"));a.fids=[i];var b=D.clone(e.getVar("extend"));b.index=0,B.entry(a,b)}}),h=C.t("不包含 已删除 文件夹的邮件， ")+g.html()):1===f.length&&f[0]===i&&(g=new a.Link({text:C.t("点击此处查看"),cls:"nui-txt-link",click:function(){var a=D.clone(e.getVar("param")),b=D.clone(e.getVar("extend"));delete a.fids,delete b.index,B.entry(a,b)}}),h=g.html()+C.t(" 普通文件夹邮件")),h&&(b={content:h})}}catch(j){}return b}function l(b){var c=this;if(b)return b;try{var d=c.view,e=d.module,f=e.param("fid"),g=z.get(f);if(g.keepPeriod){var h="";if(4!==f){var i=new a.Link({text:C.t("修改"),cls:"nui-txt-link",click:function(){try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"options.AntiSpamModule",inputName:"keepPeriod2"}),e.cleanCache()}});h="("+i.html()+")"}var j="";if($S("isFree")){var k="deleteRecovery";x.getProductStatue(k,function(b){if(!b){var c=new a.Link({text:C.t("误删恢复（开通日期之后误删的邮件10天内可恢复）"),cls:"nui-txt-link",click:function(){x.showProduct(k,"deleted_del")}});j="&nbsp;"+c.html()}})}var l="";if($S("isVip")){var m=new a.Link({text:C.t("文件恢复"),cls:"nui-txt-link",click:function(){$I("util.CustomAppManager").goOutLink("recovery",C.t("文件恢复"))}}),n=new a.Icon({extcls:"nui-ico-tequan"});l=m.html()+n.html()}b={content:C.t("“")+g.name+C.t("” 自动删除 ")+g.keepPeriod+C.t(" 天")+h+C.t("以上的邮件 (")+C.t("网易")+C.t("反垃圾系统已帮您拦截99.8%的垃圾邮件)")+j+l}}}catch(o){}return b}function m(b){function c(){$S("closeForwardTips",!0),a.Thread.delay(function(){d.update()},10)}var d=this;if(b)return b;try{var e=d.view.module.extend("subtype");if("folder"===e&&!$S("closeForwardTips")){var f=d.view;f.module;var g=v.getForwardAddr();if(g){var h=new a.Link({text:C.t("自动转发设置"),cls:"nui-txt-link",click:function(){c();try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"BaseSetModule",inputName:"autoForward"})}}),i=C.t("目前您的邮件已设置自动转发到 ")+g+C.t("。如需修改请点击 ")+h.html();b={content:i,closeclick:c}}}}catch(j){}return b}function n(b){function c(){$S("closeAntiSpamTips",!0),a.Thread.delay(function(){d.update()},10)}var d=this;if(b)return b;try{var e=d.view.module.extend("subtype");if("folder"===e&&!$S("closeAntiSpamTips")){var f=d.view,g=f.module,h=g.param("fid"),i=z.getInfo(h,"unread"),j=v.isLowAntiSpamLevel();if(20>h&&i>0&&j){var k=new a.Link({text:C.t("重新设置"),cls:"nui-txt-link",click:function(){c();try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"AntiSpamModule"})}}),l=C.t("垃圾邮件过多？可能是由于反垃圾级别设置过低或关闭了邮件智能分类，建议您 检查 或 ")+k.html();b={content:l,closeclick:c}}}}catch(m){}return b}function o(b){function c(){$S("closePopInfoTips",!0),a.Thread.delay(function(){d.update()},10)}var d=this;if(b)return b;try{var e=d.view.module.extend("subtype");if("folder"===e&&!$S("closePopInfoTips")){var f=d.view,g=f.module,h=g.param("fid"),i=z.getPopInfo(h);if(i.isPop&&i.stats){F.encodeHTML(new a.Email(i.username,i.name).toString());var j=i.stats.endTime||$I("util.Misc").getTime(0),k=G.format(j,"yyyy-M-d HH:mm"),l=i.stats,m=new a.Link({link:"pop3_skip_info",text:C.t("查看详情"),cls:"nui-txt-link",target:"_blank"}),n=[i.username,"&nbsp;"+C.t("于")+"&nbsp;",k,"&nbsp;"+C.t("收取到 ")+"<strong>",l.receivedMessageCount?l.receivedMessageCount:0,"</strong>"+C.t(" 封新邮件"),l.skippedMessageCount?C.t("，跳过了 ")+"<strong>"+l.skippedMessageCount+"</strong>"+C.t(" 封邮件")+"("+m.html()+")":"",l.spamMessageCount?C.t("，其中  ")+"<strong>"+l.spamMessageCount+"</strong>"+C.t(" 封被移到垃圾邮件箱"):"",l.errorMessageCount?C.t("，收取  ")+"<strong>"+l.errorMessageCount+"</strong>"+C.t(" 封出错"):"",l.rejectedMessageCount?C.t("，  ")+"<strong>"+l.rejectedMessageCount+"</strong>"+C.t(" 封被拒收"):"",l.excessMessageCount?C.t("，  ")+"<strong>"+l.excessMessageCount+"</strong>"+C.t(" 封超过单封邮件容量"):""].join("");b={content:n,closeclick:c}}}}catch(o){}return b}function p(b){function c(){$S("closeRecoveryTips",!0),a.Thread.delay(function(){d.update()},10)}var d=this;if(b)return b;try{var e=d.view.module.extend("subtype");if($S("isVip")&&"folder"===e&&!$S("closeRecoveryTips")&&!($S("cos").pref_mail_preserving_days>0)){var f=1;if(f>0){var g=new a.Link({text:C.t("立即开启")+"&gt;&gt;",cls:"nui-txt-link",click:function(){c(),$I("util.CustomAppManager").goOutLink("recovery",C.t("文件恢复"))}}),h=new a.Icon({extcls:"nui-ico-tequan"}),i=C.t("开启文件恢复，防止邮件丢失！")+h.html()+" "+g.html();b={content:i,closeclick:c}}}}catch(j){}return b}function q(a){var b=this,c=b.view.module;return!a||c.isNone()?a={hidden:!0}:a.hidden=!1,a}function r(){var b=this,c=b.getConfig(),d=b.block=new a.Block(c);return d.html()}function s(){var b=this,c=b.block,d=b.getConfig();c.update(d),a.Component.setEvents()}function t(){var a=this;try{a.block.destroy(),a.block=null}catch(b){}}function u(a){var b=this;b.view=a}try{var v=$L("support.OptionSupport")}catch(w){return w}try{var x=$L("product.Privileges")}catch(w){return w}try{var y=$L("init.Tag")}catch(w){return w}try{var z=$L("init.Folder")}catch(w){return w}try{var A=$L("init.Defer")}catch(w){return w}try{var B=$L("interface.MboxInterface")}catch(w){return w}var C=new $I18N("module.mbox.Tips"),D=a.Object;a.Function;var E=a.Array,F=a.String,G=a.Date,H=a.createClass($N("module.mbox.Tips"));D.extend(H.prototype,{view:null,block:null,getConfig:c,selectFolder:e,defer:f,popDeleteInfo:g,popDeleteFolder:h,advLock:i,spamFolder:j,deleteFolder:k,systemDelete:l,forward:m,antiSpam:n,popInfo:o,recovery:p,secondAuth:d,hide:q,get:r,update:s,destroy:t,initialize:u})}($,window),function(a,b,c){function d(a){var b=this,c={groups:[]},d=b.view,e=b.view.module;return b.select(c),b.complete(c),b.remove(c),"archive"!==e.extend("area")&&"defer"!==e.extend("subtype")&&b.report(c),b.control(c),b.recovery(c),b.refresh(c),b.calendar(c),b.extend(c,a),c.hidden=""===d.getLayout()&&e.isNone(),c}function e(a){var b=this,c=b.view,d=c.module,e=a.groups,f=[{xtype:"button",subclass:"dropdownBtn",checkbox:{checkedchange:function(a){d.log("toolbar","allornone"),c.select(a?"all":"none")},checked:c.allSelected},menu:{groups:[{items:[{text:C.t("全选"),click:function(){d.log("toolbar","all"),c.select("all")}},{text:C.t("不选"),click:function(){d.log("toolbar","none"),c.select("none")}},{text:C.t("未读"),click:function(){d.log("toolbar","unread"),c.select("unread")}},{text:C.t("已读"),click:function(){d.log("toolbar","read"),c.select("read")}}]}]}}];"defer"===d.extend("subtype")&&f[0].menu.groups[0].items.push({text:C.t("到期"),click:function(){c.select("expire")}}),e[e.length]={items:f}}function f(a){var b=this,c=b.view,d=c.module;if("defer"===d.extend("subtype")){var e=a.groups,f=[];f.push({xtype:"button",subclass:"mainBtn",text:C.t("设为完成"),icon:{type:"done",subtype:"white"},click:function(){d.log("toolbar","defercomplete"),c.setDefer("complete")}}),e[e.length]={items:f}}}function g(a){var b,c=this,d=c.view,e=d.module,f=a.groups,g=e.param("fid"),b=e.param("fids"),h=e.param("tag"),i=e.extend("smart"),j=C.t("删 除"),k=!1,l=!1;g>0?l=E.has([4,5,7,15,18],g):b&&(l=E.has(b,4)&&1===b.length),l||!h||i||(l=0===h[0].indexOf("%")),l?(j=C.t("彻底删除"),k=!0):2===g&&(j=C.t("删除草稿")),f[f.length]={items:[{xtype:"button",text:j,click:function(){e.log("toolbar",k?"permanentdeleted":"movetodeleted"),d.remove(k)},disabled:l?d.folderSelected:!1}]}}function h(a){var b=this,c=b.view,d=c.module,e=a.groups,f=d.param("fid"),g=c.folderSelected;if(!f||!E.has([2,3],f)){var h=[];E.has([5,7,18],f)&&h.push({xtype:"button",text:C.t("信 任"),click:function(){d.log("toolbar","report","normal"),c.setSpam(!1)},disabled:g}),h.push({xtype:"button",text:C.t("举 报"),click:function(){d.log("toolbar","report","spam"),c.setSpam(!0)},disabled:g}),e[e.length]={items:h}}}function i(a){var b=this,c=a.groups,d=c[c.length]={items:[]},e=d.items;b.mark(e),b.move(e),b.more(e)}function j(b){var c=this,d=c.view,e=d.module,f=(e.extend("type"),e.extend("subtype")),g=d.folderSelected,h={xtype:"button",subclass:"dropdownBtn",text:C.t("标记为"),menu:{groups:[]}};b.push(h);var i=h.menu.groups;if("defer"===f){var j=[{text:C.t("完成"),click:function(){d.setDefer("complete")},icon:"todo"}];i[i.length]={items:j}}var k="read"===f,l=e.extend("read"),m=[{text:C.t("已读"),click:function(){e.log("toolbar","setread"),d.setRead(!0)},disabled:k&&l},{text:C.t("未读"),icon:"unread",click:function(){e.log("toolbar","setunread"),d.setRead(!1)},disabled:k&&!l}];if("folder"===f&&m.push({text:C.t("全部设为已读"),click:function(){e.log("toolbar","setallread"),d.setAllRead()}}),i[i.length]={items:m},e.isDefer()&&"defer"!==f){var n=[{text:C.t("待办邮件"),click:function(){e.log("toolbar","setdefer"),d.setDefer("add")},disabled:g,icon:"todo"}];i[i.length]={items:n}}if(e.isFlag()){for(var o=a.LETTERFLAG,p=[],q="flag"===f,r=e.extend("flag"),s=2,t=o.length;t>s;s++)o[s]&&(p[p.length]={text:o[s],icon:"flag-"+s,extcls:"txt-flag"+s,click:function(a){return function(){e.log("toolbar","setflag",a),d.setFlag(a)}}(s),disabled:q&&r===s});i[i.length]={items:[{text:C.t("红旗"),icon:"flag-1",extcls:"txt-flag1",click:function(){e.log("toolbar","setflag",1),d.setFlag(1)},disabled:q&&1===r},{text:C.t("其他旗帜"),icon:"flag-0",menu:{groups:[{items:p}]}},{text:C.t("取消旗帜"),click:function(){e.log("toolbar","setflag",0),d.setFlag(0)}}]}}if(e.isTag()){var u=A.list(),v=[],w="tag"===f,x=e.param("Tag");for(var y in u){var z=u[y];v[v.length]={text:A.getName(z),icon:{type:"tag",subtype:z.color,xtype:"icon"},click:function(a){return function(){e.log("toolbar","settag",1),d.setTag(!0,a)}}(z.name),dieabled:function(a){return w&&x&&E.has(x,a)}(z.name)}}var B=i[i.length]={items:[{text:C.t("标签"),menu:{groups:[]}}]},D=B.items[0].menu.groups;v.length>0&&(D.push({items:v,type:"scroll"}),B.items.push({text:C.t("取消所有标签"),click:function(){e.log("toolbar","settag",0),d.setTag()}})),D.push({items:[{text:C.t("新建标签并标记"),click:function(){e.log("toolbar","settag",2);try{var a=$L("support.Tag",this)}catch(b){return b}a.add({callback:function(a){d.setTag(!0,a)}})}}]})}e.isTop()&&(i[i.length]={items:[{text:C.t("置顶邮件"),click:function(){e.log("toolbar","settop",1),d.setTop(!0)},disabled:g},{text:C.t("取消置顶"),click:function(){e.log("toolbar","settop",0),d.setTop(!1)},disabled:g}]})}function k(a){var b=this,d=b.view,e=d.module,f=e.param("fid"),g={xtype:"button",subclass:"dropdownBtn",text:C.t("移动到"),menu:{groups:[]}};a.push(g);var h=g.menu.groups,i=B.list(),j={custom:[],pop:[],system:[]};E.each(i,function(a,b){if(f!==b.id){var g,h=b.flags;g=h.custom?"custom":h.pop?"pop":"system";var i=j[g];i[i.length]={text:b.name,click:function(){e.log("toolbar","move",1),d.move(b.id)},icon:h.pop?{type:"folder",subtype:b.flags.iconSubtype,xtype:"icon"}:c}}});var k=[],l=!1;D.each(j,function(a,b){var c=b.length>0;l&&c&&k.push({type:"split"}),l=l||c;for(var d=0,e=b.length;e>d;d++)k.push(b[d])}),h[h.length]={items:k,type:"scroll"},h[h.length]={items:[{text:C.t("新建文件夹并移动"),click:function(){e.log("toolbar","move",2);try{var a=$L("support.Folder",this)}catch(b){return b}a.add({callback:function(a){d.move(a)}})}}]}}function l(b){var c=this,d=c.view,e=d.module,f=d.folderSelected,g={xtype:"button",subclass:"dropdownBtn",text:C.t("更多"),menu:{groups:[]},disabled:f};b.push(g);var h=g.menu.groups,i=[{text:C.t("导出选中邮件"),click:function(){e.log("toolbar","export"),d.exportLetter()},disabled:f},{text:C.t("转发选中邮件"),click:function(){e.log("toolbar","forward"),d.forwardLetter()},disabled:f}],j=e.param("fid");if(j>0){var k=a.Ud.get({field:"ntes_option",flag:"sizeshow"})-0,l=!(G||$S("isFree")&&1!==k),m=C.t("发件人"),n="from";(2===j||3===j)&&(m=C.t("收件人"),n="to");var o=[],o=[[C.t("按时间从新到旧"),"date",!0],[C.t("按时间从旧到新"),"date",!1],[C.t("按"+m+"降序"),n,!0],[C.t("按"+m+"升序"),n,!1],[C.t("按主题降序"),"subject",!0],[C.t("按主题升序"),"subject",!1]];l&&(o.push([C.t("按邮件从大到小"),"size",!0]),o.push([C.t("按邮件从小到大"),"size",!1]));var p=0,q=e.param("order"),r=e.param("desc");switch(q){case"date":p=r?0:1;break;case"to":case"from":p=r?2:3;break;case"subject":p=r?4:5;break;case"size":p=r?6:7}for(var s=[],t=0,u=o.length;u>t;t++){var v=D.clone(e.param()),w=D.clone(e.extend()),y=o[t];v.order=y[1],v.desc=y[2],s[s.length]={text:y[0],click:function(a,b){return function(){e.log("toolbar","sort",a.order+"_"+a.desc),x.entry(a,b)}}(v,w),checked:t===p}}i.push({text:C.t("排序"),menu:{groups:[{items:s,checkType:"radio"}]}})}h[h.length]={items:i}}function m(b){var c=this,d=c.view,e=d.module,f=b.groups,g=e.param("fid");4!==g&&15!==g||!a.Ext.recovery||(f[f.length]={items:[{xtype:"button",text:C.t("误删恢复"),click:function(){e.log("toolbar","recovery");try{var a=$L("interface.OutlinkInterface",this)}catch(b){return b}a.goOutlink({key:"recovery",title:C.t("误删恢复")})}}]})}function n(a){var b=this,c=b.view,d=a.groups;d[d.length]={items:[{xtype:"button",text:C.t("刷 新"),click:function(){c.module.log("toolbar","refresh"),c.refresh()}}]}}function o(a){var c=this,d=c.view,e=d.module,f=a.groups,g=e.extend("subtype");if("folder"===g||"calendar"===g){var h;try{var i=e.param("filter");if(i&&i.sentDate){var j=i.sentDate,k=e.constructor,l=j.split(":"),m=l[0],n=l[1],o=k.parseSentDate(m),p=k.parseSentDate(n);h=0===o-p?o:[o,p]}}catch(q){}f[f.length]={items:[{xtype:"calendar",onselect:function(a,c){e.log("toolbar","calendar"),c||(c=new b.Date(a));var d=F.format(a,"yyyyMMdd"),f=F.format(c,"yyyyMMdd"),g=D.clone(e.param()),h=D.clone(e.extend());g.fid&&(g.fids=[g.fid],delete g.fid);var i=(c.getTime()-a.getTime())/1e3/60/60/24;h.calendar=0===i?"date":6===i?"week":"month",h.subtype="calendar",g.filter={sentDate:d+":"+f},x.entry(g,h)},focus:h}],type:"ext"}}}function p(a,b){var c=this,d=a.groups;c.page(d,b),c.option(d)}function q(a,b){var d,e,f=this,g=f.view,h=g.module,i=h.getPage(),j=h.extend("index"),k=h.extend("area");if(h.isArchive()&&(d="normal"===k,e="archive"===k),i>0||d||e){var l=i-1,m=j>0||e?function(){h.log("toolbar","previous"),g.goPage(j-1),j--}:c,n=!m,o=l>j||d?function(){h.log("toolbar","next"),g.goPage(j+1),j++}:c,p=!o,q=[];if(e&&q.push({text:C.t("最近的邮件"),value:-1,checked:!1}),0===i&&(i=1),!G||b)for(var r=0;i>r;r++)q.push({text:r+1+"/"+i,value:r,checked:r===j});else q.push({text:j+1+"/"+i,value:j,checked:!0});d&&q.push({text:C.t("更早的邮件"),value:i,checked:!1});var s=a[a.length]={items:[],type:"ext"},t=s.items;t.push({xtype:"select",system:G,subclass:"simpleSelect",options:q,title:C.t("当前第")+(j+1)+C.t("页"),selectedchange:function(){var a=this,b=a.value-0;b!==j&&(h.log("toolbar","gopage"),g.goPage(b),(-1===b||b===i)&&(-1===b?a.setValue(j):a.setSelected(j),a.fire("selectedchange")))},listeners:G&&!b?{mouseover:{handler:function(){f.update(!0)}}}:c});var s=a[a.length]={items:[],type:"ext"},t=s.items;t.push({xtype:"button",icon:"prev",subclass:"roundBtn",disabled:n,click:m,title:C.t("上一页"),lazyListen:!1},{xtype:"button",icon:"next",subclass:"roundBtn",disabled:p,click:o,title:C.t("下一页"),lazyListen:!1})}}function r(b){var d=this,e=d.view,f=e.module,g=f.extend("type"),h=f.extend("subtype"),i=f.param("fid"),j=b[b.length]={items:[],type:"ext"},k=j.items,l={groups:[],extcls:"nui-settingMenu",delegateTo:"self",reverse:!0};k.push({xtype:"button",icon:"setting",subclass:"roundBtn",menu:l,title:C.t("设置")});var m,n=l.groups;m=[];var o=a.Ud;if(!G&&"search"!==g){var p=o.get({field:"ntes_inbox",flag:"layout"})-0;0===p&&(p=1);for(var q=[[C.t("关闭"),1],[C.t("底部"),2],[C.t("右侧"),3]],r=[],s=0,t=q.length;t>s;s++){var u=q[s],v=u[1];r[r.length]={text:u[0],value:v,checked:p===v,subclass:"btn"}}m.push({doNotHide:!0,text:C.t("读信窗口"),extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){f.log("toolbar","setlayout",a),e.setLayout(a)},items:r}})}var w=o.get({field:"ntes_letter",flag:"line_height"})-0;0===w&&(w=3);var x=o.get({field:"ntes_letter",flag:"font_size"})-0;0===x&&(x=1);var y=-1;1!==w&&2!==w||2!==x?3!==w&&0!==w||1!==x&&0!==x?4===w&&3===x&&(y=3):y=2:y=1;for(var A=[[C.t("宽松"),1],[C.t("适中"),2],[C.t("紧凑"),3]],B=[],s=0,t=A.length;t>s;s++){var D=A[s],F=D[1];B[B.length]={text:D[0],value:F,checked:y===F,subclass:"btn"}}if(m.push({text:C.t("列表间距"),extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){f.log("toolbar","setspace",a),e.setSpace(a)},items:B}}),!a.Ext.limit_max){for(var H=[],I=[["10",10],["15",15],["20",20],["30",30],["50",50],["100",100]],J=f.extend("limit"),s=0,t=I.length;t>s;s++){var K=I[s],L=K[1];H[H.length]={text:K[0],value:L,checked:J===L,subclass:"btn"}}m.push({text:C.t("每页显示邮件数量"),extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){f.log("toolbar","setmaxlist",a),e.setMaxList(a)},items:H}})}for(var M=o.get({field:"ntes_option",flag:"sendershow"})-0,N=[[C.t("发件人姓名"),1],[C.t("通讯录昵称"),2]],O=[],s=0,t=N.length;t>s;s++){var P=N[s],Q=P[1];O[O.length]={text:P[0],value:Q,checked:2===M^2!==Q,subclass:"btn"}}if(m.push({gap:"before",text:C.t("发/收件人姓名显示"),extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){f.log("toolbar","setsendershow",a),e.setSenderShow(a)},items:O}}),!G&&$S("isFree")&&"l-r"!==e.getLayout()){var R=o.get({field:"ntes_option",flag:"sizeshow"})-0;m.push({text:C.t("邮件大小"),extText:{xtype:"checkbox",subclass:"switch",checked:1===R,text:C.t("显示"),unCheckText:C.t("隐藏"),checkedchange:function(a){f.log("toolbar","setsize",a?1:0),e.setSize(a?1:0)}}})}if(f.isThread(!0)){var S=$S("isFree"),T=S?0:1,U=S?1:0,V=o.get({field:"ntes_option",flag:"thread"})-0;m.push({text:C.t("邮件会话"),extText:{xtype:"checkbox",subclass:"switch",checked:V===T,text:C.t("开启"),unCheckText:C.t("关闭"),checkedchange:function(a){f.log("toolbar","setthread",a?1:0),e.setThread(a?T:U)}}})}if(a.Ext.summary&&"full"!==h){var W=o.get({field:"ntes_option",flag:"summary"})-0;m.push({text:C.t("邮件摘要"),extText:{xtype:"checkbox",subclass:"switch",checked:1===W,text:C.t("开启"),unCheckText:C.t("关闭"),checkedchange:function(a){f.log("toolbar","setsummaryshow",a?1:0),e.setSummaryShow(a?1:0)}}})}var X=!1;3===i&&a.Ext.letterRecall&&(m.push({gap:"before",text:C.t("邮件撤回"),click:function(){f.log("toolbar","gomailback");try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"BaseSetModule",inputName:"SectionMailRecall"})}}),X=!0),m.push({gap:X?c:"before",text:C.t("邮箱中心"),click:function(){f.log("toolbar","gomailcenter"),z.entry({module:"AccountCenterModule"})}}),m.push({text:C.t("来信分类"),click:function(){f.log("toolbar","gofilter"),z.entry({module:"MailFilterModule"})}}),m.push({text:C.t("文件夹管理"),click:function(){f.log("toolbar","gofoldermanager"),z.entry({module:"FolderTagModule"})}}),E.has([5,7,18],i)&&m.push({text:C.t("智能分类设置"),click:function(){f.log("toolbar","goantispam"),z.entry("AntiSpamModule")}}),m.push({text:C.t("更多设置"),click:function(){f.log("toolbar","moresetting"),z.entry({module:"BaseSetModule"})}}),n.push({items:m})}function s(){var b=this,c=b.getConfig(),d=b.toolbar=new a.Toolbar(c);return b.view.module._toolbar=d,d.html()}function t(a){var b=this,c=b.toolbar,d=b.getConfig(a);c.update(d)}function u(){var a=this;try{a.toolbar.destroy(),a.toolbar=null}catch(b){}}function v(a){var b=this;try{b.toolbar.find("checkbox")[0].setChecked(a,!0)}catch(c){}}function w(a){var b=this;b.view=a}try{var x=$L("interface.MboxInterface")}catch(y){return y}try{var z=$L("interface.OptionInterface")}catch(y){return y}try{var A=$L("init.Tag")}catch(y){return y}try{var B=$L("init.Folder")}catch(y){return y}var C=new $I18N("module.mbox.Toolbar"),D=a.Object;a.Function;var E=a.Array,F=a.Date,G=a.Browser.isIE("<9"),H=a.createClass($N("module.mbox.Toolbar"));D.extend(H.prototype,{view:null,toolbar:null,getConfig:d,select:e,complete:f,remove:g,report:h,control:i,mark:j,move:k,more:l,recovery:m,refresh:n,calendar:o,extend:p,page:q,option:r,get:s,update:t,destory:u,selectAll:v,initialize:w})}($,window),function(a){function b(b,c){var d=c.listen,e=this,f=e.module;f.view;var g=(f.extend("type"),f.extend("subtype")),h=a.Context.getModule(),i=f===h,j=!1;try{switch(g){case"folder":var k=f.param("fid"),l=b.Folder;if(l&&l.info.stats&&l.info.stats[k]&&(j=!0),f.isThread()&&L.showTop(k,!0)){var m=b.Defer;m&&m.info.stats&&m.info.stats.expire&&(j=!0)}break;case"flag":var n=f.param("filter").label0,o=b.Flag;o&&o.info.stats&&o.info.stats[n]&&(j=!0);break;case"tag":var p=f.param("tag"),q=b.Tag;if(q&&q.info.stats)for(var r=0,s=p.length;s>r;r++)if(q.info.stats[p[r]]){j=!0;break}break;case"contacts":var t=f.param("filter"),u=t.chatWithAddress||t.fromAddress||t.toAddress,v=b.Contacts;if(v&&v.info.stats)for(var w=u.split(","),r=0,s=w.length;s>r;r++)if(v.info.stats[w[r]]){j=!0;break}break;case"defer":var m=b.Defer;m&&m.info.stats&&(j=!0);break;case"read":var l=b.Folder;l&&l.changed&&(j=!0);break;case"emails":var v=b.Contacts;v&&v.changed&&(j=!0);break;default:M.each(b,function(b,c){return c.changed?(j=!0,a.BREAK):void 0})}}catch(x){}j&&(d||(i?f.replace():e.lazyReplace(f)),f.view.update())}function c(b){function c(){try{var a=g.getCacheData(-1);if(!a)try{var c=h.letters;a=[];for(var e=0,f=c.length;f>e;e++)a.push(c[e].data)}catch(i){}if(a)for(var j=0,k=0,l=a.length,n=p.length;l>j&&n>k;j++){var o=a[j];if(o&&m[o.id]){var q=d.syncData(b,o);q&&(y[o.id]=!0),k++}}}catch(i){}}try{var d=$L("interface.MboxInterface",this)}catch(e){return e}var f=this,g=f.module,h=g.view,i=g.param("fid"),j=g.extend("subtype"),k=g.extend("brand"),l=b.fid,m=b.list,n=b.action,o=b.value,p=b.data,q=b.type,r=p.length,s=b.hasThread,t=b.hasSent,u=b.allFid,v=g.isThread(),w=a.Context.getModule(),x=g===w,y={},z=!1,A=!1,B=!0,C=!1,D=!1,E=!1,F=!1,G=!1;if(u>0)z=!0;else if("top"===n&&l&&(l[i]||v)&&g.isTop())z=!0;else if("flag"===n){if("flag"===j)z=!0,A=!0;else if("normal"===j)for(var H=g.param("conditions"),I=0,J=H.length;J>I;I++){var O=H[I];if("label0"===O.field){z=!0;break}}}else if("read"===n){if("read"===j||"emails"===j)D=!0;else try{g.param("filter").flags.read===!1&&(D=!0)}catch(e){}F=!0}else if("tag"===n&&"tag"===j)z=!0;
else if("defer"===n&&"defer"===j)z=!0,E=!0;else if("defer"!==n||"add"!==q&&"complete"!==q&&"modify"!==q||"folder"!==j){if("move"===n){if(l[i]||i===o||v)z=!0,A=!0;else if(o&&4!==o||"search"!==g.extend("type")){if(o)switch(j){case"contacts":case"flag":case"tag":var P=$G.common.unnormalids;if(!o||N.has(P,o))z=!0,A=!0;else for(var I=0,J=p.length;J>I;I++)if(N.has(P,p[I].fid)){z=!0;break}break;case"defer":break;default:z=!0,A=!0}else if("defer"===j||k)z=!0,A=!0;else if("folder"===j)for(var Q=L.getDate("tomorrow"),I=0,J=p.length;J>I;I++)try{var R=p[I];if(R.flags.deferHandle&&R.defer<Q){E=!0,z=!0;break}}catch(e){}}else z=!0,A=!0;"archive"===b.area&&"archive"!==g.extend("area")&&"folder"===j&&(C=!0),F=!0}}else z=!0,B=!0,E=!0,v&&(G=!0);if(C&&g.extend("forceRequest",!0),D&&g.extend("forcePage",!0),E&&L.setCache(),G&&h.tips.update(),F&&k)if(x)try{g.refreshBrand()}catch(e){}else g.extend("forceBrand",!0);if(c(),z&&!x)f.lazyReplace(g);else{if(B)for(var I=0,J=p.length;J>I;I++)y[p[I].id]=!0;if(M.count(y)>0){if(z?g.replace(n,A,r,m,y):h.syncLetter(n,r,m,y),x&&z){var S=h.getLayout();S&&a.SM.go({parent:g,module:"mbox.PreviewModule",param:{layout:S},viewType:S,sharebar:!0,cacheDom:!1,reset:!1})}}else(s||K.check()&&t||u)&&f.lazyReplace(g)}}function d(b){var c=this,d=c.module;if(d.view,"mboxAd"==b||!b){try{d.getDom("AdDiv").style.display="none"}catch(e){}$S("mboxAdClosed",!0),a.LocalStorage.set("mailmboxpro","1",{domain:$S("fullDomain"),expires:7})}if("mboxFooterAd"==b){try{d.getDom("FooterDiv").style.display="none"}catch(e){}$S("mboxFooterAdClosed",!0)}}function e(){var b=this,c=b.module,d=c.view,e=a.Context.getModule();c===e?d.refresh(c.extend("index")):b.cleanCache(c)}function f(){var b=this,c=b.module,d=c.view,e=a.Context.getModule();c===e?d.refresh(c.extend("index")):b.cleanCache(c)}function g(b){var c=this,d=c.module,e=d.view;if(b===d.extend("area")){var f=a.Context.getModule();d===f?e.refresh(d.extend("index")):c.cleanCache(d)}}function h(){var a=this,b=a.module;a.cleanCache(b)}function i(b){if(b){var c=this,d=c.module,e=d.view,f=a.Context.getModule();d===f?e.refresh(d.extend("index")):c.cleanCache(d)}}function j(){var a=this,b=a.module;a.lazyReplace(b)}function k(){var a=this,b=a.module;a.cleanCache(b)}function l(){var a=this,b=a.module,c=b.param("fid");(2===c||3===c)&&a.cleanCache(b)}function m(a){var b=this,c=b.module,d=c.view;if(d.toolbar.update(),"search"===c.extend("type")){var e=c.param("fids");e.push(a)}}function n(b){var c=this,d=c.module,e=d.param("fid");if(e===b){var f=d.view;f.update()}if(!e){var g=a.Context.getModule();d===g?d.view.goPage(d.extend("index"),!0):c.cleanCache(d)}}function o(b){var c=this,d=c.module,e=a.Context.getModule();if(b===d.param("fid"))if(d===e){try{var f=$L("interface.MboxInterface",this)}catch(g){return g}f.entry({fid:1})}else c.cleanCache(d,!0),a.MultiTab.remove(d);else d.view.toolbar.update()}function p(b){var c=this,d=c.module;d.view;var e=a.Context.getModule(),f=d.param("fid");b!==f&&4!==b&&f||(e===d?d.replace("folder"):c.lazyReplace(d))}function q(a){var b=this,c=b.module,d=c.view;a[c.param("fid")]&&d.tips.update()}function r(){var a=this,b=a.module,c=b.view;c.toolbar.update(),M.each(c.letters,function(a,b){try{b.components.tagmanage.menu.update(b.tagManage())}catch(c){}})}function s(b,c){var d=this,e=d.module,f=e.view,g=a.Context.getModule(),h=!1;if("tag"===e.extend("subtype")&&c){var i=e.param("tag");N.has(i,b)&&(a.MultiTab.remove(e),a.JS.remove(e),h=!0)}g===e?h||e.replace("tag"):d.lazyReplace(e),f.toolbar.update()}function t(b){var c=this,d=c.module,e=d.view,f=a.Context.getModule(),g=!1;if("tag"===d.extend("subtype")){var h=d.param("tag");N.has(h,b)&&(a.MultiTab.remove(d),a.JS.remove(d),g=!0)}d===f?g||d.replace("tag"):c.lazyReplace(d),e.toolbar.update()}function u(b){for(var c=this,d=c.module,e=d.view,f=a.Context.getModule(),g=d===f,h=d.extend("index"),i={},j=0,k=b.length;k>j;j++){var l=b[j],m=l.field,n=l.flag,o=l.value;"ntes_letter"===m?("font_size"===n||"line_height"===n)&&(i.setClass=!0):"ntes_option"===m?"sizeshow"===n?i.forceRequest=!0:("sendershow"===n||"summary"===n)&&(i.forceRequest=!0):"ntes_inbox"===m?"layout"===n&&(d.extend("forceRequest",!0),i.forceRequest=!0):"maxlist"===m&&(d.extend("limit",o),i.forceRequest=!0)}i.setClass&&(e.setClass(),g||e.toolbar.update()),i.forceRequest&&(g?d.view.refresh(h,!0,!1,!0):c.cleanCache(d)),a.Object.count(i)>0&&g&&e.toolbar.update()}function v(b){var c=this,d=c.module;d.view;for(var e=d.extend("index"),f=a.Context.getModule(),g=0,h=b.length;h>g;g++){var i=b[g],j=i.field,k=i.flag;i.value,"ntes_option"===j&&"sendershow"===k&&(d===f?d.view.refresh(e,!0):c.cleanCache(d))}}function w(){var b=this,c=b.module,d=c.view,e=c.extend("index"),f=a.Context.getModule(),g=a.Ud.get({field:"ntes_option",flag:"sendershow"})-0;if(2===g?c===f?c.view.refresh(e):b.cleanCache(c):c.view.markContact(),"contacts"===c.extend("subtype"))try{d.title.update()}catch(h){}}function x(){var b=this,c=b.module,d=c.view,e=c.extend("index"),f=a.Context.getModule(),g=a.Ud.get({field:"ntes_option",flag:"sendershow"})-0;if(2===g?c===f?c.view.refresh(e):b.cleanCache(c):c.view.markContact(),"contacts"===c.extend("subtype"))try{d.title.update()}catch(h){}}function y(){var a=this,b=a.module;try{if("emails"===b.extend("subtype")){var c=b.param("filter");""===c.chatWithAddress&&$E(["support.AddressSupport","interface.MboxInterface"],function(a,b){var c=a.getMarkData();b.contacts(c.contact[0])})}}catch(d){}}function z(){var b=this,c=b.module,d=c.view,e=a.Context.getModule();3===c.param("fid")&&(c===e?c.replace("recall"):b.lazyReplace(c),d.update())}function A(){var b=this,c=b.module;c.view;var d=a.Context.getModule();3===c.param("fid")&&(c===d?c.view.refresh(c.extend("index")):b.cleanCache(c))}function B(){var a=this,b=a.module;if(3===b.param("fid"))try{a.cleanCache(b)}catch(c){}}function C(){try{var a=this.module;a._child.setWidth()}catch(b){}}function D(a){try{for(var b=this,c=b.module.view,d=c.letters,e=0,f=d.length;f>e;e++){var g=d[e];if(g.data.id===a){g.setDefer();break}}}catch(h){}}function E(a){try{var b=this,c=b.module.view;switch(a){case"letter":c.getAd(!0);break;case"inboxBottom":c.getFooter(!0);break;case"brand":c.showBanner(!0)}}catch(d){}}function F(a,b){if(a.isRendered){try{}catch(c){}a.cleanCache(b)}}function G(a){a.isRendered&&a.lazyReplace()}function H(){a(".Bp0 .wn2")&&a(".Bp0 .wn2").css({backgroundColor:"#"+($S("skin").color||"6A8DE5")})}try{var I=$L("module.BaseListener")}catch(J){return J}try{$L("init.Folder")}catch(J){return J}try{var K=$L("init.Thread")}catch(J){return J}try{var L=$L("init.Defer")}catch(J){return J}try{$L("init.Tag")}catch(J){return J}new $I18N("module.mbox.MboxListener");var M=a.Object,N=a.Array,O=a.createClass($N("module.mbox.MboxListener"));M.mix(O,I,null,{_listeners:{"sync:request":{handler:b},"letter:update":{handler:c},"letter:closead":{handler:d},"letter:rollback":{handler:e},"letter:setspam":{handler:f},"letter:allread":{handler:g},"letter:setfilter":{handler:h},"letter:setfilterrule":{handler:i},"letter:schedule":{handler:j},"search:removeall":{handler:k},"compose:send":{handler:l},"folder:add":{handler:m},"folder:modify":{handler:n},"folder:remove":{handler:o},"folder:empty":{handler:p},"folder:keep":{handler:q},"tag:add":{handler:r},"tag:modify":{handler:s},"tag:remove":{handler:t},"options:inboxModify":{handler:u},"options:contactModify":{handler:v},"addr:dataInit":{handler:w},"addr:dataReset":{handler:x},"addr:dataMark":{handler:y},"read:recall":{handler:z},"read:wmsvrDelete":{handler:A},"read:mailStatusUpdate":{handler:B},"global:resize":{handler:C},"schedule:insert":{handler:D},"schedule:remove":{handler:D},"ad:dataChange":{handler:E},"options:skinChange":{handler:H}},cleanCache:F,lazyReplace:G})}($,window),function(a,b,c){function d(a,b,c,d){var e,f=K.funcs[a.func];if(b&&(e=f[0],e&&(a.func=e,a.thread=!0,a.sent=c)),d>0){e=f[1],a.func=e;var g=a.body;g.fid=d,delete g.ids,f[2]&&f[2](a,d)}}function e(a,b){"archive"===b&&(a.body.mboxa="2")}function f(a){for(var b=[],c={},d=0,e=a.length;e>d;d++){var f=a[d],g=f.id||f;g&&(b.push(g),c[g]=!0)}return[b,c]}function g(){}function h(a,b){function c(a){for(var b=a["var"],a=b.shift(),c=0,d=h.length;d>c;c++)h[c](b.shift());return a}function d(a){F.setCache(a)}function e(a){E.initArchive(a)}var f={},g=[],h=[];if(a.loadExpire){var i=F.loadCache(!0);g.push(i),h.push(d)}if(a.loadArchive){var j=E.loadArchive();g.push(j),h.push(e)}return g.length>0?(g.unshift(b),I.each(g,function(a,b){b["var"]=b.body,delete b.body}),f.request={func:"global:sequential",body:{items:g}},f.handleExtra=c):f.request=b,f}function i(b){function c(a){var b=a["var"];i(g?b:b.length>0?b[0]:null)}var d,e,f=this,g=b.isThread,h=b.id,i=b.callback,j=a.Ext.tag;if(g)d="mbox:getThreadMessageInfos",e={id:h,returnTag:j};else{var k;a.Ext.summary&&1===a.Ud.get({field:"ntes_option",flag:"summary"})-0&&(k=1),d="mbox:getMessageInfos",e={ids:[h],"summaryWindowSize ":k,returnTag:j}}var l={func:d,body:e,call:c};b.error&&(l.error=b.error),f.wmsvr(l)}function j(a){function b(b){a.callback(b)}for(var c=a.ids,d={func:"global:sequential",body:{items:[]},call:b},e=d.body.items,f=0,g=c.length;g>f;f++)e.push({func:"mbox:getThreadMessageInfos","var":{id:c[f]}});this.wmsvr(d)}function k(a){function b(b){for(var c=$I("core.DataAction").S_OK,d=b["var"],e=[],f=0,g=d.length;g>f;f++){var h=d[f];if(h.code===c)for(var i=h["var"],j=0,k=i.length;k>j;j++)e.push(i[j].id)}a.callback(e)}var c=this;c.getThreadInfo({ids:a.ids,callback:b})}function l(a){function b(b){a.callback(b)}var c=this,d=a.fid;d||(d=c.module.param("fid"));var e={flags:{top:!0}};c.getList({fid:d,filter:e,returnTotal:!0,limit:0},{sync:!0},b)}function m(a){function b(a){g(a["var"])}function c(){return!0}var d=this,e=a.ids,f=a.pattern,g=a.callback,h={func:"mbox:getMessageSummaryInfos",body:{ids:e,pattern:f},call:b,error:c};d.wmsvr(h)}function n(b){function d(b){function c(a){e.rollback({uk:b.uk,data:{ids:p.ids,attrs:{flags:{read:!h}}},callback:a,area:g})}J.fire("letter:update",{list:o[1],action:"read",value:h,data:i,hasThread:l,hasSent:m,allFid:f,area:g});var d;b&&a.Ext.rollback&&!f&&(b.uk||p)&&(d=c),k(b,d)}var e=this,f=b.allFid,g=b.area,h=b.isRead,i=b.data,j=!!b.voidRequest,k=b.callback,l=b.hasThread,m=b.hasSent,n={flags:{read:h}},o=e.getIds(i),p=e.getRollbackData(null,i,"read");if(j)d();else{var q={func:"mbox:updateMessageInfos",body:{ids:o[0],attrs:n},call:d};e.setFunc(q,l,c,f),e.setArea(q,g),e.wmsvr(q)}}function o(b){function d(b){function c(a){var c=[];for(var d in o.items)c.push({ids:o.items[d],attrs:{label0:d-0}});e.rollback({uk:b.uk,data:{items:c},callback:a,area:g})}J.fire("letter:update",{list:n[1],action:"flag",value:h,data:i,hasThread:j,hasSent:k,allFid:f,area:g});var d;b&&a.Ext.rollback&&!f&&(b.uk||o)&&(d=c),l(b,d)}var e=this,f=b.allFid,g=b.area,h=b.flag,i=b.data,j=b.hasThread,k=b.hasSent,l=b.callback,m={label0:h};1!==h&&(m.flags={flagged:!1});var n=e.getIds(i),o=e.getRollbackData(null,i,"flag"),p={func:"mbox:updateMessageInfos",body:{ids:n[0],attrs:m},call:d};e.setFunc(p,j,c,f),e.setArea(p,g),e.wmsvr(p)}function p(b){function d(b){function c(a){var c=[];for(var d in q.items){var f="%default%"===d?[]:d.split(","),j={ids:q.items[d]};h?j["delete"]=[i]:j.add=i?[i]:f,c.push(j)}e.rollback({type:"tag",uk:b.uk,data:{items:c},callback:a,area:g})}J.fire("letter:update",{list:n[1],action:"tag",value:i,data:j,isAdd:h,hasThread:k,hasSent:l,allFid:f,area:g});var d;b&&a.Ext.rollback&&!f&&(b.uk||q)&&(d=c),m(b,d)}var e=this,f=b.allFid,g=b.area,h=b.isAdd,i=b.tag,j=b.data,k=b.hasThread,l=b.hasSent,m=b.callback,n=e.getIds(j),o=h&&i?[i]:c,p=h?c:i?[i]:function(){var a=[];if(f){var b=G.list();for(var c in b){var d=b[c];a.push(d.name)}}else for(var e=0,g=j.length;g>e;e++){var h=j[e].tag;if(h)for(var i=0,k=h.length;k>i;i++){var l=h[i];G.get(l)&&!I.has(a,l)&&a.push(l)}}return a}(),q=e.getRollbackData(null,j,"tag"),r={func:"mbox:updateMessageTags",body:{ids:n[0],add:o,"delete":p},call:d};e.setFunc(r,k,c,f),e.setArea(r,g),e.wmsvr(r)}function q(b){function d(b){function d(a){var d=[];for(var f in q.items){var h=JSON.parse(f),i=h.defer?new Date(h.defer):c,j=h.deferHandle,k=h.memo;d.push({ids:q.items[f],attrs:{memo:k?k:"",defer:j&&i?i:c,flags:{deferHandle:j}}})}e.rollback({uk:b.uk,data:{items:d},callback:a,area:g})}J.fire("letter:update",{list:p[1],action:"defer",value:{deferHandle:i,defer:j,memo:k},data:l,type:h,hasThread:m,hasSent:n,allFid:f,area:g});var r;b&&a.Ext.rollback&&(b.uk||q)&&(r=d),o(b,r)}var e=this,f=b.allFid,g=b.area,h=b.type,i=!1,j=b.defer,k=b.memo,l=b.data,m=b.hasThread,n=b.hasSent,o=b.callback,p=e.getIds(l),q=e.getRollbackData(null,l,"defer"),r={};switch(h){case"add":case"modify":r.memo=k?k:"",r.defer=j?j:null,i=!!j,r.flags={deferHandle:i};break;case"complete":var s=new Date(0);r.defer=new Date(s.getTime()+6e4*s.getTimezoneOffset()),r.flags={deferHandle:i};break;case"delete":i=!0,r.memo=""}var t={func:"mbox:updateMessageInfos",body:{ids:p[0],attrs:r},call:d};e.setArea(t,g),e.wmsvr(t)}function r(b){function c(b){function c(a){var c=[];for(var f in m.items){var g=f;"undefined"===f&&(g=""),c.push({ids:m.items[f],attrs:{memo:g}})}d.rollback({uk:b.uk,data:{items:c},callback:a,area:e})}J.fire("letter:update",{list:l[1],action:"memo",value:f,data:g,hasThread:h,hasSent:i,area:e});var k;b&&a.Ext.rollback&&(b.uk||m)&&(k=c),j(b,k)}var d=this,e=b.area,f=b.memo,g=b.data,h=b.hasThread,i=b.hasSent,j=b.callback,k={memo:f?f:""},l=d.getIds(g),m=d.getRollbackData(null,g,"memo"),n={func:"mbox:updateMessageInfos",body:{ids:l[0],attrs:k},call:c};d.setArea(n,e),d.wmsvr(n)}function s(b){function c(b){function c(a){d.rollback({uk:b.uk,data:{ids:m.ids,attrs:{flags:{top:!f}}},callback:a})}J.fire("letter:update",{fid:e[1],list:l[1],action:"top",value:f,data:g,hasThread:h,hasSent:i});var k;b&&a.Ext.rollback&&(b.uk||m)&&(k=c),j(b,k)}var d=this,e=b.fidInfo,f=b.isTop,g=b.data,h=b.hasThread,i=b.hasSent,j=b.callback,k={flags:{top:f}},l=d.getIds(g),m=d.getRollbackData(null,g,"top"),n={func:"mbox:updateMessageInfos",body:{ids:l[0],attrs:k},call:c};d.wmsvr(n)}function t(a){function b(a){function b(){J.fire("letter:setfilter"),h&&h()}var f;if(a)try{f=a["var"]}catch(i){}var j={func:"mbox:updateMessageInfos",body:{ids:f,attrs:f?g:c,rule:f&&g?c:e},call:b};d.wmsvr(j)}var d=this,e=a.ruleConditions,f=a.fids,g=a.attrs,h=a.callback;if(f&&g){var i={func:"mbox:searchMessages",body:{fids:f,ruleConditions:e},call:b};d.wmsvr(i)}else b()}function u(a){function b(a){J.fire("letter:setfilterrule",g),h&&h(a)}function c(a){var b=a.code;return"FA_ATTR_SIZE_EXCEEDED"===b?(h&&h(),!0):void 0}var d=this,e=a.fid,f=a.email,g=a.history,h=a.callback,i={func:"ntes:mbox:addHistoryFilter",body:{fid:e,email:f,history:!!g},call:b,error:c};d.wmsvr(i)}function v(c){function d(a){J.fire("letter:rollback",{data:j}),l(a)}function e(c){if(i&&"FA_NEED_AUTH2"===c.code){for(var e=c["var"],f=[],h=0,j=e.length;j>h;h++)f.push(e[h].param);var k={func:"ntes:mbox:updateMessageInfos",body:{items:f,type:"multi"},call:d};return a.AdvLock.show(function(){b.setTimeout(function(){g.wmsvr(k)},500)},!1),!0}}function f(a){"archive"===k&&(a.mboxa="2")}var g=this,h=c.type,i=c.uk,j=c.data,k=c.area,l=c.callback;if(j&&(j.type=j.items?"multi":"single",k))if("single"===j.type)f(j);else for(var m=j.items,n=0,o=m.length;o>n;n++)f(m[n]);var p={func:i?"ntes:mbox:messageUndo":"tag"===h?"ntes:mbox:updateMessageTags":"ntes:mbox:updateMessageInfos",body:i?{uk:i}:j,call:d,error:e};g.wmsvr(p)}function w(b){function d(b){function c(a){var c=[];for(var d in p.items)c.push({ids:p.items[d],attrs:{fid:d-0}});e.rollback({uk:b.uk,data:{items:c},callback:a,area:g})}J.fire("letter:update",{fid:h[1],list:o[1],action:"move",value:i,data:j,isThread:k||l,fromThread:m,allFid:f,area:g});var d;b&&a.Ext.rollback&&!f&&i&&(b.uk||p)&&(d=c),n(b,d)}var e=this,f=b.allFid,g=b.area,h=b.fidInfo,i=b.moveToId,j=b.data,k=b.hasThread,l=b.hasSent,m=b.fromThread,n=b.callback,o=e.getIds(j),p=e.getRollbackData(null,j,"move"),q={body:{ids:o[0]},call:d};if(i){var r=!1;if(15!==i)for(var s=0,t=j.length;t>s;s++)if(15===j[s].fid){r=!0;break}q.func="mbox:updateMessageInfos",q.body.attrs={fid:i,flags:r?{deleted:!1}:c}}else q.func="mbox:deleteMessages";e.setFunc(q,k,!0,f),e.setArea(q,g),e.wmsvr(q)}function x(a){function b(a){if(d(a),i){J.fire("rslist:add",h?"refuse":"safe",o);try{var b=$L("support.OptionSupport",this)}catch(c){return c}b.addList({name:h?"refuselist":"safelist",value:o.join(),noErr:!0,forceAdd:!0})}m(e(a))}function c(a){var b=a.code;return"FA_LIST_FULL"===b||"FA_LIST_NOT_UPDATE"===b?(d(a,!0),m(e(a,!0)),!0):void 0}function d(a,b){var c,d;try{c=a["var"].updateMessageInfos["var"].mid,d={};for(var e=0,f=c.length;f>e;e++)d[c[e]]=!0}catch(i){}J.fire("letter:setspam",h,j,k||l,!!b,d,g)}function e(a,b){var c={},d=a["var"];c.lettercount=d.updateMessageInfos["var"].count;try{c.historycount=d.deleteHistory["var"].count}catch(e){}try{c.listcount=i?o.length:0}catch(e){}return c.listerror=!!b,c}var f=this,g=a.area;a.data;var h=a.isSpam,i=a.addList,j=a.deleteLetter,k=a.hasThread,l=a.hasSent,m=a.callback,n=a.ids,o=a.emails,p=a.reportType,q=a.spamType;o&&0!==o.length||(i=!1,j=!1);var r={func:"ntes:mbox:reportSpam",body:{ids:n,emails:o,reportType:p,spamType:q,attrs:{deleteHistory:j,addList:i,thread:k}},call:b,error:c};f.setArea(r,g),f.wmsvr(r)}function y(b){function c(b){function c(a){d.rollback({data:{ids:h,attrs:{flags:{read:!1}}},callback:a,area:e})}J.fire("letter:allread",e);var f;if(b){var h=b["var"].mids;a.Ext.rollback&&(f=c)}g(b,f)}var d=this,e=b.area,f=b.body;f.isThread;var g=b.callback,h={func:"ntes:mbox:updateAllMessages",body:f,call:c};d.setArea(h,e),h.body.search.mboxa=h.body.mboxa,d.wmsvr(h)}function z(b){function c(b){var c=a.Ajax.IFRAME,e=$S("sid"),f={requestType:c,method:a.Ajax.POST};b.length>1?(f.url="./s?sid="+e+"&func=mbox:packMessages",f.body="mid="+b.join("&mid=")):f.url=a.Uri.getUrl("read_data",!0)+"&mode=download&mid="+b.join("")+"&l=inbox&action=export",d.request(f),g()}var d=this,e=b.ids,f=b.isThread,g=b.callback;f?d.getThreadIds({ids:e,callback:c}):c(e)}function A(b,c,d){if(a.Ext.rollback){if(b||(b={}),c)for(var e=0,f=c.length;f>e;e++){var g,h,i=c[e],j=i.id;switch(d){case"read":case"top":g="single";break;case"flag":h=i.label0,g="multi";break;case"memo":h=i.memo,g="multi";break;case"move":h=i.fid,g="multi";break;case"tag":h=(i.tag||[]).join()||"%default%",g="multi";break;case"defer":var k=i.defer;h=JSON.stringify({defer:k?k.getTime():k,deferHandle:!!i.flags.deferHandle,memo:i.memo||""}),g="multi"}if("single"===g){var l=b.ids;l||(l=b.ids=[]),l.push(j)}else{var m=b.items;m||(m=b.items={});var l=m[h];l||(l=m[h]=[]),l.push(j)}}return b.ids||b.items||(b=null),b}}function B(){}try{var C=$L("module.BaseAction")}catch(D){return D}try{var E=$L("init.Folder")}catch(D){return D}try{var F=$L("init.Defer")}catch(D){return D}try{var G=$L("init.Tag")}catch(D){return D}var H=a.Object,I=a.Array,J=a.Listener,K=a.createClass($N("module.mbox.MboxAction"));H.mix(K,C,{funcs:{"mbox:updateMessageInfos":["ntes:mbox:updateThreadInfos","ntes:mbox:updateFolderMessageInfos"],"mbox:updateMessageTags":["ntes:mbox:updateThreadTags","ntes:mbox:updateFolderMessageTags"],"mbox:deleteMessages":[null,"mbox:emptyFolder",function(a,b){a.body={id:b,permanently:!0}}]}},{setFunc:d,setArea:e,getIds:f,getList:g,bindExtra:h,getLetterInfo:i,getThreadInfo:j,getThreadIds:k,getTop:l,getSummary:m,setRead:n,setFlag:o,setTag:p,setDefer:q,setMemo:r,setTop:s,setFilter:t,setFilterRule:u,rollback:v,move:w,setSpam:x,setAllRead:y,exportLetter:z,getRollbackData:A,initialize:B})}($,window),function(a,b,c){function d(){var b=$G.environment,c=[];c.push(b.cacheRootPath),c.push("pattern"),c.push(b.mailPattern),c.push("css"),c.push("gibx_custom.css"),Mb.addedCss||(a.Ajax.request({requestType:a.Ajax.CSS,url:c.join("/")}),Mb.addedCss=!0)}function e(){var a=this,b=a.module,c=a.setClass("Html"),d=[];return a.completed=!1,d[d.length]='<div id="'+b.createId("HtmlDiv")+'" class="'+c+'">',d.push(a.getControl()),d.push('<div class="Dg0">'),d.push(a.getAd()),d.push(a.getBanner()),d.push(a.getTips()),d.push(a.getTitle()),d.push(a.getSmarts()),d.push(a.getList()),d.push(a.getPager()),d.push(a.getNone()),d.push(a.getFooter()),d.push("</div>"),d[d.length]="</div>",a.addHeader(a.getToolbar(),d.join(""),"frame-main-cont-body-first")}function f(c){function d(a){h.unshift('<div class="tN0 nui-closeable" id="'+a+'"'+(f.isNone()?' style="display:none"':"")+">"),h.push("</div>")}var e=this,f=e.module,g=f.isAd(),h=[];if(g&&b.gAd&&b.gAd.getLetter)try{var i,j=a.Ud.get({field:"ntes_inbox",flag:"layout"}),k="3"===j?"letterSmall":"letter",l=b.gAd.getLetter(k);if(c){var m=f.getDom("AdDiv");h.push(l),h.push(new a.Link({text:"",cls:"nui-closeable-x",click:function(){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showProduct("noAd","noAd_jx"),a.Listener.fire("letter:closead","mboxAd")}}).html()),m.innerHTML=h.join("")}else i=f.createId("AdDiv"),h.push(l),h.push(new a.Link({text:"",cls:"nui-closeable-x",click:function(){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showProduct("noAd","noAd_jx"),a.Listener.fire("letter:closead","mboxAd")}}).html()),d(i)}catch(n){}return h.join("")}function g(){return""}function h(){var a=this;return a.tips.get()}function i(){var a=this;return a.title.get()}function j(){return""}function k(){return""}function l(){var b=this,c=b.module,d=c.extend("area"),e=c.extend("index"),f=c.getPage(),g=b.setClass("List"),h=[];if(h[h.length]=['<div id="',c.createId("ListDiv"),'" class="',g,'"></div>'].join(""),c.isArchive()&&"normal"===d){var i={},j=new a.Link({text:Fb.t("查看更早的邮件"),click:function(){b.goPage(f)}});i.content=j.html(),i.subclass="tipsBlock",i.hidden=!(e===f-1||0===f);var k=new a.Block(i);h[h.length]=k.html(),b.archiveTips=k}return h.join("")}function m(){var a=this;return a.pager.get()}function n(){var a=this;return a.none.get()}function o(){return""}function p(){var a=this;return a.toolbar.get()}function q(){var a=this;try{a.inserted=0,a.inserting=!1,clearTimeout(a.interval)}catch(b){}}function r(){function a(){b.insertLetter(d)}var b=this,c=b.module,d=!Lb||c.extend("limit")<=b.insertLimit;b.deleteInterval(),b.initThreads(),c.removeCache(),b.period.reset(),a()}function s(){var b=this,c=b.threads;for(c||(c=b.threads=[]);c.length>0;)a.Thread.clear(c.pop())}function t(a){this.threads.push(a)}function u(b,c,d){function e(){g.interval=setTimeout(function(){g.insertLetter(b,c,d)},0)}function f(){g.inserting=!1,g.completed=!0,g.deleteInterval(),g.pager.show(),g.pushThread(a.Thread.run(function(){h.getSummary(),g.period.count()},0)),g.pushThread(a.Thread.run(function(){g.markReaded(),g.markReFw(),g.markContact(),g.pushThread(a.Thread.run(function(){if(h.lazyLoad(),!Lb){var b,c="mboxDragDiv",d=a.fly("#"+c);d?b=d.dom:(b=document.createElement("DIV"),b.id=c,b.style.display="none",b.className="nui-layer tD0 sc0",document.body.appendChild(b)),g.dragDiv=b}var e=g.letters;if(e.length>0)try{e[0].getDiv().focus()}catch(f){}})),a.Component.setEvents(10)},0))}var g=this,h=g.module;g.period;var i;if(g.inserting)return e(),void 0;g.inserting=!0;try{d||(d=h.getCacheData());var j=h.extend("limit"),k=g.insertLimit,l=g.inserted,m=g.letters,n=g.ids,o=!(l>0),p=h.getDom("ListDiv"),q=document.createDocumentFragment(),r=[],s=0;h.extend("expire")&&(s+=Eb.getInfo("expire"));var t=j+s;if(d&&l<d.length&&t>l){o||(k=2*k);for(var u=0,v=d.length,w=b?t:k;v>l&&w>u;l++,u++)try{var x=d[l],y=new Bb(g,x);y.initDom(b);var z;if(!c)var z=g.period.get(x,b);b?(r.push(z.html||""),r.push(y.html)):(z.div&&q.appendChild(z.div),q.appendChild(y.getDiv())),m.push(y),n[y.id]=y}catch(A){}g.inserted=l,b?(i=r.join(""),p&&(p.innerHTML=r.join(""))):p&&(o&&(p.innerHTML=""),p.appendChild(q)),v>l?e():f()}else f()}catch(A){g.deleteInterval(),g.initThreads(),h.extend("retry")||(a.Thread.run(function(){g.refresh(h.extend("index"),!0,!0)},0),h.extend("retry",!0))}return g.inserting=!1,i}function v(b,c,d,e,f){function g(b,c){c||(w?w.after(b):z.prepend(b)),w=a(b)}function h(a,b,c){var d=a.data;if(a.data=b,a.format(),!f||f[b.id])switch(c){case"read":case"recall":a.setRead();break;case"flag":a.setFlag();break;case"tag":a.setTag();break;case"defer":case"memo":a.setDefer(),a.setMemo();break;case"move":case"folder":a.setMove();break;case"top":a.setTop();break;default:var e;if(!c){e=[];var g=d.flags||{},h=b.flags||{};!g.read!=!h.read&&e.push("Read"),d.label0!==b.label0&&e.push("Flag"),d.fid!==b.fid&&e.push("Move"),b.tag||(b.tag=[]),Gb.isEqual(d.tag,b.tag)||e.push("Tag"),(d.defer!==b.defer||!g.deferHandle!=!b.deferHandle)&&e.push("Defer"),d.memo!==b.memo&&e.push("Memo"),!g.top!=!h.top&&e.push("Top")}if(e.length>0)for(var i=0,j=e.length;j>i;i++)try{a["set"+e[i]]()}catch(k){}}}var i=this,j=i.module,k=j.extend("index"),l=j.getCacheData(k)||[],m=i.letters,n={},o={},p=c&&d>0&&Gb.count(e)===d;if(p)for(var q=0,r=m.length;r>q;q++){var s=m[q],t=s.data.id;e[t]?o[t]=s:n[t]=s}else{for(var u={},q=0,r=l.length;r>q;q++){var v=l[q];u[v.id]=v}for(var q=0,r=m.length;r>q;q++){var s=m[q],v=m[q].data,t=v.id;u[t]?n[t]=s:o[t]=s}}Gb.each(o,function(a,b){try{b.remove(!0)}catch(c){}}),i.period.reset();for(var w,x=[],y={},z=j.getEl("ListDiv"),q=0,r=l.length;r>q;q++){var v=l[q],t=v.id,A=i.period.get(v);A.div&&g(A.div);var s=n[t],B=!!s;B?h(s,v,b):(s=new Bb(i,v),s.initDom());var C=s.getDiv();g(C,B&&c),x.push(s),y[C.id]=s}i.letters=x,i.ids=y,i.pushThread(a.Thread.run(function(){j.getSummary(),i.period.count(),i.markContact(),i.update(),i.selectAll(!1)},0))}function w(a,b,c,d){function e(b){switch(a){case"read":b.setRead();break;case"flag":b.setFlag();break;case"tag":b.setTag();break;case"defer":case"memo":b.setDefer(),b.setMemo();break;case"move":b.setMove();break;case"top":b.setTop()}}try{}catch(f){return f}var g=this;g.module;try{for(var h=g.letters,i=0,j=0,k=h.length;k>i&&b>j;i++){var l=h[i],m=l.data.id;(c[m]||d[m])&&(e(l),j++)}}catch(f){}g.update()}function x(b){var c,d,e=this,f=this.module,g=f.extend("subtype"),h="full"===g,i="defer"===g,j=f.extend("brand"),k=1===a.Ud.get({field:"ntes_option",flag:"summary"})-0,l=f.isThread()||h||k,m=e.getLayout(f);if(!b||"Html"===b){if(c=["tc0"],h){var n=1===a.Ud.get({field:"ntes_global",flag:"secondSearch"})-0;n?c.push("zj1"):c.push("Ay0")}var o=a.Ud.get({field:"ntes_letter",flag:"font_size"})-0;c.push(Mb.fontSize[o]),0!==o&&1!==o&&(l=!0);var p=a.Ud.get({field:"ntes_letter",flag:"line_height"})-0;"l-r"===m&&(p=1),0!==p&&3!==p&&(l=!0);var q=a.Ud.get({field:"ntes_option",flag:"sizeshow"})-0,r=e.config.sizeShow=!(Lb||$S("isFree")&&1!==q);r&&(c.push("ts1"),l=!0)," "+Mb.lineHeight[p],c.push(Mb.lineHeight[p])}if(!b||"List"===b){var d=["tv0"];h&&(d.push("nF0"),l=!0),"l-r"===m&&(d.push("oo1"),l=!0),i&&(d.push("sv1"),l=!0),j&&(l=!0)}if(f.isDefer()&&Eb.getInfo("total")>0&&(l=!0),l&&Mb.addCss(),b){if("Html"===b)return c.join(" ");if("List"===b)return d.join(" ")}else{var s=f.getEl("HtmlDiv"),t=f.getEl("ListDiv");s.setClass(c.join(" ")),t.setClass(d.join(" ")),s.destroy(),t.destroy()}}function y(){var a=this,b=a.module;return b.constructor.getLayout(b)}function z(b,c){var d=this;d.module;var e=a(document.body),f=d.dragDiv,g=a.Event.get();switch(c){case"mousedown":b.setChecked(!0);var h=d.getSelected(),i=h.length,j=Fb.t("移动")+'<span class="qI0">'+i+"</span>"+Fb.t("封邮件");f.innerHTML=j,f.style.left=g.clientX+2+"px",f.style.top=g.clientY+2+"px";break;case"start":f.style.display="";break;case"drag":var k,l=a.Event.getTarget(),m=a.fly(l).findParent("LI",!0,!0);m&&(k=a.Nav.getFid(m.dom.id)),k>0&&k!==(a.Context.getModule()||{}).fid?(d.dragToFid=k,e.removeClass("sc0"),e.addClass("rA0")):(d.dragToFid=null,e.addClass("sc0"),e.removeClass("rA0"));break;case"end":e.removeClass("sc0"),e.removeClass("rA0"),f.style.display="none";var n=d.dragToFid;n>0&&(d.move(n),delete d.dragToFid)}e.destroy()}function A(){var b=this,c=b.module,d=a.fly(c.getDom("ListDiv"));d.listen("mouseover",Hb.bind(b.mouseover,b)),d.listen("mousedown",Hb.bind(b.mousedown,b)),d.listen("click",Hb.bind(b.click,b)),d.listen("touchend",Hb.bind(b.click,b)),d.listen("keypress",Hb.bind(b.keypress,b)),d.listen("contextmenu",Hb.bind(b.contextmenu,b))}function B(){for(var a=this,b=a.module,c=Ib.getTarget(),d=b.getDom("ListDiv"),e={};c&&c!==d;){var f=c.getAttribute("sign");if(f){if("letter"===f){e.div=c;break}e.sign||(e.sign=f,e.target=c)}c=c.parentNode}return e.div||(e=null),e}function C(){var a=this;try{var b=a.getTargetInfo();if(b){var c=b.div,d=a.ids[c.id];d.mouseover(b)}}catch(e){}}function D(){var b=this,c=a.Event.get();if(1===c.which)try{var d=b.getTargetInfo();if(d){var e=d.div,f=b.ids[e.id];f.mousedown(d)}}catch(g){}}function E(){var a=this;try{var b=a.getTargetInfo();if(b){var c=b.div,d=a.ids[c.id];d.click(b)}}catch(e){}}function F(){var a=this;try{var b=a.getTargetInfo();if(b){var c=b.div,d=a.ids[c.id];d.keypress(b)}}catch(e){}}function G(){var a=this;try{var b=a.getTargetInfo();if(b){var c=b.div,d=a.ids[c.id];d.contextmenu(b)}}catch(e){}}function H(a){for(var b=this,c=b.module,d=b.letters,e=0,f=0,g=d.length;g>f;f++){var h=d[f],i=h.data,j=i.flags,k=!!h.checked,l=!0;switch(a){case"all":k&&(l=!1);break;case"none":k||(l=!1);break;case"unread":!j.read===k&&(l=!1);break;case"read":!!j.read===k&&(l=!1);break;case"expire":!!h.expire===k&&(l=!1)}l&&h.setChecked(!h.checked),h.checked&&e++}b.selectAll(e>0&&e===d.length);try{c._child.view.changeSelect()}catch(m){}}function I(a){var b=this,c=b.toolbar;if("undefined"==typeof a){a=!0;for(var d=b.letters,e=0,f=d.length;f>e;e++)if(!d[e].checked){a=!1;break}}b.allSelected^a&&(c.selectAll(a),b.allSelected=a,b.folderSelected=!1,b.selectFolder())}function J(){var a=this,b=a.module;b.isSelectFolder()&&(a.tips.update(),a.toolbar.update())}function K(a){var b=this;b.folderSelected=!!a,a?b.selectFolder():b.select("none")}function L(b,c,d){function e(){i.createInterval(),a.Thread.run(function(){i.toolbar.update(),i.pager.update(),i.tips.update(),i.toggleFooter();var a=i.archiveTips;a&&a.getEl()[b===n-1?"show":"hide"]()},0)}try{}catch(f){return f}var g,h,i=this,j=i.module,k=j.extend("area");a.Ext.archive&&(g="normal"===k,h="archive"===k);var l,m,n=j.getPage();if(b>=n&&(g?l=!0:b=n-1),b>=0||(h?m=!0:b=0),l||m){var o=Gb.clone(j.param()),p=Gb.clone(j.extend());if(l)o.mboxa="2",p.index=0;else{delete o.mboxa;var b=0;try{var q=a.JS.get("mbox.ListModule",o);if(q)b=q.getPage()-1,0>b&&(b=0);else{var r=Db.getInfo(j.param("fid")),s=j.extend("limit");b=Math.floor(r/s)}}catch(f){}p.index=b}delete p.area,i.initThreads(),tb.entry(o,p)}else if(c||j.extend("forcePage")||j._cacheCleaned){i.deleteInterval();var o=Gb.clone(j.param()),p=Gb.clone(j.extend());p.index=b,p.saveLayout=!d,i.initThreads(),tb.entry(o,p)}else b!==j.extend("index")&&(j.extend("index",b),j.getData(e,b),a.Thread.run(function(){j.getDom("ScrollDiv").scrollTop=0,delete j.scrollTop}))}function M(b,d,e,f){try{}catch(g){return g}var h=this,i=h.module,j=$I("init.Sync"),k=Gb.clone(i.param()),l=Gb.clone(i.extend());l.forceRequest=!0,l.retry=e,l.saveLayout=!f;var m=i.getPage();b>=m&&(b=m-1),b>0||(b=0),l.index=b,h.deleteInterval(),h.initThreads(),d?tb.entry(k,l):(a.Listener.one("sync:request",function(){try{Eb.setCache()}catch(a){}tb.entry(k,l)}),j.request(c,{listen:!0})),setTimeout(a.Function.bind(h.module.setAd,h.module),1e3)}function N(b,d,e){function f(d,f){function h(){g.rollback(f)}if(!e){var i="";f&&(i="&nbsp;"+new a.Link({text:Fb.t("撤销"),bracket:!0,click:h}).html()),a.Tips.show({succ:!0,text:Fb.t("成功设置邮件为")+(b?Fb.t("已读"):Fb.t("未读"))+i,expires:i?g.succExpires:c})}}var g=this,h=g.module,i=g.allSelected&&g.folderSelected,j=h.param("fid");if(d=g.getSelected(d,function(a){return a.data.flags.read^b}),!i&&!g.checkLetters(d,e))return!1;var k=g.getSelectedData(d);try{var l=$L("module.mbox.MboxModule",this)}catch(m){return m}l.setRead({allFid:i?j:c,area:h.extend("area"),isRead:b,data:k,callback:f})
}function O(b,d){function e(d,e){function g(){f.rollback(e)}var h="";e&&(h="&nbsp;"+new a.Link({text:Fb.t("撤销"),bracket:!0,click:g}).html()),a.Tips.show({succ:!0,text:Fb.t("成功")+(b>0?Fb.t("设置"):Fb.t("取消"))+Fb.t("邮件旗帜")+h,expires:h?f.succExpires:c})}var f=this,g=f.module,h=g.param("fid"),i=f.allSelected&&f.folderSelected;if(d=f.getSelected(d,function(a){return a.data.label0!==b}),!i&&!f.checkLetters(d))return!1;var j=f.getSelectedData(d);try{var k=$L("module.mbox.MboxModule",this)}catch(l){return l}k.setFlag({allFid:i?h:c,area:g.extend("area"),flag:b,data:j,callback:e})}function P(b,d,e){function f(e,f){function h(){g.rollback(f)}var i="";f&&(i="&nbsp;"+new a.Link({text:Fb.t("撤销"),bracket:!0,click:h}).html()),a.Tips.show({succ:!0,text:Fb.t("成功")+(b?Fb.t("设置"):Fb.t("取消")+(d?"":Fb.t("所有")))+Fb.t("邮件标签")+i,expires:i?g.succExpires:c})}var g=this,h=g.module,i=h.param("fid"),j=g.allSelected&&g.folderSelected;if(e=g.getSelected(e,function(a){var c=a.data.tag,e=!1;return e=b?!(c&&Jb.has(c,d)):!d||d&&Jb.has(c,d)}),!j&&!g.checkLetters(e))return!1;var k=g.getSelectedData(e);try{var l=$L("module.mbox.MboxModule",this)}catch(m){return m}l.setTag({allFid:j?i:c,area:h.extend("area"),isAdd:b,tag:d,data:k,callback:f})}function Q(b,d,e){function f(d,e){function f(){g.rollback(e)}var h="";e&&(h="&nbsp;"+new a.Link({text:Fb.t("撤销"),bracket:!0,click:f}).html());var i;switch(b){case"add":case"modify":i=Fb.t("成功设置邮件待办");break;case"complete":i=Fb.t("成功完成邮件待办");break;case"delete":i=Fb.t("成功删除邮件备注")}a.Tips.show({succ:!0,text:i+h,expires:h?g.succExpires:c})}var g=this,h=g.module,i=h.param("fid"),j=g.allSelected&&g.folderSelected,k=!d;k&&(d={});var l=d.defer,m=d.memo,n=d.smsDate;if(e=g.getSelected(e,function(a){var c=!1,d=a.data;switch(b){case"add":case"modify":c=!0;break;case"complete":c=d.defer&&d.flags.deferHandle;break;case"delete":c=!!d.memo}return c}),!g.checkLetters(e))return!1;if("add"===b&&k){e&&1===e.length&&(d.mid=e[0].data.id);try{var o=$L("support.Defer",this)}catch(p){return p}return o.showMsgbox({type:b,data:d,callback:function(a){g.setDefer(b,a,e)}}),void 0}if(!j&&!g.checkLetters(e))return!1;var q=g.getSelectedData(e);try{var r=$L("module.mbox.MboxModule",this)}catch(p){return p}r.setDefer({allFid:j?i:c,area:h.extend("area"),type:b,defer:l,memo:m,smsDate:n,data:q,callback:f})}function R(b,d){function e(d,e){function g(){f.rollback(e)}var h="";e&&(h="&nbsp;"+new a.Link({text:Fb.t("撤销"),bracket:!0,click:g}).html()),a.Tips.show({succ:!0,text:Fb.t("成功")+(b?Fb.t("设置"):Fb.t("取消"))+Fb.t("邮件备注")+h,expires:h?f.succExpires:c})}var f=this;if(d=f.getSelected(d,function(a){return a.data.memo!==b}),!f.checkLetters(d,!0))return!1;var g=f.getSelectedData(d);try{var h=$L("module.mbox.MboxModule",this)}catch(i){return i}h.setMemo({area:f.module.extend("area"),memo:b,data:g,callback:e})}function S(b,d,e){function f(d,e){function f(){g.rollback(e)}var h="";e&&(h="&nbsp;"+new a.Link({text:Fb.t("撤销"),bracket:!0,click:f}).html()),d&&a.Tips.show({succ:!0,text:Fb.t("成功")+(b?Fb.t("设置"):Fb.t("取消"))+Fb.t("邮件置顶")+h,expires:h?g.succExpires:c})}var g=this,h=g.module;if(e||(e=h.param("fid")),d=g.getSelected(d,function(a){return!!a.data.flags.top!==b}),!g.checkLetters(d))return!1;var i=g.getSelectedData(d);try{var j=$L("module.mbox.ListModule",this)}catch(k){return k}j.setTop({fid:e,isTop:b,data:i,callback:f})}function T(){for(var a=this,b=a.letters,c=0,d=b.length;d>c;c++)b[c].setSummary()}function U(b){function c(){a.Tips.show({succ:!0,text:Fb.t("成功取消操作")})}var d=this;d.module;try{var e=$L("module.mbox.MboxModule",this)}catch(f){return f}e.rollback({rollback:b,callback:c})}function V(b,d){function e(d,e){function i(){f.rollback(e)}function k(){function c(c){function e(){i.checked&&g.action.setFilterRule({fid:b,email:d,history:j.checked,callback:f})}function f(b){b?a.Tips.show({succ:!0,text:Fb.t("成功设置来信分类")}):a.Msgbox.show({content:Fb.t("无法添加来信分类，请先清理已存在来信分类规则。"),title:Fb.t("设置来信分类失败")})}if(!c){var h=Fb.t("对来自 ")+d+Fb.t(" 的邮件执行以下规则："),i=new a.Checkbox({text:Fb.t("以后自动移动到&nbsp;")+"<strong>"+Db.get(b).name+"</strong>"+Fb.t("&nbsp;文件夹"),checkedchange:function(){this.checked||j.setChecked(!1,!0)}}),j=new a.Checkbox({text:Fb.t("对已收到邮件执行相同操作"),checkedchange:function(){this.checked&&i.setChecked(!0,!0)}}),k=i.html()+"<br/>"+j.html();a.Msgbox.show({type:"confirm",header:Fb.t("新建来信分类规则"),content:k,title:h,ok:e}),a.Component.setEvents()}}if(!(j.length<2)){for(var d,e=0,f=j.length;f>e;e++){if(j[e].threadMessageCount>1)return;var h=a.Uri.getAddress(j[e].from).toLowerCase();if(d){if(d!==h)return}else d=h}if(d){try{var i=$L("interface.OptionInterface",this)}catch(k){return k}i.checkFilterLimit(c)}}}try{}catch(l){return l}if(b){var m="";e&&(m="&nbsp;"+new a.Link({text:Fb.t("撤销"),bracket:!0,click:i}).html());var n=new a.Link({text:Db.get(b).name,click:Hb.bind(tb.entry,tb,{fid:b},{type:"list",subtype:"folder"})});a.Tips.show({succ:!0,text:Fb.t("成功移动邮件到 ")+n.html()+m,expires:m?f.succExpires:c}),a.Component.setEvents()}else{var o="";a.Ext.recovery&&(o="&nbsp;"+new a.Link({text:Fb.t("恢复误删邮件"),bracket:!0,click:function(){try{var a=$L("interface.OutlinkInterface",this)}catch(b){return b}a.goOutlink({key:"recovery",title:Fb.t("误删恢复")})}}).html()),a.Tips.show({succ:!0,text:Fb.t("成功删除邮件")+o}),a.Component.setEvents()}1===h&&b>20&&k()}var f=this,g=f.module,h=g.param("fid"),i=f.allSelected&&f.folderSelected;if(d=f.getSelected(d,function(a){return a.data.fid!==b||h>0&&h!==b}),!i&&!f.checkLetters(d))return!1;var j=f.getSelectedData(d);try{var k=$L("module.mbox.MboxModule",this)}catch(l){return l}k.move({allFid:i?g.param("fid"):c,area:g.extend("area"),moveToId:b,data:j,callback:e})}function W(a,b){var c=this,d=a?null:4;c.move(d,b)}function X(b,c){function d(c){var d=[];d[d.length]=Fb.t("成功")+(b?Fb.t("举报"):Fb.t("信任"))+Fb.t("邮件"),c.historycount&&(d[d.length]=Fb.t("删除历史来信")+c.historycount+Fb.t("封")),c.listcount?d[d.length]=Fb.t("将")+c.listcount+Fb.t("个发件人加入")+(b?Fb.t("黑名单"):Fb.t("白名单")):c.listerror&&(d[d.length]=Fb.t("发件人没有加入")+(b?Fb.t("黑名单"):Fb.t("白名单"))+Fb.t("，请进入设置清理名单")),a.Tips.show({succ:!0,text:d.join("，")})}var e=this,f=e.module;if(c=e.getSelected(c),!e.checkLetters(c))return!1;var g=f.param("fid"),h=e.getSelectedData(c);try{var i=$L("module.mbox.MboxModule",this)}catch(j){return j}i.setSpam({area:f.extend("area"),fid:g,data:h,isSpam:b,callback:d})}function Y(){function b(b,e){function f(){d.rollback(e)}var g="";e&&(g="&nbsp;"+new a.Link({text:Fb.t("撤销"),bracket:!0,click:f}).html()),a.Tips.show({succ:!0,text:Fb.t("成功设置全部已读")+g,expires:g?d.succExpires:c})}var d=this,e=d.module,f=Gb.clone(e.param()),g=f.fids;g&&(f.fids=g.concat("search"===e.extend("type")?[4]:$G.common.unnormalids));var h=f.filter;h||(h=f.filter={});var i=h.flags;i||(i=h.flags={}),i.read=!1;var j={flags:{read:!0}},k=$S("advLock"),l=!k.disabled&&!k.authenticated2&&(k.pop||k.folders);if(l){var m=!0;if(f.fid>0)m=!0;else for(var g=f.fids||Db.getFids(),n=0,o=0,p=g.length;p>o;o++){var q=g[o];if(k[q]&&(n+=Db.getInfo(q,"unread"),n>0)){m=!1;break}}f.skipLockedFolders=m}try{var r=$L("module.mbox.MboxModule",this)}catch(s){return s}r.setAllRead({area:e.extend("area"),body:{search:f,action:j,isThread:e.isThread()},callback:b})}function Z(a){function b(){Jb.each(a,function(a,b){b.setChecked(!1)})}var c=this,d=c.module;if(a=c.getSelected(a),!c.checkLetters(a))return!1;var e=c.getSelectedData(a,!0);try{var f=$L("module.mbox.MboxModule",this)}catch(g){return g}f.exportLetter({ids:e,isThread:d.isThread(),callback:b})}function $(){function a(){Jb.each(d,function(a,b){b.setChecked(!1)})}var b=this,c=b.module;c.isThread();var d=b.getSelected();if(!b.checkLetters(d))return!1;var e=b.getSelectedData(d,!0);try{var f=$L("module.mbox.MboxModule",this)}catch(g){return g}f.forwardLetter({ids:e,isThread:c.isThread(),callback:a})}function _(){try{var a=this,b=a.readedMid,c=$S("lastRead");if(c&&c!==b){for(var d,e,f=a.letters,g=0,h=f.length;h>g;g++){var i=f[g];if(i.data.id===c&&(i.setLastRead(!0),d=!0),i.data.id===b&&(i.setLastRead(!1),e=!0),d&&e)break}a.readedMid=c}}catch(j){}}function ab(){try{var a=this,b=$S("refw"),c=a.letters;if(b)for(var d in b)for(var e=b[d],f=0,g=c.length;g>f;f++){var h=c[f],i=h.data;if(i.id===d){var j=i.flags;j||(i.flags=j={}),j.replied||(j.replied=e.replied),j.forwarded||(j.forwarded=e.forwarded),h.setReFw(),delete b[d];break}}}catch(k){}}function bb(){for(var a=this,b=a.letters,c=[],d=0,e=b.length;e>d;d++)try{c=c.concat(b[d].components.userlabel)}catch(f){}try{var g=$L("support.AddressSupport",this)}catch(h){return h}g.mark(c)}function cb(){}function db(a,b){var c=this;if(!a){a=[];for(var d=c.letters,e=0,f=d.length;f>e;e++){var g=d[e];g.checked&&a.push(g)}}return 0===a.length?a.empty=!0:(b&&c.filterSelected(a,b),0===a.length&&(a["void"]=!0)),a}function eb(a,b){for(var c=a.length-1;c>-1;c--){var d=a[c];b(d)||(d.setChecked(!1),a.splice(c,1))}}function fb(b,c){var d=this,e="";return b.empty&&(e=Fb.t("没有选中任何邮件，请重新选择")),b["void"]&&(e=Fb.t("选择的邮件已是需要设置的状态，无需再设置")),e?(c||a.Tips.show({text:e}),d.selectAll(!1),!1):!0}function gb(a,b){for(var c=[],d=0,e=a.length;e>d;d++){var f=a[d],g=f.data;c.push(b?g.id:g),f.setChecked(!1)}return c}function hb(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c].id);return b}function ib(b){function c(){a.Tips.show({succ:!0,text:Fb.t("成功设置列表分栏布局")})}0===b&&(b=1);try{var d=$L("support.OptionSupport",this)}catch(e){return e}d.setAttr({field:"ntes_inbox",flag:"layout",value:b,relModule:["inbox","read"],callback:c})}function jb(b){function c(){a.Tips.show({succ:!0,text:Fb.t("成功设置列表显示")})}var d=0,e=0;1===b?(d=2,e=2):2===b?(d=3,e=1):3===b&&(d=4,e=3);try{var f=$L("support.OptionSupport",this)}catch(g){return g}f.setAttr({field:"ntes_letter",flag:"font_size",value:e,module:"inbox",noFire:!0,callback:function(){f.setAttr({field:"ntes_letter",flag:"line_height",value:d,module:"inbox",callback:c})}})}function kb(b){function c(){a.Tips.show({succ:!0,text:Fb.t("成功设置发件人显示")})}try{var d=$L("support.OptionSupport",this)}catch(e){return e}d.setAttr({field:"ntes_option",flag:"sendershow",value:b,module:"contact",callback:c})}function lb(b){function c(){a.Tips.show({succ:!0,text:Fb.t("成功设置邮件显示")})}try{var d=$L("support.OptionSupport",this)}catch(e){return e}d.setAttr({field:"ntes_option",flag:"sizeshow",value:b,module:"inbox",callback:c})}function mb(b){function c(){a.Tips.show({succ:!0,text:Fb.t("成功设置每页显示邮件数")})}try{var d=$L("support.OptionSupport",this)}catch(e){return e}d.setAttr({field:"maxlist",value:b,module:"inbox",callback:c})}function nb(b){function c(){a.Msgbox.show({title:Fb.t("会话设置成功，点击确定刷新邮箱"),ok:d,close:d})}function d(){top.location.reload()}try{var e=$L("support.OptionSupport",this)}catch(f){return f}e.setAttr({field:"ntes_option",flag:"thread",value:b,module:"inbox",callback:c})}function ob(b){function c(){a.Tips.show({succ:!0,text:Fb.t("成功设置邮件摘要")})}try{var d=$L("support.OptionSupport",this)}catch(e){return e}d.setAttr({field:"ntes_option",flag:"summary",value:b,module:"inbox",callback:c})}function pb(){var a,b,c=this,d=c.module,e=d.param("fid"),f=d.getFolder(),g=$S("advLock");f.pop?(a="pop",b=g.pop):(a="folder",b=g[e]),$I("init.AdvLock").setProduct({product:a,fid:e,cancel:b})}function qb(){var a=this;a.title.update(),a.toolbar.update(),a.pager.update(),a.none.update(),a.tips.update()}function rb(b){function c(){tb.defer()}Mb.noticed||(a.Msgbox.show({type:"confirm",header:Fb.t("到期待办邮件提醒"),content:Fb.t("您有 ")+b+Fb.t(" 封到期待办邮件需要处理"),title:Fb.t("您有到期待办邮件"),okText:Fb.t("立即处理"),cancelText:Fb.t("不再提示"),ok:c}),Mb.noticed=!0)}function sb(a){var b=this;b.module=a,b.letters=[],b.ids={};var c=b.config={};c.isTop=a.isTop(),b.tips=new vb(b),b.title=new wb(b),b.pager=new xb(b),b.none=new yb(b),b.toolbar=new zb(b),b.period=new Ab(b),Bb.config()}try{var tb=$L("interface.MboxInterface")}catch(ub){return ub}try{var vb=$L("module.mbox.Tips")}catch(ub){return ub}try{var wb=$L("module.mbox.Title")}catch(ub){return ub}try{var xb=$L("module.mbox.Pager")}catch(ub){return ub}try{var yb=$L("module.mbox.None")}catch(ub){return ub}try{var zb=$L("module.mbox.Toolbar")}catch(ub){return ub}try{var Ab=$L("module.mbox.Period")}catch(ub){return ub}try{var Bb=$L("module.mbox.Letter")}catch(ub){return ub}try{var Cb=$L("module.BaseView")}catch(ub){return ub}try{var Db=$L("init.Folder")}catch(ub){return ub}try{var Eb=$L("init.Defer")}catch(ub){return ub}var Fb=new $I18N("module.mbox.MboxView"),Gb=a.Object,Hb=a.Function,Ib=a.Event,Jb=a.Array;a.Date;var Kb=a.Browser,Lb=Kb.isIE("<9"),Mb=a.createClass($N("module.mbox.MboxView"));Gb.mix(Mb,Cb,{addedCss:!1,fontSize:["","","nui-txt-s16","nui-txt-s12"],lineHeight:["","tE0","pI0","","tw0"],addCss:d,noticed:!1},{config:null,pager:null,none:null,archiveTips:null,inserted:0,inserting:!1,completed:!1,interval:null,threads:[],insertLimit:Lb?20:100,succExpires:15e3,letters:null,ids:null,dragDiv:null,readedMid:null,allSelected:!1,folderSelected:!1,getHtml:e,getAd:f,getBanner:g,getTips:h,getTitle:i,getControl:j,getSmarts:k,getList:l,getPager:m,getNone:n,getFooter:o,getToolbar:p,deleteInterval:q,createInterval:r,initThreads:s,pushThread:t,insertLetter:u,replaceLetter:v,syncLetter:w,setClass:x,getLayout:y,drag:z,listen:A,getTargetInfo:B,mouseover:C,mousedown:D,click:E,keypress:F,contextmenu:G,select:H,selectAll:I,selectFolder:J,setFolderSelect:K,goPage:L,refresh:M,setRead:N,setFlag:O,setTag:P,setDefer:Q,setMemo:R,setTop:S,setSummary:T,rollback:U,move:V,remove:W,setSpam:X,setAllRead:Y,exportLetter:Z,forwardLetter:$,markReaded:_,markReFw:ab,markContact:bb,toggleFooter:cb,getSelected:db,filterSelected:eb,checkLetters:fb,getSelectedData:gb,getSelectedId:hb,setLayout:ib,setSpace:jb,setSenderShow:kb,setSize:lb,setMaxList:mb,setThread:nb,setSummaryShow:ob,setAdvLock:pb,update:qb,showDefer:rb,initialize:sb})}($,window),function(a,b,c){function d(a){for(var b=[],c={},d=0,e=a.length;e>d;d++){var f=a[d].fid;c[f]||(b.push(f),c[f]=!0)}return[b,c]}function e(a){function b(a,b){d&&d(a,b)}var c=this,d=a.callback,e=c.hasThreadAndSent(a.data),f=e[0],g=e[1],h=c.action;wb.extend(a,{hasThread:f,hasSent:g,callback:b}),h.setRead(a)}function f(a){function b(a,b){e&&e(a,b)}var c=this,d=a.single,e=a.callback,f=c.hasThreadAndSent(a.data),g=!d&&f[0],h=!d&&f[1];wb.extend(a,{hasThread:g,hasSent:h,callback:b}),delete a.single;var i=c.action;i.setFlag(a)}function g(a){function b(a,b){d&&d(a,b)}var c=this,d=a.callback,e=c.hasThreadAndSent(a.data),f=e[0],g=e[1],h=c.action;wb.extend(a,{hasThread:f,hasSent:g,callback:b}),h.setTag(a)}function h(a){function b(b,c){if(1===e.length){var f=e[0],g=a.smsDate;if(g){try{var h=$L("product.Schedule",this)}catch(i){return i}h.insert(f.subject,f.id,g)}}d&&d(b,c)}var c=this,d=a.callback,e=a.data,f=c.hasThreadAndSent(e),g=f[0],h=f[1],i=c.action;wb.extend(a,{hasThread:g,hasSent:h,callback:b}),i.setDefer(a)}function i(a){function b(a,b){d&&d(a,b)}var c=this,d=a.callback,e=c.hasThreadAndSent(a.data),f=e[0],g=e[1];wb.extend(a,{hasThread:f,hasSent:g,callback:b});var h=c.action;h.setMemo(a)}function j(a){function b(a){g&&g(a)}var c=this,d=a.ruleConditions,e=a.fids,f=a.attrs,g=a.callback,h=c.action;h.setFilter({ruleConditions:d,fids:e,attrs:f,callback:b})}function k(a){function b(a){d&&d(a)}var c=a.rollback,d=a.callback;c(b)}function l(b){function c(){i.move(b)}function d(a,b){h&&h(a,b)}var e=this,f=b.moveToId,g=b.data,h=b.callback,i=e.action,j=e.parseFid(g),k=e.hasThreadAndSent(g),l=k[0],m=k[1];if(wb.extend(b,{fidInfo:j,hasThread:l,hasSent:m,callback:d}),f>0)c();else{var n,o="",p=!!($S("cos").pref_mail_preserving_days>0);if($S("isFree")||$S("isVip")){var q=p?vb.t("误删恢复"):vb.t("开启误删恢复"),r=new a.Link({text:q,click:function(){if(!p&&$S("isFree")){try{var a=$L("product.Privileges",this)}catch(b){return b}a.showDialog("deleteRecovery","","deleted_del")}else $I("util.CustomAppManager").goOutLink("recovery",q);n.close()}});o=p?vb.t("通过 ")+r.html()+vb.t("，可恢复10天内彻底删除的邮件"):vb.t("提前")+r.html()+vb.t("，可找回10天内彻底删除邮件")}n=a.Msgbox.show({type:"confirm",content:o,title:vb.t("确定彻底删除邮件吗？"),ok:c}),a.Component.setEvents()}}function m(b){function c(){function b(){t.log("spam","normal");var a=e();f(c.checked,!1,n,a)}var c=new a.Checkbox({text:vb.t("把发件人加入白名单")});a.Msgbox.show({type:"confirm",content:c.html(),title:vb.t("所选邮件将被移动到收件箱"),ok:b}),a.Component.setEvents()}function d(){function b(){var a=vb.t("确 定");(o.checked||p.checked)&&(a=vb.t("下一步")),m.buttons.ok.setText(a)}function c(){try{t.log("spam","close")}catch(a){}}function d(){m.buttons.ok.setDisabled(!1)}function g(){function b(){var b=e();a.Log.cache({reportList$Type:b.join("|")+"$"+h});var i;if(c){i=[];var j=c.getValue();wb.each(j,function(a,b){i.push(b)})}f(d,g,n,i,h)}var c,d=o.checked,g=p.checked,h=j[0].ownerGroup.value,i=e();if(h){try{t.log("spam","type",h),d&&t.log("spam","add"),g&&t.log("spam","delete")}catch(k){}if(d||g)if(i.length>0){for(var l=[],m=[],q=0,r=i.length;r>q;q++)try{var s=new a.Uri(i[q]),u=s.getNameWithoutPrefix(),v=s.address;v&&m.push({value:v,text:'<strong class="nui-txt-normal">'+u+'</strong><em class="nui-txt-tips">&lt;'+v+"&gt;</em>",title:v,checked:!0})}catch(k){}c=new a.CheckGroup({type:"vertical",items:m,checkType:"checkbox"});var w=[];d&&(w[w.length]='<p class="nui-item"><strong class="nui-txt-impt">'+vb.t("确定要把下列选中的发件人加入黑名单？")+"</strong></p>"),g&&(w[w.length]='<p class="nui-item"><strong class="nui-txt-impt">'+vb.t("确定要删除该发件人的历史来信（谨慎）？")+"</strong></p>"),l[l.length]='<div class="nui-scroll qn0" style="height:180px;">'+c.html()+"</div>",a.Msgbox.show({type:"confirm",header:vb.t("禁止发件人"),content:l.join(""),title:w.join(""),ok:b}),a.Component.setEvents()}else b();else b()}}for(var h=[{text:vb.t("仿冒邮件（仿冒各类通知）"),value:"3",checkedchange:d},{text:vb.t("色情邮件"),value:"4",checkedchange:d},{text:vb.t("钓鱼邮件（诱导骗取信息）"),value:"5",checkedchange:d},{text:vb.t("违法邮件"),value:"6",checkedchange:d},{text:vb.t("代开发票"),value:"7",checkedchange:d},{text:vb.t("广告推广"),value:"8",checkedchange:d},{text:vb.t("其他邮件"),value:"9",checkedchange:d}],i=[],j=[],k=0;k<h.length;k++){var l=new a.Radio(h[k]);j.push(l),0===k%2&&i.push("<tr>"),i.push("<td>"),i.push(l.html()),i.push("</td>"),1==k%2&&i.push("</tr>")}1==h.length%2&&i.push("</tr>"),a.Radio.group(j);var m,o=new a.Checkbox({extcls:"nui-item",text:vb.t("将发件人加入黑名单"),checkedchange:b}),p=new a.Checkbox({extcls:"nui-item",text:vb.t("将发件人的历史来信移到垃圾邮件"),checkedchange:b}),q="<strong>"+vb.t("您举报的邮件类型为：")+"</strong>",r='<div class="xf1"><div class="kZ1"><table>'+i.join("")+"</table></div>"+o.html()+"<br/>"+p.html()+'<span class="nui-txt-impt">'+vb.t("(谨慎)")+"</span></label></div>",s=pb.isLowAntiSpamLevel();s&&(r+='<br/><br/><span class="nui-txt-impt">'+vb.t("小提示：反垃圾级别设置过低或关闭了智能分类，建议重新")+"</span> "+new a.Link({text:vb.t("设置"),click:function(){try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"AntiSpamModule"}),m.close()}}).html()),m=a.Msgbox.show({type:"confirm",header:vb.t("举报邮件"),content:r,title:q,ok:g,cancel:c,close:c}),a.Component.setEvents(),m.buttons.ok.setDisabled(!0)}function e(){for(var b=[],c={},d=0,e=m.length;e>d;d++){var f=m[d];n.push(f.id);for(var g=f.from.split(","),h=0,j=g.length;j>h;h++){var k=a.String.trim(a.Uri.getAddress(a.String.trim(g[h]).replace("+",""))).toLowerCase();c[k]||i.isSender(k)||(c[k]=!0,b.push(k))}}return b}function f(a,b,c,d,e){p.setSpam({area:k,reportType:l?"spam":"notspam",spamType:e,isSpam:l,addList:a,deleteLetter:b,data:m,ids:c,emails:d,hasThread:r,hasSent:s,callback:g})}function g(a){o&&o(a)}try{}catch(h){return h}var i=a.SenderList,j=this,k=b.area,l=b.isSpam,m=b.data,n=[],o=b.callback,p=j.action,q=j.hasThreadAndSent(m),r=q[0],s=q[1],t=a.Context.getModule();l?d():c()}function n(a){function b(a,b){e&&e(a,b)}var c=this,d=c.action,e=a.callback;a.callback=b,d.setAllRead(a)}function o(a){function b(){g&&g()}var c=this,d=c.action,e=a.ids,f=a.isThread,g=a.callback;d.exportLetter({ids:e,isThread:f,callback:b})}function p(a){function b(a){try{var b=$L("interface.ComposeInterface",this)}catch(c){return c}b.forward({id:a}),g&&g()}var c=this,d=c.action,e=a.ids,f=a.isThread,g=a.callback;f?d.getThreadIds({ids:e,callback:b}):b(e)}function q(a){var b=!1,c=!1,d=sb.check();if(d)for(var e=0,f=a.length;f>e;e++){var g=a[e];if(3===g.fid&&(c=!0),g.threadMessageCount>1&&(b=!0),b&&c)break}return[b,c]}function r(b,c){var d=a.Ud.get({field:"ntes_inbox",flag:"layout"})-0;(yb||b&&b.extend&&"full"===b.extend("viewLayout")||c&&c.extend&&"full"===c.extend.viewLayout)&&(d=0);var e;switch(d){case 3:e="l-r";break;case 2:e="t-b";break;default:e=""}return e}function s(){try{var b=a.Event.get(),c=a.Context.getModule();"mbox"==c.logPrefix&&(38===b.which?c.onFocus(-1):40===b.which&&c.onFocus(1))}catch(d){}}function t(b,c,d){var e,f,g=this;if(c.moduleName&&(e=a.JS.find(c.moduleName),delete c.moduleName),e){var h=e._var;h.call=d,h.cacheDom=!0,f=e}else{var i="search"===c.type,j="mbox."+(i?"SearchModule":"ListModule");e=a.JS.get(j,b);var k=!1,l=!1;if(e){if(e._cacheCleaned)l=!0;else{var m=c.index;e.extend("index")===m?k=!0:e.setVar("extend","index",m)}2===e.param("fid")&&(l=!0,k=!1),(c.forceRequest||e.extend("forceRequest")||e.extend("forceReplace")||e.extend("forcePage"))&&(l=!0,k=!1,delete c.forceRequest,e.setVar("extend","forceRequest"),e.setVar("extend","forceReplace"),e.setVar("extend","forcePage")),e.view.completed||(k=!1);try{e._child.view.changeSelect()}catch(n){}e===a.Context.getModule()&&(e.scrollTop=0),l&&e.cleanData(),wb.extend(e.extend(),c)}f={module:j,param:b,extend:c,call:d,cacheDom:k,reset:!1,exit:!1};var o=g.getLayout(e,f);f.hasChildMod=!0,f.sharebar=!0,f.viewType=o;try{var c=f.extend;c.brand&&(o?c.brand=!1:f.fixViewType="brand")}catch(n){}}e&&(e._viewType=o),"folder"===c.subtype&&a.Log.cache({mbox_folder_enter:b.fid}),a.JS.go(f)}function u(){}function v(){function d(){var c,d=a.Misc.getTime(),e=j.param("fid"),f=a.Ud.get({field:"ntes_inbox",flag:"layout"})-0,g=0===f||1==f;1==e&&d&&d<=new b.Date(2018,10,14)&&d>=new b.Date(2018,10,9)&&!a("showCloseyxMboxAd")&&g&&!a("#yanxuanMboxAd")&&(c=d<=new b.Date(2018,10,11)&&d>=new b.Date(2018,10,9)?'<div id="yanxuanMboxAd" style="position: absolute;right: 84px;bottom: 238px;z-index: 99;"><a href="http://u.163.com/webmailsjx1"  target="_blank"><img src="https://onegoods.nosdn.127.net/resupload/2018/11/8/61d78dc94a0ed6d7546306666b8204d5.gif"></a><a onclick="$(\'#yanxuanMboxAd\').remove();$(\'showCloseyxMboxAd\',true);" href="javascript:void(0)" class="nui-closeable-x" style="display:block;top:0;right:0;" hidefocus="hidefocus"></a></div>':'<div id="yanxuanMboxAd" style="position: absolute;right: 84px;bottom: 238px;z-index: 99;"><a href="http://u.163.com/webmailsjx2"  target="_blank"><img src="https://onegoods.nosdn.127.net/resupload/2018/11/8/7275f7ad4d6eec4b65342402eb375f74.gif"></a><a  onclick="$(\'#yanxuanMboxAd\').remove();$(\'showCloseyxMboxAd\',true);" href="javascript:void(0)" class="nui-closeable-x" style="display:block;top:0;right:0;" hidefocus="hidefocus"></a></div>',a(j.container).append(c))}function e(){k.createInterval(),k.listen()}function f(){delete j.scrollTop,j.scroll(c,g)}function g(){j.scrollTop=l.scrollTop}function h(){try{var b=k.getLayout();if(b)j.extend("saveLayout")?j.extend("saveLayout",c):a.SM.go({parent:j,module:"mbox.PreviewModule",param:{layout:b},viewType:b,sharebar:!0,cacheDom:!1,reset:!1});else if(j.extend("brand")){try{var d=$L("interface.MboxInterface",this)}catch(e){return e}d.brandLoad()}}catch(f){}}function i(){try{if(j.param("fid")>0){var a=tb.get("expire"),b=a.stats.messageCount;b>0&&k.showDefer(b)}}catch(c){}}var j=this,k=j.view,l=j.getDom("ScrollDiv");f(),e(),h(),a.Thread.delay(i),a.Thread.delay(a.Function.bind(d,this))}function w(a,b,c){var d=this,e=d.view;if("beforeunload"!==c)try{e.select("none")}catch(f){}try{d._child.exit()}catch(f){}return!0}function x(){}function y(){var a=this,b=a.param("filter"),c="";return b&&b.sentDate&&(c="date"),a.mtype+c}function z(){var a=this,b=a.view;try{a.container&&b.getAd(!0),a._child.switchIn()}catch(c){}}function A(){var a=this;try{a._child.switchOut()}catch(b){}}function B(){var b=this,d=b.view,e=b.getStats(),f=b.getTotal();if(!d.completed||b.extend("forceRequest")||!b.extend("forcePage")&&e>-1&&e!==f)d.refresh(b.extend("index"));else{if(b.extend("forceReplace"))b.extend("forceReplace",c),b.replace();else{d.markReaded(),d.markReFw();var g=b.scrollTop;if("undefined"!=typeof g){g||(g=0);var h=b.getDom("ScrollDiv");0!==g&&(h.scrollTop=g),delete b.scrollTop}b.extend("brand")&&b._child&&a.Frame.setViewType("l-r",b)}if(b.extend("forceBrand")){b.extend("forceBrand",c);try{b.refreshBrand()}catch(i){}}}try{b.onFocus()}catch(i){}}function C(){var a=this,b=a.view;b.dragDiv=null,a.removeCache()}function D(b){try{var c=a.Context.getModule(),d=c.view,e=d.letters,f=c.diff||0;if(b&&(f+=b),0>f&&(f=0),f>e.length-1&&(f=e.length-1),c.diff=f,e.length>0)try{e[f].getDiv().focus()}catch(g){}}catch(g){}}function E(a,b,c,d,e){function f(){var f=g.getCacheData(i);if(!f||f.onlyExpire){var j=i-1;j>=0||"archive"===g.extend("area")?h.goPage(j):h.refresh()}else h.replaceLetter(a,b,c,d,e)}var g=this,h=g.view,i=g.extend("index");g.extend("limit");var j=b&&c>0&&wb.count(d)===c;j?g.removeData(c,d):g.cleanData(),g.getData(f,i,!0)}function F(){function b(a,b){if(b>=0?b++:b=0,2>b&&b<a.length&&f){var d=a[b];try{d.gotoRead({preload:!0,hiddenCall:function(){c(a,b)}})}catch(e){}}}function c(c,d){a.Thread.delay(function(){b(c,d)})}var d=this,e=d.view,f=d===a.Context.getModule();if(f){var g=d.extend("index");if(d.autoGetData(g-1),d.autoGetData(g+1),0===g){for(var h=e.letters,i=[],j=[],k=0,l=h.length;l>k;k++){var m=h[k],n=m.data;2===n.fid||n.flags.top||m.isThread||n.flags.read||i.push(m)}var o=i.concat(j);c(o)}}}function G(a,b){function c(){b&&b()}var d=this,e=d.extend("type"),f=d.getPage();!(a>f-1)&&a>=0&&"search"!==e&&(d.getCacheData(a,!0)||d.getData(c,a,!0))}function H(){}function I(b){var c=this;if(b)c.removeCache(),a.JS.cleanCache(c);else{c.extend("forceRequest",!0);try{c.view.completed=!1}catch(d){}}}function J(){}function K(){var a=this;a.extend("forceReplace",!0)}function L(){var b=this,c=b.view;try{var d=c.letters;d.length>0&&a.Array.each(d,function(b,c){a.Thread.delay(function(){try{c.remove()}catch(a){}})}),c.letters=[],c.ids={},delete c.allSelected,delete c.folderSelected}catch(e){}}function M(){}function N(){var a=this,b=a.total;try{-1===b&&(b=a.getStats())}catch(c){}return b>=0||(b=0),b}function O(b){var c=this;b>=0||(b=0);var d=c.getStats();d>-1&&d!==b&&a.Thread.delay(function(){$I("init.Sync").request()},0),c.total=b}function P(){var a=this,b=-1;try{var c=a.param("fid"),d=a.isDefer(),e=d&&c>0&&tb.showTop(c)&&tb.getInfo("expire")>0;if(!e){var f,g=a.extend("subtype"),h="";if("read"===g){var i=a.param("filter"),j=!i.flags.read;j&&(f=1===a.param("fids").length?"folder":a.param("tag")?"tag":i.chatWithAddress?"contacts":"read",h="unread")}else f=g;switch(f){case"folder":var c=a.param("fid")||a.param("fids")[0];b=rb.getInfo(c,h);break;case"tag":var k=a.param("tag");b=ub.getInfo(k[0],h);break;case"defer":b=tb.getInfo("total",h);break;case"contacts":var l=a.param("filter").chatWithAddress;b=$I("init.Contacts").getInfo(l,h);break;case"read":b=rb.getTotal(h)}}}catch(m){}return b}function Q(){var a=this,b=a.getTotal(),c=a.extend("limit");return Math.ceil(b/c)}function R(a){var b,c=this,d=c.extend("subtype");switch(d){case"folder":var e=c.param("fid");b=rb.getInfo(e,a);break;case"tag":var f=c.param("tag");b=0;for(var g=0,h=f.length;h>g;g++)b+=ub.getInfo(f[g],a);break;case"normal":case"full":"unread"!==a&&(b=c.getTotal());break;case"flag":b=$I("init.Flag").getInfo(1,a);break;case"defer":}return b}function S(){return""}function T(){var a=this,b=a.keyword;if("string"!=typeof b){b="";var c=a.param("pattern");if(c)b=c;else{var d=a.param("conditions");try{wb.isArray(d)||(d=[d]);for(var e=0,f=d.length;f>e;e++){var g=d[e];if("subject"===g.field){b=g.operand;break}}}catch(h){}}a.keyword=b}return b}function U(){}function V(a,b){var c=this;try{var d;return d=b?c._var[a][b]:c._var[a]}catch(e){}}function W(a,b,c){var d=this;try{d._var[a][b]=c}catch(e){}}function X(a,b){var c=this,d="param",e=arguments.length;return 0===e?c.getVar(d):1===e?c.getVar(d,a):(2===e&&c.setVar(d,a,b),void 0)}function Y(a,b){var c=this,d="extend",e=arguments.length;return 0===e?c.getVar(d):1===e?c.getVar(d,a):(2===e&&c.setVar(d,a,b),void 0)}function Z(a){var b=this,c=!1;b.param("fid");var d=b.extend("subtype");switch(d){case"folder":case"flag":case"tag":case"read":c=sb.check(b.param("fid"),a)&&"archive"!==b.extend("area")}return c}function $(a){var b=this,c=b instanceof zb;try{!a&&c&&(a=b.param("fid"))}catch(d){}return rb.isTop(a)&&(!c||"archive"!==b.extend("area")&&"date"===b.param("order")&&b.param("desc")===!0)}function _(){var a=this,b=a.extend("area");return"archive"!==b}function ab(){var b=this,c=b.extend("area");return a.Ext.tag&&"archive"!==c}function bb(){var b=this,c=b.extend("area");return a.Ext.defer&&"archive"!==c}function cb(){var b=this,c=a.Ext.archive;if(c){var d=b.extend("subtype");switch(d){case"flag":case"tag":break;case"folder":var e=b.param("fid");0===rb.getArchive(e)&&(c=!1);break;default:c=!1}}return c}function db(){var a=this,b=a.param("fid"),c=a.isDefer(),d=c&&b>0&&tb.showTop(b)&&tb.getInfo("expire")>0,e=a.getPage();return!d&&0===e}function eb(){var b=this,c=b.extend("type"),d=b.extend("brand"),e="standard"===$G.mailPattern.currentPattern,f=$S("ad");return!(!$S("isFree")||!e||"1"==a.LocalStorage.get("mailmboxpro")||$S("mboxAdClosed")||"list"!==c||d||!f.show&&"ud"===f.userType||this.isNone())}function fb(){var a=this;a.extend("subtype");var b=a.param("fid"),c="standard"===$G.mailPattern.currentPattern,d=$S("ad"),e=a.getTotal()>=10;return $S("isFree")&&c&&e&&!$S("mboxFooterAdClosed")&&!(!d.show&&"ud"===d.userType)&&(1===b||3===b)}function gb(){var b=this,c=b.extend("subtype"),d=b.param("fid"),e=tb.getInfo("expire");return a.Ext.selectFolder&&"folder"===c&&d>1&&0===e&&b.getPage()>1&&!b.isThread()}function hb(){var b=this,c=b.extend("subtype"),d="full"===c;return d||a.Ext.summary&&1===a.Ud.get({field:"ntes_option",flag:"summary"})-0&&(d=!0),d}function ib(){try{if(!zb.listened){var b=a.fly(document);b.listen("keydown",a.Function.bind(zb.keydown,zb)),zb.listened=!0}}catch(c){}}function jb(){var a=this.view;a.getAd()}try{var kb=$L("interface.MboxInterface")}catch(lb){return lb}try{var mb=$L("module.mbox.MboxListener")}catch(lb){return lb}try{var nb=$L("module.mbox.MboxView")}catch(lb){return lb}try{var ob=$L("module.mbox.MboxAction")}catch(lb){return lb}try{var pb=$L("support.OptionSupport")}catch(lb){return lb}try{var qb=$L("module.BaseModule")}catch(lb){return lb}try{var rb=$L("init.Folder")}catch(lb){return lb}try{var sb=$L("init.Thread")}catch(lb){return lb}try{var tb=$L("init.Defer")}catch(lb){return lb}try{var ub=$L("init.Tag")}catch(lb){return lb}var vb=new $I18N("module.mbox.MboxModule"),wb=a.Object;a.Number;var xb=a.Browser,yb=xb.isIE("<9"),zb=a.createClass($N("module.mbox.MboxModule"));wb.mix(zb,qb,{"interface":kb,View:nb,Listener:mb,Action:ob,cls:"tX0",ariaLabel:vb.t("收件箱"),action:new ob,parseFid:d,isTop:$,setRead:e,setFlag:f,setTag:g,setDefer:h,setMemo:i,setFilter:j,rollback:k,switchIn:jb,move:l,setSpam:m,setAllRead:n,exportLetter:o,forwardLetter:p,hasThreadAndSent:q,getLayout:r,keydown:s,entry:t},{logPrefix:"mbox",total:-1,scrollTop:0,keyword:c,getData:u,init:v,exit:w,getText:x,getGroup:y,switchIn:z,switchOut:A,cache:B,clean:C,onFocus:D,replace:E,lazyLoad:F,autoGetData:G,getCacheData:H,cleanCache:I,cleanData:J,lazyReplace:K,removeCache:L,removeData:M,getTotal:N,setTotal:O,getStats:P,getPage:Q,getCount:R,getCondition:S,getKeyword:T,getSummary:U,getVar:V,setVar:W,param:X,extend:Y,isThread:Z,isTop:$,isFlag:_,isTag:ab,isDefer:bb,isArchive:cb,isNone:db,isAd:eb,isFooter:fb,isSelectFolder:gb,isSummary:hb,initialize:ib})}($,window),function(a){try{var b=$L("module.mbox.MboxListener")}catch(c){return c}var d=a.Object,e=a.createClass($N("module.mbox.ListListener"));d.mix(e,b,{},{})}($,window),function(a){function b(a,b,c){function d(a){l&&(a=l(a)),c(a)}var e=this,g=e.module;b||(b={});var h=g&&g.isThread(),i=h?"mbox:listThreads":"mbox:listMessages",j={func:i,body:a},k=e.bindExtra(b,j);
j=k.request,f.extend(j,{sync:b.sync,call:d,hideWait:b.hideWait});var l=k.handleExtra;e.wmsvr(j)}function c(a){var b=this;g.superClass.initialize.call(b,a)}try{var d=$L("module.mbox.MboxAction")}catch(e){return e}var f=a.Object,g=a.createClass($N("module.mbox.ListAction"));f.mix(g,d,{},{getList:b,initialize:c})}($,window),function(a,b,c){function d(){var a=this,b=a.module,c="";if(b.extend("brand")){var d=18===b.extend("fid")?"sk0":"qJ0";c='<div class="'+d+' nui-closeable" id="'+b.createId("BannerDiv")+'" style="display:none;"></div>'}return c}function e(){var b=this,d=b.module;if(d.extend("brand")){var e=d.getDom("BannerDiv");if(18!==d.param("fid")||d.isNone()){if(d.param("tag")&&d.param("tag").length>0){var f=d.param("tag")[0],g=m.getBrand(f);g&&g.logo2&&g.description&&(e.innerHTML='						<div class="kb0">							<div class="gO0"><img src="'+g.logo2+'" alt="'+g.name+'" /></div>							<h1 class="fk0">'+g.name+'</h1>							<h1 class="fX0">'+g.description+"</h1>						</div>						",e.style.display="")}}else{for(var h=$S("brandAd"),i=$I("util.Misc").getTime(0).getTime(),j=[],k=0,l=h.length;l>k;k++){var n=h[k];if(n){if(n.startTime&&n.startTime>i)continue;if(n.endTime&&n.endTime<=i)continue;if(!n.img||!n.pdlink)continue;j.push(n)}}if(d.extend("ad",j),j.length>0){var o=d.createId("adDiv"),p=d.createId("adLink"),q=d.createId("adSelectDiv"),r=d.createId("adImg"),s=[];s[s.length]='					<div class="pm0" id="'+o+'">						<a class="iQ0" id="'+p+'" target="_blank">							<img class="fJ0" id="'+r+'" />						</a>					</div>					',s[s.length]='<div class="oF0" id="'+q+'">';for(var k=0,l=j.length;l>k;k++)s[s.length]='<a class="hO0"></a>';s[s.length]="</div>",e.innerHTML=s.join("");var t=a("#"+p);t.listen("mouseover",function(){d.extend("adMouseover",!0)}),t.listen("mouseout",function(){d.extend("adMouseover",c)});for(var u=a("#"+q).find("A"),v=u.doms,k=0,l=v.length;l>k;k++){var w=function(a){return function(){b.toggleBanner(a,!0)}}(k);a.Event.listen(v[k],"click",w)}d.extend("adIndex",-1),b.toggleBanner(0),e.style.display=""}else{var x=$S("ad");if((x.show||"ud"!==x.userType)&&!$S("mboxBannerAd"))try{gAd.getByCallback("brand",{},function(b){var c=b?b.brand:"";c&&(c+=new a.Link({text:"",cls:"nui-closeable-x",click:function(){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showProduct("noAd","noAd_dywj"),a(e).hide(),$S("mboxBannerAd",!0)}}).html(),e.innerHTML=c,e.style.display="")})}catch(y){}}}}}function f(b,c){var d=this,e=d.module,f=e.extend("ad"),g=e.extend("adIndex")||0,h=d.timeout,i=!!e.extend("adMouseover"),j=5e3;try{clearTimeout(h)}catch(k){}if(i&&!c)d.timeout=setTimeout(function(){d.toggleBanner(b)},j/2);else if(b!==g){b%=f.length;for(var l=a("#"+e.createId("adSelectDiv")).find("A").doms,m=0,n=l.length;n>m;m++){var o=a(l[m]);m!==b?o.removeClass("ek0"):o.addClass("ek0")}var p=f[b],q=a("#"+e.createId("adDiv")).dom,r=a("#"+e.createId("adLink")).dom,s=a("#"+e.createId("adImg")).dom;q.style.backgroundColor="#"+(p.color?p.color:"E0ECF4"),s.src=p.img;var t=p.pdlink;r.href=t;var u=null;a.String.has(t,"http")||(u=function(){try{a.Eval.exec(t)}catch(b){}return!1}),r.onclick=function(){var a=!0;return u&&(a=u()),a},e.extend("adIndex",b),d.timeout=setTimeout(function(){d.toggleBanner(b+1)},j)}}function g(){var b=this,c=b.module,d=c.extend("smart"),e=c.param("tag"),f="";if(!c.isNone()&&d){var g=a.getClass($N("component.Tab"));a.getClass($N("component.TabItem"));var h=m.smart,i=[],j={render:function(){this.activeStyle()}};i.push({text:'<div class="ui0">'+n.t("所有分类")+'</div><span class="pz2 nui-txt-cLink">●</span>',nonClose:!0,extcls:"nui-txt-cLink",listeners:e.length>1?j:null,noDelayClick:!0,click:function(){try{var a=$L("interface.MboxInterface",this)}catch(b){return b}return a.smarts(),!0}});for(var k in h){var l=h[k],o=l.alias,p=m.smarts[o],q="",r="";("bill"===o||"bank"===o)&&(q='<div class="nui-layer tL1" style="left:-132px;top:32px;padding:0"><b class="nui-layer-arr" style="left:175px;"></b><div class="nui-layer-normal"><iframe src="https://qian.163.com/promote/web_promote_small.html" frameborder="0" style="width:368px;height:143px;"></iframe></div></div>',r=" jz1"),i.push({text:'<div class="ui0 kA1"><b class="nui-ico nui-ico-category-'+p.index+'"></b>'+p.name+'</div><span class="pz2 nui-txt-cLink">●</span>'+q,nonClose:!0,extcls:"nui-txt-cLink"+r,listeners:1===e.length&&e[0]===k?j:null,noDelayClick:!0,click:function(a){return function(){try{var b=$L("interface.MboxInterface",this)}catch(c){return c}return b.smarts(a),!0}}(o)})}var s=new g({type:"",extcls:"AH1",hasClose:!1,items:i});f=s.html()}return f}function h(){function a(a){d.unshift('<div class="xd0 nui-closeable" id="'+a+'"'+' style="display:none;"'+">"),d.push("</div>")}var b=this,c=b.module,d=[];if(c.isFooter()){var e=c.createId("FooterDiv");a(e)}return d.join("")}function i(){var a=this,b=a.module,c=b.extend("index");try{if(b.isFooter()){var d=b.getEl("FooterDiv");0===c?d.html()&&d.show():d.hide()}}catch(e){}}function j(a){var b=this;p.superClass.initialize.call(b,a)}try{var k=$L("module.mbox.MboxView")}catch(l){return l}try{var m=$L("init.Tag")}catch(l){return l}var n=new $I18N("module.mbox.ListView"),o=a.Object,p=a.createClass($N("module.mbox.ListView"));o.mix(p,k,{},{getBanner:d,showBanner:e,toggleBanner:f,getSmarts:g,getFooter:h,toggleFooter:i,initialize:j})}($,window),function(a,b,c){function d(){function c(b){var c=this,d=c.module,e=b?b.inboxBottom:"",f=[];if(f[f.length]=e,f[f.length]=new a.Link({text:"",cls:"nui-closeable-x",click:function(){$E("product.Privileges",function(a){a.showProduct("noAd","noAd_sjxdb")}),a.Listener.fire("letter:closead","mboxFooterAd")}}).html(),d.getDom("FooterDiv")){d.getDom("FooterDiv").innerHTML=f.join("");var g=d.getEl("FooterDiv");g.show()}}var d=this,e=d.view,f=a.Ud.get({field:"ntes_inbox",flag:"layout"}),g="3"!==f;d.isFooter()&&g&&b.gAd.getByCallback("inboxBottom",{},a.Function.bind(c,e))}function e(b){function c(a,b){i&&i(a,b)}function d(a){var b=$G.user.topMailCount-0,c=a.total,d=h.length,f=d+c;f>b&&(e=A.t("每个文件夹最多可以设置 ")+b+A.t(" 封置顶邮件(您设置后为 ")+f+A.t(" 封)")+'<div style="padding-top:15px" class="txt-12 txt-info">'+A.t("提示：您可以取消部分已置顶邮件的置顶状态，再进行设置")+"</div>")}for(var e,f=this,g=b.isTop,h=b.data,i=b.callback,j=f.hasThreadAndSent(h),k=j[0],l=j[1],m=f.action,n=f.parseFid(h),o=n[0],p=0,q=o.length;q>p;p++){var r=o[p];if(!f.isTop(r)){e=x.get(r).name+A.t(" 文件夹无法设置置顶");break}}if(g)for(var p=0,q=o.length;q>p;p++)e||m.getTop({fid:o[p],callback:d});e?(a.Msgbox.show({title:e}),i&&i(!1)):(B.extend(b,{fidInfo:n,hasThread:k,hasSent:l,callback:c}),m.setTop(b))}function f(a){var c=a.substring(0,4),d=parseInt(a.substring(4,6),10)-1,e=a.substring(6,8);return new b.Date(c,d,e)}function g(a,b,c){var d=this;w.entry.call(d,a,b,c)}function h(b,d){var e=this,f=d.limit,g=d.index,h=d.start;B.extend(b,{limit:f,start:h>=0?h:g*f}),e.isSummary()&&(b.summaryWindowSize=f),b.skipLockedFolders=!(b.fid>0||1===b.fids.length),b.topFlag=e.isTop()?"top":c,b.returnTag=!!a.Ext.tag,b.returnTotal=!0}function i(b,c,d){function e(a){if(!d&&0===a["var"].length&&c>0){var e=f.getPage()-1;i.index=0>e?0:e,f.getData(b)}else b()}var f=this,g=f._var,h=g.param,i=g.extend,j=i.limit;if(g.cacheDom=!0,c>=0||(c=i.index),!d){try{f.view.deleteInterval()}catch(k){}f.removeCache()}if(f.getCacheData(c,!0))a.Thread.run(function(){b()},0);else{var l=f.param("fid"),m=f.extend("area"),n=f.extend("expire")&&z.getInfo("expire")>0,o=a.Ext.archive&&l>0&&"archive"!==m,p=B.clone(h);if(f.extendParam(p,{index:c,limit:j}),n){var q=p.filter;q||(q=p.filter={}),q.todoList=!0}var r={hideWait:d,loadExpire:n&&!z.getCache(),loadArchive:o&&!(x.getArchive(l)>=0)};f.getList(p,r,e)}}function j(){var b=this,c=b.extend("subtype"),d=b.param("fid"),e=b.param("tag"),f=b.param("filter"),g=b.extend("systemContacts"),h=b.extend("smart"),i=A.t("邮件列表");try{switch(c){case"flag":i=A.t("旗帜邮件");var j=f.label0;j>=0&&(i=a.LETTERFLAG[j]+A.t("邮件"));break;case"tag":i=A.t("标签邮件"),i=h&&e.length>0?A.t("智能标签"):y.getName(e[0]);break;case"defer":i=A.t("待办邮件");break;case"contacts":if(g)i=A.t("帐号通邮件");else{i=A.t("联系人邮件");var k=f.chatWithAddress||f.fromAddress||f.toAddress,l=$I("init.Contacts").getContact(k);l&&(i=l.data.name+A.t("邮件"))}break;case"folder":var m=x.get(d);i=m.name;break;case"read":var n=b.extend("read");i=(n?A.t("已读"):A.t("未读"))+A.t("邮件");break;case"calendar":i=b.getCondition();break;case"emails":i=A.t("联系人邮件")}}catch(o){}return i}function k(){var b=this,c=b.view,d=y.getMatch();d.length>0&&(d.sort(function(a,b){return a.logo1&&!b.logo1?-1:!a.logo1&&b.logo1?1:a.weight-b.weight}),a.SM.go({parent:b,module:"mbox.BrandModule",param:b.param(),viewType:"l-r",setIEViewType:!0,hideSplit:!0,sharebar:!0,reset:!1,cacheDom:!1}),a.Frame.setViewType("l-r",b)),c.showBanner();var e=c.constructor;e.addCss()}function l(){var b=this;try{var c=y.getMatch();c.length>0?"address.AddressModule"!==b._child.mtype&&a.SM.refresh(b._child):a.Frame.setViewType("normal")}catch(d){}}function m(a,b){var d,e=this,f=e.data;a||(a=e.extend("index"));var g=0>a,h=!1,i=e.getTotal();if(f.length>0)if(g)d=f.slice();else{var j=e._var.extend;a>=0||(a=j.index),d=[];for(var k=j.limit,l=a*k,m=0,n=l,o=f.length;k>m&&o>n;m++,n++){var p=f[l+m];p&&d.push(p)}h=d.length===k||m+l===i}else h=0===a&&0===i,(g||h)&&(d=[]);if(g||h){if(!b&&e.extend("expire")&&z.getInfo("expire")>0)try{var q=z.getCache("var");if(q.length>0){var r=0===d.length;d=q.concat(d),d.onlyExpire=r}}catch(s){d=null}return d&&d.length>0?d:c}}function n(){var a=this;a.data=[]}function o(a,b){for(var c=this,d=c.data,e=c.getTotal(),f=d.length-1,g=0;f>-1&&a>g;){var h=d[f];h&&b[h.id]&&(d.splice(f,1),g++,e--),f--}c.setTotal(e)}function p(a,b,c){function d(b){for(var d=a.start,f=b["var"],g=b.total,h=e.data,i=0,j=f.length;j>i;i++)h[d+i]=f[i];e.setTotal(g),c(b)}var e=this,f=e.extend("subtype");if("emails"===f)try{var g=e.param("filter"),h=g.chatWithAddress||g.fromAddress||g.toAddress;if(!h)return d({"var":[],total:0}),void 0}catch(i){}e.action.getList(a,b,d)}function q(){var b=this,c=[],d=b.param("filter"),e=b.param("tag"),f=b.extend("subtype");if(d){if(d.label0>=0&&"flag"===f){var g=a.LETTERFLAG[d.label0];g&&c.push(g)}var h=d.flags;if(h)for(var i in h){var j=h[i];switch(i){case"priority":c.push(1===j?A.t("紧急"):5===j?A.t("缓慢"):A.t("普通"));break;case"read":"read"===f&&c.push(j?A.t("已读"):A.t("未读"));break;case"attached":c.push((j?A.t("普通"):A.t("无"))+A.t("附件"));break;case"linkAttached":c.push(j?A.t("超大附件"):"");break;case"replied":c.push((j?A.t("已"):A.t("未"))+A.t("回复"));break;case"forwarded":c.push((j?A.t("已"):A.t("未"))+A.t("转发"))}}var k=d.chatWithAddress,l=d.fromAddress,m=d.toAddress,n=d.chatWithAddress||d.fromAddress||d.toAddress;if(n){var o=$I("init.Contacts").getContact(n),p=a.String.encodeHTML(o?o.data.name:n);k?c.push(A.t("与“")+p+A.t("”的往来")):l?c.push(A.t("发自 ")+p):m&&c.push(A.t("发给 ")+p)}if(d.sentDate){var q,r=d.sentDate.split(":"),s=r[0],t=r[1],u=D.parseSentDate(s),v=D.parseSentDate(t);q=0===u-v?C.format(u,A.t("yyyy年M月d日")):C.format(u,A.t("yyyy年M月d日"))+"-"+C.format(v,A.t("yyyy年M月d日")),c.push(q)}d.defer&&c.push(A.t("待办"))}else if(e){for(var w=[],x=0,z=e.length;z>x;x++){var B=e[x],E=y.getName(B);w.push(E)}c.push(w.join())}return c.join()}function r(b){var c=this;D.superClass.initialize.call(c,b),c.cleanData(),setTimeout(a.Function.bind(c.setAd,c),1e3)}try{var s=$L("module.mbox.ListListener")}catch(t){return t}try{var u=$L("module.mbox.ListView")}catch(t){return t}try{var v=$L("module.mbox.ListAction")}catch(t){return t}try{var w=$L("module.mbox.MboxModule")}catch(t){return t}try{var x=$L("init.Folder")}catch(t){return t}try{var y=$L("init.Tag")}catch(t){return t}try{var z=$L("init.Defer")}catch(t){return t}var A=new $I18N("module.mbox.ListModule"),B=a.Object,C=a.Date,D=a.createClass($N("module.mbox.ListModule"));B.mix(D,w,{View:u,Listener:s,Action:v,action:new v,setTop:e,parseSentDate:f,entry:g},{data:null,extendParam:h,getData:i,getText:j,initBrand:k,refreshBrand:l,getCacheData:m,cleanData:n,removeData:o,getList:p,getCondition:q,initialize:r,setAd:d})}($,window),function(a){try{var b=$L("module.mbox.MboxListener")}catch(c){return c}var d=a.Object,e=a.createClass($N("module.mbox.SearchListener"));d.mix(e,b,{},{})}($,window),function(a){function b(a,b,c){function d(a){c(a)}var e=this;e.module,b||(b={});var f,h=a.ids;f=h?{func:"mbox:getMessageInfos"}:{func:"mbox:searchMessages"},g.extend(f,{body:a,call:d,hideWait:b.hideWait,sync:b.sync}),e.wmsvr(f)}function c(b){function c(b){a.Listener.fire("search:removeall"),g(b)}var d=this,e=b.data,f=b.moveToId,g=b.callback,h=d.getIds(e,!0),i={func:"mbox:updateMessageInfos",body:{ids:h[0],attrs:{fid:f}},call:c};d.wmsvr(i)}function d(a){var b=this;h.superClass.initialize.call(b,a)}try{var e=$L("module.mbox.MboxAction")}catch(f){return f}var g=a.Object,h=a.createClass($N("module.mbox.SearchAction"));g.mix(h,e,{},{getList:b,moveAll:c,initialize:d})}($,window),function(a,b,c){function d(){function b(a){var b=null;if(r)for(var c=0,d=r.length;d>c;c++){var e=r[c];e.field===a&&(b=e)}return b}try{var d=$L("support.AddressSupport",this)}catch(e){return e}var f=this,g=f.module,h=g.param(),j=g.extend(),k=g.result,p=$I("init.Folder");if("full"!==j.subtype||0===g.getTotal())return"";var q=(h.pattern,h.fids),r=h.conditions,s=h["fts.fields"],t=k.groupings,u=1===a.Ud.get({field:"ntes_global",flag:"secondSearch"})-0;a.Ud.get({field:"ntes_inbox",flag:"search_type"})-0;var v;v=u?"pJ0":"",g.hasAdditional();var w=[];w[w.length]=new a.Link({text:'<b class="oJ1"></b>',title:u?l.t("展开搜索条件"):l.t("隐藏搜索条件"),extcls:"vs1",click:o.bind(f.toggleControl,f)}).html(),w[w.length]='<div class="DG0 '+v+'" id="'+g.createId("ControlDiv")+'">';var x=new a.Link({title:l.t("设置默认搜索范围"),bracket:!0,text:l.t("设置默认"),attrs:'style="font-color:#0f6099;"',cls:"nui-txt-cLink",click:o.bind(i.setDefaultFields,i,f)});w[w.length]='<dl class="wW0" ><dt class="wU0" tabindex="0" aria-label="'+l.t("默认搜索范围")+'">'+l.t("搜索范围")+x.html()+"</dt>";var y=[],z=i.getFields();m.each(z,function(b,c){var d=s===c.key,e=d?" lZ1":"",g=new a.Link({text:c.title,value:b,click:o.bind(f.additionalSearch,f,"scope",b)});w[w.length]='<dd class="yc0'+e+'">'+g.html()+"</dd>",y.push(g)}),a.Radio.group(y),w[w.length]='</dl><dl class="wW0" ><dt class="wU0" tabindex="0" aria-label="'+l.t("文件夹")+'">'+l.t("文件夹")+"</dt>";var A=[];t&&(A=t.fid);var B=$S("_preSearchAllCount");if(!B){B=0;for(var C=0,D=A.length;D>C;C++)B+=A[C].cnt;$S("_preSearchAllCount",B)}var E=new a.Link({title:l.t("全部"),text:l.t("全部")+" "+new a.Label({text:"("+B+")",type:"tips"}).html(),click:o.bind(f.additionalSearch,f,"fid",c)});w[w.length]='<dd class="yc0 '+(q&&1===q.length?"":"lZ1")+'">'+E.html()+"</dd>";for(var C=0,D=A.length;D>C;C++){var F=A[C],G=F.val,H=F.cnt,I=p.get(G).name,E=new a.Link({title:l.t("在搜索结果中精确文件夹为")+I,text:I+" "+new a.Label({text:"("+H+")",type:"tips"}).html(),click:o.bind(f.additionalSearch,f,"fid",G)});w[w.length]='<dd class="yc0 '+(q&&1===q.length&&q[0]==G?"lZ1":"")+'" folderItemExpendFive="'+(C>5?"true":"")+'" style="'+(C>5?"display:none;":"")+'">'+E.html()+"</dd>"}if(A.length>5){var J=new a.Link({title:l.t("展开所有文件夹"),text:l.t("展开全部")+'<b class="nui-ico nui-ico-dArr"></b>',extcls:"nui-txt-link",click:function(){var b=g.getEl("ControlDiv");this.getText().indexOf(l.t("展开"))>-1?(a(b).find("[folderItemExpendFive='true']").show(),this.update({text:l.t("收起")+' <b class="nui-ico nui-ico-uArr"></b>',title:l.t("收起文件夹")})):(a(b).find("[folderItemExpendFive='true']").hide(),this.update({text:l.t("展开全部")+' <b class="nui-ico nui-ico-dArr"></b>',title:l.t("展开所有文件夹")}))}});w[w.length]='<dd class="yc0">'+J.html()+"</dd>"}w[w.length]='<dt class="wU0" tabindex="0" aria-label="'+l.t("发件人+收件人")+'">'+l.t("发件人+收件人")+"</dt>";var K=b("from"),L="";if(K){var M=K.operand,N=d.getName(a.Uri.matchEmail(M));L=n.encodeHTML(N?N:M)}var O=[];t&&(O=t.fromAddress);for(var P,Q=[],R=[],C=0,D=O.length;D>C;C++){var S=O[C],M=S.val.toLowerCase();d.getAddrObj(M)||M===$S("uid")?Q.push(S):R.push(S)}P=Q.concat(R);var T=new a.Link({title:l.t("全部"),text:l.t("全部")+" "+new a.Label({text:"("+B+")",type:"tips"}).html(),click:o.bind(f.additionalSearch,f,"from",c)});w[w.length]='<dd class="yc0 '+(K?"":"lZ1")+'">'+T.html()+"</dd>";for(var C=0,D=P.length;D>C;C++){var U=P[C],V=n.trim(U.val);if(V){try{var W=d.getName(a.Uri.matchEmail(V))}catch(e){}var H=U.cnt,X=n.encodeHTML(W?W:V),T=new a.Link({title:l.t("在搜索结果中精确发件人为")+V,text:X+new a.Label({text:" ("+H+")",type:"tips"}).html(),click:o.bind(f.additionalSearch,f,"from",V)});w[w.length]='<dd class="yc0 '+(K&&L==X?"lZ1":"")+'" mailItemExpendFive="'+(C>5?"true":"")+'" style="'+(C>5?"display:none;":"")+'">'+T.html()+"</dd>"}}if(P.length>5){var J=new a.Link({title:l.t("展开所有发件人"),text:l.t("展开全部")+'<b class="nui-ico nui-ico-dArr"></b>',extcls:"nui-txt-link",click:function(){var b=g.getEl("ControlDiv");this.getText().indexOf(l.t("展开"))>-1?(a(b).find("[mailItemExpendFive='true']").show(),this.update({text:l.t("收起")+' <b class="nui-ico nui-ico-uArr"></b>',title:l.t("收起发件人")})):(a(b).find("[mailItemExpendFive='true']").hide(),this.update({text:l.t("展开全部")+' <b class="nui-ico nui-ico-dArr"></b>',title:l.t("展开所有发件人")}))}});w[w.length]='<dd class="yc0">'+J.html()+"</dd>"}w[w.length]='<dt class="wU0" tabindex="0" aria-label="'+l.t("时间范围")+'">'+l.t("时间范围")+"</dt>";var Y=b("sentDate"),Z=i.getDateDiff(),$="";if(Y)for(var _=Y.operand,$=Z[4].name,C=0,D=Z.length;D>C;C++){var ab=Z[C];if(ab.date<=_){"<="===Y.operator&&(C++,ab=Z[C]),$=ab.name;break}}var bb=[];t&&(bb=t.sentDate);for(var C=0,D=bb.length;D>C;C++)for(var cb=0,db=Z.length;db>cb;cb++){var eb=bb[C],ab=Z[cb];if(ab.date<=eb.val){if(ab.count+=eb.cnt,cb===db-2)break}else;}var fb=new a.Link({title:l.t("全部"),text:l.t("全部")+" "+new a.Label({text:"("+B+")",type:"tips"}).html(),click:o.bind(f.additionalSearch,f,"sentDate",c)});w[w.length]='<dd class="yc0  '+(Y?"":"lZ1")+'">'+fb.html()+"</dd>";for(var C=0,D=Z.length;D>C;C++){var ab=Z[C];if(ab.count>0){var gb=ab.name,hb=ab.count,fb=new a.Link({title:l.t("在搜索结果中精确时间范围为")+gb,text:gb+new a.Label({text:" ("+hb+")",type:"tips"}).html(),click:o.bind(f.additionalSearch,f,"sentDate",C)});w[w.length]='<dd class="yc0 '+(Y&&gb==$?"lZ1":"")+'">'+fb.html()+"</dd>"}ab.count=0}w[w.length]='<dt class="wU0">'+l.t("邮件状态")+"</dt>";var ib,jb,kb=b("flags");kb&&(ib=kb.operand.attached,jb=kb.operand.read);var lb=[];t&&(lb=t["flags.attached"]);var mb=new a.Link({title:l.t("全部"),text:l.t("全部")+" "+new a.Label({text:" ("+B+")",type:"tips"}).html(),click:o.bind(function(){var a=this;a.additionalSearch("attached",c),a.additionalSearch("read",c)},f)});w[w.length]='<dd class="yc0 '+("undefined"==typeof ib&&"undefined"==typeof jb?"lZ1":"")+'">'+mb.html()+"</dd>";for(var C=0,D=lb.length;D>C;C++){var nb=lb[C],ob=nb.val?l.t("有附件"):l.t("无附件"),pb=nb.cnt,mb=new a.Link({title:l.t("在搜索结果中精确邮件状态为")+ob,text:ob+new a.Label({text:" ("+pb+")",type:"tips"}).html(),click:o.bind(f.additionalSearch,f,"attached",nb.val)});w[w.length]='<dd class="yc0 '+("boolean"==typeof ib&&ib===nb.val?"lZ1":"")+'">'+mb.html()+"</dd>"}var qb=[];t&&(qb=t["flags.read"]);for(var C=0,D=qb.length;D>C;C++){var rb=qb[C],sb=rb.val?l.t("已读"):l.t("未读"),tb=rb.cnt,ub=new a.Link({title:l.t("在搜索结果中精确邮件状态为")+sb,text:sb+new a.Label({text:" ("+tb+")",type:"tips"}).html(),click:o.bind(f.additionalSearch,f,"read",rb.val)});w[w.length]='<dd class="yc0 '+("boolean"==typeof jb&&jb===rb.val?"lZ1":"")+'">'+ub.html()+"</dd>"}return w[w.length]="</dl></div>",w.join("")}function e(){var b,c,d,e=this,f=e.module,g=1===a.Ud.get({field:"ntes_global",flag:"secondSearch"})-0,h=f.getEl("ControlDiv");g?(b="pJ0",c="",d=0,f.getEl("HtmlDiv").addClass("Ay0"),f.getEl("HtmlDiv").removeClass("zj1")):(b="",c="pJ0",d=1,f.getEl("HtmlDiv").removeClass("Ay0"),f.getEl("HtmlDiv").addClass("zj1")),h.removeClass(b),h.addClass(c),a.Ud.set({field:"ntes_global",flag:"secondSearch",value:d}),e.title.update(),h.destroy()}function f(c,d){function e(a){var b=l.conditions;if(b)for(var c=0,d=b.length;d>c;c++)if(b[c].field===a){b.splice(c,1);break}}function f(a,b){var c=l.conditions;c||(c=l.conditions=[]),h(a)?g(a,b):c[c.length]=b}function g(c,d){var e=l.conditions;if(e)for(var f=0,g=e.length;g>f;f++)if(e[f].field===c){a.Object.isEqual(e[f].operand,d.operand)||(e[f].operand instanceof b.Date?e[f].operand=d.operand:a.Object.extend(e[f].operand,d.operand));break}}function h(a){var b=!1,c=l.conditions;if(c)for(var d=0,e=c.length;e>d;d++)if(c[d].field===a){b=!0;break}return b}var j=this,k=j.module,l=m.clone(k.param()),n=m.clone(k.extend());if(n.index=0,"undefined"==typeof d)switch(c){case"from":case"sentDate":e(c);break;case"attached":case"read":e("flags");break;case"fid":l.fids=j.fidbak,delete j.fidbak;break;default:!l.fids&&j.fidbak?l.fids=j.fidbak:delete l.fids,delete j.fidbak,l.conditions&&delete l.conditions}else{var o=i.getFields(),p=i.getDateDiff();switch(c){case"scope":if(l["fts.fields"]===o[d].key)return;l["fts.fields"]=o[d].key;break;case"from":f(c,{field:c,operator:"contains",ignoreCase:!0,operand:d});break;case"fid":j.fidbak=l.fids,l.fids=[d];break;case"sentDate":d===p.length-1?f(c,{field:c,operator:"<=",operand:p[d-1].date}):f(c,{field:c,operator:">",operand:p[d].date});break;case"attached":f("flags",{field:"flags",operator:"=",operand:{attached:d}});break;case"read":f("flags",{field:"flags",operator:"=",operand:{read:d}})}}try{var q=$L("interface.MboxInterface",this)}catch(r){return r}q.entry(l,n)}function g(){function b(){try{var a=$L("module.mbox.SearchModule",this)}catch(b){return b}a.removeAll({data:e.result["var"],callback:c})}function c(){d.refresh()}var d=this,e=d.module;a.Msgbox.show({type:"confirm",content:l.t("确定将所有搜索出来的邮件都移动到 已删除 文件夹吗？"),title:l.t("删除确认"),ok:b})}function h(a){var b=this;p.superClass.initialize.call(b,a)}try{var i=$L("module.mbox.Field")}catch(j){return j}try{var k=$L("module.mbox.MboxView")}catch(j){return j}var l=new $I18N("module.mbox.SearchView"),m=a.Object,n=a.String,o=a.Function,p=a.createClass($N("module.mbox.SearchView"));m.mix(p,k,{},{getControl:d,toggleControl:e,additionalSearch:f,removeAll:g,initialize:h})}($,window),function(a,b,c){function d(a){function b(){e&&e(!0)}var c=this,d=a.data,e=a.callback,f=c.action;f.moveAll({data:d,moveToId:4,callback:b})}function e(a,b,c){var d=this;w.entry.call(d,a,b,c)}function f(b,c){var d=c.limit;y.extend(b,{windowSize:d,returnTag:!!a.Ext.tag})}function g(b,c,d){function e(a){g.extendParam(a,{limit:j}),g.getList(a,n,f)}function f(){var a=!1;if(k&&c>0){var e=g.getPage();c>=e&&(c=e-1),a=!0}a?g.getData(b,c,d):b()}var g=this,h=g.param(),i=g.extend(),j=i.limit,k=!1;c>=0||(c=i.index);var l=j*c;if(!d){try{g.view.deleteInterval()}catch(m){}g.removeCache()}var n=y.clone(i);if(n.hideWait=!!d,n.start=l,g.result){var o=g.checkCacheData(c);if(o.cached)a.Thread.run(function(){b()},0);else{var p=o.ids;e({mboxa:h.mboxa,ids:p})}}else k=!0,e(y.clone(h))}function h(){return x.t("搜索邮件")}function i(a){var b=this,d=b.extend();a||(a=d.index);var e,f=0>a;try{var g=b.result["var"];if(g)if(f)e=g.slice();else{e=[];for(var h=d.limit,i=a*h,j=0,k=g.length;k>j+i&&h>j;j++)e.push(g[j+i])}}catch(l){}return e&&e.length>0?e:c}function j(a){var b=this,c=b.extend();a||(a=c.index);var d=b.getCacheData(a),e=[],f=!0;if(d)for(var g=0,h=d.length;h>g;g++){var i=d[g];"string"==typeof i?(f=!1,e.push(i)):e.push(i.id)}return{cached:f,ids:e,cacheData:d}}function k(){var a=this;delete a.result}function l(a,b){for(var c=this,d=c.result["var"],e=c.getTotal(),f=d.length-1,g=0;f>-1&&a>g;){var h=d[f];h&&b[h.id]&&(d.splice(f,1),g++,e--),f--}c.setTotal(e)}function m(a,b,c){function d(d){var f=d["var"];if(a.ids)for(var g=e.result["var"],h=b.start,i=0,j=f.length;j>i;i++){var k=h+i,l=g[k],m=f[i];"string"==typeof l&&m.id===l&&(g[k]=m)}else e.result=d,e.setTotal(f?f.length:0);c(d)}var e=this;e.action.getList(a,b,d)}function n(){function b(){var a=e.pattern,b=[],c=e.fids;if(c&&1===c.length){var d=$I("init.Folder");b.push(d.get(c[0]).name)}var f=e.conditions;if(f)for(var g=0,h=f.length;h>g;g++){var i=f[g];switch(i.field){case"from":b.push(i.operand);break;case"sentDate":for(var j=r.getDateDiff(),k=0,l=j.length;l>k;k++){var m=j[k];if(m.date===i.operand){"<="===i.operator&&(k+=1,m=j[k]),b.push(m.name);break}}break;case"flags":var n=i.operand.attached;"boolean"==typeof n&&b.push(n?x.t("有附件"):x.t("无附件"));var o=i.operand.read;"boolean"==typeof o&&b.push(o?x.t("已读"):x.t("未读"))}}return'<strong class="Dh0">'+z.encodeHTML(a)+"</strong>"+(b.length>0?x.t("，附加条件为“")+'<strong class="txt-keyword">'+b.join("</strong>"+x.t("，")+'<strong class="txt-keyword">')+"</strong>"+x.t("”"):"")}function c(){var b=[];try{var c=e.conditions;if(y.isArray(c)&&(c=c[0]),c){var d=c.field,f=c.operand,g=c.operator;switch(d){case"flags":f.replied&&b.push(x.t("已回复")),f.forwarded&&b.push(x.t("已转发"));var h=a.Ext.newAttach?f.realAttached:f.attached;h?b.push(x.t("有附件")):h===!1&&b.push(x.t("无附件")),f.linkAttached?b.push(x.t("有超大附件")):f.linkAttached===!1&&b.push(x.t("无超大附件")),f.read?b.push(x.t("已读")):0===b.length&&b.push(x.t("未读"));break;case"label0":b.push(0===f?x.t("所有旗帜"):a.LETTERFLAG[f]);break;case"priority":switch(g){case">":b.push(x.t("缓慢"));break;case"<":b.push(x.t("紧急"));break;default:b.push(x.t("普通"))}break;case"subject":b.push('<strong class="Dh0">'+z.encodeHTML(f)+"</strong>");break;case"from":case"to":b.push(x.t("与 ")+z.encodeHTML(f)+x.t(" 往来"))}if(!d){var f=e.conditions[0].conditions[0].operand;if(f&&("string"==typeof f&&(a.Uri.matchEmail(f)?b.push(x.t("与 ")+z.encodeHTML(f)+x.t(" 往来")):b.push('<strong class="Dh0">'+z.encodeHTML(f)+"</strong>")),"object"==typeof f)){var h=a.Ext.newAttach?f.realAttached:f.attached;h&&b.push(x.t("有附件")),h===!1&&b.push(x.t("无附件")),f.linkAttached&&b.push(x.t("有超大附件")),f.linkAttached===!0&&b.push(x.t("无超大附件"))}}}}catch(i){}return 0===b.length?"":b.join()}var d=this,e=d.param(),f=d.extend();return"full"===f.subtype?b():c()}function o(){function a(a){if(d===e.extend("index")){for(var b=0,f=a.length;f>b;b++)try{var g=a[b];c[g.mid].summary=g.summary}catch(h){}e.view.setSummary()}}var b,c,d,e=this,f=e.extend();if("full"===f.subtype){var g=[],c={};b=e.getCacheData(),d=f.index;for(var h=0,i=b.length;i>h;h++){var j=b[h],k=j.id;g.push(k);var l=k;try{l=/(\d+\:)?([^:_]+)/.exec(l)[2]}catch(m){}c[l]=j}e.action.getSummary({ids:g,pattern:e.param("pattern"),callback:a})}}function p(){var a=this,b=a.param(),c=b.fids,d=b.conditions;return c&&1===c.length||d&&d.length>0}function q(a){var b=this;A.superClass.initialize.call(b,a)}try{var r=$L("module.mbox.Field")}catch(s){return s}try{var t=$L("module.mbox.SearchListener")}catch(s){return s}try{var u=$L("module.mbox.SearchView")}catch(s){return s}try{var v=$L("module.mbox.SearchAction")}catch(s){return s}try{var w=$L("module.mbox.MboxModule")}catch(s){return s}var x=new $I18N("module.mbox.SearchModule"),y=a.Object,z=a.String,A=a.createClass($N("module.mbox.SearchModule"));y.mix(A,w,{View:u,Listener:t,Action:v,action:new v,removeAll:d,entry:e},{result:null,extendParam:f,getData:g,getText:h,getCacheData:i,checkCacheData:j,cleanData:k,removeData:l,getList:m,getCondition:n,getSummary:o,hasAdditional:p,initialize:q})}($,window),function(a){function b(b){var c=this,d=c.module,f=d.view,g=b.Tag;if(g&&g.changed){var h=g.info.stats;if(h){var i=!1;e.each(h,function(b){return $I("init.Tag").get(b,"brand")?(i=!0,a.BREAK):void 0}),i&&(d.container.innerHTML=f.getHtml(),a.Component.setEvents())}}}try{var c=$L("module.BaseListener")}catch(d){return d}var e=a.Object,f=a.createClass($N("module.mbox.BrandListener"));e.mix(f,c,null,{_listeners:{"sync:request":{handler:b},"sync:cache":{handler:b}}})}($,window),function(a){function b(){function b(){for(var b,c=[],l=f.QRHerf=[],n=g.createId("ImgUl"),o=0,p=k.length;p>o;o++){var q=k[o];if(q.logo1){var r=h.get(q.id,"brand",!0),s=h.getInfo(r.name,"unread"),t=h.getInfo(r.name),u=q.largeTwoDimenCode||"",v=q.smallTwoDimenCode||"";c[c.length]='<li class="fh0">';var w='<span class="bF0"><img src="'+q.logo1+'" alt="'+q.name+'" /></span><span class="bu0">'+q.name+"</span>";w+=s>0?'<span class="bx0 nui-txt-cLink">'+s+j.t("封未读")+"</span>":'<span class="bx0">'+t+j.t("封邮件")+"</span>",v&&(w+='<span class="cz1"><img src="'+v+'" width="20" height="20" /></span>');var x=new a.Link({text:w,extcls:"cD0",click:function(a){return function(){d(q.statId),i.entry({tag:[a.name]},{type:"list",subtype:"tag"})}}(r)});c[c.length]=x.html(),c[c.length]="</li>",m.push(q.statId),e||(e=q.openUrl),u&&l.push({link:x,image:u})}}return c.length>0&&(b='<ul class="iZ0" id="'+n+'">'+c.join("")+"</ul>"),b}function c(){for(var b,c=[],f=0,g=k.length;g>f;f++){var j=k[f];if(!j.logo1){var l=h.get(j.id,"brand",!0),n=h.getInfo(l.name,"unread");c[c.length]='<li class="hz0">',c[c.length]=new a.Link({text:j.name+(n>0?" ("+n+")":""),extcls:"dY0",click:function(a){return function(){d(j.statId),i.entry({tag:[a.name]},{type:"list",subtype:"tag"})}}(l)}).html(),c[c.length]="</li>",m.push(j.statId),e||(e=j.openUrl)}}return c.length>0&&(b='<ul class="nt0">'+c.join("")+"</ul>"),b}function d(b){a.Log.record("brandClick",b)}var e,f=this,g=f.module,k=h.getMatch(),m=[],n=[];n[n.length]='				<div class="re0 nui-scroll" style="height:98%">					<h1 class="ly0">'+j.t("品牌分类")+'</h1>					<div class="iY0">			';var o=b(),p=c();return o&&(n[n.length]=o),o&&p&&(n[n.length]='<div class="nx0"></div>'),p&&(n[n.length]=p),n[n.length]="					</div>				</div>			",e&&m.length>0&&a.Thread.delay(function(){l.request({requestType:a.Ajax.IFRAME,url:e,body:{statId:m.join(),uid:$S("uid")}})}),f.addHeader(null,n.join(""),"frame-main-cont-body-second-brand")}function c(){var b=this,c=b.module,d=b.QRLayer,e=c.getEl("ImgUl");e.listen("mouseover",a.Function.bind(b.showQRCode,b)),e.listen("mouseout",function(){try{d.hide()}catch(a){}}),k.listen(e.dom.parentNode.parentNode,"scroll",function(){try{d.hide()}catch(a){}})}function d(){for(var b,c=this,d=a.Event.getTarget(),e=!0,f=c.QRLayer;d&&"UL"!=d.tagName;){if("A"===d.tagName){b=d;break}d=d.parentNode}if(b)for(var g=c.QRHerf,h=0,i=g.length;i>h;h++){var j=g[h];if(b===j.link.getEl().dom){var k=j.image,l=!1;if(c.QRLayer){var m=f.getEl().find("IMG").dom;m.src!=k&&(m.src=k,l=!0)}else f=c.QRLayer=new a.Layer({text:'<img src="'+k+'" width="200" height="200"/>',params:["arrRight"],renderTo:document.body,fixY:40}),l=!0;f.show(),l&&f.pointTo(b,document.body),e=!1;break}}if(e)try{f&&f.hide()}catch(n){}}function e(){}try{var f=$L("module.BaseView")}catch(g){return g}try{var h=$L("init.Tag")}catch(g){return g
}try{var i=$L("interface.MboxInterface")}catch(g){return g}var j=new $I18N("module.mbox.BrandView"),k=a.Event,l=a.Ajax,m=a.createClass($N("module.mbox.BrandView"));a.Object.mix(m,f,{},{QRHerf:null,QRLayer:null,getHtml:b,initQRCode:c,showQRCode:d,initialize:e})}($,window),function(a){function b(){var a=this,b=a.view;try{b.initQRCode()}catch(c){}}function c(){}function d(){return!0}function e(){}try{var f=$L("module.mbox.BrandListener")}catch(g){return g}try{var h=$L("module.mbox.BrandView")}catch(g){return g}try{var i=$L("module.BaseModule")}catch(g){return g}var j=a.createClass($N("module.mbox.BrandModule"));a.Object.mix(j,i,{View:h,Listener:f},{logPrefix:"brand",init:b,cache:c,reset:d,initialize:e})}($,window),function(a){function b(){var a=this;return a.addHeader(null,a.getNone(),"frame-main-cont-body-second frame-main-cont-body-noToolbar")}function c(){var a='<div class="nui-infoBlock nui-block si0"><div class="nui-block-title">'+i.t("未选中邮件")+"</div></div>";return a}function d(b){var c=this,d=c.module,e=d._parent,f=new a.Link({text:i.t("取消选择"),click:function(){e.view.select("none"),c.changeSelect()}}),g=[];g[g.length]='<div class="rm0">'+i.t("已选择 ")+"<strong>"+b.length+"</strong>"+i.t(" 封邮件")+'<span class="op0">'+f.html()+"</span></div>",g[g.length]='<div class="po0">';for(var h=0,j=b.length;j>h;h++){var k=b[h],l=k.getDiv(),m="",n="",o="";try{m=a.fly(l).find(".dP0").dom.innerHTML}catch(p){}try{n=a.fly(l).find(".eO0").dom.innerHTML}catch(p){}try{o=a.fly(l).find(".dd0").dom.innerHTML}catch(p){}g[g.length]='<div class="nui-infoBlock nui-block pn0"><div class="nui-block-text">',g[g.length]='<div class="ji0">'+m+"</div>",g[g.length]='<div class="jg0"><span class="nui-txt-tips">'+n+"</span></div>",o&&(g[g.length]='<div class="jf0">'+o+"</div>"),g[g.length]="</div></div>"}return g[g.length]="</div>",g.join("")}function e(){for(var b=this,c=b.module,d=c._parent,e=d.view.letters,f=d.extend("index")*d.extend("limit"),g=[],h=f,i=e.length;i>h;h++){var j=e[h];j.checked&&g.push(j)}var k=0===g.length?b.getNone():b.getSelected(g);c.getDom("ScrollDiv").innerHTML=k,a.Component.setEvents()}function f(){}try{var g=$L("module.BaseView")}catch(h){return h}var i=new $I18N("module.mbox.PreviewView"),j=a.createClass($N("module.mbox.PreviewView"));a.Object.mix(j,g,{},{getHtml:b,getNone:c,getSelected:d,changeSelect:e,initialize:f})}($,window),function(a){function b(){}function c(){}try{var d=$L("module.mbox.PreviewView")}catch(e){return e}try{var f=$L("module.BaseModule")}catch(e){return e}var g=a.createClass($N("module.mbox.PreviewModule"));a.Object.mix(g,f,{View:d},{init:b,initialize:c})}($,window),function(a,b,c){function d(b,d){var e,f=this;if(b&&(f.fid=b.fid,f.group=b.group,f.viewType=b.viewType,f.isThread=b.isThread,f.area=b.area),d!==c&&(f.folderData=e=d.folderData,f.listModule=d.listModule,f.listParam=d.listParam,f.listExtend=d.listExtend,f.listUnstable=d.listUnstable,d.hidden&&(f.isHiddenMod=!0)),e===c){var g=f._var;g&&(f.folderData=e=g.folderData)}e!==c&&(f.fid=e.fid),f.isIE678=a.Browser.isIE("<9"),f.isChrome=!!a.Browser.chrome(),f._initFrameOnloadHandler(),f.userLabels={}}function e(a){var b=this,d=b.folderData;return d!==c?d.subject||K.t("无主题"):(b.textCall=a,K.t("信件加载中"))}function f(){var c=this;c.part||c.fixSibling(),c.markRead(!1),b.setTimeout(function(){c.part||c.updateTag(),(!c.isIE678||c.isThread)&&c.scroll(null,a.Function.bind(c._scrollHandler,c))},200),c.updateUserLabel()}function g(){var a=this;return a.group||a.name}function h(){try{var b={},d=this._var.param;return d!==c&&d.hidden?(a.Object.extend(b,d),delete b.hidden,delete b.moduleName,b):d}catch(e){}}function i(){var a=this,b=a.reader,c=b.body;b.notFocus=!1,a.listUnstable&&a.siblingInited&&a.fixSibling(),c.greetingCardContent&&b.assistant.bodyFilter("mail")}function j(){var c=this,d=c.reader,e=[],f=d.body;d.notFocus=!0,f.mediaContent&&e.push(function(){f.stopAllMedia()}),f.greetingCardContent&&e.push(function(){f.destroy(!0)}),e.length>0&&b.setTimeout(function(){a.Array.each(e,function(a,b){b()})},200)}function k(){var a=this;a.viewType&&a.switchIn(),$S("lastRead",a.mid||a.tid),a.markRead(!1)}function l(){var a=this;return a.viewType&&a.switchOut(),!0}function m(a){var b=this;b.part?(history.back(),"function"==typeof a&&a()):b.listParam!==c?G.entry(b.listParam,b.listExtend,a):G.entry({fid:b.fid},null,a)}function n(){var b=this;b.viewType||G.getPosition({moduleName:b.listModule,data:b.folderData,callback:function(c){var d,e,f=$C(b.createId("pre")),g=$C(b.createId("next"));return c?(d=c.pre,e=c.next,d?(b.preMail=d,f.getEl().dom.title=K.t("上一封：")+a.String.escapeHTML(d.folderData.subject)):(f.setDisabled(),f.getEl().dom.title=K.t("无上一封")),e?(b.nextMail=e,g.getEl().dom.title=K.t("下一封：")+a.String.escapeHTML(e.folderData.subject)):(g.setDisabled(),g.getEl().dom.title=K.t("无下一封")),b.siblingInited=!0,void 0):(f.setDisabled(),g.setDisabled(),void 0)}})}function o(a){var b=this;try{var c=$L("interface.ReadInterface",this)}catch(d){return d}var e,f=b[a+"Mail"];if(f){e=f.folderData,c.entry({isThread:(e.threadMessageCount||0)>1,moduleName:f.moduleName,moduleParam:f.moduleParam,moduleExtend:f.moduleExtend,folderData:e,group:b.getGroup()});try{b.switchOut()}catch(d){}b.log({action:"click",item:a})}}function p(a){var b,c,d=this;d.isThread||(b=d[a+"Mail"],b&&(c=b.folderData,H.preload({id:c.id,fid:c.fid,locked:c.flags?c.flags.locked:!1})))}function q(){}function r(a){var c,d=this,e=d.folderData;d.isHiddenMod||d.part||(c=(e.flags||{}).read)||b.setTimeout(function(){G.setRead({moduleName:d.listModule,isRead:!c,data:e,area:d.area,voidRequest:a})},300)}function s(a){var b=this,c=a.folderData||b.folderData,d={moduleName:b.listModule,data:c,fromThread:a.threadItem};if(a.threadItem&&(b.moveLock=!0),a.del){var e=c.fid;4!==e&&15!==e&&18!==e&&(d.moveToId=4)}else d.moveToId=a.toFid;G.move(d)}function t(b){var c=this;G.setSpam({isSpam:b,data:c.folderData,callback:function(){a.Tips.show({text:K.t("成功")+(b?K.t("举报"):K.t("信任"))+K.t("邮件"),type:"suc"})}})}function u(a,b){function c(a){G.setDefer(a)}var d=this;if(a)return c(b),void 0;var e=d.folderData;(e.flags||{}).deferHandle&&e.defer?c({type:"complete",data:e}):d.showDeferPanel({type:"modify"})}function v(a){var b=this,c=b.folderData,d=a.type;try{var e=$L("support.Defer",this)}catch(f){return f}e.showMsgbox({type:d,data:{defer:c.defer,memo:c.memo,mid:b.mid,smsShow:a.smsShow,memoShow:a.memoShow},callback:function(a){b.setDefer(!0,{type:d,defer:a.defer,memo:a.memo,smsDate:a.smsDate,data:c})}})}function w(){var b=this,c=b.folderData,d=c.flags||{},e=!d.top;G.setTop({isTop:e,moduleName:b.listModule,data:c,callback:function(c){if(c){var d=e?K.t("成功设置"):K.t("成功取消");a.Tips.show({text:d+K.t("邮件置顶"),type:"suc"})}else a.Tips.show({text:K.t("置顶设置失败"),type:"err"});G.entry({moduleName:b.listModule,fid:b.fid})}})}function x(a){var b=this,c={moduleName:b.listModule,tag:a.value,data:b.folderData};b.isThread&&(c.single=!0),"add"===a.type&&(c.isAdd=!0),G.setTag(c)}function y(b){var c=this;if(a.Ext.tag&&"archive"!==c.area){var d=b||c.folderData,e=d.tag,f=[];e&&a.Array.each(e,function(b,d){var e,g=I.get(d);g&&(e=new a.Tag({text:I.getName(g),type:g.color,attrs:"hasClose",click:function(){c.log({action:"click",item:"icon_tag"}),G.entry({fid:0,showTag:!0,tag:[g.name]})},closeclick:a.Function.bind(c.setTag,c,{type:"remove",value:g.name})}),f.push(e.html()))});var g=a.fly(c.getDom("divTag"));g&&g.empty().html(f.join(""))}}function z(){var b=this;a.MultiTab.remove(b),a[b.viewType?"SM":"JS"].remove(b)}function A(){var d,e=this,f=a.Element,g=b.HTMLElement;try{for(var h in e)if(d=e[h]||h,!(d instanceof a.Component))if(d instanceof f)d.destroy();else if(d instanceof g){if("container"===h)continue;d=e[h]=c}else d.module===e&&e.clean.call(d)}catch(i){}}function B(){}function C(){$S("readFraLd")===c&&$S("readFraLd",function(b,d,e){var f=a[$S("viewType")?"SM":"JS"].find(b);(null!==f||(f=a[$S("viewType")?"JS":"SM"].find(b),null!==f))&&(f.isThread?f.threadItems[e].reader.body.onLoadHandler(d):f.reader.body.onLoadHandler(d),d=c)})}function D(a,b){var c=this;c.action&&c.action.safeBrowsing&&c.action.safeBrowsing(a,b)}try{var E=$L("module.BaseModule")}catch(F){return F}try{var G=$L("interface.MboxInterface")}catch(F){return F}try{var H=$L("interface.ReadInterface")}catch(F){return F}try{var I=$L("init.Tag")}catch(F){return F}var J,K=new $I18N("module.read.BaseReadModule");J=a.createClass($N("module.read.BaseReadModule")),a.Object.mix(J,E,null,{initialize:d,init:f,getText:e,getGroup:g,getHistoryParam:h,switchIn:i,switchOut:j,cache:k,exit:l,back:m,fixSibling:n,enterSibling:o,preloadSibling:p,updateUserLabel:q,markRead:r,moveTo:s,report:t,setDefer:u,showDeferPanel:v,setTop:w,setTag:x,updateTag:y,moduleRemove:z,clean:A,safeBrowsing:D,_scrollHandler:B,_initFrameOnloadHandler:C}),b.DoFSCommand=function(b){try{if("quit"===b){var c=a("div .sp0");c&&a.Array.each(c.doms,function(b,c){c=a(c),c.empty(),a(c.dom.parentNode).removeClass("oT0"),c.remove().destroy()}),c.destroy(),a.Ext.useNewAd&&a.Ud.set({field:"ntes_letter",flag:"read_ad",value:1})}}catch(d){}}}($,window),function(a,b){function c(a){this.module=a}function d(a){var b=a.param,c={id:b.mid,header:!0,returnImageInfo:!0,returnAntispamInfo:!0,autoName:!0,returnHeaders:{"Resent-From":"A",Sender:"A","List-Unsubscribe":"A","Reply-To":"A"},supportTNEF:!0};$S("isyeah")&&(c.returnHeaders.From=""),b.part&&(c.part=b.part),b.markRead&&(c.markRead=!0),"archive"===b.area&&(c.mboxa="2"),this.wmsvr({func:"mbox:readMessage",body:c,call:function(b){a.call(b)},log:{l:"read",action:"read"},cacheFlag:a.cacheFlag,hideWait:a.isHidden})}function e(a){var b=a.param;this.wmsvr({func:"mbox:decryptMessage",body:{id:b.mid,password:b.pwd,mode:"both",filterImages:!1,wmsvrlog:{action:"decryptMessage"}},ignoreError:!0,call:a.call,log:{l:"read",action:"decrypt"}})}function f(b){this.wmsvr({func:"mbox:sendMDN",body:{id:b,dispositionInfo:{mode:"manual",type:"displayed"}},call:function(b){return b.code!==a.S_OK?!0:(a.Tips.show({text:r.t("回执发送成功"),type:"suc"}),void 0)}})}function g(a){var b;switch(a.type){case"send":case"recall":b={mid:a.mid};break;case"mail":b={pid:a.mid}}this.wmsvr({func:"user:listDeliveryHistory",body:b,call:function(b){a.callback(a.type,b)}})}function h(a){this.wmsvr({func:"mbox:recallMessage",body:{mid:a.mid},call:a.callback,log:{l:"read",action:"recallMessage"}})}function i(a){this.wmsvr({func:"ntes:mbox:ynote",body:{action:"saveEmail",mid:a.mid,password:a.pwd},call:a.call,error:a.error})}function j(a){this.wmsvr({func:"global:sequential",body:{items:[{func:"mbox:saveSent","var":{id:a.fullSaveId}},{func:"mbox:deleteMessages","var":{id:a.mid}}]},ignoreError:!0,call:a.call})}function k(b){var c=p.getMailSess(),d=a.Cookie.get("Coremail",!0),e={mail_id:b.mid,option:b.option||"all",NTES_SESS:c,Coremail:d,sender:b.sender,subject:b.subject,mobile:null===a.SenderList.getMobile()?0:1};b.tag&&(e.tag=b.tag),a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.POST,rnd:!0,url:a.Uri.getUrl("smart_mailtag2",!0),body:e,call:b.call})}function l(b,c){var d=a.Uri.getUrl("safeBrowsing");d+="&url="+b,a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.GET,sync:!0,rnd:!0,url:d,call:c})}function m(c){a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.GET,rnd:!0,url:a.Uri.getUrl("read_mail_service",!0)+"?uid="+c.uid+"&sender="+c.sender+"&hmid="+b.encodeURIComponent(c.hmid||"")+"&time="+c.time+"&appid=js6",call:c.call})}try{var n=$L("module.BaseAction")}catch(o){return o}try{var p=$L("util.Misc")}catch(o){return o}var q,r=new $I18N("module.read.ReadAction");q=a.createClass($N("module.read.ReadAction")),a.Object.mix(q,n,null,{initialize:c,readMessage:d,decrypt:e,sendReceipt:f,listDeliveryHistory:g,recallMessage:h,saveToYNote:i,saveAttachMissed:j,getSmartTag:k,safeBrowsing:l,getMailServiceData:m})}($,window),function(a,b,c){function d(a){var b=this;b.module=a}function e(){var a=this,b=a.module,c=!!b.viewType;return a.addHeader(c?"":a.getToolbar(),a.getContentHtml(),c?"frame-main-cont-body-noToolbar":"")+a.getOuterHtml()}function f(){var b=this;return a.Toolbar.html(b.getToolbarConf())}function g(){}function h(){return""}function i(){return""}function j(){var a=this.module;return{items:[{xtype:"button",id:a.createId("pre"),subclass:"roundBtn",icon:"prev",listeners:{mousedown:{handler:function(){a.preloadSibling("pre")}},click:{handler:function(){a.enterSibling("pre"),a.log({action:"click",item:"toolbar_pre"})}}}},{xtype:"button",id:a.createId("next"),subclass:"roundBtn",icon:"next",listeners:{mousedown:{handler:function(){a.preloadSibling("next")}},click:{handler:function(){a.enterSibling("next"),a.log({action:"click",item:"toolbar_next"})}}}}],type:"ext"}}function k(b){var d=this,e=d.module,f=e.folderData;return b=b===c?"":b+"_",a.Object.clone(D.getMenu({tag:f.tag,callback:function(a,c){a?(e.log({action:"click",item:b+"menu_tagremove"}),e.setTag({type:"remove",value:c})):(e.log({action:"click",item:b+"menu_tagadd"}),e.setTag({type:"add",value:c}))},remove:function(){e.log({action:"click",item:b+"menu_tagremoveall"}),e.setTag({type:"remove",value:null})}}))}function l(a){var b=this,c=b.module;return{width:$G.environment.isCh?160:320,groups:[{items:[{text:G.t("回复全部"),click:function(){c.log({action:"click",item:"menu_replyall"}),(a||b.module.reader).assistant.fullReply()},extText:"Shift + A"},{text:G.t("回复全部(带附件)"),click:function(){c.log({action:"click",item:"menu_replyall_attach"}),(a||b.module.reader).assistant.fullReply({withAttachments:!0})}},{text:G.t("回复全部(新邮件)"),click:function(){c.log({action:"click",item:"menu_replyall_new"}),(a||b.module.reader).assistant.reply({type:"new"})}}]}]}}function m(a){var b=this,c=b.module;return{width:$G.environment.isCh?120:240,groups:[{items:[{text:G.t("转发"),click:function(){c.log({action:"click",item:"menu_forward"}),(a||b.module.reader).assistant.forward()},extText:"Shift + F"},{text:G.t("原信转发..."),click:function(){c.log({action:"click",item:"menu_forwardtransmit"}),(a||b.module.reader).assistant.originalForward()}},{text:G.t("作为附件转发"),click:function(){c.log({action:"click",item:"menu_forwardattach"}),(a||b.module.reader).assistant.forward({asAttachment:!0})}}]}]}}function n(){for(var b,c,d=this,e=d.module,f={width:$G.environment.isCh?100:150,groups:[{items:[]},{items:[{text:G.t("取消旗帜"),icon:"flag-0",click:function(){e.log({action:"click",item:"menu_flag_clear"}),e.reader.assistant.setFlag(0)}}]}]},g=f.groups[0].items,h=1,i=a.LETTERFLAG,j=i.length;j>h;h+=1)b=i[h],c=h+"",b&&g.push({text:b,icon:"flag-"+c,extcls:"txt-flag"+c,click:a.Function.bind(function(a){e.log({action:"click",item:"menu_flag"}),e.reader.assistant.setFlag(a)},null,h)});return f}function o(){var b=this,c=b.module,d=c.folderData,e=d.flags||{},f={width:$G.environment.isCh?120:240,groups:[]},g=f.groups;if(c.isThread||g.push({items:[{text:G.t("旗帜"),menu:b.getFlagConf()}]}),"archive"!==c.area){if(!c.isThread){var h=(d.flags||{}).deferHandle&&d.defer;g.unshift({items:[{id:c.createId("toolbarSetDefer"),text:h?G.t("设为完成"):G.t("设置待办"),click:function(){c.log({action:"click",item:h?"menu_finish":"menu_defer"}),c.setDefer()}}]})}a.Ext.tag&&g.push({items:[{text:G.t("标签"),menu:{id:c.createId("toolBarTagMenu"),listeners:{render:function(){try{this.unlisten("render"),this.update(b.getTagConf())}catch(a){}}}}}]});var i=e&&e.top;g.push({items:[{id:c.createId("toolbarSetTop"),text:i?G.t("取消置顶"):G.t("置顶邮件"),click:function(){c.log({action:"click",item:i?"menu_top_clear":"menu_top"}),c.setTop()}}]})}return f}function p(b){var c=this;b=b||c.module.reader;for(var d,e={width:$G.environment.isCh?160:320,groups:[{items:[],checkType:"radio"}]},f=e.groups[0].items,g=a.READ_ENCODE,h=0,i=g.length;i>h;h+=1)d=g[h],f.push({text:d[0],checked:0===h,click:a.Function.bind(function(a){b.log({action:"click",item:"menu_charset"}),b.assistant.bodyFilter("encode",a)},null,d[1])});return e}function q(){for(var b,c,d,e,f=this,g=f.module,h={width:$G.environment.isCh?160:320,groups:[]},i=a.READ_FONT,j=[],k=h.groups,l=g.font||0,m=0,n=i.length;n>m;m+=1)b=i[m],c=b[0],d=b[1]||c,c='<span style="font-family: '+d+'">'+c+"</span>",e={text:c,checked:m===l,click:a.Function.bind(function(a){g.log({action:"click",item:"menu_font"}),g.reader.body.zoom("F",a)},null,d)},0===m&&(e.split=!0),j.push(e);return k.push({items:j,checkType:"radio"}),h}function r(){var b=this,d=b.module,e={groups:[{items:[{text:G.t("打印邮件"),click:function(){d.log({action:"click",item:"menu_printmail"}),d.reader.assistant.blankView(!0)}},{text:G.t("查看信头"),click:function(){d.log({action:"click",item:"menu_viewhead"}),d.reader.assistant.bodyFilter("header")}},{text:G.t("查看邮件"),click:function(){d.log({action:"click",item:"menu_viewmail"}),d.reader.assistant.bodyFilter("mail")}},{text:G.t("导出邮件"),click:function(){d.log({action:"click",item:"menu_download"}),d.reader.assistant.exportLetter()}},{text:G.t("选择编码"),menu:b.getCharsetConf()},{text:G.t("选择字体"),menu:b.getFontConf()}]},{items:[{text:G.t("新窗口打开"),hidden:!$G.environment.isCh,click:function(){d.log({action:"click",item:"menu_newwin"}),d.reader.assistant.blankView()}},{text:G.t("同主题查看"),click:function(){d.log({action:"click",item:"menu_samesubject"}),d.reader.assistant.searchSameSubject()}},{text:G.t("保存到网盘..."),click:function(){d.log({action:"click",item:"menu_savetonf"}),d.reader.assistant.saveToNf()}},{text:G.t("保存到有道云笔记..."),click:function(){d.log({action:"click",item:"menu_savetonf"}),d.reader.assistant.saveToYNote()}},{text:G.t("保存联系人..."),click:function(){d.log({action:"click",item:"menu_savecontact"}),d.reader.assistant.saveContacts()}},{text:G.t("邮件备注"),click:function(){d.log({action:"click",item:"menu_memo"}),d.reader.assistant.editMemo()}}]},{items:[]}]},f=e.groups[1].items;a.Ext.scheduleRead&&$G.environment.isCh&&f.push({text:G.t("设置日程")+($S("isFree")?G.t("管理"):G.t("提醒")),click:function(){d.log({action:"click",item:"menu_schedule"});try{var a=$L("product.Schedule",this)}catch(b){return b}var e=d.mid,f=$S("schedule");f!==c&&f[e]?a.edit(e):a.add(e,d.folderData.subject)}}),f=e.groups[2].items,a.Ext.readTran_enable&&3!==d.fid&&$G.environment.isCh&&f.unshift({text:G.t("全文翻译"),click:function(){d.log({action:"click",item:"menu_trans"}),d.reader.translate({type:0})}});try{a.Array.remove(e.groups,function(a){return!a.items||0===a.items.length},!0)}catch(g){}return e}function s(){var b=this,d=b.module,e=d.fid,f={id:d.createId("folderMenu"),groups:[],type:"scroll"},g=f.groups,h=F.list(),i={custom:[],pop:[],system:[]};a.Array.each(h,function(a,b){if(e!==b.id){var f,g=b.flags;f=g.custom?"custom":g.pop?"pop":"system";var h=i[f];h[h.length]={text:b.name,click:function(){",2,3,4,18,7,5,15,".indexOf(","+b.id+",")?d.log({action:"click",item:"menu_move",value:b.id}):d.log({action:"click",item:"menu_move"}),d.moveTo({toFid:b.id})},icon:g.pop?{type:"folder",subtype:b.flags.iconSubtype,xtype:"icon"}:c}}});var j=[],k=!1;return a.Object.each(i,function(a,b){var c=b.length>0;k&&c&&j.push({type:"split"}),k=k||c;for(var d=0,e=b.length;e>d;d++)j.push(b[d])}),g[g.length]={items:j},g[g.length]={items:[{text:G.t("新建文件夹并移动"),click:function(){d.log("toolbar","move",2);try{var a=$L("support.Folder",this)}catch(b){return b}a.add({callback:function(a){d.log({action:"click",item:"menu_move_new"}),d.moveTo({toFid:a})}})}}]},f}function t(){var b=this,c=b.module,d="2"===a.Ud.get({field:"ntes_option",flag:"sendershow"}),e="1"===a.Ud.get({field:"ntes_letter",flag:"read_head"}),f=0===$S("attrs").user.afterdel,g="1"===a.Ud.get({field:"ntes_option",flag:"readRange"}),h="1"!==a.Ud.get({field:"ntes_read",flag:"mail_service"}),i={extcls:"nui-settingMenu",delegateTo:"self",groups:[{items:[{text:G.t("发/收件人显示"),extText:{xtype:"checkgroup",checkType:"radio",name:"sendershow",checkedchange:function(a){c.log({action:"click",item:"menu_sendershow",value:a}),E.setAttr({field:"ntes_option",flag:"sendershow",value:a,module:"contact"})},items:[{id:c.createId("opt_send"),text:G.t("发件人姓名"),value:1,checked:!d,subclass:"btn"},{id:c.createId("opt_contact"),text:G.t("通讯录昵称"),value:2,checked:d,subclass:"btn"}]},doNotHide:!0},{text:G.t("进行移动或删除邮件后"),extText:{xtype:"checkgroup",checkType:"radio",name:"afterdel",checkedchange:function(a){c.log({action:"click",item:"menu_aftermove",value:a}),E.setAttr({field:"afterdel",value:a,module:"read"})},items:[{id:c.createId("opt_next"),text:G.t("读下一封"),value:1,checked:!f,subclass:"btn"},{id:c.createId("opt_back"),text:G.t("返回列表"),value:0,checked:f,subclass:"btn"}]},doNotHide:!0}]}]};return c.isThread||(i.groups[0].items.unshift({text:G.t("默认显示完整/精简信息"),extText:{xtype:"checkgroup",checkType:"radio",name:"read_head",checkedchange:function(a){c.log({action:"click",item:"menu_headershow",value:a}),E.setAttr({field:"ntes_letter",flag:"read_head",value:a,module:"read"})},items:[{id:c.createId("opt_fullInfo"),text:G.t("完整信息"),value:0,checked:!e,subclass:"btn"},{id:c.createId("opt_compactInfo"),text:G.t("精简信息"),value:1,checked:e,subclass:"btn"}]},doNotHide:!0}),a.Ext.read_mailService&&i.groups[0].items.push({text:G.t("服务类邮件"),extText:{xtype:"checkgroup",checkType:"radio",name:"mailservice",checkedchange:function(a){c.log({action:"click",item:"menu_range",value:a}),E.setAttr({field:"ntes_read",flag:"mail_service",value:a,module:"read"})},items:[{id:c.createId("opt_service_on"),text:G.t("精简模式"),value:0,checked:h,subclass:"btn"},{id:c.createId("opt_service_off"),text:G.t("完整模式"),value:1,checked:!h,subclass:"btn"}]},doNotHide:!0})),i.groups[0].items.push({text:G.t("对选中内容进行转发或回复"),extText:{xtype:"checkbox",name:"readRange",checked:g,subclass:"switch",text:G.t("开启"),unCheckText:G.t("关闭"),checkedchange:function(a){var b=a?1:0;c.log({action:"click",item:"menu_range",value:b}),E.setAttr({field:"ntes_option",flag:"readRange",value:b,module:"read"})}},doNotHide:!0}),i.groups[0].items.push({gap:"before",text:G.t("更多设置 ")+">>",click:function(){c.log({action:"click",item:"menu_options"});try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"options.BaseSetModule"})}}),{items:[{id:c.createId("optionMenu"),xtype:"button",subclass:"roundBtn",icon:"setting",title:G.t("快捷设置"),menu:i,click:function(){c.log({action:"click",item:"toolbar_option"})}}],type:"ext"}}function u(b){var c,d=this.module,e=a.Uri.getEmails(b,"Email",!0),f=e.match;return c=f.length>0?f[0]:{name:b,address:""},("-"===c.name.substr(0,1)||"+"===c.name.substr(0,1))&&(c.defaultName=c.name=c.name.substr(1)),{email:c,popupRenderTo:this.module.container,listeners:{subAction:function(a){d.log({action:"click",item:"addr_"+a})}},hideVipIcon:!0}}function v(a){return'<a href="" target="_blank" id="'+a.createId("aTempLink")+'" rel="noreferrer"></a>'}try{var w=$L("support.Tag")}catch(x){return x}try{var y=$L("support.OptionSupport")}catch(x){return x}try{var z=$L("init.Folder")}catch(x){return x}try{var A=$L("module.BaseView")}catch(x){return x}var B,C,D,E,F,G=new $I18N("module.read.BaseReadView");D=w,E=y,F=z,C=A,B=a.createClass($N("module.read.BaseReadView")),a.Object.mix(B,C,null,{initialize:d,getHtml:e,getToolbar:f,getToolbarConf:g,getContentHtml:h,getOuterHtml:i,getSiblingBtConf:j,getTagConf:k,getReplyConf:l,getForwardConf:m,getFlagConf:n,getMarkConf:o,getCharsetConf:p,getFontConf:q,getMoreConf:r,getFolderConf:s,getOptionConf:t,getTempLinkHtml:v,getContactConf:u})}($,window),function(a,b,c){function d(){var b,d=this,e=d.module,f=e.folderData,g=f.fid,h={groups:[]},i=h.groups,k="button";return i.push({items:[{xtype:k,text:'<span style="font-family:simsun"><< </span>'+j.t("返回"),click:function(){e.log({action:"click",item:"toolbar_back"}),e.back(),a.Menu.hideAllMenu()}}]}),b=[{xtype:k,subclass:"splitBtn",extcls:"nui-imptBtn",text:j.t("回复全部"),menu:d.getReplyConf(),click:function(){e.log({action:"click",item:"toolbar_replyall"}),e.reader.assistant.fullReply()},arrclick:function(){e.log({action:"click",item:"toolbar_reply_arr"})}},{xtype:k,subclass:"splitBtn",text:j.t("转 发"),menu:d.getForwardConf(),click:function(){e.log({action:"click",item:"toolbar_forward"}),e.reader.assistant.forward()},arrclick:function(){e.log({action:"click",item:"toolbar_forward_arr"})}}],3===g?b.unshift({xtype:k,text:j.t("再次编辑发送"),click:function(){e.log({action:"click",item:"toolbar_sendagagin"});try{var a=$L("interface.ComposeInterface",this)}catch(b){return b}a.edit({id:e.mid,body:{decryptPassword:"decryption"in e.reader?e.reader.decryption.pwd:c}})}}):b.unshift({xtype:k,extcls:"nui-imptBtn",text:j.t("回 复"),click:function(){e.log({action:"click",item:"toolbar_reply"}),e.reader.assistant.reply()}}),i.push({items:b}),e.part?h:(b=[{xtype:k,text:4===g||15===g||18===g?j.t("彻底删除"):j.t("删 除"),click:function(){e.log({action:"click",item:"toolbar_del"}),e.moveTo({del:!0})}},{xtype:k,subclass:"dropdownBtn",text:j.t("移动到"),menu:d.getFolderConf(),click:function(){e.log({action:"click",item:"toolbar_move_arr"})}},{xtype:k,subclass:"dropdownBtn",text:j.t("更 多"),menu:d.getMoreConf(),click:function(){e.log({action:"click",item:"toolbar_more_arr"})}}],"archive"!==e.area&&(3===g?b.splice(3,0,{xtype:k,id:e.createId("recallBt"),text:j.t("撤回邮件"),hidden:!(a.Ext.letterRecall||a.Ext.letterRecall_vip),click:function(){e.log({action:"click",item:"toolbar_recall"}),e.reader.assistant.recall()}}):b.splice(1,0,{xtype:k,text:j.t("举 报"),click:function(){e.log({action:"click",item:"toolbar_report"}),e.report(!0)}},{xtype:k,subclass:"dropdownBtn",text:j.t("标记为"),menu:d.getMarkConf(),click:function(){e.log({action:"click",item:"toolbar_mark"})}}),",5,6,7,18,".indexOf(","+f.fid+",")>-1&&b.splice(1,0,{xtype:k,text:j.t("信 任"),click:function(){e.log({action:"click",item:"toolbar_trust"}),e.report(!1)}})),i.push({items:b}),i.push(d.getSiblingBtConf()),i.push(d.getOptionConf()),h)}function e(){var a=this,b=a.module,c=['<div class="tR0" role="list">',b.reader.view.getHtml(),"</div>",'<div class="frame-main-cont-body-mask"></div>'];return c.join("")}try{var f=$L("module.read.BaseReadView")}catch(g){return g}var h,i,j=new $I18N("module.read.ReadView");i=f,h=a.createClass($N("module.read.ReadView")),a.Object.mix(h,i,null,{getToolbarConf:d,getContentHtml:e})}($,window),function(a,b,c){function d(a){var b=this;return function(){b[a].apply(this.module,arguments)}}function e(){}function f(a){var b=this.reader,c=b.body.frame;a&&!c.contentWindow.document&&(c.src=c.src)}function g(){var a=this;if(!a.part)try{var b=a.view.getFolderConf();b.hidden=!0,$C(a.createId("folderMenu")).update(b)}catch(c){}}function h(){var a=this;a.part||"archive"===a.area||y.updateTagMenu.apply(a)}function i(a){var b=this;if(!b.part&&"archive"!==b.area){var c=b.folderData.tag||[];if(a)for(var d=0,e=c.length;e>d;d+=1)if(c[d]===a){c.splice(d,1);break}y.updateTagMenu.apply(b)}}function j(a){var b=this;if(!b.part){var d,e=a.list;if(e[b.tid||b.mid])w.syncData(a,b.folderData);else if("move"!==a.action)return;switch(a.action){case"flag":d=y.getHandler("setFlag");break;case"tag":"archive"!==b.area&&(d=y.getHandler("setTag"));break;case"top":d=y.getHandler("setTop");break;case"memo":d=y.getHandler("setMemo");break;case"defer":d=y.getHandler("setMemo");break;case"move":d=y.getHandler("folderMove")}d!==c&&d.apply({module:b},arguments)}}function k(){var a=this.reader,b=(a.folderData.label0||"")+"";a.isThread||(a.getDom("h1Subject").className="nui-fIBlock py0 nui-txt-flag"+b,$C(a.createId("flagHeadBt")).update(a.view.getSubjectHrefHtml("flag",!0)))}function l(){var a=this;y.updateTagMenu.apply(a)}function m(){var a=this,b=$C(a.createId("toolbarSetTop"));b!==c&&b.update({text:a.folderData.flags.top?z.t("取消置顶"):z.t("置顶邮件")})}function n(b){var c=this.reader,d=b.action;if(c.assistant.editMemo(!0),"defer"===d&&($C(c.createId("deferHeadBt")).update(c.view.getSubjectHrefHtml("defer",!0)),!c.isThread)){var e=c.folderData,f=(e.flags||{}).deferHandle&&e.defer,g=$C(c.createId("toolbarSetDefer"));g&&g.update({text:f?z.t("设为完成"):z.t("设置待办")});var h=c.getDom("mailService");if(h){var i=a.fly(h).find(".APP-service-hr .desc");i&&(i.doms[0].style.display=f?"none":"",i.doms[1].style.display=f?"":"none")}}}function o(a){var b=this,c=a.list,d=b.previousMail,e=b.nextMail;d&&c[d.folderData.id]||e&&c[e.folderData.id]?b.fixSibling():c[b.tid||b.mid]&&y.exitModule.apply(b)}function p(a,b,c,d,e){var f=this;!f.part&&e[f.tid||f.mid]&&y.exitModule.apply(f)}function q(a){var b=this;b.isHiddenMod&&b.fid===a&&w.syncData({action:"read",value:1},b.folderData)}function r(c){var d=this,e=d.reader,f=d.isThread;!c instanceof b.Array&&(c=[c]);for(var g,h,i,j=0,k=c.length;k>j;j+=1)if(g=c[j],h=g.flag||g.field,i=g.value,"read_head"!==h||f)if("readRange"===h)try{a.fly("#dvRangOptions").empty().remove()}catch(l){}else if("recall"!==h||f){if("mail_service"===h&&!f){var m=e.getDom("mailService");m&&e.mailServiceLoaded&&a.fly(m)["1"===i.toString()?"hide":"show"]()}}else 3===e.fid&&$C(e.createId("recallBt"))[i?"show":"hide"]();else{if(e.isThread)return;e.showHeader("1"===i.toString())}try{a.JS.displayModule===d||f||$C(d.createId("optionMenu")).update(d.view.getOptionConf().items[0])}catch(l){}}function s(b){for(var c=this,d=c.module,e=d.tid||d.mid,f=b.data.items,g=0,h=f.length;h>g;g+=1){var i=f[g],j=i.ids;if(a.Array.has(j,e)){d.moduleRemove();break}}}function t(){var a=this.reader;try{var b=a.body.frame.contentDocument,c=b.getElementById("ntes_link_color");null!==c&&(c.innerText=c.innerHTML="a: {color:#"+$G.user.color+"}")}catch(d){}}function u(){var b=this,c=b.view.getTagConf(),d=$C(b.createId("toolBarTagMenu")),e=$C(b.createId("subjectTagMenu"));c.hidden=!0,d&&d.update(c),e&&e.update(c),b.updateTag(),a.Component.setEvents()}function v(){var b=this,c=b.nextMail,d=a.JS.reqModule===b.name;0!==$S("attrs").user.afterdel&&c&&d?b.enterSibling("next"):d&&b.back(function(){b.remove()})}try{var w=$L("interface.MboxInterface")}catch(x){return x}var y,z=new $I18N("module.read.ReadHandler");y=a.createClass($N("module.read.ReadHandler")),a.Object.extend(y,{getHandler:d,resize:e,network:f,folder:g,tagModify:h,tagRemove:i,letterUpdate:j,setFlag:k,setTag:l,setTop:m,setMemo:n,folderMove:o,setSpam:p,setAllRead:q,options:r,rollback:s,skin:t,schedule:n,updateTagMenu:u,exitModule:v})}($,window),function(a){try{var b=$L("module.BaseListener")}catch(c){return c}try{var d=$L("module.read.ReadHandler")}catch(c){return c}var e;e=a.createClass($N("module.read.ReadListener")),a.Object.inherit(e,b,{_listeners:{"global:resize":{handler:d.getHandler("resize")},"global:network":{handler:d.getHandler("netWork")},"folder:add":{handler:d.getHandler("folder")},"folder:modify":{handler:d.getHandler("folder")},"folder:remove":{handler:d.getHandler("folder")},"tag:add":{handler:d.getHandler("tagModify")},"tag:modify":{handler:d.getHandler("tagModify")},"tag:remove":{handler:d.getHandler("tagRemove")},"letter:update":{handler:d.getHandler("letterUpdate")},"letter:setspam":{handler:d.getHandler("setSpam")},"letter:allread":{handler:d.getHandler("setAllRead")},"letter:rollback":{handler:d.getHandler("rollback")},"options:readModify":{handler:d.getHandler("options")},"options:skinChange":{handler:d.getHandler("skin")},"schedule:insert":{handler:d.getHandler("schedule")}}})}($,window),function(a,b,c){function d(b){var c=this;c.reader=b,c.modernIE=a.Browser.isIE(">8"),c.isIE=a.Browser.isIE(),c.isChrome=!!a.Browser.chrome(),c.contentType="mail"}function e(){var a=this,d=a.reader;a.frame=d.getDom("frameBody"),a.autoHeightCount=0,a.autoHeightTimer=b.setTimeout(function e(){return a.loadComplete||a.autoHeightCount>1?(a.autoHeightTimer=a.autoHeightCount=c,void 0):(a.autoSize({heightOnly:!0,ignoreIE:!0}),a.autoHeightCount+=1,a.autoHeightTimer=b.setTimeout(e,2e3),void 0)},1e3)}function f(a){var b=this;if(a){var d=b.reader;d.getDom("dvContent").innerHTML=d.view.getFrameHtml(a)}else{var e=b.frame;b.contentLoaded=b.loadComplete=!1,e.contentWindow.location.reload(),b.isChrome&&(e.style.height=b.normalHeight),e=c}}function g(b){var d=this,e=d.reader,f=d.frame||e.getDom("frameBody");
if(f){try{a.Event.unlistenAll(f),a.Event.unlistenAll(a.Element.getIframeDoc(f))}catch(g){}b||a.fly(f.parentNode).empty()}f=null,e.contentType=c,d.rangInited=!1,a.Browser.isIE("<9")&&setTimeout(function(){d.autoSize()},1e3)}function h(d){function e(){var e,n,o,p=200,q=0,r=0,s=0;if(e=a.Element.getIframeDoc(l)){if(n=e.documentElement,f.isIE&&!f.modernIE){o=e.body||n;try{p=o.scrollHeight,r=o.scrollWidth}catch(t){return}q=40}else{f.modernIE&&(l.style.width=d.half?"":"100%"),o=n;try{p=o.scrollHeight,r=o.scrollWidth}catch(t){return}q=20}if(n.scrollWidth-n.offsetWidth>10&&(p+=20),p=Math.max(p,200),p!==b.parseInt(l.style.height,10)&&(l.style.height=p+q+"px"),f.isIE&&!f.modernIE)try{r=o.scrollWidth}catch(t){return}else try{r=o.scrollWidth,s=e.body.scrollWidth}catch(t){return}r=Math.max(r,s),!f.isIE&&f.widthSet||g.isThread||(!d.heightOnly&&r>700&&r>l.offsetWidth?l.style.width=r+30+"px":f.isIE||r!==b.parseInt(l.style.width,10)||(f.widthSet=!0)),l.style.maxWidth=d.half?"49.5%":"100%",m&&k>0&&(h.scrollTop=Math.floor(b.parseInt(l.style.height,10)*(k/i))+j,h=c),l=c,g.isThread&&g.module.resetOrderNum()}}var f=this,g=f.reader;if(d=d||{},!g.isHidden){var h,i,j,k,l=d.frame||f.frame||g.getDom("frameBody"),m=d.setScrollPos;l&&(m&&(h=f.reader.getDom("ScrollDiv"),i=b.parseInt(f.frame.style.height,10),j=f.reader.getDom("dvReadHeadInfo").offsetHeight+1,k=h.scrollTop-j),l.style.height="auto",b.setTimeout(e,0))}}function i(d,e){function f(){var a=o.frame,c=p.view.mimFrameHeight,d=q.offsetHeight;u.innerHTML=r,q.style.display="none";try{a.style.height=b.Math.max(a.contentWindow.document.body.scrollHeight-d,c)+"px"}catch(e){o.autoSize()}}function g(a){try{var b=a.getAttribute("style");return(b.cssText||b).toLowerCase().replace(/[ \']/gi,"")}catch(c){}return""}function h(){try{var a="isReplyContent",b="BLOCKQUOTE",c=e.getElementById(a);if(null!==c){if(c.nodeName.toUpperCase()===b)return c;for(var d=e.getElementsByTagName(b),f=0;f<d.length;f+=1)if(c=d[f],c.id===a)return c}}catch(g){}return!1}function i(){try{for(var a,b,c=e.getElementsByTagName("DIV"),d=0;d<c.length;d+=1)if(a=c[d],a.innerHTML==="------------------&nbsp;"+N.t("原始邮件")+"&nbsp;------------------"&&(b=a.parentNode,b.parentNode===e.body.childNodes[1]))return b}catch(f){}return!1}function j(){try{for(var a,b=e.getElementsByTagName("BLOCKQUOTE"),c=0;c<b.length;c+=1)if(a=b[c],"gmail_quote"===a.className)return a}catch(d){}return!1}function k(){try{var a=e.body.firstChild,b="font-family:timesnewroman,newyork,times,serif;font-size:12pt";return g(a)===b&&g(a.childNodes[1])===b&&g(a.childNodes[1].childNodes[1])===b?a.childNodes[1].childNodes[1]:!1}catch(c){}return!1}function l(){try{var a,b=e.getElementsByTagName("HR")[0];if(b&&"stopSpelling"===b.id)for(var c,d=e.body.childNodes,f=0,g=d.length;g>f;f+=1)c=d[f],c===b?(a=e.createElement("DIV"),b.parentNode.insertBefore(a,b),a.appendChild(c)):a&&a.appendChild(c);return a}catch(h){}return!1}function m(){try{var a,b=e.body.childNodes[1];if("font:10pttahoma"===g(b)&&"background:#f5f5f5"===g(b.childNodes[1])&&4===b.childNodes[1].childNodes.length)for(var c,d=e.body.childNodes,f=0,h=d.length;h>f;f+=1)c=d[f],c===b?(a=e.createElement("DIV"),b.parentNode.insertBefore(a,b),a.appendChild(c)):a&&a.appendChild(c);return a}catch(i){}return!1}function n(){try{var a=e.getElementsByTagName("BLOCKQUOTE")[0];if(a&&a.parentNode===e.body&&"cite"===a.type&&0===a.getAttribute("cite").indexOf("mid"))return a}catch(b){}return!1}var o=this,p=o.reader,q=h()||i()||j()||k()||l()||m()||n(),r=N.t("- 显示引用文字 -"),s=N.t("- 隐藏引用文字 -");if("object"==typeof q){var t="0",u=e.createElement("A");"1"!==t&&f(),q.parentNode.insertBefore(a.fly(u).css({fontSize:"12px",display:"block",color:"#5c6efc",textDecoration:"none"}).attr({href:["javascript",":void(0);"].join(""),target:"_self"}).listen("click",function(){return u.innerHTML===r?(u.innerHTML=s,q.style.display="",o.autoSize()):f(),u.blur(),p.log({action:"click",item:"body_quote"}),!1}).html("1"===t?s:r).dom,q);var v=e.getElementById("blockquoteStyle");try{v.parentNode.removeChild(v)}catch(w){try{o.isIE?e.createStyleSheet().addRule("blockquote","display:inherit"):(v=e.createElement("style"),v.type="text/css",v.innerHTML="blockquote{display:inherit}",(e.body||e.documentElement).appendChild(v))}catch(x){}}v=c}try{a.fly(e.getElementById("blockquoteStyle")).remove()}catch(w){}d=e=c}function j(d){function e(b){var c,d={};try{if(b-=a.Misc.getTime(!1).getTime(),5e3>b)throw{};c=b/864e5,c>1?d.text=Math.ceil(c)+N.t("天"):(c=b/36e5,c>1?d.text=Math.ceil(c)+N.t("小时"):(c=b/6e4,d.text=Math.floor(c)+N.t("分"))),d.text+=N.t("后到期"),d.available=!0}catch(e){d={available:!1,text:N.t("已过期")}}return d}var f,g=this,h=g.reader,i="divNeteaseBigAttach",j="divNeteaseBigAttach_bak",k=d.getElementById(i);if(h.cloudAttached){if(g.cloudAttachInited||null===k)return f=d.getElementById("divNeteaseDropbox"),null!==f&&h.cloudAttached&&(h.cloudAttached=!1,h.addInitCall(function(){try{if(a.fly(h.getDom("dvCloudAttachHead")).remove(),a.fly(h.getDom("ulCloudAttachItem").parentNode).remove(),h.commonAttached)h.attach.updateHeaderInfo();else{a.fly(h.getDom("dvAttachBody")).remove();try{a.fly(h.getDom("attachInfo_full").parentNode).remove()}catch(b){}try{a.fly(h.getDom("attachInfo_compact")).remove()}catch(b){}}}catch(b){}})),d=c,void 0;for(var l,m,n,o,p,q,r,s,t,u,v=[],w=new RegExp("^(http:|https:)*//fs.(qiye.){0,1}163.com/[\\s\\S]*");k;)l=k,l.id=j,k=d.getElementById(i);l&&(k=l,k.id=i),m=k.getElementsByTagName("A");for(var x=0,y=m.length;y>x;x+=1)n=m[x],q=n.href,o=n.getAttribute("download"),o&&w.test(o)&&(p=n.getAttribute("filename"),r=n.getAttribute("filesize")-0,t=b.parseInt(n.getAttribute("expiretime")),u=e(t),o=b.encodeURI(q),o&&w.test(o)||(o=null),u.available?(s=n.getAttribute("preview"),s=w.test(s)?b.encodeURI(s):c):s="",v.push({id:"cloudAttach_"+x,cloud:!0,filename:p,contentLength:r,download:o,preview:s&&s.replace(/^(http:)*\/\//,"https://"),expireText:u.text}));v.length>0?h.addInitCall(function(){h.attach.showCloudAttach(v)}):k.style.display="block",g.cloudAttachInited=!0,d=c}else if(null!==k){var z=d.getElementById("cloudAttachStyle");try{z.parentNode.removeChild(z)}catch(A){try{g.isIE?d.createStyleSheet().addRule("#divNeteaseBigAttach","display:block"):(z=d.createElement("style"),z.type="text/css",z.innerHTML="#divNeteaseBigAttach{display:block}",(d.body||d.documentElement).appendChild(z))}catch(B){}}}}function k(a){var b=this,d=b.reader;d.addInitCall(function(){try{"function"==typeof a.contentWindow.r_a_h&&b.reader.updateInlineAttach(a.contentWindow.r_a_h())}catch(d){}a=c})}function l(d){function e(e){var g=this,h=e.index,i=s+h+"",j=e.resized,k=g.get("timer"),l=d.getElementById(i);if(k!==c&&(b.clearTimeout(k),g.set("timer",c)),null!==l)l.style.display="";else{var m,n,o=g.dom.src,q=o.replace(/.+part=/,"");if(m=7===o.indexOf($S("host"))&&q.length>0,!m&&!j)return;n=g.offset(),l=a.Element.create("DIV",i,d).html(p.view.getImageOptHtml({nfMenu:m,maxMenu:j,width:e.width,height:e.height,part:e.part,src:o,index:h})),l.dom.style.cssText="position:absolute;left:"+n.x+"px;top:"+((n.y>29?n.y:30)-30)+"px",a(d.body).append(l.dom).destroy(),a(d.body.lastChild).listen("mouseover",function(){var a=g.get("timer");a!==c&&(b.clearTimeout(a),g.set("timer",c))}).listen("mouseout",function(){f.apply(g)}).destroy(),g.set("menuId",i),a.Component.setEvents()}g.set("menuActive",!0)}function f(){var e=this,f=e.get("menuActive");f&&e.set("timer",b.setTimeout(function(){var b=d.getElementById(e.get("menuId"));b.style.display="none",e.set("menuActive",!1),e.set("timer",c);try{a.fly(b).find("#"+p.createId("NTES_YX_menu")).hide().css({visibility:"hidden"})}catch(f){}},300))}var g,h,i,j,k,l,m,n,o=this,p=o.reader,q=d.getElementsByTagName("IMG"),r=q.length,s="ntes_read_img_menu_",t=$S("sid");if(0===r)return!1;o.imgEventInited||(o.frame.contentWindow.NTES_Events={saveToNF:function(a){p.log({action:"click",item:"content_nf"}),p.assistant.saveToNf(a+"")}},o.imgEventInited=!0),p.junkPic&&(p.tipsComplete?p.addBlockInfo("junkPic"):p.junkPicTip=!0),g=p.isThread?o.isIE?62:52:0;for(var u=0;r>u;u+=1){h=q[u],k=h.width,l=h.height,j=h.src;var v=!1;o._getUrlParam(j,"sid")===t&&l&&l>50&&(k&&k>760&&(m=(b.innerWidth||document.body.clientWidth)-201-34-g,k>m&&(m=Math.max(760,m),h.style.width=m+"px",h.style.height=Math.floor(m/k*l)+"px"),n=v=!0),i=a(h),i.listen("mouseover",a.Function.bind(e,i,{resized:v,part:o._getUrlParam(j,"part"),index:u,width:k,height:l})).listen("mouseout",a.Function.bind(f,i)))}return n}function m(d){function e(e){var g;try{g=f.frame.contentWindow.event||e}catch(h){g=e}g=a.Event.get(g),$S("fGetActiveReaderBody",function(){return f});try{a.fly("#dvRangOptions").hide()}catch(h){}f.rangTimer!==c?(b.clearTimeout(f.rangTimer),f.rangTimer=c):f.rangTimer=b.setTimeout(function(){f.showRangeOpt(d,g),f.rangTimer=c},500),a.Event.fire(document,"mouseup")}var f=this;d=d||a.Element.getIframeDoc(f.frame),a.Event.listen(d,"mouseup",e),a.Event.listen(d,"dblclick",e)}function n(){var b=this,c=a.Element.getIframeDoc(b.frame);a.Event.unlisten(c,"mouseup"),a.Event.unlisten(c,"dblclick")}function o(b,d){var e,f,g=this,h=g.reader,i=g.rangText=g.getRangText(b),j="0"===a.Ud.get({field:"ntes_option",flag:"readRange"});if((!j||"mouseup"!==d.type)&&i){if(e=a("#dvRangOptions"),e===c&&(f=j?h.view.getTranlateTipHtml(!0):h.view.getRangeOptHtml(),e=a(a.fly(document.body).append(f).dom.lastChild),a.Component.setEvents()),j){if(!/^[a-z]*$/.test(i))return;try{var k=$L("product.Translate",this)}catch(l){return l}k.request(i,function(b,c){c=a.Eval.get("("+c+")"),0!==c.customTranslation.content.length&&(a.fly("#dvRangOptions").show().dom.firstChild.firstChild.firstChild.innerHTML=h.view.getTranlateTipHtml(!1,c),h.log({action:"show",item:"body_trans"}))})}var m,n,o=d.pageX,p=d.pageY,q=a.fly(g.frame).offset(),r=0;p-=h.module.getDom("ScrollDiv").scrollTop,r=g.isIE?b.body?b.body.offsetWidth:b.documentElement.offsetWidth:b.documentElement.offsetWidth,m=o+q[0]+40,n=o+280,n>r&&!h.translating?e.css({left:"auto",right:"0px"}):e.css({left:m+"px",right:"auto"}),g.isIE&&(p-=document.documentElement.scrollTop),e.css({top:p+q[1]+20+"px"}),j||e.show(),e.destroy(),a.fly(document.body).one("mouseup",function(){try{a.fly("#dvRangOptions").hide()}catch(b){}})}}function p(c){var d="";return"getSelection"in b?d=this.frame.contentWindow.getSelection():"selection"in c&&(d=c.selection.createRange().text),a.String.trim(d.toString())}function q(b){var d=this,e=d.reader,f=b.getElementById("divNeteaseMailCard"),g={};if(null!==f&&0!==f.childNodes.length){for(var h,i,j,k,l,m,n,o,p,q,r=f.getElementsByTagName("STRONG"),s=0,t=r.length;t>s;s+=1)n=r[s],o=n.getAttribute("func"),"name"===o?g.name=a.String.trim(n.innerHTML):"key2"===o&&(h=(m=n.getElementsByTagName("A")).length>0?a.String.trim(m[0].innerHTML):a.String.trim(n.innerHTML),k=a.Uri.matchEmail(h),k?g.email=k.address:/^(1[3|5|8])\d{9}$/.test(h)&&(i=h));if(!g.email||!a.SenderList.isSender(g.email)){for(p=f.getElementsByTagName("SPAN"),s=0,t=p.length;t>s;s+=1)q=p[s],q.getAttribute("func")&&(l=a.String.trim(q.innerHTML),l.indexOf(N.t("手机"))>-1?(m=l.replace("：",":").split(":"),i=a.String.trim(m[m.length-1])):l.indexOf(N.t("电话"))>-1?(m=l.replace("：",":").split(":"),j=a.String.trim(m[m.length-1])):/^(1[3|5|8])\d{9}$/.test(l)?i=l:/^\d{3,4}-\d{7,8}(-\d{3,4})?$/.test(l)&&(j=l));if(g.phone=i||j,(0!==r.length||0!==p.length)&&(g.email||g.name||g.phone)){for(var u=f.getElementsByTagName("A")||[],s=0;s<u.length;s++){var v=u[s];v.innerText===N.t("使用帮助")&&a.fly(u[s]).remove()}a.fly(f).before(a.Element.create("DIV",c,b).html(e.view.getVCardTipsHtml(g)).dom)}}}}function r(d){var e=this,f=e.reader,g=f.notFocus;if(!g){var h=d.getElementsByTagName("player"),i=h.length;if(i>0){var j={},k=f.data.attachments;if(k===c||0===k.length)return;a.Array.each(k,function(a,b){j[b.filename]=b});var l=e.mediaPlayers=[],m=i-1;h=a.Object.toArray(h),a.Array.each(h,function(a,d){var g=d.getAttribute("param"),i=d.getAttribute("media"),k=j[g];if(k){e.mediaContent=!0;try{var n=$L("product.AvMail",this)}catch(o){return o}var p="NTES_MAIL_READ_FlashPlayer"+k.id;d.parentNode.innerHTML=(new n).getPlayHtml(f.attach.getOptionUrl("download",k),i,p),l.push(p),h[a]=d=c,a===m&&b.setTimeout(function(){e.autoSize({heightOnly:!0})},200)}})}}var n=d.getElementById("cards_read");null!==n&&(e.greetingCardContent=!0,g&&e.destroy(!0))}function s(b,c){var d=this,e=d.reader,f=e.folderData;if(f){var g=[];try{g=[].concat(f.accounts?f.accounts:$S("orgUid"),f.to.split(","),f.from.split(","))}catch(h){}for(var i=0;i<g.length;i++)g[i]=a.Uri.getAddress(a.String.trim(g[i])),g[i]=(g[i]||"").toLowerCase();for(var j=c.getElementsByTagName("span"),i=0;i<j.length;i++){var k=j[i].getAttribute("ntes_mm_email");if(k){var l=g.indexOf(k.toLowerCase());if(0===l&&(j[i].style.backgroundColor="#fff777"),l>0&&(j[i].style.backgroundColor="#E0E0E0"),-1!==l){j[i].style.borderRadius="2px",j[i].style.color="#333333";var m=j[i].getElementsByTagName("a");m&&m.length&&(m[0].style.color="#333333",m[0].style.textDecoration="none")}}}}}function t(a){try{var b=a.body,c=a.body.querySelectorAll('[mdtype="list"]');if(c)for(var d=0;d<c.length;d++)c[d].style.listStylePosition="outside";var e=b.innerHTML;e=e.replace(/__(href|formAction|onclick|javascript)/gi,"$1"),b.innerHTML=e}catch(f){}}function u(a){try{var b=a.body,c=a.body.querySelectorAll('[mdtype="list"]');if(c)for(var d=0;d<c.length;d++)c[d].style.listStylePosition="outside";var e=b.innerHTML;e=e.replace(/(margin-left|text-indent)\s*:\s*(-\d+)/g,function(a,b){return b+":"+"0"}),b.innerHTML=e}catch(f){}}function v(a,b){var c=this;c.reader;try{var d=b.body,e=d.innerHTML;d.innerHTML=K.fix(e)}catch(f){}}function w(){var b=this,c=a.Element.getIframeDoc(b.frame);a.Array.each(b.mediaPlayers,function(a,b){try{c.getElementById(b).stop()}catch(d){}})}function x(b,d){var e=this,f=a.Element.getIframeDoc(e.frame),g=!0,h=e.isChrome;h&&e.normalHeight===c&&(e.normalHeight=e.frame.offsetHeight+"px");try{switch(b){case"I":M.setFontSize(f.body,!0);break;case"O":M.setFontSize(f.body,!1);break;case"R":g=!1,e.reload();break;case"F":M.setFontFamily(f.body,d)}}catch(i){}g&&e.autoSize({chromeResize:h,setScrollPos:!0}),f=c}function y(d){var e=this,f=e.reader;e.contentLoaded=!0;var g,h;if(d=d||e.frame,e.frame=d,g=a.Element.getIframeDoc(d),e.autoHeightTimer!==c&&(b.clearTimeout(e.autoHeightTimer),e.autoHeightTimer=e.autoHeightCount=c,0===e.autoHeightCount&&e.autoHeightCount({heightOnly:!0,ignoreIE:!0})),"mail"!==e.contentType)return e.autoSize(),void 0;if(e.fixSafeLink(g),e.fixStyle(g),e.fixEmoji(d,g),e.setReplyQuote(d,g),e.digAttach(g),e.resetInlineAttach(d),e.detectVCard(g),h=e.fixLargeImage(g),e.detectMediaPlayer(g),e.autoSize({chromeResize:h}),e.setRangEvent(g),$S("isFree")&&e.setAtHeightlight(d,g),a.Event.listen(g,"click",a.Function.bind(e.onClickHandler,e)),e.loadComplete=!0,($S("ad").show!==!1||"ud"!==$S("ad").userType)&&$S("isFree")&&!f.errorMailWarn&&b.gAd.getByCallback("readTop",{},function(a){var b=a.readTop;b&&b.length>0&&f.addBlockInfo("yAd",null,{content:b})}),a.Component.setEvents(50),g=c,e.optimizationChecked||f.isThread||(b.setTimeout(function(){e.checkContentOptimizable()},1500),e.optimizationChecked=!0),a.Ext.pdfConver_atta&&$S("id_attr_frist_pdf")&&!a.LocalStorage.get("pdf_conversion_read_"+$S("uid")))try{var i=new a.Layer({width:"192px",content:"<p>"+N.t("PDF 格式转换上线了，立即体验。")+"</p>",params:"hasArr arrDown",left:"38px",top:$G.environment.isCh?"-27px":"-46px",zIndex:"2",doNotHide:!0,renderTo:a.fly("#"+$S("id_attr_frist_pdf")).dom});i.render(),a.fly("#"+$S("id_attr_frist_pdf")).mouseover(function(){a.LocalStorage.set("pdf_conversion_read_"+$S("uid"),!0),i.destroy()})}catch(j){}}function z(c){function d(c){if(a.Support._ieVersion<9)b.open(c);else{var d=g.module.getDom("aTempLink");d.href=c;var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),d.dispatchEvent(e)}}function e(){if(j&&0===j.indexOf("https://count.mail.163.com/")){var b=j.indexOf("?")>-1?"&":"?";j+=b+"frmjs=true",j.indexOf("uid=")<0&&(j+="&uid="+$S("uid")),j.indexOf("domain=")<0&&(j+="&domain="+$S("domain")),a.Ajax.request({requestType:a.Ajax.IFRAME,rnd:!0,url:j})}else{var c=h.getAttribute("log"),d=h.getAttribute("logid");"1"===c&&d&&a.Ajax.request({requestType:a.Ajax.IFRAME,rnd:!0,url:"http://jslog.mail.126.com/count/c.htm?product=mailclick&uid="+$S("uid")+"&domain="+$S("domain")+"&logid="+d})}}var f=this,g=f.reader;a.Event.fire(document,"click");var h=a.fly(a.Event.getTarget(c)).findParent("a[href], area[href], input[formaction], button[formaction]",!0,!0);if(h){h=h.dom;var i=h.id,j=(h.href||h.formAction||h.getAttribute("formAction")||"").toLowerCase(),k=h.href||h.formAction||h.getAttribute("formAction")||"";if("1"===h.getAttribute("sys")){var l=h.getAttribute("interface");if(l){var m=h.getAttribute("logkey");m&&g.log({action:"click",item:"direct_mail_"+a.String.escapeHTML(m)});var n=h.getAttribute("param"),o={};try{o=JSON.parse(n.replace(/'/g,'"'))}catch(p){o=n}a.Nav.entry(l,o,h.getAttribute("method"))}else if(i){var q;switch(i){case"dock_start":L.showDock();break;case"mobile_reply":if($S("isFree")){var r=h.getAttribute("tauid_sig"),s=h.getAttribute("key");q=a.Uri.getUrl(i),r&&(q+="&tauid_sig="+r),s&&(q+="&key="+s),a.Ajax.jsonp(q,function(c){c&&"200"===c.res?a.Msgbox.show({type:c.type,header:c.title,content:c.memo,okText:c.okText,ok:function(){switch(c.action){case"newwin":b.open(c.url);break;case"link":try{var d=$L("interface.OutlinkInterface",this)}catch(e){return e}d.goOutlink({key:c.key,param:c.param});break;case"interface":a.Nav.entry(c["interface"],c.param,c.method)}}}):c&&c.memo&&a.Msgbox.show({content:c.memo})})}break;case"courseassist":break;case"noschedule":a.Ud.set({field:"ntes_option",flag:"schedule_notify",value:1}),a.Tips.show({type:"suc",text:N.t("您发送的定时邮件到达时将不再用邮件方式通知，您可以进入操作习惯设置再次设定发送通知邮件")});break;case"cards_read":break;case"ntes_cloudmusic":break;case"mail_member":var t=h.getAttribute("goods-type")||"plus",j=h.href,u=a.Support.parseQuery(j).utm_source,v=h.getAttribute("utm-source"),w=v||u;if(a.Event.stop(c),"cloudfile"===t.toLowerCase()&&$S("isVip")){try{var x=$L("product.FileCenter",this)}catch(y){return y}x.entry("bj_center")}else{try{var z=$L("product.Privileges",this)}catch(y){return y}z.showDialog(t,"",w)}break;default:var A={};if(q=a.Uri.getUrl(i),q&&q.indexOf("http")>-1){var B=j.split("?");if(2===B.length){var C=B[1];if(C.length>0){B=C.split("&");for(var D=0,E=B.length;E>D;D+=1){var F=B[D].split("=");F[1]&&(A[F[0]]=F[1])}}}}if("_blank"===h.getAttribute("sys_target"))b.open(q);else switch(i){case"file_center":case"nf_center":case"fj_center":case"bj_center":case"photo_center":try{var x=$L("product.FileCenter",this)}catch(y){return y}FC.entry(i);break;case"cards_read":case"read_postcard":try{var G=$L("interface.OutlinkInterface",this)}catch(y){return y}G.goOutlink({key:i,param:{to:g.from[0]}});break;default:try{var G=$L("interface.OutlinkInterface",this)}catch(y){return y}G.goOutlink({key:i,param:A})}}}return e(),a.Event.cancel(c),void 0}if(0===j.indexOf("mailto:")){var H=a.Uri.getEmails(a.String.trim(b.decodeURI(j.replace(/^mailto:|\?.*$/gi,"")))).match;if(H.length>0){a.Array.each(H,function(a,b){H[a]=b.name?b.name+"<"+b.address+">":b.address});try{var I=$L("interface.ComposeInterface",this)}catch(y){return y}I.entry({info:{to:H}})}return a.Event.cancel(c),void 0}0===j.indexOf("#")||"#"===h.getAttribute("href")||0===j.indexOf(["java","script:"].join(""))||8==a.Browser.ie()&&0===j.indexOf(f.frame.ie8_src)?h.target="_self":(h.target="_blank",!/(ht|f)tp(s?)\:\/\/[0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*(:(0-9)*)*(\/?)([a-zA-Z0-9\-\.\?\,\'\/\\\+&amp;%\$#_]*)?/i.exec(k)||/^https?:\/\/count.mail.163.com/i.exec(k)||/^https?:\/\/mail.yeah.net/i.exec(k)||/^https?:\/\/(webmail.vip.|vip.|www.)?188.com/i.exec(k)||(a.Event.cancel(c),g.module.safeBrowsing(k,function(b){var c={};try{c=a.JSON.parse(""===b.responseText?"{}":b.responseText)}catch(e){}switch(c.message?c.message.toLowerCase():""){case"normal":d(k);break;case"suspect":var f,g='<div class="nui-msgbox-titleText-hd">'+N.t("第三方链接提醒")+"</div>"+'<div class="nui-msgbox-titleText-bd">'+N.t("您将前往身份不明的第三方网站，请您仔细查看谨慎辨别，建议您不要随意泄漏帐号密码等安全信息。")+"</div>"+'<div class="nui-msgbox-titleText-ft">'+a.Link.html({text:N.t("取消前往"),cls:"nui-txt-link",click:function(){f.hide()}})+a.Link.html({text:N.t("继续前往"),cls:"nui-txt-link",click:function(){d(k),f.hide()}})+"</div>";f=a.Msgbox.show({noHeader:!0,noFooter:!0,contentType:"custom",content:g,type:"titleText"});break;case"danger":var g='<div class="nui-msgbox-titleText-hd"><span class="nui-txt-impt">'+N.t("假冒伪造链接警告")+"</span></div>"+'<div class="nui-msgbox-titleText-bd">'+N.t("您所点击的链接已被识别出是假冒伪造的不安全网站，它可能会盗取您的个人帐号，隐私信息，我们已禁止了该网站的跳转并建议您不要前往。")+"</div>";a.Msgbox.show({noHeader:!0,noFooter:!0,contentType:"custom",content:g,type:"titleText"});break;default:d(k)}})))}}function A(){var a=this.reader,b=a.data,d=(b.html||b.text||{}).contentLength;return d===c||d>51200?void 0:d===c?0:d}function B(){var b,c,d=this,e=d.frame,f="";return e?(b=a.Element.getIframeDoc(e),b&&b.body?(c=b.body,f=d._getInnerTEXT(c),f.replace(/([\n\r]\s*) {3,}/g,"\n")):f):f}function C(b){function c(a){var b,d,e,f="",g=0,h=a.nodeType;if(h){if(d=a.nodeName||"",e=/(STYLE)|(SCRIPT)/.test(d),1===h&&!e||9===h||11===h){if("BR"===d)return" ";if(a.childNodes.length>0)for(a=a.firstChild;a;a=a.nextSibling)f+=c(a);else if("string"==typeof a.textContent)return a.textContent}else if(3===h||4===h)return a.nodeValue}else for(;b=a[g];g++)f+=c(b);return f}var d=this,e="";if(d.modernIE||a.Browser.firefox())try{e=c(b.childNodes)}catch(f){}else e=b.innerText||b.textContent||e;return e}function D(a,c){var d=a.match(new RegExp("(^|&)"+c+"=([^&]*)(&|$)"));return null===d?null:b.decodeURIComponent(d[2])}function E(d,e,f,g){var h=this;if(1===d.nodeType){var i=M.getFontSize("currentStyle"in d?d.currentStyle.fontSize:b.getComputedStyle(d,null).getPropertyValue("font-size"),e);i!==c&&(d.style.fontSize=i),f||(d.style.lineHeight="1.66")}g&&"content"!==d.className||a.Array.each(d.childNodes,function(a,b){h.setFontSize(b,e)}),d=c}function F(a,c){var d,e,f=this,g=b.parseFloat(a);if(d=a.indexOf("px")>-1?3:a.indexOf("em")>-1?0:a.indexOf("%")>-1?1:a.indexOf("pt")>-1?2:3,e=f.fontUnit[d],c){if(g+=e,g>f.fontLimit[d][1])return}else if(g-=e,g<f.fontLimit[d][0])return;return g+f.fontSymbol[d]}function G(b,d){var e,f=this;1===b.nodeType&&(e=b.rawFontFamily,"inherit"===d?b.style.fontFamily=e||d:(e=b.style.fontFamily,e&&b.rawFontFamily===c&&(b.rawFontFamily=e),b.style.fontFamily=d)),a.Array.each(b.childNodes,function(a,b){f.setFontFamily(b,d)}),b=c}function H(){var b=this,c=b.reader;if(b.frame){var d=a.Element.getIframeDoc(b.frame);if(!(b.getBodySize()<1536)){for(var e,f=!0,g=["table","map","thead","tbody","tfoot","th","tr","td","select","input","button","form","area","caption ","canvas","frame","frameset","iframe","audio","video","embed","object","dialog","summary","applet"],h=0,i=g.length;i>h;h+=1)if(e=g[h],d.getElementsByTagName(e).length>0){f=!1;break}var j=d.getElementsByTagName("a");if(i=j.length,i>0)for(var k=0;i>k;k+=1)if(j[k].getAttribute("sys")){f=!1;break}if(f){var l=c.view.getHeaderLinkHtml(!0);a.fly(c.getDom("dvHeaderLinks")).prepend(l)}}}}function I(){function b(){var b=a.Element.getIframeDoc(i.dom),c=b.getElementsByTagName("style");a.Array.each(c,function(a,b){if(a>1)try{b.parentNode.removeChild(b)}catch(c){}}),d(b.body.firstChild),b.body.firstChild.className="content",a.Array.each(b.getElementsByTagName("br"),function(b,c){if(b>0)for(var d=c.previousSibling;d;){if(d&&3===d.nodeType){if(a.String.trim(d.nodeValue).length>0)return}else if(1===d.nodeType){var e=d.nodeName.toLowerCase();return("br"===e||"div"===e||"p"===e)&&(c.style.display="none"),void 0}d=d.previousSibling}});var g=i.dom.parentNode.offsetWidth-80;a.Array.each(b.getElementsByTagName("img"),function(a,b){var c=b.width;c>g&&(b.style.width=g+"px")}),e(b.getElementsByTagName("div")),e(b.getElementsByTagName("p")),i.show(),f.autoSize({frame:i.dom,heightOnly:!0})}function d(a){if(1===a.nodeType){var b=a.id;if("divNeteaseBigAttach"!==b&&"divNeteaseMailCard"!==b){a.removeAttribute("class"),a.removeAttribute("style"),a.removeAttribute("alink"),a.removeAttribute("link"),a.removeAttribute("text"),a.removeAttribute("vlink"),a.removeAttribute("face"),a.removeAttribute("size"),a.removeAttribute("align"),a.removeAttribute("border"),a.removeAttribute("height"),a.removeAttribute("width"),a.removeAttribute("hspace"),a.removeAttribute("vspace"),a.removeAttribute("background"),a.removeAttribute("color"),a.removeAttribute("bgcolor");for(var e=a.childNodes,f=0,g=e.length;g>f;f+=1)d(e[f]);a=c}}}function e(b){a.Array.each(b,function(b,c){try{0===c.getElementsByTagName("img").length&&0===a.String.trim(f._getInnerTEXT(c)).length&&(c.style.display="none")}catch(d){}})}var f=this,g=f.reader;a.Support.loadStyleSheet("gread_reader.css");var h=g.view.getOptimizedContentHtml();a.fly(document.body).append(h);var i=a("#ifrmOptimizedContent");i.listen("load",b),i.dom.src=g.getFrameUrl().replace("/readhtml","/readhtml_optimized");var j=a("#dvOptimizedContent");j.listen("click",function(){a.Event.getTarget()===j.dom&&(i.remove().destroy(),j.empty().remove().destroy(),a("#read_mask").empty().remove().destroy())})}try{$L("support.AddressSupport")}catch(J){return J}try{var K=$L("util.Emoji")}catch(J){return J}try{var L=$L("init.Dock")}catch(J){return J}var M,N=new $I18N("module.read.MailReaderBody");M=a.createClass($N("module.read.MailReaderBody")),a.Object.extend(M,{fontSymbol:["em","%","pt","px"],fontUnit:[.1,10,2,2],fontLimit:[[.8,4.3],[80,430],[10,50],[12,60]],setFontSize:E,getFontSize:F,setFontFamily:G}),a.Object.extend(M.prototype,{initialize:d,init:e,reload:f,destroy:g,autoSize:h,setReplyQuote:i,digAttach:j,resetInlineAttach:k,fixLargeImage:l,setRangEvent:m,removeRangEvent:n,showRangeOpt:o,getRangText:p,detectVCard:q,detectMediaPlayer:r,setAtHeightlight:s,fixEmoji:v,fixStyle:u,fixSafeLink:t,stopAllMedia:w,zoom:x,onLoadHandler:y,onClickHandler:z,getBodySize:A,getBodyText:B,checkContentOptimizable:H,showOptimizedContent:I,_getInnerTEXT:C,_getUrlParam:D})}($,window),function(a,b,c){function d(a){var b=this;b.reader=a}function e(){var b,c=this,d=c.reader,e=d.folderData,f="1"===a.Ud.get({field:"ntes_letter",flag:"read_head"}),g="",h=!!e.flags.system,i="",j=[' style="display:none"',""];d.module.resourcePreloaded?(i=c.getFullHeadHtml(),d.fullHeaderInited=!0,f&&(g=c.getCompactHeadHtml(),d.compactHeaderInited=!0,j.reverse())):f?(g=c.getTempCompactHeadHtml(),j.reverse()):i=c.getTempFullHeadHtml();var k="";e.composeExtra&&e.composeExtra.showOneRcpt&&(k=" fM1");var l=d.isServiceMail&&d.isMailServiceAvailable()?' style="display:none;"':"";return b=['<div id="'+d.createId("dvReadHeadInfo")+'" class="sI0 nui-bg-light'+(d.viewType?" jO0":"")+(h?" uL0":"")+'">',d.isThread?"":c.getSubjectHtml(),'<div class="ow0'+k+'">','<ul id="'+d.createId("ulCompact")+'"'+j[0]+' role="listitem" tabindex="0">',g,"</ul>",'<ul id="'+d.createId("ulFull")+'"'+j[1]+' role="listitem" tabindex="0">',i,"</ul>","</div>",'<div id="'+d.createId("dvHeaderLinks")+'" class="oe0">',c.getHeaderLinkHtml(),d.isThread||d.viewType?a.Toolbar.html(c.getSimpleToolbarConf()):"","</div>",'<div class="yz1" id="'+d.createId("dvSystemCert")+'" style="'+(f?"display:none;":"")+'">',h?'<img class="tX1" src="https://mimg.127.net/p/js4/lib/img/integrity/cert_ntes.png" alt="'+fb.t("网易官方邮件")+'">':"","</div>","</div>",'<div class="nui-split nui-split-cDark sK0 lB0"></div>','<div id="'+d.createId("dvBlockInfo")+'" style="display:none" title="'+fb.t("提示区")+'" aria-label="'+fb.t("提示区")+'" role="listitem" tabindex="0"></div>','<div class="CG0" id="'+d.createId("dvReadAttachPreviewIcs")+'">',"</div>",'<div class="nu0">',c.getMailServiceHtml(),'<div id="'+d.createId("dvContent")+'" class="nui-fClear sR0"'+l+">",c.getFrameHtml(),"</div>","</div>",'<div id="'+d.createId("dvReadAd")+'" class="tI0 txt-info"></div>','<div class="lY0">','<div id="'+d.createId("dvAttach_reply")+'" class="sz0 nui-bg-light nui-bdr-light">','<a name="'+d.createId("aAttachTag")+'"></a>',c.getAttachListHtml(),'<div class="sw0" id="'+d.createId("dvReply")+'" tabindex="0" title="'+fb.t("快捷回复区")+'" aria-label="'+fb.t("快捷回复区")+'" role="listitem">',c.getReplyHtml(),"</div>","</div>","</div>",c.getBottomAD(),c.getTempLinkHtml(d)],d.isThread||d.module.isIE678||b.push('<div id="'+d.createId("dvZoom")+'" class="sF0"'+l+">",c.getZoomHtml(),"</div>"),b.join("")}function f(c){var d,e,f,g,h,i=this,j=i.reader,k=j.data,l=k.from,m=k.to||[],n=k.cc||[],o=[],p=c?" ":"&nbsp;",q=j.module.userLabels;for(m="string"==typeof m?[m]:m,n="string"==typeof n?[n]:n,h=m.concat(n),e=0,f=h.length;f>e;e+=1){var r=j.module.view.getContactConf(h[e].toString());r.extcls="nui-txt-cLink",r.id="compactLabel"+e,o.push(c?r.email.name||r.email.address:a.UserLabel.html(r)),q[r.id]=r.id}l=l instanceof b.Array?l[0]:l.toString();var s=p+fb.t("于")+p+i.getCompactDateStr()+p+fb.t("发给")+p+o.join(fb.t("、"));return c?l+s:(j.isThread&&(s="<p><span>"+s+"</span></p>"),g=j.module.view.getContactConf(l),g.id="compactLabelFrom",d=['<li class="ig0 dM0">','<div class="hX0">','<div class="cc1">','<strong class="nui-txt-suc">'+a.UserLabel.html(g)+"</strong>",s,"</div>",i.getAttachHtml(!0),"</div>","</li>"].join(""),q[g.id]=g.id,d)}function g(){var a=this;return[a.getMemoHtml(),a.getSenderHtml(),a.getReceiverHtml(),a.getDateHtml(),a.getAttachHtml()].join("")}function h(){var c=this,d=c.reader,e=d.folderData,f=e.from||"";return f=(f instanceof b.Array?f[0]:f).toString(),['<li class="ig0 dM0">','<div class="hX0">','<div class="cc1">','<strong class="nui-txt-suc">'+a.String.escapeHTML(cb.getName(d.module.view.getContactConf(f).email))+"</strong>",fb.t("&nbsp;于&nbsp;")+c.getCompactDateStr()+fb.t("&nbsp;发给&nbsp;")+a.String.escapeHTML(e.to||""),"</div>","</div>","</li>"].join("")}function i(){var c=this,d=c.reader,e=d.folderData,f=e.from||"";return f=(f instanceof b.Array?f[0]:f).toString(),['<li class="ig0 ew0">','<div class="iI0">'+fb.t("发件人：")+"</div>",'<div class="hX0">',a.String.escapeHTML(d.module.view.getContactConf(f).email.toString()),"</div>","</li>",'<li class="ig0 fD0">','<div class="iI0">'+fb.t("收件人：")+"</div>",'<div class="hX0">',a.String.escapeHTML(e.to||""),"</div>","</li>",c.getDateHtml()].join("")}function j(){var c=this,d=c.reader,e=d.module,f="";if(d.isServiceMail&&d.isMailServiceAvailable()){var g=d.folderData,h=(g.flags||{}).deferHandle&&g.defer;f=['<link href="https://mimg.127.net/xm/webmail/app-service/'+b.$G.environment.mailServiceVer+'/css/app_service.css" rel="stylesheet" type="text/css">','<div id="'+d.createId("mailService")+'" class="APP-service" style="display:none;">',"<div></div>",'<div class="APP-service-hr" style="display:none;">','<span class="desc" style="display:'+(h?"none":"")+'">','<a target="_blank" href="https://help.mail.163.com/feedback.do?m=add&categoryName=webmail%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%8C%96">'+fb.t("意见反馈")+"</a>",'<span class="split">|</span>','<span class="alert"><i class="ico-clock"></i>',a.Link.html({text:fb.t("为此邮件设置待办提醒"),cls:"nui-txt-link",click:function(){e.setDefer(),e.log({action:"click",item:"service_defer"})}}),"</span>",'<span class="split">|</span>','<span class="content">'+fb.t("以下为原邮件")+"</span>","</span>",'<span class="desc" style="display:'+(h?"":"none")+'">'+fb.t("以下为原邮件")+"</span>","</div>","</div>"].join("")
}return f}function k(c){var d=this,e=d.reader,f="",g=400,h=e.locked;if(e.speed&&!h)d.mimFrameHeight=g;else if(h&&!c)f='<div style="height:'+g+'px;"></div>';else{var i,j=e.createId("frameBody"),k=e.getFrameUrl(),l=" onload=\"$S('readFraLd')('"+e.module.name+"', this"+(e.isThread?", '"+e.threadToken+"'":"")+');"';if(a.Browser.chrome())i=240;else try{i=(document.documentElement.clientHeight||document.body.clientHeight)-414,i=b.Math.max(i,400)}catch(m){i=400}d.mimFrameHeight=i,f='<iframe id="'+j+'" name="'+j+'" class="oD0"  frameborder="0" src="'+k+'" style="height:'+i+'px"'+l+"></iframe>"}return f}function l(a){var b,c=this,d=c.reader,e="",f="";return d.commonAttached&&(e=['<div id="'+d.createId("dvAttachHead")+'"  class="sa0"></div>','<div class="rY0" style="display:none;margin-bottom:15px">','<ul id="'+d.createId("ulCommonAttachItem")+'" class="qs0 nui-fClear"></ul>',"</div>"].join("")),d.cloudAttached&&(f=['<div id="'+d.createId("dvCloudAttachHead")+'" class="sa0"></div>','<div class="rY0" style="display:none;">','<ul class="qs0 nui-fClear" id="'+d.createId("ulCloudAttachItem")+'"></ul>',"</div>"].join("")),b=[e,f,'<div class="nui-split nui-split-cDark"></div>'].join(""),a?(d.getDom("dvAttachBody").innerHTML=b,void 0):['<div id="'+d.createId("dvAttachBody")+'" class="tn0" style="display:none;" tabindex="0">',b,"</div>"].join("")}function m(b,c){var d,e,f,g=this,h=g.reader,i='<div class="nui-split sK0"></div>';if(c)d="nui-ico-bigAtt",e=fb.t("超大附件"),f=i;else{var j;try{var k=h.folderData.tag;a.Array.has(k,"%st_sys_fake%")&&(j='<span class="oG1">'+fb.t("您的附件内容可能含有诈骗信息或钓鱼链接，请谨慎打开！")+"</span>")}catch(l){}d="nui-ico-att",e=fb.t("附件"),f=[b>1?"&nbsp;"+a.Link.html({id:h.createId("downloadAllLink"),text:fb.t("打包下载"),title:fb.t("下载全部")+b+fb.t("个附件"),link:a.Uri.getUrl("read_pack",!0)+"&mid="+h.mid+"&part="+h.attach.commonId.join("&part="),target:"downloadFrame",cls:"nui-txt-link jh0",listeners:{click:{handler:function(){h.log({action:"click",item:"attach_downloadall"})}}}}):"",j||"","</div>",'<div class="nui-split sK0"></div>',b>5?['<div class="rf0">','<div id="_mail_toolbar_1_300" class="js-component-toolbar nui-toolbar ">','<div class="nui-toolbar-item">',a.Link.html({id:h.createId("sortLink"),text:fb.t("附件排序(默认)")+'<b class="nui-ico nui-ico-downArr">d</b>',cls:"nui-txt-link",click:function(){h.log({action:"click",item:"attach_sort"})},listeners:{render:function(){new a.Menu({groups:[{checkType:"radio",items:[{text:fb.t("按上传顺序排序(默认)"),checked:!0,click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("",this.rawConfig.text)}},{text:fb.t("按附件类型排序"),click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("type",this.rawConfig.text)}},{text:fb.t("按附件从小到大"),click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("size",this.rawConfig.text)}},{text:fb.t("按附件从大到小"),click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("size",this.rawConfig.text,!0)}},{text:fb.t("按附件名升序"),click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("name",this.rawConfig.text)}},{text:fb.t("按附件名降序"),click:function(){h.log({action:"click",item:"attach_sort"}),h.attach.sort("name",this.rawConfig.text,!0)}}]}],width:155}).attachTo({clickFrom:this.getEl(),renderTo:h.getDom("ScrollDiv"),reverse:!0})}}}),"</div>","</div>","</div>"].join(""):""].join("")}return['<div class="ox0">','<b class="nui-ico '+d+'"></b>','<strong class="jU0">'+e+'<span class="nui-txt-s12 nui-txt-tips" style="font-weight:normal">&nbsp;('+b+")</span></strong>",f].join("")}function n(c){var d,e,f,g,h,i,j,k,l,m,n=this,o=n.reader,p=o.createId(c.id),q=a.String.escapeHTML(c.filename),r=c.imagesrc,s=c.icon,t="string"==typeof r,u=a.Link,v="cK0",w=v+" bJ0",x='<img src="https://mimg.127.net/p/t.gif" class="nui-ico bD0 W0" /><br />'+fb.t("下载"),y='<img src="https://mimg.127.net/p/t.gif" class="nui-ico bD0 X0" /><br />'+fb.t("打开"),z='<img src="https://mimg.127.net/p/t.gif" class="nui-ico bD0 V0" /><br />'+fb.t("预览"),A='<img src="https://mimg.127.net/p/t.gif" class="nui-ico bD0 bv3" /><br />'+fb.t("编辑"),B='<img src="https://mimg.127.net/p/t.gif" class="nui-ico bD0 Z0" /><br />'+fb.t("存网盘"),C='<img src="https://mimg.127.net/p/t.gif" class="nui-ico bD0 D1" /><br />'+fb.t("翻译"),D='<img src="https://mimg.127.net/p/t.gif" class="nui-ico bD0 A1" /><br />'+fb.t("PDF转换"),E="";m=t?'<img src="'+r+'" style="display:none" onload="$S(\'thumbnailHandler\')(this);" onerror="$S(\'thumbnailHandler\')(this, true, \''+a.String.escapeHTML(c.mime)+"');\" ></img>":a.Icon.html({type:"file75",subtype:s}),c.isCommon?(d=u.html({text:x,link:c.download,cls:v,target:"downloadFrame",listeners:{click:{handler:function(){o.log({action:"click",item:"attach_download"})}}}}),"9"===s&&c.eml?e=u.html({text:y,cls:v,click:function(){o.log({action:"click",item:"attach_open"}),a.fly(o.getDom(c.id)).removeClass("nui-bdr-item nui-bg-item fM0");try{var b=$L("interface.ReadInterface",this)}catch(d){return d}o.module._frameCtrlNoDelete=!0,b.entry(c.eml)}}):c.open&&(e=u.html({text:y,cls:v,link:c.open,target:"_blank",listeners:{click:{handler:function(){o.log({action:"click",item:"attach_open"})}}}}),(c.mime&&"pdf"===c.mime||c.filename&&/\.pdf$/.exec(c.filename))&&(e=u.html({text:y,cls:w}))),c.localPreview&&(f=t?u.html({text:z,cls:v,click:function(){o.log({action:"click",item:"attach_preview"}),c.previewHandler(c.imageIndex)}}):u.html({text:z,cls:v,link:c.preview,target:"_blank",listeners:{click:{handler:function(){o.log({action:"click",item:"attach_preview"})}}}})),c.editHandler&&(g=u.html({text:A,cls:v,click:function(){o.log({action:"click",item:"attach_Edit"}),c.editHandler()}})),c.saveToNfHandler&&(h=u.html({text:B,cls:v,click:function(){o.log({action:"click",item:"attach_saveNF"}),c.saveToNfHandler()}}))):c.isCloud?(c.download&&(d=u.html({text:x,link:c.download,cls:v,target:"_blank"})),c.preview&&(f=u.html({text:z,cls:v,link:c.preview,target:"_blank"})),E=['<div class="el0">','<span class="nui-txt-tips cy0">('+c.expireText+")</span>","</div>"].join(""),e=g=h=""):c.isDecrypt&&(d=u.html({text:x,cls:v,link:c.download,target:"ifrDownUrl"})),d=d||u.html({text:x,cls:w}),f=f||u.html({text:z,cls:w}),c.isCloud||(e=e||u.html({text:y,cls:w}),h=h||u.html({text:B,cls:w}),g=g||u.html({text:A,cls:w})),c.translate&&(k=u.html({text:C,cls:v,listeners:{click:{handler:function(){var d="read_atta_translate",e=a.LocalStorage.get(d,!0);if(e)b.open(c.translate,"_blank"),a.Log.cache({read_atta_translate_outlink:"1"});else{var f=a.Button.html({delegateTo:"self",text:fb.t("确定"),subclass:"mainBtn",click:function(){b.open(c.translate,"_blank"),$C("isReadAttrTranslateNoRemind").getChecked()&&a.LocalStorage.set(d,"1",{path:"/",expires:3650,domain:$S("fullDomain")},!0),a.Msgbox.msgbox.hide(),a.Log.cache({read_atta_translate_noremind:$C("isReadAttrTranslateNoRemind").getChecked()?"1":"0",read_atta_translate_sure:"1",read_atta_translate_outlink:"1"})}}),g=a.Checkbox.html({text:a.Label.html({text:fb.t("不再提醒")},!0),checked:!0,id:"isReadAttrTranslateNoRemind"},!0);a.Msgbox.show({extcls:"gRead-attr-translate-msgbox",noHeader:!0,noFooter:!0,content:'<div class="gRead-attr-translate"><dl><dt>'+fb.t("提醒")+"</dt><dd>"+fb.t("您即将进入有道文档翻译：")+"https://pdf.youdao.com<br>"+fb.t("文档一键翻译，保留原文排版。")+'</dd></dl><div class="gRead-attr-translate-btn">'+f+'</div><div class="gRead-attr-translate-check">'+g+"</div></div>",width:$G.environment.isCh?"360px":"450px",height:"186px",contentType:"custom",close:function(){a.Msgbox.msgbox.hide(),a.Log.cache({read_atta_translate_close:"1"})}})}}}}})),c.conversion&&(l=u.html({text:D,cls:v,click:function(){c.conversion()}}),$S("id_attr_frist_pdf")||$S("id_attr_frist_pdf",p));var F=" gO1";return c.conversion&&(F=" fd1"),['<li id="'+p+'" class="lh0 '+(c.isCloud?"gl0":"")+'" tabindex="0">',"<table>","<tbody>","<tr>",'<td class="eG0">','<div class="cf0">',m,"</div>","</td>","</tr>","<tr>",'<td class="gx0">','<strong class="dh0">'+q+"</strong>",'<span class="nui-txt-tips di0">'+c.size+"</span>",E||"",'<div class="ey0'+F+'">','<div class="dn0">','<div class="dw1 bR1"></div>','<div class="dw1 bC2"></div>','<div class="dw1 bI1"></div>',"</div>",'<div class="dp0 nui-fClear">','<div class="dw1 bR1"></div>','<div class="bU1">','<div class="cg0">'+q+"</div>",d,e,f,a.Ext.attach_online_modify?g:"",a.Ext.netfolder_enable?h:"",i,j,k,l,"</div>",'<div class="dw1 bI1"></div>','</div><div class="dj0"><div class="dw1 bR1"></div>','<div class="dw1 bC2"></div>','<div class="dw1 bI1"></div>',"</div></div></td></tr></tbody></table></li>"].join("")}function o(b){function c(b){for(var c=[],d=0;d<b.length;d++){var e,f=b[d].split(":"),g=f[f.length>1?1:0],h=a.Uri.getEmails(g,"Email",!0),i=h.match;if(i&&i.length>0)e=i[0],e.force=!0,e.name=a.AddressSupport.getName(e);else{var j=g.split("@");e={name:j[0],address:g}}c.push(e)}for(var k=100,d=0;d<c.length;d++){var l=c[d];k-=l.name.length,c[d]='<span class="'+(0>k?"_ics_item_trigger":"")+'">'+(d?fb.t("、"):"")+a.String.escapeHTML(l.name)+"<i>"+a.String.escapeHTML(l.address)+"</i></span>"}return 0>k&&c.push(a.Link.html({text:"↑ "+fb.t("收起"),extcls:"_ics_item_trigger_up",click:function(b){a(b.target).findParent("dd").removeClass("_ics_item_trigger_show")}})+a.Link.html({text:"↓ "+fb.t("展开"),extcls:"_ics_item_trigger_down",click:function(b){a(b.target).findParent("dd").addClass("_ics_item_trigger_show")}})),c.join("")}function d(a){var b=1===a?"fW3":"hH3";return'<div class="sq1 mh2 '+b+'">'+fb.t("您已")+(1===a?fb.t("接受"):fb.t("拒绝"))+fb.t("本次会议邀请")+"</div>"}for(var e=this,f=e.reader,g=[],h=0;h<b.length;h++){var i,j,k=b[h],l=new Date(k.startTime),m=new Date(k.endTime),n=new Date,o=+k.allday,p=a.Date.format(l,"yyMd")===a.Date.format(m,"yyMd"),q=k.startTime===k.endTime;if(o){var r=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime();i=r>k.endTime,j=a.Date.format(l,fb.t("yyyy-MM-dd 周w"))+(q?"":"～"+a.Date.format(m,p?"":fb.t("yyyy-MM-dd 周w")))}else i=+n>k.endTime,j=a.Date.format(l,fb.t("yyyy-MM-dd 周w HH:mm"))+(q?"":"～"+a.Date.format(m,p?"HH:mm":fb.t("yyyy-MM-dd 周w HH:mm")));var s="",t="",u="",v="",w=k.extended||{};switch(a.Ext.ics2schedule||(w={}),w.type){case"organizer":var x=w.data;s='<div class="kZ2">'+x.acceptNum+fb.t("人接受")+"&nbsp;&nbsp;"+x.refuseNum+fb.t("人谢绝")+"&nbsp;&nbsp;"+x.pendingNum+fb.t("人暂定")+"&nbsp;&nbsp;"+x.noResponseNum+fb.t("人未操作")+'&nbsp;&nbsp;<div class="mK1"><b class="js-component-icon nui-ico nui-ico-help"></b><div class="js-component-layer nui-layer nui-layer-hasArr"><b class="nui-layer-arr"></b><div class="nui-layer-normal">'+fb.t("若收件人包含邮件列表，由于无法识别邮件列表是否操作，则邮件列表会被当做1个未操作人。")+"</div></div></div></div>",x.acceptList&&x.acceptList.length&&(t+='<dl class="mj1 mh2 fW3"><dt>'+fb.t("接受者:")+"</dt><dd>"+c(x.acceptList)+"</dd></dl>"),x.refuseList&&x.refuseList.length&&(t+='<dl class="mj1 mh2 hH3"><dt>'+fb.t("谢绝者:")+"</dt><dd>"+c(x.refuseList)+"</dd></dl>"),x.pendingList&&x.pendingList.length&&(t+='<dl class="mj1 mh2 hI1"><dt>'+fb.t("暂定者:")+"</dt><dd>"+c(x.pendingList)+"</dd></dl>");break;case"attendee":var x=w.data;switch(x.status){case 0:var y="icsOperate_"+ +new Date;v='<div class="sk2" id="'+y+'">'+a.Button.html({text:fb.t("接受"),subclass:"mainBtn",click:function(){try{var b=$L("product.Schedule",this)}catch(c){return c}b.replyAttendee({sReply:"accept",oIcs:k},function(b){return"reload"===b?(f.attach.showIcsAttach(),void 0):(a("#"+y).replace(d(1)),void 0)})}})+a.Button.html({text:fb.t("拒绝"),click:function(){try{var b=$L("product.Schedule",this)}catch(c){return c}b.replyAttendee({sReply:"reject",oIcs:k},function(b){return"reload"===b?(f.attach.showIcsAttach(),void 0):(a("#"+y).replace(d(2)),void 0)})}})+"</div>";break;case 1:case 2:u=d(x.status)}break;default:"PUBLISH"!==k.method&&(t='<dl class="mj1 mh2 hI1"><dt>'+fb.t("暂定者:")+"</dt><dd>"+c(k.attendList)+"</dd></dl>")}var z="";i&&(z='<div class="qK1">'+fb.t("日程已过期")+"</div>",v=""),"CANCEL"===k.method&&(z='<div class="qK1">'+fb.t("日程已取消")+"</div>",v="");var A=[];z&&A.push("mn1"),(u||v)&&A.push("qI1");var B=['<div class="wI0 '+A.join(" ")+'"'+(w.type?' data-ics="'+w.type+'"':"")+">",'<div class="wJ2">','<div class="wK2"><b>'+a.Date.format(l,fb.t("M月"))+"</b><strong>"+a.Date.format(l,"d")+"</strong><span>"+a.Date.format(l,fb.t("周w"))+"</span></div>","</div>",'<div class="vj1">',"<h4>"+a.String.escapeHTML(k.summary)+"</h4>",'<div class="ua1">','<div class="mo1 mh2 hK1">'+j+"</div>",k.location?'<div class="mo1 mh2 gX1">'+a.String.escapeHTML(k.location)+"</div>":"",s,t,"</div>",z,u,v,"</div>","</div>"];g.push(B.join(""))}return g.join("")}function p(){var d=this,e=d.reader,f=fb.t("快捷回复"),g=f+fb.t("（按Ctrl+Enter键发送）"),h={renderTo:e.createId("dvReplyBts"),id:e.createId("sendBt"),text:fb.t("&nbsp;&nbsp;发&nbsp;送&nbsp;&nbsp;"),subclass:"mainBtn",click:function l(){e.log({action:"send",item:"body_reply"});var b=$C(e.createId("replyInput")),c=$C(e.createId("replyTip")),d=$C(e.createId("replyRetryLink")),f=$C(e.createId("sendBt")),g=$C(e.createId("cancelBt")),h=a.String.trim(b.getValue());return 0===h.length?(a.Msgbox.show({header:fb.t("系统提示"),content:fb.t("回复内容为空，请重新输入后重试。"),ok:function(){b.focus()}}),void 0):($C(e.createId("sendBt")).update({text:fb.t("发送中"),icon:"loading",click:function(){}}),g.setDisabled(),e.assistant.reply({type:"simple",content:h,call:function(b){var h,i=e.getDom("dvReplyBts"),j=e.getDom("spanReplyNbsp"),k={renderTo:i,text:fb.t("再回一封邮件"),cls:"lc0 nui-txt-link",click:function(){this.hide(),c.hide(),f.update({text:fb.t("&nbsp;&nbsp;发&nbsp;送&nbsp;&nbsp;"),icon:null,click:l}),f.show(),g.setDisabled(!1),g.show(),j.style.display="",$C(e.createId("replyInput")).setValue(""),e.getDom("dvReplyInputs").style.display="",e.getDom("fullReplyLink").style.display=""}};j.style.display="none",b?(h={text:fb.t("邮件发送成功！"),type:"suc",tabindex:"0",hidefocus:"hidefocus"},e.getDom("dvReplyInputs").style.display="none"):(h={text:fb.t("抱歉，邮件发送失败"),type:"err",tabindex:"0",hidefocus:"hidefocus"},k.text=fb.t("立即重试"),k.click=function(){$C(e.createId("sendBt")).fire("click")}),f.hide(),g.hide(),e.getDom("fullReplyLink").style.display="none",c?(c.update(h),c.show(),c.getEl().dom.focus()):(h.renderTo=i,h.id=e.createId("replyTip"),h.subclass="normalTips",c=new a.Label(h),c.getEl().dom.focus()),d?(d.unlistenAll(),d.update(k),d.listen("click",k.click),d.show()):(k.id=e.createId("replyRetryLink"),d=new a.Link(k))}}),void 0)}},i={renderTo:e.createId("dvReplyBts"),id:e.createId("cancelBt"),text:fb.t("&nbsp;&nbsp;取&nbsp;消&nbsp;&nbsp;"),click:function(){e.log({action:"cancel",item:"body_reply"});var a=$C(e.createId("replyInput"));a.setValue(""),a.getInputEl().attr("style",""),a.getEl().removeClass("fK0"),e.getDom("dvReplyBts").style.display="none",e.getDom("dvAttach_reply").parentNode.style.height="auto",a.showPlaceholder(),d.replyUnfold=!1,a=c}},j={text:fb.t("完整模式回复"),cls:"nui-txt-link",click:function(){e.log({action:"click",item:"body_fullreply"}),e.assistant.fullReply({type:"fragment",content:a.String.trim($C(e.createId("replyInput")).getValue())})}},k={id:e.createId("replyInput"),subclass:"multiLineIpt",extcls:"nf0",placeholder:f,ariaLabel:g,title:g,focus:function(){if(!d.replyUnfold){var f=this;e.getDom("dvReplyBts").style.display="";try{e.getDom("fullReplyLink").style.display=""}catch(g){}if(!e.isThread){var k=e.getDom("dvAttach_reply").parentNode;k.style.height=k.offsetHeight+116+"px",e.getDom("ScrollDiv").scrollTop+=161,k=c}b.setTimeout(function(){f.getEl().addClass("fK0")},150);var l=$C(e.createId("sendBt")),m=$C(e.createId("cancelBt"));l?(l.show(),m.show()):(new a.Button(h),a.fly(e.getDom("dvReplyBts")).append('<span id="'+e.createId("spanReplyNbsp")+'">&nbsp;&nbsp;<span>'),new a.Button(i),a.fly(e.getDom("dvReplyBts")).append(['<div id="'+e.createId("fullReplyLink")+'" class="le0">','<div class="hl0">',a.Link.html(j),"</div>","</div>"].join(""))),f.hidePlaceholder(),d.replyUnfold=!0,e.log({action:"active",item:"body_reply"})}},enter:function(){var b,c=a.Event.getEvent();c&&c.ctrlKey&&(b=$C(e.createId("sendBt")),b&&b.fire("click"))},keyup:function(){var a=this.getInputEl().dom,b=a.scrollHeight,c=a.offsetHeight;if(b>c)if(400>=b){a.style.overflow="hidden",a.style.height=b+"px";var d=e.getDom("ScrollDiv");d.scrollTop+=b}else a.style.overflow="auto"}};return['<div id="'+e.createId("dvReplyInputs")+'" class="qB0">',a.Input.html(k),"</div>",'<div id="'+e.createId("dvReplyBts")+'" class="qG0" style="display:none"></div>'].join("")}function q(){var b=this,c=b.reader,d="roundBtn",e="-1",f=a.Button;return['<div id="'+c.createId("dvReadZoom")+'" class="sF0">','<div id="'+c.createId("backToTop")+'" class="qc0 qM0" style="display:none;">',f.html({subclass:d,icon:{type:"backToTop"},extcls:"oI0",title:fb.t("返回顶部"),tabindex:e,click:function(){c.log({action:"click",item:"backtotop"}),c.getDom("ScrollDiv").scrollTop=0,this.getEl().dom.parentNode.style.display="none",c.log({action:"click",item:"body_top"})}}),"</div>",'<div id="'+c.createId("showZoomBt")+'" class="qc0 me0">',f.html({subclass:d,icon:{type:"zoomIn"},extcls:"nw0",title:fb.t("展开缩放工具"),tabindex:e,click:function(){c.getDom("showZoomBt").style.display="none",c.getDom("zoomBts").style.display="",c.log({action:"click",item:"body_zoom",value:0})}}),"</div>",'<div id="'+c.createId("zoomBts")+'" class="qc0 nv0" style="display:none;">',f.html({subclass:d,icon:{type:"bigPlus"},extcls:"ke0",title:fb.t("放大显示正文文字"),tabindex:e,click:function(){c.body.zoom("I"),c.log({action:"click",item:"body_zoom"})}}),f.html({subclass:d,icon:{type:"original"},extcls:"mM0",title:fb.t("还原显示正文文字"),tabindex:e,click:function(){c.body.zoom("R"),c.log({action:"click",item:"body_zoom"})}}),f.html({subclass:d,icon:{type:"bigMinus"},extcls:"jA0",title:fb.t("缩小显示正文文字"),tabindex:e,click:function(){c.body.zoom("O"),c.log({action:"click",item:"body_zoom"})}}),f.html({subclass:d,icon:{type:"bigClose"},extcls:"mN0",title:fb.t("隐藏缩放工具"),tabindex:e,click:function(){c.getDom("showZoomBt").style.display="",c.getDom("zoomBts").style.display="none"}}),"</div>","</div>"].join("")}function r(){var b=$,c=this,d=c.reader,e=d.folderData,f=e.subject||fb.t("无主题"),g=d.createId("h1Subject"),h=e.label0?" nui-txt-flag"+e.label0:"",i="archive"!==d.area;f=a.String.escapeHTML(f);try{f=b.fix(f)}catch(j){}var k,l='<h1 id="'+g+'" class="nui-fIBlock py0'+h+'" role="listitem" tabindex="0" title="'+fb.t("邮件标题")+'" aria-level="1">'+f+"</h1>",m="";return d.part?k=c.getSubjectHrefHtml("print"):(a.Ext.tag&&!d.isThread&&i&&(l+='<div id="'+d.createId("divTag")+'" class="nui-fIBlock lF0"></div>',m=c.getSubjectHrefHtml("tag")),k=[c.getSubjectHrefHtml("flag"),i?c.getSubjectHrefHtml("defer"):"",c.getSubjectHrefHtml("print")].join("")),['<div class="rB0">',l,'<div class="nui-fIBlock oB0" role="toolbar">',m,k,"</div>","</div>"].join("")}function s(){return['<li class="ig0 eu0">','<div class="iI0">'+fb.t("时&nbsp;&nbsp;&nbsp;间：")+"</div>",'<div class="hX0">'+this.getDateStr()+"</div>","</li>"].join("")}function t(){var c,d,e=this,f=e.reader,g=f.folderData,h=g.from,i=f.data.headers,j=i["Resent-From"],k=i.Sender,l="";if(!h)return f.from=[fb.t("发件人")],f.localSender=[],['<li class="ig0 ew0">','<div class="iI0">'+fb.t("发件人：")+"</div>",'<div class="hX0">'+fb.t("（无）")+"</div>","</li>"].join("");if(h=(h instanceof b.Array?h[0]:h).toString().replace(/^"[+|-]/,'"'),f.from=[h],c=f.module.view.getContactConf(h),d=c.email,f.localSender=[d],j instanceof b.Array&&j.length>0)l=fb.t("由 ")+a.String.escapeHTML(j.join(","))+fb.t(" 转发");else{var m=g.ctrls&&"ntessale"===g.ctrls.RulesType||f.data.antispamInfo&&"ntessale"===f.data.antispamInfo.RulesType;if(!m&&k instanceof b.Array&&k.length>0&&h.length>0){var n=k[0];d.address!==a.Uri.getAddress(n)&&(l=fb.t("由 ")+a.String.encodeHTML(n)+fb.t(" 代发&nbsp;,&nbsp;")+a.Link.html({link:"sender_help",text:fb.t("帮助"),target:"_blank",cls:"txt-info"}))}}return l.length>0&&(l='<span class="cP0">('+l+")</span>"),['<li class="ig0 ew0">','<div class="iI0">'+fb.t("发件人：")+"</div>",'<div class="hX0">',a.Addr.html(c),l,"</div>","</li>"].join("")}function u(){var b=this,c=b.reader,d=c.data,e=c.folderData,f=c.fid,g=[],h={to:fb.t("收件人"),cc:fb.t("抄送人")};3===f&&(h.bcc=fb.t("密送人"),e.composeExtra&&e.composeExtra.showOneRcpt&&(h.to=fb.t("群发单显")));var i=c.localReceiver=[];return a.Object.each(h,function(b,e){var f=[],h="",j=d[b]||[];if(0!==j.length||"to"===b){j="string"==typeof j?[j]:j;var k=j.length;k>0&&(c[b]=j);for(var l=0;k>l;l+=1){var m=c.module.view.getContactConf(j[l]);l>4&&(m.hidden=!0),f.push(a.Addr.html(m)),i.push(m.email)}if(l>0&&"bcc"===b&&f.push('<span id="_mail_label_0_439" class="js-component-label nui-txt nui-txt-info  ">'+fb.t("(密送人仅在已发送文件夹显示，对发件人可见。)")+"</span>"),l>5){var n="nui-txt-link",o="dt0";h=[a.Link.html({id:c.createId("addrMoreLink"+b),text:fb.t("&darr;还有")+(k-5)+fb.t("个联系人"),cls:n,spancls:o,click:function(){var d=a.fly(c.getDom("dvRead"+b)).find(".nui-addr").doms;this.hide(),$C(c.createId("addrLessLink"+b)).show();for(var e=5;k>e;e+=1)d[e].style.display=""}}),a.Link.html({id:c.createId("addrLessLink"+b),text:fb.t("&uarr;隐藏信息"),cls:n,spancls:o,hidden:!0,click:function(){var d=a.fly(c.getDom("dvRead"+b)).find(".nui-addr").doms;this.hide(),$C(c.createId("addrMoreLink"+b)).show();for(var e=5;k>e;e+=1)d[e].style.display="none"}}),a.Link.html({text:fb.t("保存所有")+e,cls:n,spancls:o,click:function(){c.assistant.saveContacts(b)}})].join("")}g.push(['<li id="'+c.createId("liReadOut"+b)+'" class="ig0 fD0">','<div class="iI0">',e,fb.t("：")+"</div>",'<div id="'+c.createId("dvRead"+b)+'" class="hX0">',f.join("")||fb.t("（无）"),h,"</div>","</li>"].join(""))}}),g.join("")}function v(a){var b=this,c=b.reader;return c.attached||"fullSaveId"in c.folderData?(a?['<div id="'+c.createId("attachInfo_compact")+'" class="cF1">','<b class="nui-ico nui-ico-att"></b>&nbsp;',b.getAttachInfoHtml(a),"</div>"]:['<li class="ig0 fw0">','<div class="iI0">'+fb.t("附&nbsp;&nbsp;&nbsp;件：")+"</div>",'<div id="'+c.createId("attachInfo_full")+'" class="hX0">',b.getAttachInfoHtml(a),"</div>","</li>"]).join(""):""}function w(b){var c=this,d=c.reader,e=d.cloudAttachments;if(d.cloudAttached&&!e&&!d.commonAttached&&!d.isDecrypted)return"";var f,g=d.folderData,h=(d.data.attachments||[]).concat(e||[]),i=h.length,j="";if(f=i,f>0){if(b)j=a.Link.html({text:(f?f+fb.t("个"):"")+fb.t("附件"),title:fb.t("点击查看附件"),cls:"nui-txt-link",click:function(){d.log({action:"click",item:"head_attach"}),d.attach.skipToList()}});else{var k="",l=fb.t("未命名附件"),m="",n=0;for((i>1||d.commonAttached&&d.cloudAttached)&&(k=fb.t("等"));i>n;){if(l=a.String.trim(h[n].filename||""),l.length>0){l=l.split(String.fromCharCode(92)).pop();break}n+=1}var o=a.String.left(a.String.escapeHTML(l),50);m=fb.t("共有")+o+k+f+fb.t("个附件，点击查看"),j=['<span class="nui-txt-normal">'+f+fb.t("个 ")+(g.fullSaveId?fb.t("超大附件"):"")+"</span>",'<span class="txt-info">',"(<span>",a.Icon.html({type:"file",subtype:eb.getSubtype({type:"file",name:l})}),o,"</span> ",k,")</span>","<span> ",a.Link.html({text:fb.t("查看附件"),title:m,cls:"nui-txt-link",click:function(){d.log({action:"click",item:"head_attach"}),d.attach.skipToList()}}),"</span>"].join("")}j=["<span >","</span>"].join(j)}return 3===g.fid&&"fullSaveId"in g&&(j+=c.getUnSavedInfo(b)),j}function x(){var a=this,b=a.reader,c=a.getBacklogHtml(),d=a.getMemoTextHtml(),e=c.length&&d.length?'<div class="dr0"></div>':"";return['<li id="'+b.createId("memo")+'" class="gS0 nui-assistBlock"'+(c.length||d.length?"":' style="display:none"')+">",'<div id="'+b.createId("backlog")+'"'+(c.length?"":' style="display:none"')+">",c,"</div>",e,'<div id="'+b.createId("memoText")+'" class="dJ0"'+(d.length?"":' style="display:none"')+">",d,"</div>",'<div id="'+b.createId("memoEditor")+'" class="dJ0" style="display:none"></div>',"</li>"].join("")}function y(){var b,d,e,f=this,g=f.reader,h=[],i=g.mid,j=g.folderData,k=j.flags||{},l=j.defer;return k.deferHandle&&l!==c?(d=$S("schedule"),e=a.Ext.scheduleMbox&&d!==c&&d[i],b=['<div id="'+g.createId("backlog_defer")+'" class="dJ0">','<div class="cm0"><b class="nui-ico nui-ico-todo nui-ico-todo-selected" title="'+fb.t("待办邮件")+'"></b></div>','<div class="bZ0">','<div class="er1">'+fb.t("已设为待办邮件，")+a.Date.format(l,fb.t("yyyy年MM月dd日"))+fb.t("处理&nbsp;"),a.Link.html({text:fb.t("修改"),cls:"nui-txt-link",click:function(){g.module.showDeferPanel({type:"modify"})}}),e||!a.Ext.scheduleRead?"":a.Link.html({text:fb.t("短信提醒我处理"),cls:"nui-txt-link",click:function(){g.module.showDeferPanel({type:"modify",smsShow:!0})}}),"</div>",'<div class="ce0">',a.Button.html({text:fb.t("设为完成"),subclass:"smallMainBtn",icon:{type:"done",subtype:"white"},subType:"white",click:function(){g.module.setDefer()}}),"</div>","</div>","</div>"],e&&(h=['<div class="dr0"></div>','<div id="'+g.createId("backlog_mag")+'" class="dJ0">','<div class="cm0"><b class="nui-ico nui-ico-smsRemind"></b></div>','<div class="bZ0">','<div class="er1">'+fb.t("已设置短信提醒&nbsp;"),$G.environment.isCh?a.Link.html({text:fb.t("修改"),cls:"nui-txt-link",click:function(){try{var a=$L("product.Schedule",this)}catch(b){return b}a.edit(g.mid)}}):"","</div>","</div>","</div>"]),b.join("")+h.join("")):""}function z(b){var c=this,d=c.reader;return b=a.String.trim(b||d.folderData.memo||""),b.length>0?['<div class="cm0"><b class="nui-ico nui-ico-remark-xs" title="'+fb.t("邮件备注")+'"></b></div>','<div class="bZ0">','<div class="er1">',a.String.escapeHTML(b),"</div>",'<div class="dI0">',a.Link.html({text:fb.t("编辑"),cls:"nui-txt-link",click:function(){d.assistant.editMemo()}}),"&nbsp;&nbsp;",a.Link.html({text:fb.t("删除"),cls:"nui-txt-link",click:function(){a.Msgbox.show({type:"confirm",title:fb.t("删除确认"),content:fb.t("您确定要删除该邮件的备注吗？"),ok:function(){d.assistant.setMemo({del:!0,value:""}),d.getDom("memo").style.display="none"}})}}),"</div>","</div>"].join(""):b}function A(){var b=this,c=b.reader;return[a.Input.html({id:c.createId("memoInput"),subclass:"multiLineIpt",extcls:"bV0",inputClass:"K0",value:a.String.trim(c.folderData.memo||""),listeners:{keyup:function(){var b=a.String.trim(this.getValue()),d=b.length;c.getDom("memoInfo").innerHTML=d>100?fb.t("您已输入 ")+"<strong>"+d+"</strong>"+fb.t(" 字，")+'<span class="nui-txt-err">'+fb.t("请删除 ")+"<strong>"+(d-100)+"</strong>"+fb.t(" 字")+"</span>":fb.t("您已输入 ")+"<strong>"+d+"</strong>"+fb.t(" 字，还能输入 ")+"<strong>"+(100-d)+"</strong>"+fb.t(" 字")}}}),'<div class="cd1">',a.Button.html({text:fb.t("确定"),subclass:"mainBtn",extcls:"bt0",click:function(){var b=a.String.trim($C(c.createId("memoInput")).getValue()),d=b.length;return 0===d||d>100?(a.Msgbox.show({header:fb.t("系统提示"),content:0===d?fb.t("请输入备注内容后重试。"):fb.t("您输入的文字多于")+"<strong>100</strong>"+fb.t("个字符，请删除")+"<strong>"+(d-100)+"</strong>"+fb.t("个字符后重试。"),ok:function(){$C(c.createId("memoInput")).focus()}}),void 0):b===c.folderData.memo?(c.assistant.editMemo(!0),void 0):(c.assistant.setMemo({type:"edit",value:b}),c.folderData.memo=b,c.assistant.editMemo(!0),void 0)}}),"&nbsp;&nbsp;",a.Button.html({text:fb.t("取消"),extcls:"bt0",click:function(){c.assistant.editMemo(!0)}}),'<span id="'+c.createId("memoInfo")+'" class="bv0"></span>',"</div>"].join("")}function B(b){var c=this,d=c.reader;if(b)return[a.Icon.html({type:"glasses"}),a.Link.html({cls:"nui-txt-link",text:fb.t("优化阅读"),click:function(){try{a.fly("#dvOptimizedContent").remove(),a.fly("#read_mask").remove()}catch(b){}d.body.showOptimizedContent()}}),'&nbsp;<span style="color:#E5E5E5">|<span>&nbsp;'].join("");
var e=a.Ud.get({field:"ntes_letter",flag:"read_head"}),f=d.isThread||"1"===e,g=[a.Link.html({id:d.createId("compactLink"),cls:"nui-txt-link",title:fb.t("点击使用精简显示模式"),text:fb.t("精简信息")+'<b class="nui-ico jS0">k</b>',hidden:f,click:function(){if(d.log({action:"click",item:"head_compact"}),d.showHeader(!0),this.hide(),$C(d.createId("fullLink")).show(),!d.isThread){try{var b=$L("support.OptionSupport",this)}catch(c){return c}b.setAttr({field:"ntes_letter",flag:"read_head",value:1,module:"read"})}a.Component.setEvents(50)}}),a.Link.html({id:d.createId("fullLink"),cls:"nui-txt-link",title:fb.t("点击使用完整显示模式"),text:fb.t("完整信息")+'<b class="nui-ico jS0">j</b>',hidden:!f,click:function(){if(d.log({action:"click",item:"head_compelete"}),d.showHeader(!1),this.hide(),$C(d.createId("compactLink")).show(),!d.isThread){try{var b=$L("support.OptionSupport",this)}catch(c){return c}b.setAttr({field:"ntes_letter",flag:"read_head",value:0,module:"read"})}a.Component.setEvents(50)}})].join("");return g}function C(b,d){var e,f=this,g=f.reader,h=g.folderData,i=g.createId(b+"HeadBt"),j="noBg",k="miniBtn",l="",m={mouseover:{handler:function(){a.fly(this).find("b").removeClass(l)}},mouseout:{handler:function(){a.fly(this).find("b").addClass(l)}}};switch(b){case"flag":var n,o=h.label0;n=o?{type:"flag",subtype:o+""}:{type:"flags",subtype:"transparent"},e={title:fb.t("设为红旗"),subclass:k,type:j,icon:n},m.click=function(){g.log({action:"click",item:"icon_flag"}),g.assistant.setFlag(-1)};break;case"defer":var p;(h.flags||{}).deferHandle&&h.defer?(p="todo-selected",l="nui-ico-todo-selected-transparent",m.render=function(){var b=this.getEl(),d=38,e=b.offset().x-201;382-d-20>e&&(d=0);try{var f=$L("support.Defer",this)}catch(i){return i}var j,k=f.getMenu({data:h,left:d,top:10,complete:function(){g.module.setDefer()},modify:function(){g.module.showDeferPanel({type:"modify"})},modifySms:function(){g.module.showDeferPanel({type:"modify",smsShow:!0})},modifyMemo:function(){g.module.showDeferPanel({type:"modify",memoShow:!0})},"delete":function(){g.assistant.setMemo({del:!0,value:""})}});0===d&&(k.listeners={render:function(){a.fly(j.getEl().find(".nui-layer-arr").doms[0]).css({left:e+"px",right:"auto"})}}),j=new a.Menu(k),j.attachTo({clickFrom:b}),b=c},m.click=function(){g.log({action:"click",item:"icon_defer"})}):(p="todo",l="nui-ico-todo-transparent",m.click=function(){g.log({action:"click",item:"icon_defer"});try{var a=$L("support.Defer",this)}catch(b){return b}a.showMsgbox({type:"modify",data:{defer:h.defer,memo:h.memo,mid:g.mid},callback:function(a){g.module.setDefer(!0,{type:"modify",defer:a.defer,memo:a.memo,smsDate:a.smsDate,data:h})}})}),e={title:fb.t("待办邮件"),subclass:k,type:j,icon:{type:p,subtype:"transparent"}};break;case"print":e={title:fb.t("打印"),subclass:k,type:j,icon:{type:"print",subtype:"transparent"}},l="nui-ico-print-transparent",m.click=function(){g.log({action:"click",item:"icon_print"}),g.assistant.blankView(!0)};break;case"tag":e={title:fb.t("邮件标签"),subclass:k,type:j,icon:{type:"tags",subtype:"transparent"}},l="nui-ico-tags-transparent",m.click=function(){g.log({action:"click",item:"icon_tag"})},m.render=function(){var b=g.module.view.getTagConf("icon");b.id=g.createId("subjectTagMenu"),b.reverse=!1,new a.Menu(b).attachTo({clickFrom:this.getEl()})}}return e.id=i,e.listeners=m,d?e:a.Button.html(e)}function D(b,d){var e,f=this,g=f.reader,h=g.createId(b),i="sV0",j="assistBlock",k="nui-txt-link";switch(b){case"mailStatus":e={icon:d.icon,content:['<div class="qu0">','<p  class="nui-txt-normal">',d.msg,a.Link.html({id:g.createId("readCheckStatus"),text:fb.t("查看详情"),cls:k,click:function(){var a=this,b=$C(g.createId("mailTable")),d=b===c;g.assistant.queryMailStatus("mail",h,d,function(){d||b.show(),a.hide(),$C(g.createId("readHideStatus")).show(),$C(g.createId("readRefreshStatus")).show()})}}),a.Link.html({id:g.createId("readHideStatus"),text:fb.t("隐藏详情"),cls:k,hidden:!0,click:function(){$C(g.createId("mailTable")).hide(),this.hide(),$C(g.createId("readRefreshStatus")).hide(),$C(g.createId("readCheckStatus")).show()}}),a.Link.html({id:g.createId("readRefreshStatus"),text:fb.t("刷新"),cls:k,hidden:!0,click:function(){$C(g.createId("mailTable")).destroy(),g.assistant.queryMailStatus("mail",h,!0)}}),"</p>","</div>"].join("")};break;case"sendStatus":var l,m=["","nui-txt-suc","nui-txt-err","nui-txt-impt"];if(d.info.ext&&(l=d.info.ext.type),l===c)return l;e={extcls:i+" qh0",icon:l+"State",content:['<div class="qu0">',"<p>",("recall"===l?fb.t("撤回状态"):fb.t("发送状态"))+fb.t("：")+'<strong id="'+g.createId("sendStatusText")+'" class="'+m[d.info.ext.status]+'">'+d.info[1]+"</strong>",a.Link.html({id:g.createId("readCheckStatus"),text:fb.t("查看详情"),cls:k,click:function(){var a=this,b=$C(g.createId(l+"Table")),d=b===c;g.assistant.queryMailStatus(l,h,d,function(){d||b.show(),a.hide(),$C(g.createId("readHideStatus")).show(),$C(g.createId("readRefreshStatus")).show()})}}),a.Link.html({id:g.createId("readHideStatus"),text:fb.t("隐藏详情"),cls:k,hidden:!0,click:function(){$C(g.createId(l+"Table")).hide(),this.hide(),$C(g.createId("readRefreshStatus")).hide(),$C(g.createId("readCheckStatus")).show()}}),a.Link.html({id:g.createId("readRefreshStatus"),text:fb.t("刷新"),cls:k,hidden:!0,click:function(){$C(g.createId(l+"Table")).destroy(),g.assistant.queryMailStatus(l,h,!0)}}),"</p>","</div>"].join("")};break;case"subscribe":e={content:['<div class="qu0">','<p id="'+g.createId(b)+'" class="nui-txt-normal">',fb.t("如果这封邮件不是您订阅的，请 "),a.Link.html({text:fb.t("举报"),cls:k,click:function(){g.module.report(!0)}}),fb.t("；如果是分类错误的邮件，可以 "),a.Link.html({text:fb.t("添加到白名单"),cls:k,click:function(){var d=g.localSender[0];if(d===c)return a.Tips.show({type:"err",text:fb.t("发件人地址错误")}),void 0;try{var e=$L("support.OptionSupport",this)}catch(f){return f}e.addList({name:"safelist",value:d.address},function(a){a&&(g.getDom(b).innerHTML='<span class="nui-txt-suc">'+fb.t("发件人已被加入白名单，该发件人今后发送的邮件将会进入收件箱")+"</span>")})}}),"</p>","</div>"].join("")};break;case"spamFolder":e={icon:"alert",params:"hasClose",content:['<div class="qu0">','<p class="nui-txt-normal">','<span class="nui-txt-impt">'+fb.t("请留意：此邮件在垃圾文件夹，如有提示您填写邮箱信息、中奖需汇款转账等信息，请谨防网络欺诈！")+"</span>",a.Link.html({text:fb.t("查看详情"),target:"_blank",noParam:!0,link:"read_yjzp"}),"</p>","</div>"].join("")};break;case"junkPic":e={params:"hasClose",icon:"alert",content:['<div class="qu0">','<p class="nui-txt-impt">',fb.t("该邮件中包含了图片，"),a.Link.html({text:fb.t("点击这里显示图片"),cls:k,click:function(){g.junkPic=!1,g.assistant.bodyFilter("mail"),$C(h).destroy()}}),"</p>","</div>"].join("")};break;case"EAI":e={params:"hasClose",icon:"alert",content:['<div class="qu0">','<p class="nui-txt-normal">',fb.t("提示内容：发件人是一个国际化电子邮件地址（EAI），解码前为 "),d.EAI,fb.t("，请谨慎辨别"),"</p>","</div>"].join("")};break;case"decryptForm":e={icon:"encrypt32",extcls:i+" no0",content:['<div class="qu0">','<p class="nui-txt-normal">'+fb.t("这是一封由 ")+'<strong class="nui-txt-suc">'+a.String.escapeHTML(g.localSender[0].defaultName)+"</strong>"+fb.t(" 从网易邮箱发出的加密邮件。"),a.Link.html({link:"read_decrypt_help",title:fb.t("查看使用说明"),text:fb.t("查看网易邮箱加密邮件的使用说明"),target:"_blank"}),"</p>",'<p class="nui-txt-normal">'+fb.t("输入发件人提供给您的密码，即可查阅完整邮件")+'<span class="nui-txt-tips">'+fb.t("(您可以通过电话、短信或其他方式向发件人索取密码)")+"</span></p>",'<div class="iG0 nui-txt-normal">'+fb.t("输入密码："),a.Input.html({id:g.createId("decryptInput"),inputType:"password",placeholder:fb.t("在此输入密码"),maxLength:6,listeners:{enter:function(){var b=this;b.fire("keydown"),g.decryption.decrypt({pwd:this.getValue(),call:function(d){return d.error!==c?(b.errorTips=new a.Tips({text:d.error,subclass:"normalTips",type:"err",renderTo:b.getEl().dom.parentNode}),void 0):($C(g.createId("decryptForm")).destroy(),g.addBlockInfo("decryptResult"),void 0)}})},keydown:function(){this.errorTips!==c&&this.errorTips.destroy()}}}),a.Button.html({text:fb.t("确定"),title:fb.t("提交密码进行解密"),subclass:"inputBtn",click:function(){$C(g.createId("decryptInput")).fire("enter")}}),"&nbsp;","</div>","</div>"].join("")};break;case"decryptSuc":e={params:"hasClose",icon:"decrypt32",content:['<div class="qu0">','<p class="nui-txt-suc">'+fb.t("邮件已解密，以下是解密后的邮件内容：")+"</p>","</div>"].join("")};break;case"decryptPwd":e={params:"hasClose",extcls:i+" no0 nr0",icon:"encrypt",content:'<div class="qu0"><span class="nui-txt-normal">'+fb.t("加密邮件的密码为：")+a.String.escapeHTML(d.pwd)+"</span></div>"};break;case"systemWarn":e={params:"hasClose",icon:"alert",content:['<div class="qu0">','<p class="nui-txt-impt">',fb.t("请注意：此邮件有可能存在仿冒，请不要轻易透露个人重要信息，提高警惕，谨防网络诈骗！"),a.Link.html({text:fb.t("查看详情"),link:"read_yjzp",target:"_blank"}),"</p>","</div>"].join("")};break;case"DAWarn":e={params:"hasClose",icon:"alert",content:['<div class="qu0">','<p class="nui-txt-impt">',fb.t("提示：该邮件可能是诈骗邮件或钓鱼邮件！请仔细检查发件人和邮件内容，不要轻易泄露帐号密码等安全信息，请谨慎识别，万勿轻信。"),a.Link.html({text:fb.t("立即举报"),cls:"nui-txt-link nui-txt-link-impt",click:function(){g.module.report(!0)}}),"</p>","</div>"].join("")};break;case"attachWrong":e={params:"hasClose",icon:"alert",content:['<div class="qu0">','<p class="nui-txt-impt">'+fb.t("该邮件的附件格式不正确")+"</p>","</div>"].join("")};break;case"transCheck":e={icon:"translate",params:"hasClose",content:['<div class="qu0">','<p class="nui-txt-impt">',a.Link.html({text:fb.t("翻译成中文"),cls:"nui-txt-link",click:function(){g.translate({type:1})}}),"</p>","</div>"].join("")};break;case"transLoading":e={icon:"loading",content:fb.t("正在翻译，请稍候...")};break;case"transMenu":e={icon:"translate",content:['<div class="qu0">',"<p>",a.Link.html({id:g.createId("tansOriginalLink"),cls:k,text:fb.t("只显示原文"),click:function(){g.translator.switchContent(0)}}),'<span class="oH0 nui-txt-aside">|</span>',a.Link.html({id:g.createId("tansTranslationLink"),cls:k,text:fb.t("只显示译文"),click:function(){g.translator.switchContent(1)}}),'<span class="oH0 nui-txt-aside">|</span>',a.Link.html({id:g.createId("tansComparisonLink"),cls:k,text:fb.t("对照显示"),disabled:!0,click:function(){g.translator.switchContent(2)}}),a.Ext.human_trans?['<span class="oH0 nui-txt-aside">|</span>',"<span>"+fb.t("您还可以选择")+a.Link.html({text:fb.t("网易专业翻译"),cls:k,click:function(){try{var a=$L("product.Translate",this)}catch(b){return b}a.goHuman({mid:g.mid,vendor:"read"}),g.log({action:"click",item:"trans_pro",value:"3"})}})+fb.t("，查看更精准的译文")+"</span>"].join(""):"","</p>","</div>"].join(""),ext:$S("isFree")?a.Link.html({text:fb.t("最快的人工翻译，有道专业翻译"),target:"_blank",noParam:!0,link:"trans_ad2"}):a.Link.html({text:fb.t("有道翻译"),target:"_blank",noParam:!0,link:"read_trans_provide","left-bracket":fb.t("本服务由  "),"right-bracket":fb.t(" 提供")})};break;case"transRetry":e={icon:"translate",content:['<div class="qu0">',"<p>",fb.t("在线翻译服务异常，请稍候&nbsp;"),a.Link.html({text:fb.t("重试"),click:function(){g.translate({type:2}),$C(h).destroy()}}),"</p>","</div>"].join("")};break;case"smartAd":e={extcls:i+" Ab0",subclass:j,content:d.content,closeclick:function(){if(this.destroy(),f._bAdPrivileges){try{var a=$L("product.Privileges",this)}catch(b){return b}a.showProduct("noAd","noAd_dxyht")}}};break;case"yAd":e={extcls:i+" Ab0",subclass:j,content:d.content,closeclick:function(){if(this.destroy(),f._bAdPrivileges){try{var a=$L("product.Privileges",this)}catch(b){return b}a.showProduct("noAd","noAd_dxyht")}}}}return e.extcls=e.extcls||i,e.subclass=j,e.id=h,e}function E(b,d){function e(a){a===c||0===a.length?j.sendStatus=a:j.sendStatus||(j.sendStatus=a)}var f,g,h,i,j=this.reader,k=j.folderData,l="",m=fb.t("撤回成功"),n="";switch(b){case"mail":var o={};f=[],a.Array.each(d,function(a,b){o[b.msgid]?o[b.msgid].push(b):o[b.msgid]=[b]});for(var p in o){var q=o[p],r=[];a.Array.each(q,function(b,c){r.push(new a.Email(c.to,c.to_name))}),f.push({msgType:q[0].msgType,rectime:q[0].rectime||q[0].modtime,email:r})}d=f,g=[{text:fb.t("处理方式")},{text:fb.t("时间")},{text:fb.t("联系人")}],i=fb.t("没有查到详情，系统仅保留7天内的回复、转发信息。");break;case"send":g=[{text:fb.t("收件人")},{text:fb.t("发送状态")},{text:fb.t("时间")}],i=a.Misc.getTime(0)-j.data.sentDate>6048e5?fb.t("邮件发送已经超过7天，查询不到详情"):fb.t("没有查到详情，请稍后再试");break;case"recall":g=[{text:fb.t("收件人")},{text:fb.t("撤回状态")},{text:fb.t("时间")}],i=fb.t("没有查到详情，请稍后再试")}a.Array.each(d,function(c,d){var f="",g="",h=0;if("mail"===b)switch(d.msgType){case 0:f=fb.t("未知");break;case 1:f=fb.t("新邮件");break;case 2:case 3:case 4:f=fb.t("已回复"),g="re";break;case 5:f=fb.t("已自动回复"),g="re";break;case 6:case 7:case 8:f=fb.t("已转发"),g="fw";break;case 9:f=fb.t("已自动转发"),g="fw"}else{var i=d.result,j=Math.round(i/100),o=i%100;if(1===j)switch(o){case 0:case 6:case 7:case 8:case 10:f=fb.t("成功到达对方邮箱"),h=1,e(fb.t("发送成功"));break;case 1:f=fb.t("正在投递中"),h=0;break;case 2:case 5:f=fb.t("未到达对方邮箱"),h=2,e(l);break;case 3:case 4:f=fb.t("被对方退回"),h=2,e(l);break;default:f=fb.t("未知操作"),h=3,e(l)}else if(2===j)switch(o){case 0:case 6:case 7:case 8:f=fb.t("成功到达对方服务器"),h=1,e(fb.t("发送成功"));break;case 1:f=fb.t("对方服务器未响应,重新投递中");for(var p=["@163.com","@126.com","@188.com","@vip.188.com","@yeah.net","@vip.163.com","@vip.126.com"],q=0,r=p.length;r>q;q+=1)if(-1!==d.to.indexOf(p[q])){f=fb.t("正在投递中");break}h=0,e(l);break;case 2:case 5:f=fb.t("未到达对方服务器"),h=2,e(l);break;case 3:case 4:f=fb.t("被对方服务器退回"),h=2,e(l);break;default:f=fb.t("未知操作"),h=3,e(l)}else if(3===j||4===j){switch(o){case 0:case 1:case 6:case 7:case 8:f=fb.t("正在处理中"),h=0;break;case 2:case 5:case 3:case 4:f=fb.t("发送不成功，详细原因请查看退信"),h=2;break;default:f=fb.t("未知操作"),h=3}e(l)}else if(5===j||7===j)switch(o){case 0:f=fb.t("撤回成功"),h=5,e(m);break;case 9:f=fb.t("成功到达对方邮箱"),h=1;break;default:f=fb.t("未知操作"),h=3,e(l)}else if(6===j)switch(o){case 0:f=fb.t("审核通过"),h=1;break;case 1:f=fb.t("待审核"),h=0;break;case 2:f=fb.t("未通过审核"),h=2,e(l);break;case 3:f=fb.t("超过审核时间，审核自动通过"),h=1;break;default:f=fb.t("未知操作"),h=3,e(l)}else if(8===j)switch(o){case 0:f=fb.t("撤回成功"),h=5,e(m);break;case 9:f=fb.t("成功到达对方服务器"),h=1;break;default:f=fb.t("未知操作"),h=3,e(l)}else f=fb.t("未知操作"),h=3,e(l);if("recall"===b&&k.rclStatus&&1===h){var s=d.rclResult;0===s?(f=fb.t("正在撤回邮件，请稍候。"),h=s):(f=fb.t("撤回失败，原因：")+({4:fb.t("信件不存在，可能已经被用户删除"),5:fb.t("信件存在但已经被读取过"),6:fb.t("信件存在但已经被客户端收取"),7:fb.t("信件存在但已经被推送出去"),8:fb.t("信件已过期"),9:fb.t("不支持撤回发往外域帐号的邮件")}[d.rclResult]||fb.t("其他原因")),h=6,e(n))}g=["doing","suc","err","other","doing","suc","err"][h],d.email=new a.Email(d.to,d.to_name)}d.icon=g,d.msg=f,d.status=h});var s=d.length;if(0===s)h=[[{colspan:3,text:i}]],e(l);else{h=[];for(var t,u,v,w=0;s>w;w+=1)t=d[w],u=a.Date.format(t.rectime||t.modtime,fb.t("yyyy年M月d日   HH:mm(星期w)")),"mail"===b?(v=[{text:'<span class="nui-txt-normal">'+t.msg+"</span>"},{text:'<span class="nui-txt-normal">'+u+"</span>"},{text:""}],a.Array.each(t.email,function(a,b){var c=b.name;c||(c=cb.getName(b)),v[2].text+=(c?'<span title="'+b.address+'" class="nui-txt-normal">'+c+"</span>":'<span class="nui-txt-normal">'+b.address)+(a<t.email.length-1?fb.t("、"):"")+"</span>"})):v=[{text:'<span class="nui-txt-normal">'+a.String.encodeHTML(t.email.toString())+"</span>"},{text:'<span class="nui-txt-'+t.icon+'">'+t.msg+"</span>"},{text:'<span class="nui-txt-normal">'+u+"</span>"}],h.push(v)}return{id:j.createId(b+"Table"),subclass:"simpleTable",headCells:g,bodyCells:h}}function F(){var b=this,d=b.reader,e={groups:[{items:[{xtype:"button",text:fb.t("回复全部"),click:function(){d.log({action:"click",item:"letter_toolbar_replyAll"}),d.assistant.fullReply()}},{xtype:"button",subclass:"dropdownBtn",text:fb.t("更多"),menu:{reverse:!0,groups:[{items:[{text:fb.t("删除"),click:function(){d.log({action:"click",item:"letter_menu_del"}),d.module.moveTo({del:!0,threadItem:!0,folderData:d.folderData})}},{text:fb.t("回复"),click:function(){d.log({action:"click",item:"letter_menu_reply"}),d.assistant.reply()}}].concat(d.module.view.getReplyConf(d).groups.pop().items,d.module.view.getForwardConf(d).groups.pop().items)},{items:[{text:fb.t("查看信头"),click:function(){d.log({action:"click",item:"menu_viewhead"}),d.assistant.bodyFilter("header")}},{text:fb.t("查看邮件"),click:function(){d.log({action:"click",item:"menu_viewmail"}),d.assistant.bodyFilter("mail")}},{text:fb.t("同主题查看"),click:function(){d.log({action:"click",item:"menu_samesubject"}),d.assistant.searchSameSubject()}},{text:fb.t("保存到网盘..."),click:function(){d.log({action:"click",item:"menu_savetonf"}),d.assistant.saveToNf()}},{text:fb.t("导出邮件"),click:function(){d.log({action:"click",item:"menu_download"}),d.assistant.exportLetter()}},{text:fb.t("选择编码"),menu:d.module.view.getCharsetConf(d)},{text:fb.t("选择字体"),menu:d.module.view.getFontConf()},{text:fb.t("翻译邮件"),hidden:!$G.environment.isCh,click:function(){d.log({action:"click",item:"menu_trans"}),d.translate({type:0})}}]},{items:[{text:fb.t("新窗口打开"),hidden:!$G.environment.isCh,click:function(){d.log({action:"click",item:"menu_newwin"}),d.assistant.blankView()}},{text:fb.t("保存联系人..."),click:function(){d.log({action:"click",item:"menu_savecontact"}),d.assistant.saveContacts()}},{text:fb.t("邮件备注"),click:function(){d.log({action:"click",item:"menu_memo"}),d.assistant.editMemo()}}]}]},click:function(){d.log({action:"click",item:"letter_menu_more"})}}]}]};return 3===d.fid&&e.groups[0].items[1].menu.groups[0].items.unshift({text:fb.t("再次编辑发送"),click:function(){d.log({action:"click",item:"toolbar_sendagagin"});try{var a=$L("interface.ComposeInterface",this)}catch(b){return b}a.edit({id:d.mid,body:{decryptPassword:"decryption"in d?d.decryption.pwd:c}})}}),a.Ext.scheduleRead&&$G.environment.isCh&&e.groups[0].items[1].menu.groups[1].items.splice(5,0,{text:fb.t("设置日程")+($S("isFree")?fb.t("管理"):fb.t("提醒")),click:function(){d.log({action:"click",item:"menu_schedule"});try{var a=$L("product.Schedule",this)}catch(b){return b}var e=d.mid,f=$S("schedule");f!==c&&f[e]?a.edit(e):a.add(e,d.folderData.subject)}}),!a.Ext.letterRecall&&!a.Ext.letterRecall_vip||3!==d.fid||d.isThread||e.groups[0].items[1].menu.groups.splice(1,0,{items:[{text:fb.t("撤回邮件"),click:function(){d.log({action:"click",item:"menu_recall"}),d.assistant.recall()}}]}),e}function G(b,d,e){var f=this.reader;return b=b||f.folderData.sentDate||f.data.sentDate,e?b:b===c?fb.t("(未知时间)"):a.Date.format(b,d||fb.t("yyyy年MM月dd日 HH:mm (星期w)"))}function H(){var b,c=this.reader,d=c.folderData.sentDate||c.data.sentDate,e=a.Misc.getTime();if(d.getFullYear()===e.getFullYear()){var f=d.getMonth()===e.getMonth(),g=d.getDate(),h=e.getDate();b=f&&g===h?a.Date.format(d,"HH:mm"):f&&g===h+1?fb.t("昨天")+a.Date.format(d,"HH:mm"):a.Date.format(d,fb.t("MM月dd日 HH:mm"))}else b=a.Date.format(d,"yyyy-MM-dd HH:mm");return b}function I(b){function c(){return a.Misc.getTime().getTime()-i.sentDate.getTime()<18e5}function d(){a.Msgbox.html({content:fb.t("抱歉，距邮件发出时间大于30分钟，附件无法保存。"),icon:"err"});try{$C(g.createId("attachSaveLinkfull")).destroy(),a.fly(g.getDom("attachSaveLinkSplitfull")).remove()}catch(b){}try{$C(g.createId("attachSaveLinkcompact")).destroy(),a.fly(g.getDom("attachSaveLinkSplitcompact")).remove()}catch(b){}}var e,f=this,g=f.reader,h="",i=g.folderData,j=b?"compact":"full";return h=a.Icon.html({type:"alert"})+a.Label.html({text:fb.t("邮件大小超过1M，未保存普通附件"),type:"info"})+"&nbsp;",e=c(),e&&(h+="("+a.Link.html({id:g.createId("attachSaveLink"+j),text:fb.t("马上保存"),cls:"nui-txt-link",click:function(){return c()?(g.module.action.saveAttachMissed({fullSaveId:i.fullSaveId,mid:i.id,call:function(b){switch(b.code){case"S_OK":var c=function(){a.Listener.fire("read:wmsvrDelete",i),bb.entry({fid:i.fid}),g.module.moduleRemove()};a.Msgbox.show({header:fb.t("系统提示"),title:fb.t("附件保存成功"),icon:"suc",ok:c,close:c});break;case"FA_MAIL_NOT_FOUND":d();break;case"FS_MS0259":d();break;default:a.Msgbox.html({content:fb.t("附件保存失败，错误码：")+b.code,icon:"err"})}}}),void 0):(d(),void 0)}}),h+='<span id="'+g.createId("attachSaveLinkSplit"+j)+'">&nbsp;|&nbsp;</span>'),h+=(e?"":"(")+a.Link.html({text:fb.t("设置自动保存"),cls:"nui-txt-link",click:function(){try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"BaseSetModule",inputName:"afterSendRule"})}})+")"}function J(){for(var b=this,c=b.reader,d=[],e=c.localReceiver,f=c.localSender[0],g=e.length-1;g>-1;g-=1){var h=e[g];db.isSender(h.address)||d.push(cb.getName(h))}return d.push(cb.getName(f)),d.reverse(),fb.t("快捷回复给：")+a.String.escapeHTML(a.String.trim(d.join(fb.t("、"))))}function K(){var b="dvRangOptions",d="#dvRangOptions";return['<div id="'+b+'" class="nui-msgbox pa0" style="display:none;">','<div class="nui-msgbox-bd">','<div class="nui-msgbox-wide">','<ul class="jw0">','<li class="ju0">',a.Link.html({text:fb.t("回复选中"),cls:"jv0",click:function(){var b,e,f=$S("fGetActiveReaderBody");f!==c&&(b=f(),e=b.rangText,b.reader.assistant.reply({type:"fragment",content:e}),a.fly(d).hide())}}),"</li>",'<li class="gi0">|</li>','<li class="ju0">',a.Link.html({text:fb.t("转发选中"),cls:"jv0",click:function(){var b,e,f=$S("fGetActiveReaderBody");f!==c&&(b=f(),e=b.rangText,b.reader.assistant.forward({type:"fragment",content:e}),a.fly(d).hide())}}),"</li>",'<li class="gi0">|</li>','<li class="ju0">',a.Link.html({text:fb.t("设置"),cls:"jv0",click:function(){try{var b=$L("interface.OptionInterface",this)}catch(c){return c}b.entry({module:"BaseSetModule",inputName:"selectedcontent"}),a.fly(d).hide()}}),"</li>",'<li class="gi0">|</li>','<li class="ju0">',a.Link.html({text:fb.t("关闭"),cls:"jv0",click:function(){var b,e=$S("fGetActiveReaderBody");e!==c&&(b=e(),b.reader.body.removeRangEvent(),a.fly(d).hide())}}),"</li>","</ul>","</div>","</div>","</div>"].join("")}function L(a,b){return a?['<div id="dvRangOptions" class="nui-msgbox tM0 qF0" style="display:none;z-index:999" onclick="$.Event.cancelBubble();">','<div class="nui-msgbox-bd">','<div class="nui-msgbox-wide">','<div class="qz0 nui-txt-normal nui-scroll nui-scroll-hasShadow">',"</div>","</div>","</div>","</div>"].join(""):['<div class="hk0">','<strong class="jK1">'+b.returnPhrase+"</strong>",'<span class="iE1">',b.phoneticSymbol?"["+b.phoneticSymbol+"]":"","</span>","</div>",'<div class="hO1">',"<ul>",'<li class="lq0">',b.customTranslation.content.join('</li><li class="lq0">'),"</li>",'<li class="lq0"></li>',"</ul>","</div>"].join("")}function M(b){var c,d,e,f=this,g=f.reader,h=a.Element.getIframeDoc(g.body.frame),i=b.name||"",j=b.email||"",k=$S("isFree"),l=g.createId("mailCardAddLink");return k?(c=a.Ud.get({field:"ntes_compose",flag:"card"}),d=fb.t("创建我的电子名片"),e="name_card_new"):(d=fb.t("创建我的个性名片"),e="vcard"),['<div style="font-size:12px;margin-bottom:10px;background-color: #FFFFE1;border-top:1px solid #C5D2DA;padding:3px 5px">',fb.t("电子名片-此邮件包含")+i+fb.t("的电子名片。&nbsp;"),a.Link.html({id:l,doc:h,text:fb.t("保存名片到通讯录"),listeners:{click:{handler:function(){cb.contactDialog({addr:{name:i,email:j,phone:b.phone},callback:function(){a.Tips.show({type:"suc",text:fb.t("名片保存成功")}),$C(l).destroy()}})}}}}),"</div>"].join("")}function N(a){var b="",c=[],d=a.maxMenu;return a.nfMenu&&c.push('<a href="javascript:void(0);" hidefocus="hidefocus" title="'+fb.t("将图片保存到网盘")+'" onclick="NTES_Events.saveToNF(\''+a.part+'\');return false;" style="vertical-align:bottom;display:inline-block;+display:inline;+zoom:1;position:relative;+zoom:1;background-image:url(https://mimg.127.net/ggimg/all/img18/140308_nui_btn.png);background-position:0 ; ;border:1px solid #999;border-top-left-radius:3px;border-bottom-left-radius:3px;'+(d?"":"border-top-right-radius:3px;border-bottom-right-radius:3px;")+'text-decoration:none;color:#555;height:26px;width:38px;line-height:0;font-size:0;"><img src="https://mimg.127.net/ggimg/all/img18/140312_wp_2x.png" style="position:absolute;left:10px;top:6px;border:0;" width="16" height="13" /></a>'),d&&(c.push('<a href="javascript:void(0)" hidefocus="hidefocus" title="'+fb.t("1比1查看原图")+'" onclick="window.open(\''+a.src+"', 'pic_preview_"+a.index+'\');return false;" style="vertical-align:bottom;display:inline-block;+display:inline;+zoom:1;position:relative;+zoom:1;background-image:url(https://mimg.127.net/ggimg/all/img18/140308_nui_btn.png);background-position:0 ; ;border:1px solid #999;border-left:none;border-top-right-radius:3px;border-bottom-right-radius:3px;text-decoration:none;color:#555;height:26px;width:38px;line-height:0;font-size:0;"><img src="https://mimg.127.net/ggimg/all/img18/140312_origin.png" style="position:absolute;left:12px;top:8px;border:0;" width="13" height="10" /></a>'),b='<div style="display:inline-block;+display:inline;+zoom:1;font-size: 12px; font-weight: normal; border: 1px solid #ddd; background-color: #F4F4F4; line-height: 14px; padding: 5px;color:#999">'+fb.t("(&nbsp;原尺寸为")+a.width+"×"+a.height+"&nbsp;)</div>"),['<div style="display:inline-block;+display:inline;+zoom:1;font-size: 12px; font-weight: normal;line-height: normal;margin-right:6px;">',c.join(""),"</div>",b].join("")}function O(a){var b=this.reader;return a===c?['<a href="javascript:void(0);" style="font-size:12px;display:block;height:25px;line-height:25px;padding-left:31px;position:relative;+zoom;1;color:#666;text-decoration:none" onmousemove="this.style.backgroundColor=\'#ececec\';" onmouseout="this.style.backgroundColor=\'\';" onclick="NTES_Events.shareToYXFriend();this.parentNode.style.display=\'none\';return false;"><img src="https://mimg.127.net/ggimg/all/img18/140312_friend_2x.png" style="position:absolute;left:9px;top:5px;border:0;" width="14" height="14" />'+fb.t("分享给易信好友")+"</a>",'<a href="javascript:void(0);" style="font-size:12px;display:block;height:25px;line-height:25px;padding-left:31px;position:relative;+zoom;1;color:#666;text-decoration:none;" onmousemove="this.style.backgroundColor=\'#ececec\';" onmouseout="this.style.backgroundColor=\'\';" onclick="NTES_Events.shareToYXGroups();this.parentNode.style.display=\'none\';return false;"><img src="https://mimg.127.net/ggimg/all/img18/140312_quan_2x.png" style="position:absolute;left:9px;top:5px;border:0;" width="14" height="14" />'+fb.t("分享到易信朋友圈")+"</a>"].join(""):{groups:[{items:[{text:fb.t("分享给易信好友"),click:function(){b.log({action:"click",item:"attach_share_group"}),b.assistant.imageShareToYiXin(a+"",c,!0)}},{text:fb.t("分享到易信朋友圈"),click:function(){b.log({action:"click",item:"attach_share_friend"}),b.assistant.imageShareToYiXin(a+"")}}]}],width:155}}function P(){var b=a.Uri.getUrl("savetonf_new");return $S("lastNetfolderFid")&&(b+="&fid="+$S("lastNetfolderFid")),['<div style="padding:10px">','<div style="zoom:1;padding:10px;height:230px;border-width:1px;border-style:solid" class="bdr-light">','<iframe id="ifrSaveToNf" src="'+b+'" height="228px" width="380px" frameborder="0"></iframe>',"</div>","</div>"].join("")}function Q(a){return["<html>","<head>",'<base target="_blank" />','<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"<title>"+fb.t("网易邮箱")+"</title>",'<style type="text/css">',"html{word-wrap:break-word;}","body{font-size:14px;font-family:arial,verdana,sans-serif;line-height:1.666;padding:10px 8px;margin:0;overflow:auto}","pre {white-space: pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space: -o-pre-wrap;word-wrap: break-word;}","</style>","</head>","<body>","<div>",a||"","</div>","</body>","</html>"].join("")}function R(){var b=this,d=b.reader;return['<div id="read_mask" class="nui-mask"></div>','<div id="dvOptimizedContent" class="mz1 nui-scroll">','<div class="xV0">','<div class="jh1">',a.Link.html({text:fb.t("增大"),cls:"dV1",click:function(){var b=a.fly("#ifrmOptimizedContent").dom;_.setFontSize(a.Element.getIframeDoc(b).body,!0,!0,!0),d.body.autoSize({frame:b,heightOnly:!0}),b=c}}),'<b class="ek2"></b>',a.Link.html({text:fb.t("缩小"),cls:"dy1",click:function(){var b=a.fly("#ifrmOptimizedContent").dom;_.setFontSize(a.Element.getIframeDoc(b).body,!1,!0,!0),d.body.autoSize({frame:b,heightOnly:!0}),b=c}}),"</div>",'<div class="nT1">','<h1 class="hk2">',a.String.escapeHTML(d.data.subject),"</h1>",'<p class="fH1">',"<span>"+fb.t("发件人："),a.String.escapeHTML(cb.getName(d.module.view.getContactConf(d.from[0]).email)),"</span>","&nbsp;&nbsp;&nbsp;&nbsp;","<span>"+fb.t("时间："),b.getDateStr(),"</span>","</p>","</div>",'<div class="mE1">','<iframe id="ifrmOptimizedContent" src="about:_blank" class="fI3" frameborder="0" style="height:auto;display:none;"></iframe>',"</div>","</div>","</div>"].join("")}function S(c){var d=this,e=d.reader;if("ud"!==$S("ad").userType&&c)try{b.gAd.getByCallback("read",{},function(b){var c=b.read,f=a.Link.html({title:fb.t("去广告"),text:'<span style="float: right;color: #999;font-size: 18px;padding-left: 8px;cursor: pointer;position: relative;z-index: 1;">&times;</span>',click:function(){if(e.getDom("dvReadAd").style.display="none",d._bAdPrivileges){try{var a=$L("product.Privileges",this)}catch(b){return b}a.showProduct("noAd","noAd_dxyht")}}});c&&c.length>0&&(e.getDom("dvReadAd").innerHTML=['<div class="nui-split"></div>','<div class="rd0" tabindex="0" title="'+fb.t("广告区")+'" aria-label="'+fb.t("广告区")+'" role="listitem">',f,c,"</div>",'<div class="nui-split"></div>'].join(""))})}catch(f){}}function T(){var c,d=$S("ad"),e=$S("isFree")&&!$S("closeAd")&&!(!d.show&&"ud"===d.userType);try{c=b.gAd.getReadBanner()}catch(f){}return e&&c?['<div style="margin:0 10px 60px 10px;position:relative;+zoom:1">',c,a.Link.html({text:fb.t("关闭"),cls:"rt2",click:function(){try{var a=$L("product.Privileges",this)}catch(b){return b}a.showProduct("noAd","noAd_dxyht")}}),"</div>"].join(""):""}function U(a){return'<a href="" target="_blank" id="'+a.createId("aTempLink")+'" rel="noreferrer"></a>'}try{var V=$L("interface.MboxInterface")}catch(W){return W}try{var X=$L("support.AddressSupport")}catch(W){return W}try{var Y=$L("init.SenderList")}catch(W){return W}try{var Z=$L("util.Icon")}catch(W){return W}try{$L("product.Schedule")}catch(W){return W}try{var $=$L("util.Emoji")}catch(W){return W}try{var _=$L("module.read.MailReaderBody")}catch(W){return W}var ab,bb,cb,db,eb,fb=new $I18N("module.read.MailReaderView");bb=V,cb=X,db=Y,eb=Z,ab=a.createClass($N("module.read.MailReaderView")),a.Object.extend(ab.prototype,{initialize:d,getHtml:e,getCompactHeadHtml:f,getFullHeadHtml:g,getTempCompactHeadHtml:h,getTempFullHeadHtml:i,getMailServiceHtml:j,getFrameHtml:k,getAttachListHtml:l,getAttachHeader:m,getAttachListItemHtml:n,getAttachPreviewIcsHtml:o,getReplyHtml:p,getZoomHtml:q,getSubjectHtml:r,getDateHtml:s,getSenderHtml:t,getReceiverHtml:u,getAttachHtml:v,getAttachInfoHtml:w,getMemoHtml:x,getBacklogHtml:y,getMemoTextHtml:z,getMemoEditorHtml:A,getHeaderLinkHtml:B,getSubjectHrefHtml:C,getBlockConf:D,getMailStatusConf:E,getSimpleToolbarConf:F,getDateStr:G,getCompactDateStr:H,getUnSavedInfo:I,getReplyNotice:J,getRangeOptHtml:K,getTranlateTipHtml:L,getVCardTipsHtml:M,getImageOptHtml:N,getImageShareMenu:O,getNfListHtml:P,getTranslationHtml:Q,getOptimizedContentHtml:R,getAD:S,getBottomAD:T,getTempLinkHtml:U,_bAdPrivileges:!0})}($,window),function(a,b,c){function d(b){var d=this;d.reader=b,d.baseUrl=a.Uri.getUrl("read_data",!0)+"&mid="+b.mid,d.imageItems=[],d.sortType="",$S("thumbnailHandler")===c&&$S("thumbnailHandler",v.thumbnailHandler);
for(var e=b.data,f=e.attachments,g=a.Ext.newAttach,h=[],i=[],j=0,k=f.length;k>j;j+=1){var l=f[j],m=l.id,n=l.filename,o=n.indexOf(".")>-1?n.split(".").pop().toLowerCase():" ";if(l.filename=(n||m).split(String.fromCharCode(92)).pop(),l.mimeType=o,"cmecypt"===o)b.isEncrypted=!0,l.inlined=!1;else if(g&&l.inlined){d.inlineAttachFound=!0;continue}h.push(m),i.push(l)}d.commonId=h,e.attachments=i,0===i.length&&b.resetAttachFlag(!1)}function e(){for(var c,d=this,e=d.reader,f=e.data.attachments,g=[],h=0,i=f.length;i>h;h+=1)g.push(e.view.getAttachListItemHtml(d.create(f[h],"common")));i>0&&(e.getDom("dvAttachHead").innerHTML=e.view.getAttachHeader(i),c=e.getDom("ulCommonAttachItem"),c.parentNode.style.display="",c.innerHTML=g.join(""),d.showIcsAttach(),b.setTimeout(function(){if(d._setAttachEvent(),a.Ext.attach_online_modify){try{var b=$L("product.FileEdit",this)}catch(c){return c}b.loginO365()}},200))}function f(c,d){var e,f,g,h=this,i=h.reader,j=v.mimeMap,k=j.pic,l=j.iconImg,m=j.preview,n=c.id,o=c.filename,p=c.mimeType,q=c.contentLength,r={id:n,mid:i.mid,filename:o,mime:c.mimeType,size:q>0?a.Number.convert("base64"===c.encoding?3*q/4:q):""};switch(d){case"common":r.isCommon=e=!0,i.isEncrypted||(r.saveToNfHandler=a.Function.bind(h.saveToNf,h,n));break;case"cloud":r.isCloud=f=!0,r.expireText=c.expireText;break;case"decrypt":r.isDecrypt=g=!0}f?(r.download=c.download+"&member="+a.Ud.udProxy["product.vipMember"],r.preview=c.preview):(r.download=h.getOptionUrl("download",c),r.preview=h.getOptionUrl("preview",c));var s=("base64"===c.encoding?3*q/4:q)<=1024*1024*(f?1:10);a.Ext.readTran_atta&&s&&("pdf"===p||"docx"===p||"doc"===p||/.(doc|docx|pdf)$/.exec(o))&&(r.translate=f?a.Uri.getUrl("translateattach_cloud",!0)+"?"+(c.preview||"").split("?")[1]:h.getOptionUrl("translate",c));var u=!f||("base64"===c.encoding?3*q/4:q)<=20971520;if(a.Ext.pdfConver_atta&&("pdf"===p||/.(pdf)$/.exec(o))&&u){var w,x,y={cloud:f?"true":"false",filename:encodeURIComponent(o),filesize:"base64"===c.encoding?3*q/4:q};f?(w=(c.download.split("?")[1]||"").split("&"),x=["file"]):(w=(r.preview.split("?")[1]||"").split("&"),x=["sid","part","uid","mid"]);for(var z=0,A=w.length;A>z;z++)for(var B=w[z].split("="),C=0,D=x.length;D>C;C++)if(x[C]===B[0]){y[x[C]]=decodeURIComponent(B[1]);break}r.conversion=a.Function.bind(a.Support.pdfConversion,h,y,"read")}var E=t.getSubtype({type:"file",name:o});if(E&&(r.icon=E,!f)){if(k[E]){var F=h.imageItems;r.open=h.getOptionUrl("pic",c),r.previewHandler=a.Function.bind(h.previewImages,h),l[E]&&(r.imagesrc=h.getOptionUrl("src",c)),r.imageIndex=F.length,F.push({id:n,original:h.getOptionUrl("original",c),title:o,downloadLink:r.download})}else"17"===E&&(r.open=h.getOptionUrl("open",c));a.Ext.prev&&m[p]&&(r.localPreview=!0),a.Ext.attach_online_modify&&(r.editHandler=function(){var a=h.getOptionUrl("edit",c);b.open(a)})}return c.isMsg&&"message/rfc822"===c.contentType.toLowerCase()&&(r.eml={fid:i.fid,mid:i.mid,group:i.module.getGroup(),part:n}),r}function g(c){function d(){var d=a.Uri.getUrl("savetonf_new"),g=$S("lastNfid");g&&(d+="&fid="+g);var h=['<div style="padding:10px">','<div style="zoom:1;padding:10px;height:230px;border-width:1px;border-style:solid" class="bdr-light">','<iframe id="ifrSaveToNf" src="'+d+'" height="228px" width="380px" frameborder="0"></iframe>',"</div>","</div>"].join("");a.Msgbox.show({type:"confirm",contentType:"normal",title:w.t("保存到网盘"),content:h,ok:function(){var d=a.fly("#ifrSaveToNf").dom.contentWindow.fid;if($S("lastNfid",d),d){var g=a.Uri.getUrl("savetonf_sub")+("&mid="+b.encodeURIComponent(f.reader.mid)+"&dirId="+d);c&&(g+="&part="+c),a.Ajax.jsonp(g,e)}}})}function e(b){var c=b.code;if(200===c||c===a.S_OK)a.Tips.show({text:w.t("成功保存到网盘"),type:"suc"});else{var d={800:w.t("网盘容量超出限制"),801:w.t("网盘文件总数超出限制"),802:w.t("流量超出限制"),803:w.t("登录超时，重新登录"),500:w.t("未知错误")},e=b.msg||d[c]||w.t("错误码")+c;e=w.t("保存到网盘失败，")+e,a.Tips.show({text:e,type:"err"})}}var f=this,g=$S("advLock");g.authenticated2||g.disabled||!g.nf?d():a.AdvLock.show(d)}function h(d){var e=this,f=$S("ImgPreviewObj");if(f===c)return a.Ajax.request({requestType:a.Ajax.SCRIPT,url:"https://mimg.127.net/xm/all2/preview/preview-"+($G.environment.isDebug?"develop":"1.8.min")+".js",call:function(){b.Preview!==c&&($S("ImgPreviewObj",b.Preview),e.previewImages(d))}}),void 0;if(e.imageItems.length>0){var g={index:d,data:e.imageItems,downloadAble:!0,composeFunc:function(a){try{var b=$L("interface.ComposeInterface",this)}catch(c){return c}b.entry({info:{attachments:[{type:"internal",_mid:e.reader.module.mid,_part:a}]}})}};f.init(g)}}function i(a){for(var c,d,e=this,f=e.reader,g=[],h=0,i=a.length;i>h;h+=1)d=a[h],g.push(f.view.getAttachListItemHtml(e.create(d,"cloud")));f.cloudAttachments=a,c=f.getDom("ulCloudAttachItem"),f.getDom("dvCloudAttachHead").innerHTML=f.view.getAttachHeader(i,!0),c.innerHTML=g.join(""),c.parentNode.style.display="",e.updateHeaderInfo(),b.setTimeout(function(){e._setAttachEvent(!0)},200)}function j(){function b(){if(0===j&&0!==k.length){var b=d.getDom("dvReadAttachPreviewIcs");b.style.display="block",k.sort(function(a,b){return a.startTime-b.startTime});for(var c=[],e=[],f=0;f<k.length;f++)a.Array.indexOf(c,k[f].uid)<0&&(c.push(k[f].uid),e.push(k[f]));b.innerHTML=d.view.getAttachPreviewIcsHtml(e)}}for(var c=this,d=c.reader,e=d.data.attachments,f=[],g=0,h=e.length;h>g;g+=1){var i=e[g].mimeType||e[g].filename.split(".").pop();"string"==typeof i&&"ics"===i.toLocaleLowerCase()&&f.push(e[g])}var j=f.length,k=[];try{var l=$L("product.Schedule",this)}catch(m){return m}for(var g=0;j>g;g++)l.getIcsInfo({sMid:encodeURIComponent(d.mid),sPartid:f[g].id,pwd:(d.decryption||{}).pwd,from:d.folderData.from},function(a){k=k.concat(a||[]),--j,b()})}function k(){var a=this,b=a.reader;b.fullHeaderInited&&(b.getDom("attachInfo_full").innerHTML=b.view.getAttachInfoHtml()),b.compactHeaderInited&&(b.getDom("attachInfo_compact").innerHTML=b.view.getAttachInfoHtml(!0))}function l(b,c,d){var e=this,f=e.reader,g=b+(d?"_desc":"");if(e.sortType!==g){var h,i,j=f.data.attachments;switch(b){case"size":h=function(a,b){var c=a.contentLength,e=b.contentLength,f=["base64"===a.encoding?3*c/4:c,"base64"===b.encoding?3*e/4:e];return d&&f.reverse(),f[0]-f[1]};break;case"type":h=function(a,b){var c=a.filename.replace(/(.|\n)*\./,"").toLowerCase(),d=b.filename.replace(/(.|\n)*\./,"").toLowerCase();return c>d?1:d>c?-1:0};break;case"name":h=function(a,b){var c=[a.filename.toLowerCase(),b.filename.toLowerCase()];return d&&c.reverse(),c[0]>c[1]?1:c[0]<c[1]?-1:0};break;default:h=function(a,b){return a.id-b.id}}j.sort(h),i=f.getDom("ulCommonAttachItem").childNodes,a.Array.each(j,function(a,b){var c=b.id,d=i[a];d.id!==f.createId(c)&&d.parentNode.insertBefore(f.getDom(c),d)}),$C(f.createId("sortLink")).getEl().html(c+'<b class="nui-ico nui-ico-downArr">d</b>'),e.sortType=g}}function m(d,e){var f,g=this,h=g.reader.mid,i=e.id;switch(d){case"original":f=g.baseUrl+"&part="+i+"&mode=inline";break;case"download":f=g.baseUrl+"&part="+i+"&mode=download&l=read&action=download_attach";break;case"open":f=g.baseUrl+"&part="+i+"&mode=inline&l=read&action=open_attach";break;case"pic":f=a.Uri.getUrl("read_pic",!0)+"&mid="+h+"&part="+i+"&mode=inline&l=read&action=open_attach";try{g.reader.isDecrypted&&(f=g.baseUrl+"&part="+i+"&mode=inline&l=read&action=open_attach")}catch(j){}break;case"rawPic":f="/js6/s?func=mbox:getMessageData&sid="+$S("sid")+"&mid="+h+"&part="+i;break;case"preview":f=a.Uri.getUrl("previewattach")+"&mid="+h+"&part="+i+"&keyfrom=wm"+$S("domain");break;case"translate":f=a.Uri.getUrl("translateattach")+"&mid="+h+"&part="+i+"&keyfrom=wm"+$S("domain");break;case"edit":f=a.Uri.getUrl("idp_qiye_edit")+"&mid="+h+"&part="+i+"&rnd="+(new Date).getTime();break;case"src":var k=g.baseUrl+"&mode=inline&part="+e.id;if(a.Ext.readNewPic)f=[a.Uri.getUrl("read_thumbnail",!0),"mid="+b.encodeURIComponent(h),"part="+e.id,"contenttype="+b.encodeURIComponent(e.contentType),"sWidth="+(e.width||-1),"sHeight="+(e.height||-1),"width=100&height=100"].join("&");else{var l=g._getThumbnailSize(e,200),m=l[0],n=l[1],o=e.width,p=e.height;o&&p&&(m>=o||n>=p)?f=k:e.contentOffset!==c&&(f=["//pic."+$S("fullDomain")+"/coremail/fcg/imgapp?funcid=thumbnail","sid="+$S("sid"),"mid="+b.encodeURIComponent(h),"off="+e.contentOffset,"len="+e.contentLength,"enc="+e.encoding,"conttype="+e.contentType,"width="+m,"height="+n,"needoriginal=1"].join("&"))}}return f}function n(){var c=this,d=c.reader,e=a(d.getDom("dvAttachBody").firstChild),f="lr0",g="qf0";if(d.module.getDom("ScrollDiv").scrollTop=e.offset().y-200,a.Browser.chrome()||a.Browser.safari())e.addClass(f),b.setTimeout(function(){e.setClass("sa0"),e.destroy()},1e3);else var h=0,i=b.setInterval(function(){return h>8?(b.clearInterval(i),e.removeClass(g),e.destroy(),void 0):(h&!1?e.removeClass(g):e.addClass(g),h+=1,void 0)},100)}function o(b){var c=this,d=c.reader,e=[],f=navigator.userAgent.toLocaleLowerCase().indexOf("touch")>-1&&a.Browser.ie()>9;try{e=d.getDom(b?"ulCloudAttachItem":"ulCommonAttachItem").childNodes}catch(g){}for(var h=0,i=e.length;i>h;h+=1){var j=e[h];a.Event.listen(j,"mouseover",function(a){c._mouseEventHandler(a,this)}),a.Event.listen(j,"mouseout",function(a){c._mouseEventHandler(a,this)}),a.Event.listen(j,"focus",function(a){c._mouseEventHandler(a,this)}),f&&a.Event.listen(j,"click",function(a){c._clickEventHandler(a,this)})}}function p(d,e){var f=this,g="nui-bdr-item nui-bg-item fM0",h=" gh0",i=" gp0",j=a(e),k=d.type;if("mouseover"===k||"focus"===k){var l=j.dom.parentNode.parentNode,m=j.offset().x,n=a.fly(l).offset().x,o=m+j.dom.offsetWidth,p=n+l.offsetWidth;j.addClass(20>m-n?g+h:100>p-o?g+i:g);try{b.clearTimeout(j.get("menuTimer")),"focus"===k&&f.lastHover&&f.lastHover!==j.dom.id&&a.fly("#"+f.lastHover).removeClass(g+h+i)}catch(q){}f.lastHover=j.dom.id}else{var r=j.find(".js-component-menu");j.removeClass(g+h+i),r!==c&&j.set("menuTimer",b.setTimeout(function(){r&&a.Component.getItem(r.doms[0]).hide()},400))}j.destroy()}function q(b,d){var e=this,f=e.activeAttach;f&&a.Event.fire(f,"mouseout"),d!==f?(a.Event.fire(d,"mouseover"),e.activeAttach=d):e.activeAttach=c}function r(a,b){var c,d=400,e=600,f=a.width,g=a.height;if("number"!=typeof f||"number"!=typeof g)c=[b,b];else if(b>=f||b>=g||d>f&&e>g||d>g&&e>f)c=[f,g];else{var h=f/g;c=g>f?[b,Math.round(b/h)]:[Math.round(b*h),b]}return c}function s(b,c,d){if(c)b.parentNode.innerHTML=a.Icon.html({type:"file75",subtype:t.getSubtype({type:"file",name:d})});else{b.style.display="";var e,f,g=b.clientWidth,h=b.clientHeight,i=100;if(i>=g&&i>=h)return;g>h?(e=h,f="height"):(e=g,f="width"),e>i&&(b.style[f]=i+"px")}b=null}try{var t=$L("util.Icon")}catch(u){return u}var v,w=new $I18N("module.read.MailReaderAttach");v=a.createClass($N("module.read.MailReaderAttach")),a.Object.extend(v,{mimeMap:{pic:{31:!0,32:!0,33:!0,34:!0,36:!0,37:!0,38:!0},iconImg:{31:!0,32:!0,33:!0,34:!0},preview:{doc:!0,docx:!0,ppt:!0,pptx:!0,xls:!0,xlsx:!0,pdf:!0,zip:!0,rar:!0,htm:!0,html:!0,xml:!0,txt:!0,java:!0,jsp:!0,js:!0,c:!0,cpp:!0,py:!0,h:!0,hpp:!0,cs:!0,sh:!0,css:!0,jpg:!0,jpeg:!0,gif:!0,png:!0,bmp:!0,shtml:!0,xhtml:!0,mht:!0,asp:!0,aspx:!0,ini:!0,inf:!0,dib:!0,wpt:!0,dot:!0,dotm:!0,dotx:!0,docm:!0,pot:!0,potm:!0,potx:!0,pps:!0,ppsx:!0,pptm:!0,dpt:!0,xlsm:!0,xlt:!0,xltx:!0,xltm:!0,ett:!0,war:!0,ear:!0,"7z":!0,tar:!0,gz:!0,tgz:!0,taz:!0,cpgz:!0,z:!0,bz:!0,bz2:!0,tbz:!0,tbz2:!0,cpio:!0,ar:!0,crx:!0,sext:!0,wps:!0,rtf:!0,et:!0,dps:!0,jar:!0,flv:!0,mp3:!0,wma:!0,eml:!0,psd:!0}},thumbnailHandler:s}),a.Object.extend(v.prototype,{initialize:d,init:e,create:f,saveToNf:g,previewImages:h,showCloudAttach:i,showIcsAttach:j,updateHeaderInfo:k,sort:l,getOptionUrl:m,skipToList:n,_setAttachEvent:o,_mouseEventHandler:p,_clickEventHandler:q,_getThumbnailSize:r})}($,window),function(a,b,c){function d(a){this.reader=a}function e(b){var c=this,d=c.reader;if(b=b||{},!c._checkReplyTo(a.Function.bind(c.reply,c,b))){var e,f,g={withAttachments:b.withAttachments},h="reply";switch(b.type){case"simple":g={toAll:!0,content:b.content},h="quickReply";break;case"all":g.toAll=!0;break;case"new":e={param:{info:{to:d.from.concat(d.to||[]),cc:d.cc,bcc:d.bcc}}},h="entry";break;case"fragment":g={fragment:!0,toAll:!0,content:b.content};break;default:g.content=b.content}e=e||{id:d.mid,body:c._getReplyBody(g),callback:function(c){b.call&&b.call(c.code===a.S_OK)}},e.lang=d.lang,F[h](e,f)}}function f(b){var d=this,e=d.reader;if(!d._checkReplyTo(a.Function.bind(d.fullReply,d,b))){b=b||{};var f=!0,g=e.localSender.concat(e.localReceiver),h=$S("uid");3===e.fid||0===g.length?f=!1:a.Array.each(g,function(b,c){var d=c.address;return d===h||D.isSender(d)||d.indexOf("groups.163.com")>-1||d.indexOf("g.qq.com")>-1||d.indexOf("googlegroups.com")>-1?(f=!1,a.BREAK):void 0}),b.type=b.type||"all",f?a.Msgbox.show({header:L.t("温馨提示"),content:L.t("您不在此邮件的收件人名单中，如回复全部，则其他收件人会知道您收到了此邮件！是否要回复全部收件人？"),buttons:[{xtype:"button",text:L.t("回复发件人"),subclass:"mainBtn",click:function(){b.type=c,d.reply(b),a.Msgbox.msgbox.close()}},{xtype:"button",text:L.t("回复全部"),click:function(){d.reply(b),a.Msgbox.msgbox.close()}},{xtype:"button",text:L.t("取消"),click:function(){a.Msgbox.msgbox.close()}}]}):d.reply(b)}}function g(a){var b,c,d=this,e=d.reader;b={id:e.mid,body:d._getForwardBody(a||{}),lang:e.lang},F.forward(b,c)}function h(){function c(b,c){var d=c.name,e=c.email;return b=a.String.trim(b),b&&(d.indexOf(b)>-1||e.indexOf(b)>-1)?d?'"'+d+'"<'+e+">":e:void 0}function d(c){if(c=a.String.trim(c),0===c.length)return L.t("请填写转发地址。");var d=a.Uri.getEmails(c);if(d.wrong.length>0)return L.t("请填写正确的转发地址。");if(d.match.length>1)return L.t("只能输入一个转发地址。");var f={mode:"transmit",attrs:{bcc:c}};h.part&&(f.part=b.parseInt(h.part)),F.quickForward({id:h.mid,body:f,callback:e})}function e(b){b.code===a.S_OK&&a.Msgbox.show({header:L.t("原信转发"),title:L.t("转发成功 ")})}var f,g=this,h=g.reader,i=a.Msgbox.show({contentType:"normal",type:"prompt",header:L.t("原信转发"),inputLabel:L.t("收件人："),inputPlaceholder:L.t("请输入转发地址"),footer:L.t("提示：原信转发邮件不能撤回"),autoFocus:!0,okText:L.t("发 送"),ok:d,close:function(){try{f._remove()}catch(a){}}}).find("input")[0];a.fly(i.getEl().dom.parentNode).append("<div>"+a.Label.html({type:"tips",text:L.t("(如：zhangsan@example.com)")})+"</div>"),i.unlisten("enter"),f=new I({isTop:!0,input:i.getInputEl(),inputDiv:i.getEl(),match:c})}function i(a){var b=this,c=b.reader,d=c.folderData;G.setFlag({flag:-1===a?d.label0?0:1:a,moduleName:c.module.listModule,data:d,area:c.area})}function j(b){var c=this,d=c.reader;return b?(a.fly(d.getDom("memo")).empty().replace(d.view.getMemoHtml()),a.Component.setEvents(),void 0):(d.showHeader(),d.getDom("memoText").style.display="none",a.fly(d.getDom("memoEditor")).html(d.view.getMemoEditorHtml()).show().dom.parentNode.style.display="",a.Component.setEvents(),$C(d.createId("memoInput")).fire("keyup"),void 0)}function k(a){var b=this,c=b.reader,d={moduleName:c.listModule,memo:a.value,data:c.folderData};G.setMemo(d)}function l(){var b=this,d=b.reader;if(!d.isHidden&&!d.receiptSended){var e=a.Ud.get({field:"op_readreceipt"}).toString(),f=d.data;f!==c&&f.requestReadReceipt&&("0"===e?a.Msgbox.show({type:"confirm",header:L.t("已读回执"),title:a.String.escapeHTML(d.localSender[0].toString())+L.t("要求发送“已读回执”，是否发送？"),okText:L.t("发送"),cancelText:L.t("不发送"),ok:function(){$C("readReceiptAways").getChecked()&&a.Ud.set({field:"op_readreceipt",value:"2"}),d.module.action.sendReceipt(d.mid)},cancel:function(){$C("readReceiptAways").getChecked()&&a.Ud.set({field:"op_readreceipt",value:"1"})},content:a.Checkbox.html({id:"readReceiptAways",text:L.t("以后都按这次操作，不再提示")})}):"2"===e&&d.module.action.sendReceipt(d.mid)),d.receiptSended=!0}}function m(c){function d(){var c=L.t("正在撤回中..."),d=j.rclStatus?L.t("正在查询撤回状态..."):c,g=h.localReceiver,i=[],m={};a.Array.each(g,function(a,b){var d=b.address;d in m||(m[d]=!0,i.push([{text:d},{text:c}]))}),f=new a.Msgbox({type:"confirm",contentType:"wide",title:'<b class="nui-ico nui-ico-loading">e</b>'+d,icon:"loading",extcls:k,content:a.Table.html({subclass:"simpleTable",headCells:l,bodyCells:i})}),f.buttons.cancel.hide(),h.module.action.recallMessage({mid:h.mid,callback:e}),($S("isFree")||$S("isVip"))&&a.Ajax.jsonp(a.Uri.getUrl("read_recall_notary",!0)+"&mid="+b.encodeURIComponent(h.mid),function(){})}function e(b){var c=b.code,d=b["var"],e=d.recallresult,g=L.t("已执行撤回操作，结果如下"),i=L.t("撤回失败"),n={0:L.t("撤回中，请稍后查看详情"),1:L.t("撤回中，请稍后查看详情"),2:L.t("成功撤回"),3:L.t("成功撤回"),4:i,5:i,6:i,7:i,8:i,9:i,14:i,15:i};if("FA_UNSUPPORT_RECALL"===c)return a.Msgbox.show({cls:k,title:L.t("这封邮件无法撤回！")}),void 0;if("FA_MAIL_EXPIRED"===c)return a.Msgbox.show({header:L.t("系统提示"),title:L.t("很抱歉，该邮件不能被撤回"),content:"<p>"+L.t("此邮件距发送时已超过")+m+L.t("天，无法撤回。")+"</p>"}),void 0;j.recalled=!0,j.rclStatus&&(g=L.t("撤回查询已经完成！"));var o=[-1,-1,-1],p=[];a.Object.each(e,function(a,b){1===b?(-1===o[0]&&(o[0]=1),o[0]=o[0]&&!0):2===b||3===b?(-1===o[1]&&(o[1]=1),o[1]=o[1]&&!0):(-1===o[2]&&(o[2]=1),o[2]=o[2]&&!0),p.push([{text:a},{text:'<span class="'+(1===b?"nui-txt-normal":2===b||3===b?"nui-txt-suc":"nui-txt-err")+'">'+n[b]+"</span>"}])}),j.rclStatus=o[0]&&-1!==o[0]?1:o[1]&&-1!==o[1]?o[2]&&-1!==o[2]?5:3:4;var q="",r="";j.rclStatus&&j.rclStatus>0&&(j.rclStatus<3?q=L.t("邮件撤回中"):3===j.rclStatus?(q=L.t("撤回成功"),r="nui-txt-suc "):4===j.rclStatus?(q=L.t("撤回不成功"),r="nui-txt-err "):5===j.rclStatus&&(q=L.t("部分成功"),r="nui-txt-impt "));var s=$C(h.createId("sendStatus"));s&&s.update(h.view.getBlockConf("sendStatus",{info:G.getSendInfo(h.folderData)})),f.update({title:g,content:a.Table.html({subclass:"simpleTable",headCells:l,bodyCells:p})}),f.buttons.cancel.hide(),f.buttons.ok.update({text:L.t("查看详情")}),f.listen("ok",function(){try{$C(h.createId("readCheckStatus")).fire("click")}catch(a){}}),a.Listener.fire("read:recall",h.mid)}var f,g=this,h=g.reader,i=h.data,j=h.folderData,k="jy0",l=[{text:L.t("已发送邮箱地址")},{text:L.t("状态")}],m=$G.user.allowRecallBeforeDays||15,n=a.Misc.getTime(0)-(h.folderData.sentDate||i.sentDate);return m&&n>1e3*3600*24*m?(a.Msgbox.show({header:L.t("系统提示"),title:L.t("很抱歉，该邮件不能被撤回"),content:"<p>"+L.t("此邮件距发送时已超过")+m+L.t("天，无法撤回。")+"</p>"}),void 0):j.recallable?(j.recalled||j.rclStatus?a.Msgbox.show({title:L.t("该邮件已经被执行撤回，如需查看撤回结果，请点击“查看详情”。")}):a.Msgbox.show({type:"confirm",title:L.t("您确定要撤回此邮件吗？"),cls:k,content:['<p class="nui-item-spc1x">'+L.t("邮件撤回详细说明：")+"</p>",'<p class="nui-item-spc1x">'+L.t("1. 撤回功能开通后发送的邮件才支持撤回；")+"</p>",'<p class="nui-item-spc1x">'+L.t("2. 邮件发送未超过")+m+L.t("天，在对方未读(或显示未读状态)，未被对方从邮件客户端(比如Outlook，Foxmail)收取过，才支持撤回；")+"</p>",'<p class="nui-item-spc1x">'+L.t("3. 撤回成功后，对方看到的邮件将被清除，撤回的结果将通过系统邮件通知您。")+"</p>"].join(""),ok:d}),void 0):(3e5>n&&!c?G.getLetterData({moduleName:h.listModule,mid:h.mid,refersh:!0,callback:function(a){a&&(h.module.folderData=h.folderData=a,g.recall(!0))}}):g.whyRecallDisabled(),void 0)}function n(){function b(b,c){for(var h=c["var"]||[],i=a.Misc.getTime(0)-(d.folderData.sentDate||e.sentDate),j=!1,k=a.Uri.getUrl("read_recall_help",!0),l=0,m=h.length;m>l;l+=1){var n,o=null;h[l].recallable?(d.module.folderData.recallable||G.getLetterData({moduleName:d.listModule,mid:d.mid,refersh:!0,callback:function(a){a&&(d.module.folderData=d.folderData=a)}}),n=18e4>i,o=g[h[l].rclResult],!o&&n&&(o=L.t("邮件正在发送中，请稍后尝试撤回"))):(n=6e4>i,o=n?L.t("系统处理中，请稍后尝试撤回"):L.t("撤回功能开通后发送的邮件才支持撤回，目前仅尝试撤回发往网易163、126、yeah.net、vip163、vip126和188的邮件。")+L.t("更详细的撤回条件可")+" $help$"),o||(j=!0),o&&(f[o]||(f[o]=!0))}j&&(f[L.t("其他原因邮件不支持撤回。")]=!0);var p=[];for(var q in f)p.push(q);var r='<h4 class="g-dialogBox-title">'+L.t("很抱歉，该邮件不能被撤回")+"</h4>";p.length>0&&(r+='<p class="txt-info g-dialogBox-item">'+L.t("原因如下：")+p.join("<br>").replace("$help$",a.Link.html({link:k,text:L.t("查看帮助"),target:"_blank"}))+"</p>"),a.Msgbox.show({title:L.t("撤回邮件"),content:r})}var c=this,d=c.reader,e=d.data,f={},g={5:L.t("信件存在但已经被读取过。"),6:L.t("信件存在但已经被客户端收取过。"),7:L.t("信件存在但已经被推送出去。")},h={type:"recall",mid:d.mid,callback:b};d.module.action.listDeliveryHistory(h)}function o(c){function d(){a.Msgbox.show({contentType:"normal",title:L.t("保存到网盘"),content:f.view.getNfListHtml(),ok:function(){var d,e=a.fly("#ifrSaveToNf").dom.contentWindow.fid;$S("lastNetfolderFid",e),e&&(d=a.Uri.getUrl("savetonf_sub"),d+="&mid="+b.encodeURIComponent(f.mid)+"&dirId="+e,c&&(d+="&part="+c),a.Ajax.jsonp(d,function(b){var c=b.code;return 200===c||c===a.S_OK?(a.Tips.show({text:L.t("成功保存到网盘"),type:"suc"}),void 0):(a.Tips.show({text:L.t("保存到网盘失败，")+(b.msg||K.netFolderError[c]||L.t("错误码")+c),type:"err"}),void 0)}))},cancel:function(){}})}var e=this,f=e.reader,g=$S("advLock");g.authenticated2||g.disabled||!g.nf?d():a.AdvLock.show(function(){d()})}function p(){var b,d=this,e=d.reader,f=e.decryption;return f!==c&&(b=f.pwd)===c?(a.Msgbox.html({title:L.t("本邮件是加密邮件，请解密后重试。"),icon:"err",ok:function(){$C(e.createId("decryptInput")).focus()}}),void 0):(e.module.action.saveToYNote({mid:e.mid,pwd:b,call:function(){a.Msgbox.html({title:L.t("邮件已成功保存到有道云笔记"),icon:"suc"})},error:function(b){var c,d,e=b.code;if("S_PARTIAL_OK"===e)try{c=[],d=b["var"].fails,a.Array.each(d,function(b,d){c.push(a.String.escapeHTML(d.resource))}),a.Msgbox.html({title:L.t("邮件部分保存成功！以下附件因类型受限，无法保存"),content:c.join("<br />")+e,icon:"err"})}catch(f){}else a.Msgbox.html({title:L.t("保存失败，错误码：")+e,icon:"err"})}}),void 0)}function q(c){var d,e=this,f=e.reader,g=f.view.getDateStr(null,null,!0);d=a.Ext.read_noSsidRead?"read/viewmail.jsp?mid="+f.mid:$G.environment.readUrl.replace("readhtml","viewmail")+"&mid="+f.mid,f.isDecrypted&&(d+="&decryptMsg=true"),f.part&&(d+="&part="+f.part),c&&(d+="&type=1"),g&&(d+="&t="+g.getTime()),$G.environment.isCh||(d+="&hl="+$G.environment.hl),b.open(d,f.module.moduleName+(f.threadToken||""))}function r(b){var c=this,d=c.reader,e=d.data,f=[];f=b?e[b]||[]:(e.from||[]).concat(e.to||[]).concat(e.cc||[]),H.contactListDialog({data:f,callback:function(b){b.code===a.S_OK?a.Tips.show({text:L.t("联系人保存成功"),succ:!0}):a.Tips.show({text:L.t("联系人保存失败"),err:!0})}})}function s(){var b=this.reader,c=a.Uri.getUrl("read_data",!0)+"&mid="+b.mid+"&mode=download&l=read&action=download_eml";b.part&&(c+="&part="+b.part),a.fly("#downloadFrame").dom.src=c}function t(b,d){var e,f=this.reader,g=f.body.frame;switch(b){case"header":if("header"===f.contentType)return;e=a.Uri.getUrl("read_head",!0)+"&mid="+f.mid+"&l=read&action=read_head",f.part&&(e+="&part="+f.part),f.contentType="header";break;case"mail":if("mail"===f.contentType)return;f.contentType="mail";break;case"encode":f.bodyEncoding=d}e=e||f.getFrameUrl(),f.body.destroy(!0),g.src=e,g=c}function u(){var b="Re:",c=this.reader.folderData.subject.replace(/(re|reply|回复|答复|fw|forward|转发)[:|：]/gi,b),d=c.lastIndexOf(b);d>-1&&(c=a.String.trim(c.substr(d+3)));try{var e=$L("interface.MboxInterface",this)}catch(f){return f}e.title(c)}function v(d){function e(){g.getDom("dvContent").style.display="",g.getDom("dvZoom").style.display=""}var f=this,g=f.reader,h=g.folderData,i=b.setTimeout(function(){e(),i=c},3e4);g.module.action.getMailServiceData({uid:$S("orgUid"),sender:g.localSender[0].address,time:(g.view.getDateStr(null,null,!0)||new Date).getTime(),hmid:h.hmid,call:function(f){i!==c&&(b.clearTimeout(i),i=c);var j;try{j=a.JSON.parse(f.responseText)}catch(k){return e(),void 0}if(j.code===a.S_OK){var l=g.getDom("mailService"),m=j["var"];l.firstChild.innerHTML=m.html;var n=a.fly(l.firstChild).find("a");n&&n.each(function(c,d){"1"===d.getAttribute("data-open-with-alert")&&d.protocol===location.protocol&&a.fly(d).listen("click",function(c){var e=d.href,f=d.title,g=b.parseInt(d.getAttribute("data-width")||500),i=b.parseInt(d.getAttribute("data-height")||480);return"1"!==d.getAttribute("data-without-user-info")&&(e+=(e.indexOf("?")>-1?"&":"?")+"uid="+$S("orgUid")+"&hmid="+b.encodeURIComponent(h.hmid)+"&t="+(new Date).getTime().toString()+"&host="+$S("host")),a.Msgbox.show({header:f,content:'<iframe frameborder="0" style="width:100%;height:'+i+'px" src='+e+"></iframe>",width:g+"px",contentType:"wide",noFooter:!0}),a.Event.cancel(c),!1});var e=d.getAttribute("data-log-url");e&&a.fly(d).listen("click",function(){return a.Ajax.jsonp(e),!1})}),l.style.display="",(1===m["switch"]||1===j["switch"])&&(l.lastChild.style.display="",e()),d&&d()}else e()}})}function w(){var d=this,e=d.reader,f=e.folderData;if(!d.InternationalNumChecked&&"ud"!==$S("ad").userType&&1!==a.Cookie.get("js_read_smart_hint")-0){var g,h=e.data.headers.Sender;g=h instanceof b.Array&&h.length>0?h[0]:f.from;var i,j=f.tag;j&&j.length>0&&(i=j.join(",")),e.module.action.getSmartTag({mid:f.id,subject:f.subject,sender:g,tag:i,call:function(a){var d,f=JSON.parse(a.responseText),g=f.error;if(g===c){try{d=b.gAd.parseLetterFlag(f)}catch(h){return}"string"==typeof d&&d.length>0&&!e.errorMailWarn&&e.addBlockInfo("smartAd",null,{content:d})}}})}}function x(b,d,e,f){function g(b,e){h.isLoadingMailStatus=!1;var g=e["var"];if(e.code!==a.S_OK)return a.Msgbox.html({header:L.t("系统提示"),content:L.t("抱歉，系统繁忙，请稍候再试。")}),void 0;new a.Table(i.view.getMailStatusConf(b,g)).render($C(d).getEl());var j=i.sendStatus;j&&(i.getDom("sendStatusText").innerHTML=j,"suc"===g[0].icon&&(i.getDom("sendStatusText").className="nui-txt-suc"),i.sendStatus=c),f!==c&&f(),a.Component.setEvents(),"send"===b&&a.Listener.fire("read:mailStatusUpdate",i.mid,g[0])}var h=this,i=h.reader;return e?(h.isLoadingMailStatus||(h.isLoadingMailStatus=!0,i.module.action.listDeliveryHistory({type:b,mid:i.mid,callback:g})),void 0):(f!==c&&f(),void 0)}function y(c){var d=this,e=d.reader,f=e.data,g={id:e.mid,decryptPassword:(e.decryption||{}).pwd,attrs:{subject:(K.replyTitleText[$S("attrs").user.replyf]||K.replyTitleText[0])+f.subject,isHtml:!!f.html}};c.toAll&&(g.dontCcDelegatedAddress=g.toAll=!0),c.withAttachments&&(g.withAttachments=!0),e.part&&(g.part=b.parseInt(e.part));var h=a.String.escapeHTML(c.content||"").replace(/\n/g,"<br/>"),i=e.from.join(""),j=a.Date.format(e.folderData.sentDate||f.sentDate),k=K.replyBodyText[d._getLanguage()];if(f.html){var l=["<p>",k[0],j,k[2],a.String.encodeHTML(i),k[1],"</p>",'<blockquote id="isReplyContent" style="PADDING-LEFT: 1ex; MARGIN: 0px 0px 0px 0.8ex; BORDER-LEFT: #ccc 1px solid">'].join(""),m="</blockquote>";h&&(c.fragment?g.defaultContent=h:l=h+"<br/><br/>"+l),g.quoteHTMLStart=l,g.quoteHTMLEnd=m}else{var n=[k[0],j,k[2],i,k[1],"\n"].join("");h?c.fragment?(g.attrs.content=n+"\n"+h,h=""):g.quoteTextStart=h+"\n"+n:g.quoteTextStart=n,g.quoteTextEnd="",g.quoteTextLinePrefix=">",g.defaultContent=h}var o=d._getSender();return o&&(g.attrs.account=o.toString()),g}function z(d){var e,f,g,h=this,i=h.reader,j=i.data,k=d.asAttachment,l={mode:k?"attach":"quote",attrs:{subject:(K.forwardTitleText[a.Ud.get({field:"ntes_option",flag:"forward"})]||K.forwardTitleText[0])+j.subject,isHtml:!!j.html}},m=d.content;if(i.part&&(l.part=b.parseInt(i.part)),"fragment"===d.type&&(m=a.String.escapeHTML(m)),j.html?(g="quoteHTMLStart",k?l.attrs.content="":(f="<br/>",l.quoteHTMLStart='<DIV id="isForwardContent">',l.quoteHTMLEnd="</DIV>"),l.attrs.isHtml=!0):(g="quoteTextStart",k?l.attrs.content="":(f="\n",l.quoteTextStart=f,l.quoteTextEnd="")),!k){e=K.forwardBodyText[h._getLanguage()];var n=(i.from||[]).join(","),o=(i.to||[]).join(","),p=(i.cc||[]).join(","),q=j.subject;j.html&&(n=a.String.escapeHTML(n),o=a.String.escapeHTML(o),p=a.String.escapeHTML(p),q=a.String.escapeHTML(q)),l[g]+=[e[5],e[0]+n,e[1]+a.Date.format(j.sentDate||i.folderData.sentDate),e[2]+o,(i.cc?e[3]+p+f:"")+e[4]+q,m||""].join(f)}m!==c&&(l.attrs.content=(l.quoteHTMLStart||l.quoteTextStart)+(l.quoteHTMLEnd||l.quoteTextEnd));var r=h._getSender();return r&&(l.attrs.account=r.toString()),l}function A(){var a,b=this,c=b.reader;if(c.fid>19){var d=J.getPopInfo(c.fid);d.isPop&&d.username&&(a=D.isSender(d.username))}return a}function B(){var b,d,e=this,f=e.reader,g="";if(e.language!==c)return e.language;if("west"===f.lang)d=1;else{try{b=e.reader.body.frame.contentWindow.document.body,g=a.String.trim((b.innerText||b.textContent||"").replace(/<[^>]+>/g,"")).substr(0,500)}catch(h){}d=0===g.length||g.match(/[^\x00-\x80]/g)?0:1}return e.language=d,d}function C(b){var d=this,e=d.reader,f=e.data,g=e.localSender[0].address||"",h=a.Uri.getAddress(g),i=f.headers["Reply-To"],j=i?i.join(","):!1,k=!1;if(j){var l=a.Uri.getEmails(j).match;l.length>0&&a.Array.each(l,function(d,e){return e.address!==h?(a.Msgbox.show({header:L.t("风险提示"),title:L.t("您回复的地址和原邮件发送地址不一致，请注意识别。"),content:L.t("发送地址：")+a.String.escapeHTML(g)+"<br />"+L.t("回复地址：")+a.String.escapeHTML(j),okText:L.t("继续回复"),ok:function(){f.headers["Reply-To"]=c,b()},cancel:function(){}}),k=!0,a.BREAK):void 0})}return k}try{var D=$L("init.SenderList")}catch(E){return E}try{var F=$L("interface.ComposeInterface")}catch(E){return E}try{var G=$L("interface.MboxInterface")}catch(E){return E}try{var H=$L("support.AddressSupport")}catch(E){return E}try{var I=$L("util.AutoComplete")}catch(E){return E}try{var J=$L("init.Folder")}catch(E){return E}var K,L=new $I18N("module.read.MailReaderAssistant");K=a.createClass($N("module.read.MailReaderAssistant")),a.Object.extend(K,{replyTitleText:["Re:","Reply:",L.t("回复:"),L.t("答复:")],forwardTitleText:["Fw:","Forward:",L.t("转发:")],replyBodyText:[[L.t("在 "),L.t(" 写道："),L.t("，")],["At "," wrote:",", "]],forwardBodyText:[[L.t("发件人："),L.t("发送日期："),L.t("收件人："),L.t("抄送人："),L.t("主题："),"-------- 转发邮件信息 --------"],["From: ","Date: ","To:  ","Cc:  ","Subject: ","-------- Forwarding messages --------"]],netFolderError:{800:L.t("网盘容量超出限制"),801:L.t("网盘文件总数超出限制"),802:L.t("流量超出限制"),803:L.t("登录超时，重新登录"),500:L.t("未知错误")}}),a.Object.extend(K.prototype,{initialize:d,reply:e,fullReply:f,forward:g,originalForward:h,setFlag:i,editMemo:j,setMemo:k,sendReceipt:l,recall:m,whyRecallDisabled:n,saveToNf:o,saveToYNote:p,blankView:q,saveContacts:r,exportLetter:s,bodyFilter:t,searchSameSubject:u,loadMailServiceContent:v,querySmartMailTags:w,queryMailStatus:x,_getReplyBody:y,_getForwardBody:z,_getSender:A,_getLanguage:B,_checkReplyTo:C})}($,window),function(a,b,c){function d(a){this.reader=a}function e(b){var c=this,d=c.reader,e=b.pwd;return 0===e.length?(b.call({error:j.t("请输入密码")}),void 0):(d.module.action.decrypt({param:{mid:d.mid,pwd:e},call:a.Function.bind(c.showDecryptResult,c,b)}),void 0)}function f(b,c){var d=this,e=d.reader,f=c.code,g=c["var"];if(f===a.S_OK){d.pwd=b.pwd,e.isDecrypted=$S("decryptedMid")[e.mid]=!0;var h=g.attachments||[];return e.data.attachments=h,e.commonAttached=h.length>0,e.attached=e.commonAttached||e.cloudAttached,d.updateContent(g),document.cookie=e.mid+"="+d.pwd+";path=/",void 0}b.call({error:i.ERROR_INFO[f]})}function g(d){var e=this,f=e.reader,g=f.body.frame,h=$C(f.createId("decryptForm"));1===h.getEl().dom.parentNode.childNodes.length&&(h.getEl().dom.parentNode.style.display="none"),h.destroy(),f.addBlockInfo("decryptSuc");try{f.body.destroy(!0),g.contentWindow.document.body.innerHTML=(d.html||d.text||{content:"<div>"+j.t("邮件正文不存在")+"</div>"}).content,b.setTimeout(function(){f.body.onLoadHandler(g)},a.Browser.isIE()?2e3:1e3)}catch(i){}g=c,f.attach.baseUrl=a.Uri.getUrl("read_decrypt_data",!0)+"&mid="+f.mid;var k=f.getDom("dvAttachBody");a.fly(k).empty().replace(f.view.getAttachListHtml()),f.showAttach();var l=f.getDom("attachInfo_compact"),m=f.getDom("attachInfo_full");f.attached?(null!==l&&a.fly(l).empty().replace(f.view.getAttachHtml(!0)),null!==m&&a.fly(m.parentNode).empty().replace(f.view.getAttachHtml())):(null!==l&&a.fly(l).empty().remove(),null!==m&&a.fly(m.parentNode).empty().remove())}function h(a){var b=$S("decryptedMid");return b?a in b:($S("decryptedMid",{}),!1)}var i,j=new $I18N("module.read.MailReaderDecryption");i=a.createClass($N("module.read.MailReaderDecryption")),a.Object.extend(i,{ERROR_INFO:{FA_MAIL_NOT_FOUND:j.t("信件不存在"),FA_PART_NOT_FOUND:j.t("附件不存在"),FA_INVALID_PART:j.t("信件Part不是嵌套信"),FA_EMPTY_PASSWORD:j.t("没有传递密码参数"),FA_INVALID_PASSWORD:j.t("密码错误，请重新输入"),FA_INVALID_ENCRYPTED_DATA:j.t("数据错误")},isDecrypted:h}),a.Object.extend(i.prototype,{initialize:d,decrypt:e,showDecryptResult:f,updateContent:g})
}($,window),function(a,b,c){function d(a){this.reader=a}function e(){var b=this,c=b.reader;a.Ajax.request({requestType:a.Ajax.SCRIPT,url:a.Uri.getUrl("read_trans",!0)+"&a=get&mid="+c.mid,rnd:!0,paddingFunc:function(a){var b;try{b=a.result.fanyi}catch(d){return}b&&"west"===b.lang&&(c.lang=b.lang,c.addBlockInfo("transCheck"),c.log({action:"show",item:"trans_tip"}))}})}function f(b){var d=this,e=d.reader;if(!d.requested){var f,g=e.decryption,h=g!==c,i="";if(h&&g.pwd===c)return a.Msgbox.html({header:k.t("系统提示"),content:k.t("抱歉，本邮件是加密邮件，请先进行解密。"),ok:function(){$C(e.createId("decryptInput")).focus()}}),void 0;try{$C(e.createId("transCheck")).destroy()}catch(j){}switch(e.addBlockInfo("transLoading"),b){case 0:i="_btn";break;case 1:i="_tip";break;case 2:i="_rty"}f=a.Uri.getUrl("read_trans",!0)+"&a=fanyi&mid="+e.mid+"&keyform=wm"+$S("domain")+i,"hz"===$G.environment.svr&&(f+="&svr=hz"),h&&(f+="&decryptMsg=1"),a.Ajax.request({requestType:a.Ajax.SCRIPT,url:f,rnd:!0,paddingFunc:function(a){d.response(a)}}),d.requested=!0}}function g(a){var b=this,d=b.reader,e=(a||{}).result,f=$C(d.createId("transLoading"));return f!==c&&f.destroy(),e!==c&&e.error?(d.addBlockInfo("transRetry"),b.requested=!1,void 0):(b.translation=e.fanyi||e,d.addBlockInfo("transMenu"),b.switchContent(2),void 0)}function h(d){var e=this,f=e.reader;if(e.showType!==d){e.showType=d;var g=e.translation,h=a.String.escapeHTML(g.title||k.t("无主题")),i=a(f.module.getDom("h1Subject")),j=a(f.getDom("dvContent")),l=$C(f.createId("tansOriginalLink")),m=$C(f.createId("tansTranslationLink")),n=$C(f.createId("tansComparisonLink")),o=a(f.body.frame),p=a(f.getDom("translationFrame"));switch(d){case 2:if(p===c){p=a.Element.create("IFRAME",f.createId("translationFrame")),p.setClass("oD0 eP0"),p.css({height:f.view.mimFrameHeight+"px"}),p.attr({frameBorder:"0",src:"/"+$G.common.appName+"/read/readblank.jsp"}),j.append(p.dom),p.listen("load",function(d){b.setTimeout(function(){e.autoSize()},1e3);for(var f=a.Element.getIframeDoc(a.Event.getTarget(d)),g=f.getElementsByTagName("A"),h=0,i=g.length;i>h;h+=1)g[h].target="_blank";a.Event.listen(f,"click",function(){a.Event.fire(document,"click")}),f=c});var q=p.dom.contentWindow;p.destroy(),b.setTimeout(function(){q.document.body.innerHTML=g.content},500)}j.setClass("nui-fClear sR0 kV0"),i.html(h),o.show(),p.show(),l.setDisabled(!1),m.setDisabled(!1),n.setDisabled(),f.body.autoSize({half:!0});break;case 1:j.setClass("nui-fClear sR0 eX0"),i.html(h),o.hide(),p.show(),l.setDisabled(!1),m.setDisabled(),n.setDisabled(!1);break;case 0:j.setClass("nui-fClear sR0"),i.html(a.String.escapeHTML(f.folderData.subject||k.t("无主题"))),o.show(),p.hide(),l.setDisabled(),m.setDisabled(!1),n.setDisabled(!1),f.body.autoSize()}i.destroy(),j.destroy(),o.destroy(),p.destroy()}}function i(){var b=this.reader.getDom("translationFrame"),c=a.Element.getIframeDoc(b),d=this.reader.view.mimFrameHeight,e=a.Browser.isIE()?c.body.scrollHeight+150:c.documentElement.scrollHeight+30;b.style.height=(d>e?d:e)+"px",c=null}var j,k=new $I18N("module.read.MailReaderTranslator");j=a.createClass($N("module.read.MailReaderTranslator")),a.Object.extend(j.prototype,{initialize:d,check:e,translate:f,response:g,switchContent:h,autoSize:i})}($,window),function(a,b,c){function d(b){var d,e=this;a.Object.extend(e,b);var f=e.folderData,g=$S("attrs").user.junkpic||0;e.junkPic=2===g||1===g&&5===e.fid,d=e.module||e.threadItem.module,e.baseUrl=a.Ext.read_noSsidRead?"read/readhtml.jsp?mid="+e.mid:$G.environment.readUrl+"&mid="+e.mid;var h=$S("ad").userType;"ud"!==h&&Math.random()>.5&&(h="ud"),e.baseUrl+="&userType="+h,e.view=new y(e),e.body=new A(e),e.assistant=new C(e),e.isDecrypted=D.isDecrypted(e.mid),(3===e.fid||f===c||(f.flags||{}).read)&&(e.receiptSended=!0),e.isThread?(e.createId=function(a){return d.createId(e.threadToken+a)},e.getDom=function(a){return d.getDom(e.threadToken+a)}):(e.createId=a.Function.bind(d.createId,d),e.getDom=a.Function.bind(d.getDom,d))}function e(){var c=this;if(!c.module.resourcePreloaded){c.setAttachObj();var d=c.isThread||"1"===a.Ud.get({field:"ntes_letter",flag:"read_head"});c.showHeader(d),d&&c.showHeader(!d,d)}if(c.initMailService(),c.initBody(),c.showAttach(),c.isServiceMail&&c.isMailServiceAvailable()||c.showTips(),c.fillReplyInput(),c.inited=!0,c.exeInitCall(),a.Component.setEvents(50),b.setTimeout(function(){c.assistant.sendReceipt()},1e3),!G.downloadFramInited){var e="downloadFrame",f=a.Element.create("iframe",e).attr({name:e,frameborder:"0",src:"about:blank"}).css({display:"none"});document.body.appendChild(f.dom),G.downloadFramInited=!0,f.destroy()}}function f(){return"1"!==a.Ud.get({field:"ntes_read",flag:"mail_service"})}function g(){var a=this;a.isServiceMail&&a.isMailServiceAvailable()&&a.assistant.loadMailServiceContent(function(){a.mailServiceLoaded=!0})}function h(){var a=this;a.body.init()}function i(){var b=this,c=b.data.attachments||[];b.commonAttached&&0===c.length?b.resetAttachFlag(!1):!b.commonAttached&&c.length>0&&a.Array.each(c,function(c,d){return d.inlined?void 0:(b.attached=b.commonAttached=!0,a.BREAK)}),b.attached&&(b.attach=new B(b))}function j(a,b){var c=this,d=c.getDom("ulCompact"),e=c.getDom("ulFull"),f=c.getDom("dvSystemCert");a?(b||(e.style.display="none",d.style.display="",f.style.display="none"),c.compactHeaderInited||(d.innerHTML=c.view.getCompactHeadHtml(),c.compactHeaderInited=!0,c.module.updateUserLabel())):(b||(d.style.display="none",e.style.display="",f.style.display=""),c.fullHeaderInited||(e.innerHTML=c.view.getFullHeadHtml(),c.fullHeaderInited=!0))}function k(){var b=this,c=b.folderData;if(c.composeExtra&&c.composeExtra.showOneRcpt){var d=b.getDom("liReadOutto");null!==d&&(d.firstChild.innerHTML=H.t("群发单显:"),a.fly(d.parentNode.parentNode).addClass("fM1"))}}function l(a){var b=this,d=this.module,e=b.folderData.flags||{};d.commonAttached=b.commonAttached=!(!e.attached||e.inlineAttached&&!e.realAttached||a!==c&&!a),d.cloudAttached=b.cloudAttached=!!e.linkAttached,d.attached=b.attached=b.commonAttached||b.cloudAttached}function m(){var a=this,b="";a.attached?(a.commonAttached&&!a.getDom("dvAttachHead")&&a.view.getAttachListHtml(!0),a.attach.init()):b="none",a.getDom("dvAttachBody").style.display=b}function n(b){var c=this;if(c.commonAttached&&!c.attach.inlineAttachFound&&!c.inlineChecked){for(var d,e=b.length,f=c.data.attachments||[],g=f.length,h={},i=0;g>i;i+=1)d=f[i],h[d.id+""]=d.filename;if(e>0){for(var j,k,l=!1,m=[],n=0;e>n;n+=1){k=b[n],k.id=k.id+"";var o=h[k.id],p=o.indexOf(".")>-1?o.split(".").pop().toLowerCase():" ";if(k.filename=o,k.inlined&&"cmecypt"!==p){var q=c.getDom(k.id+"");q&&(j=q.parentNode.parentNode,a.fly(q).remove()),l=!0}else m.push(k)}if(l)if(c.data.attachments=m,c.resetAttachFlag(m.length>0),0===m.length)if(c.cloudAttached)c.attach.updateHeaderInfo(),a.fly(c.getDom("dvAttachHead")).remove(),a.fly(j).remove();else{a.fly(c.getDom("dvAttachBody")).remove(),a.fly(c.getDom("attachInfo_full").parentNode).remove();try{a.fly(c.getDom("attachInfo_compact")).remove()}catch(r){}}else c.getDom("dvAttachHead").innerHTML=c.view.getAttachHeader(m.length),c.attach.updateHeaderInfo();c.inlineChecked=!0}}}function o(){var a=this,b=$C(a.createId("replyInput")),c=a.view.getReplyNotice(),d=c+H.t("（按Ctrl+Enter键发送）");b.showPlaceholder(c),b.getEl().attr({title:d,"aria-label":d})}function p(){var d=this,e=d.data,f=d.folderData,g=f.flags||{},h=f.tag||[],i=d.fid,j=[],k=e.from;k=k instanceof b.Array?k[0]:k.toString();var l="";e.headers&&e.headers.From&&(l=e.headers.From);var m=!1,n=!1;if(a.Array.has(h,"%st_sys_fake%"))j.push(d.addBlockInfo("DAWarn",!0)),n=!0;else{if(e.antispamInfo!==c){var o=a.String.trim((e.antispamInfo.RulesType+"").toLowerCase());(0===o.indexOf("fake")||0===o.indexOf("ntesfake"))&&(j.push(d.addBlockInfo("systemWarn",!0)),m=!0)}5!==i||m||j.push(d.addBlockInfo("spamFolder",!0))}if(g.realAttached&&!d.part){var p=e.attachments||[];0===p.length&&j.push(d.addBlockInfo("attachWrong",!0))}if(18===i&&g.read&&j.push(d.addBlockInfo("subscribe",!0)),3===i||-1===i&&3===f.fid){var q=F.getSendInfo(f);q&&j.push(d.addBlockInfo("sendStatus",!0,{info:q}))}else{var r,s,t=[];g.replied&&(t.push(H.t("回复")),s="re"),g.forwarded&&(t.push(H.t("转发")),s=s===c?"fw":"refw"),r=t.join(H.t("且")),r.length>0&&j.push(d.addBlockInfo("mailStatus",!0,{msg:H.t("邮件已被")+r+"&nbsp;&nbsp;",icon:s}))}d.isEncrypted&&(d.decryption=new D(d),j.push(d.addBlockInfo("decryptForm",!0))),3===i&&g.encrypted&&f.encpwd&&j.push(d.addBlockInfo("decryptPwd",!0,{pwd:f.encpwd})),d.junkPicTip&&(j.push(d.addBlockInfo("junkPic",!0)),delete d.junkPicTip),$S("isyeah")&&5!==i&&a.Uri.getAddress(k)!==a.Uri.getAddress(l)&&j.push(d.addBlockInfo("EAI",!0,{EAI:a.Uri.getAddress(l)})),j.length>0&&a.fly(d.getDom("dvBlockInfo")).show().html(j.join("")),d.tipsComplete=!0,(m||n)&&(d.errorMailWarn=!0)}function q(b,d,e){var f,g=this,h=g.view.getBlockConf(b,e);if(h!==c){if(d)return a.Block.html(h);if($C(g.createId(b))!==c)return;f=g.getDom("dvBlockInfo"),f.style.display="",new a.Block(h).render(f),f=c}}function r(b){var d=this;if(d.locked)return 0===b.type&&a.Msgbox.show({title:H.t("抱歉，已加锁邮件暂不支持全文翻译。"),header:H.t("系统提示")}),void 0;if(d.translator===c&&(d.translator=new E(d)),b.check){if(d.isServiceMail&&d.isMailServiceAvailable())return;var e,f,g,h=/^[A-Za-z\s`~!@#\$%\^\-\&\*\(\)_\+<>\?:"\{\},\.\\\/;'\[\]]+$/,i=/\b[A-Za-z]+\s/gi;if(!h.test(d.folderData.subject)){if(e=d.body.getBodySize(),e>51200||0===e)return;if(f=d.body.getBodyText().slice(0,499),g=f.match(i)||[],g.length<20)return}return d.translator.check(),void 0}d.translator.translate(b.type),d.log({action:"click",item:"trans_tip"})}function s(){var a=this,b=a.baseUrl;return a.junkPic&&(b+="&filterImages=on"),a.isHidden&&(b+="&preventSetRead=on"),a.part&&(b+="&part="+a.part),document.body.className.indexOf("ua-noYaHei")<0&&(b+="&font=15"),a.bodyEncoding!==c&&(b+="&encoding="+a.bodyEncoding),b+="&color="+$G.user.color}function t(a,d){var e=this,f=d===c?a:function(){b.setTimeout(a,d)};if(e.inited)return f(),void 0;var g=e.initCalls;g===c&&(e.initCalls=g=[]),g.push(f)}function u(){var a=this,b=a.initCalls;if(b!==c){for(;b.length>0;)try{b.shift()()}catch(d){}delete a.initCalls}}function v(){var a=this.module;a.log.apply(a,arguments)}function w(){try{this.getDom("h1Subject").focus()}catch(a){}}function x(){return!0}try{var y=$L("module.read.MailReaderView")}catch(z){return z}try{var A=$L("module.read.MailReaderBody")}catch(z){return z}try{var B=$L("module.read.MailReaderAttach")}catch(z){return z}try{var C=$L("module.read.MailReaderAssistant")}catch(z){return z}try{var D=$L("module.read.MailReaderDecryption")}catch(z){return z}try{var E=$L("module.read.MailReaderTranslator")}catch(z){return z}try{var F=$L("interface.MboxInterface")}catch(z){return z}var G,H=new $I18N("module.read.MailReader");G=a.createClass($N("module.read.MailReader")),a.Object.extend(G.prototype,{initialize:d,init:e,isMailServiceAvailable:f,initMailService:g,initBody:h,setAttachObj:i,showHeader:j,resetReceiverText:k,resetAttachFlag:l,showAttach:m,updateInlineAttach:n,fillReplyInput:o,showTips:p,addBlockInfo:q,translate:r,getFrameUrl:s,addInitCall:t,exeInitCall:u,focusSubject:w,log:v,destroy:x})}($,window),function(a,b,c){function d(a){var b=this,d=a.level,e=a.param;b.action===c&&(b.action=new i),d>0&&b.loadMailData(e),d>1&&b.loadFrame(e)}function e(a){var b=this,d=a.mid,e=a.call,f=b.dataCache[d];return f===c?f:f.loading?(f.call=e,"loading"):(e(f.data),"complete")}function f(a){var d,e,f=this,g=a.mid,h=f.frameCache[g],i=h.frame;h!==c&&(d=a.createId("frameBody"),e=a.reader.body,i.attr({id:d,name:d}),f.frameHandler!==c&&b.clearTimeout(f.frameHandler),a.getDom("dvContent").appendChild(i.dom),i.show(),h.loaded&&(e.frame=i.dom,e.onLoadHandler(),i.destroy()),i.listen("load",function(){e.onLoadHandler(this),i.destroy()}),f.frameCache[g]=c)}function g(b){function d(b){if(b.code!==a.S_OK)return h[g]=c,void 0;var d=h[g];d.loading=!1,d.data=b,d.call!==c&&(d.call(b),d.call=c)}var e,f=this,g=b.id,h=f.dataCache;h[g]===c&&(e={id:g,header:!0,returnImageInfo:!0,returnAntispamInfo:!0,autoName:!0,returnHeaders:{"Resent-From":"A",Sender:"A","List-Unsubscribe":"A","Reply-To":"A"},supportTNEF:!0},$S("isyeah")&&(e.returnHeaders.From=""),b.part&&(e.part=b.part),b.markRead&&(e.markRead=!0),"archive"===b.area&&(e.mboxa="2"),h[g]={loading:!0},f.action.wmsvr({func:"mbox:readMessage",body:e,call:function(a){d(a)},log:{l:"read",action:"read"},cacheFlag:3,hideWait:!0}))}function h(d){var e,f,g=this,h=d.id,i=g.frameCache;i[h]===c&&(e=a.Element.create("IFRAME"),f=m+"&mid="+h+"&color="+$G.user.color,(2===l||1===l&&5===d.fid)&&(f+="&filterImages=on"),document.body.className.indexOf("ua-noYaHei")<0&&(f+="&font=15"),e.attr({frameBorder:"0",scrolling:"no",src:f}),e.setClass("oD0"),e.css({height:"400px",display:"none"}),i[h]={frame:e,loaded:!1},a.Event.one(e.dom,"load",function(){i[h]!==c&&(i[h].loaded=!0)}),g.frameHandler=b.setTimeout(function(){g.frameHandler=c,document.body.appendChild(e.dom)},0))}try{var i=$L("module.BaseAction")}catch(j){return j}var k;k=a.createClass($N("module.read.Turbo"));var l=$S("attrs").user.junkpic||0,m=a.Ext.read_noSsidRead?"read/readhtml.jsp?preventSetRead=true":$G.environment.readUrl+"&preventSetRead=true";a.Object.extend(k,{frameCache:{},dataCache:{},start:d,getMailData:e,getFrame:f,loadMailData:g,loadFrame:h})}($,window),function(a,b,c){function d(a,b){var d,e=this;e.constructor.superClass.initialize.apply(e,arguments),a&&(e.mid=a.id||a.mid,e.part=a.part,e.speed=b.speed,e.locked=a.locked,d=a.action),e.reader=new r({module:e,mid:e.mid,fid:e.fid,folderData:e.folderData,isThread:e.isThread,isHidden:e.isHiddenMod,viewType:e.viewType,part:e.part,area:e.area,speed:e.speed,locked:e.locked}),e.checkServiceMail(),d!==c&&e.reader.addInitCall(function(){switch(d){case"reply":e.reader.assistant.reply();break;case"replyAll":e.reader.assistant.reply({type:"all"});break;case"forward":e.reader.assistant.forward()}}),e.reader.addInitCall(function(){e.reader.view.getAD(!0)})}function e(b){function d(h){function i(a){a!==c&&(e.data=f.data=a["var"]),e.part&&(e.folderData=e.reader.folderData={subject:e.data.subject,flags:{},from:e.data.from},"textCall"in e&&(e.textCall(e.getText()),delete e.textCall),j()),e._subInit()}var j=function(){h||b()};try{var k=g.tag||[],l=$S("attrs").user.junkpic;a.Array.has(k,"%st_sys_fake%")&&0!==l&&(f.junkPic=!0)}catch(m){}var n=e.locked;if(n&&!h){try{var o=$L("product.MailUnlock",this)}catch(p){return p}return o.unlockMail(function(){f.body.reload(!0),d(!0)},function(){e.remove()}),j(),void 0}var q;if(f.resetReceiverText(),f.resetAttachFlag(),!e.part&&!f.isDecrypted){if(q=s.getMailData({mid:e.mid,call:function(a){a!==c&&(e.data=f.data=a["var"]),f.setAttachObj(),e.resourcePreloaded===c&&(e.resourcePreloaded=!0,j()),e._subInit()}}),"complete"===q)return;if("loading"===q)return e.resourcePreloaded=!1,j(),void 0}e.part||j();var r={param:{area:e.area,mid:e.mid,part:e.part,markRead:!(e.folderData.flags||{}).read&&!e.isHiddenMod,password:e.token},call:i,cacheFlag:f.isDecrypted?0:3,isHidden:e.isHiddenMod};e.action.readMessage(r)}var e=this,f=e.reader,g=e.folderData;g===c?v.getLetterData({moduleName:e.listModule,mid:e.mid,callback:function(b,c){b&&(e.folderData=f.folderData=g=b,e.fid=f.fid=b.fid,e.checkServiceMail(),"textCall"in e&&!e.part&&(e.textCall(e.getText()),delete e.textCall),d()),c&&c.code===a.S_PARTIAL_OK&&a.Msgbox.show({header:x.t("读信异常"),content:x.t("抱歉，该封信件不存在。"),ok:function(){e.remove()}})}}):d()}function f(){var a=this;a.constructor.superClass.init.apply(a),a.isHiddenMod||b.setTimeout(function(){try{a.getDom("h1Subject").focus()}catch(b){}},500),a.log({action:"init",item:"mod"})}function g(){var a=this,c=a.reader;a.isHiddenMod&&(a.isHiddenMod=c.isHidden=!1,c.body.autoSize(),b.setTimeout(function(){a.getDom("h1Subject").focus(),c.assistant.sendReceipt()},0)),a.constructor.superClass.cache.apply(a,arguments)}function h(){var a=this;a.speed&&!a.reader.locked&&s.getFrame(a)}function i(){var a=this.reader;a.focusSubject()}function j(){var b=this,d=b.folderData;if(d!==c){var e=d.tag;b.isServiceMail=b.reader.isServiceMail=a.Ext.read_mailService&&!b.isThread&&e instanceof Array&&a.Array.has(e,"%st_p_extr%")}}function k(){var c=this;c.reader.init();var d,e=(c.data.antispamInfo||{}).RulesType,f=c.fid;if(e&&"ntessale"!==e&&5!==f&&7!==f)if(e=a.String.trim(e.toLowerCase()),e&&0!==e.indexOf("fake")&&0!==e.indexOf("ntesfake")&&"ntessys"!==e){d=c.getDom("h1Subject"),d.innerHTML='<img src="https://mimg.127.net/p/js4/lib/img/integrity/cx_0.gif" class="kF0" alt="'+x.t("网易诚信邮件联盟认证邮件")+'" title="'+x.t("网易诚信邮件联盟认证邮件")+'"/>'+d.innerHTML,c.getEl("dvReadHeadInfo").addClass("uL0");var g=c.getDom("dvSystemCert");g&&(g.innerHTML='<img class="tX1" src="https://mimg.127.net/p/js4/lib/img/integrity/cert_cx.png" alt="'+x.t("网易邮件认证 呈现联盟")+'">')}else if("ntessys"===e){d=c.getDom("h1Subject"),d.innerHTML='<img src="https://mimg.127.net/p/js4/lib/img/integrity/cx_e.gif" class="kF0" alt="'+x.t("网易官方邮件")+'" title="'+x.t("网易官方邮件")+'"/>'+d.innerHTML,c.getEl("dvReadHeadInfo").addClass("uL0");var g=c.getDom("dvSystemCert");g&&(g.innerHTML='<img class="tX1" src="https://mimg.127.net/p/js4/lib/img/integrity/cert_ntes.png" alt="'+x.t("网易官方邮件")+'">')}b.setTimeout(function(){c.reader.translate({check:!0})},500)}function l(){var d=this,e=a.Event.getTarget(),f=d.scrollTimer;f!==c&&(b.clearTimeout(f),d.scrollTimer=c),d.scrollTimer=b.setTimeout(function(){d.getDom("backToTop").style.display=e.scrollTop>0?"":"none",d.scrollTimer=c,e=c},500)}function m(){var a=this;a.reader.destroy(),a.constructor.superClass.moduleRemove.call(a)}try{var n=$L("module.read.BaseReadModule")}catch(o){return o}try{var p=$L("module.read.ReadAction")}catch(o){return o}try{var q=$L("module.read.ReadListener")}catch(o){return o}try{var r=$L("module.read.MailReader")}catch(o){return o}try{var s=$L("module.read.Turbo")}catch(o){return o}try{var t=$L("module.read.ReadView")}catch(o){return o}try{var u=$L("interface.ReadInterface")}catch(o){return o}try{var v=$L("interface.MboxInterface")}catch(o){return o}var w,x=new $I18N("module.read.ReadModule");w=a.createClass($N("module.read.ReadModule")),a.Object.mix(w,n,{"interface":u,Action:p,View:t,Listener:q,cls:"tR0",ariaLabel:x.t("读信")},{css:"",logPrefix:"read",initialize:d,getData:e,init:f,cache:g,onAfterRender:h,onFocus:i,checkServiceMail:j,_subInit:k,_scrollHandler:l,remove:m})}($,window),function(a){function b(b){var c;try{c=k.getTime(0)}catch(d){c=new Date}var e=["c",c.valueOf()].join(":");b=b||{};var f=b.type||"compose";if("compose"!=f){var g=b.param;if(g){if("string"==typeof g.id&&(e=g.id),"reply"==f){var h=g.body;h&&(h.toAll&&(f+="_all"),h.withAttachments&&(f+="_ach"))}if("forward"==f){var h=g.body;h&&"attach"==h.mode&&(f+="_ach")}}else f="compose",b={}}var i=!1;if("compose"==f){var j=a.JS.modules["compose.ComposeModule"];o.each(j,function(c,d){return-1!=c.indexOf('"type":"compose"')&&d.empty()?(a.JS.go(d),q.resetModule(d,b.param),i=!0,a.BREAK):void 0})}if("draft"==f){var j=a.JS.modules["compose.ComposeModule"];o.each(j,function(b,c){var d=c.info.get({did:!0});return d&&d==e?(a.JS.go(c),i=!0,a.BREAK):void 0})}if(!i){var l=!0,m={type:f,fullScreen:l,cid:e},n="";"0"==p.get({field:"ntes_global",flag:"compose_showContacts"})&&(n="l-r");var r={module:"compose.ComposeModule",param:m,extend:b,viewType:n,hasChildMod:!0,noDragbar:!0};a.JS.go(r)}}function c(a,b){var c=a.base,d=a.data,e=a.sign;b&&b.info&&c.fillContent(b.info),d.set({status:"initSign",value:!1}),d.set({status:"useSign",value:null}),e.load(),c.autoSave(),c.autoKeep()}function d(b,c){var d="";switch(b.code){case"FA_FORBIDDEN":d=n.t("发信附加功能权限不足！");break;case"FA_OVERFLOW":if(b.overflowReason)switch(d=b.overflowReason){case"pref_smtp_max_mail_count":d=n.t("信件封数超过限制！");break;case"pref_smtp_max_num_rcpts":d=n.t("收件人个数超过限制！");break;case"pref_smtp_max_send_mail_size":d=n.t("信件大小超过限制！");break;case"pref_flow_limit":d=n.t("信件流量超过限制！");break;case"pref_quota":d="save"===c?n.t("邮箱容量已满，邮件无法保存为草稿，请尽快清理邮箱。立即开通邮箱会员，可享受超大存储空间"):"deliver"===c?n.t("邮箱容量已满，邮件未能保存到“已发送”文件夹。立即开通邮箱会员，可享受超大存储空间"):n.t("存草稿或定时发信时邮箱容量超过限制，请尽快清理邮箱。")}else d="",d+=n.t("1、收件人个数超过限制　　　　　&nbsp;")+"<br>",d+=n.t("2、信件大小或流量超过限制　　　&nbsp;")+"<br>",d+=n.t("3、存草稿或定时发信容量超过限制&nbsp;");break;case"FA_NO_RECEIPT":d=n.t("发信时缺少收件人！");break;case"FA_WRONG_RECEIPT":d=n.t("收件人地址格式错误！"),b.badAddress&&(d+="("+a.String.escapeHTML(b.badAddress)+")");break;case"FA_INVALID_ACCOUNT":d=n.t("发件人地址格式错误！"),b.badAddress&&(d+="("+a.String.escapeHTML(b.badAddress)+")");break;case"FA_INVALID_DATE":d=n.t("定时发信设置时间错误！");break;case"FR_INVALID_REQUEST":d=n.t("发信内容格式错误！");break;case"FA_MTA_USER_BLACK_LIST":d=n.t("黑名单用户不允许发信！");break;case"FA_MTA_TOO_MANY_RCPTS":d=n.t("发送人数超过限制！");break;case"FA_MTA_RCPT_ERROR":d="FA_MTA_RCPT_ERROR";break;case"FA_MTA_REJECTED":if(b.mtaCode)switch(b.mtaCode){case 5510:d=n.t("IP地址异常，请求被拒绝！");break;case 5511:d=n.t("对不起，您的帐号目前被禁止发信")+n.t("，请")+'<a href="http://feedback.mail.126.com/antispam/complain.php?user='+$S("uid")+'" target="_blank">'+n.t("点击这里申诉")+"</a>。";break;case 5520:d=n.t("对不起，您今天发送邮件数量超过限制，请明日再试！");break;case 5521:d=n.t("短时间发信过多，请稍后再试！");break;case 5530:d=n.t("对不起，您今天发送对象过多，请明日再试！");break;case 5531:d=n.t("短时间发送对象过多，请稍候尝试！");break;case 5522:d=n.t("操作过于频繁，请求被拒绝！");break;case 4512:case 5540:case 5910:d=n.t("邮件含敏感内容，请求被拒绝！");break;case 5911:d=n.t("对不起，您只能发送邮件给系统管理员！");break;case 5532:d=n.t("对不起，您本次群发的收件人数量超过限制，请减少后重发！");break;case 5550:d="5550"}d||(d=n.t("对不起，未知原因导致服务器拒绝发送！"),b.mtaCode&&(d+="("+n.t("错误码")+":"+b.mtaCode+")"))}return d}function e(b,c,d){var e={need:n.t("非常抱歉，系统认为您需要输入验证码才能继续完成发信，如有不便，敬请体谅！"),invalid:n.t("验证码不正确，请重新输入！")},f=e[b],g="s?func=user:generateVerifyCodeImage&sid="+$S("sid")+"&time="+(new Date).valueOf(),h="<p>"+f+"</p>"+'<img id="imgMsgBoxVerify" src="'+g+'" alt="'+n.t("验证码图片")+'" >'+'<p><a id="aMsgBoxVerify" href="javascript:void(0)" class="nui-txt-link">'+n.t("看不清楚？换一个")+"</a></p>";a.Msgbox.show({type:"prompt",header:n.t("发信验证"),title:n.t("填写验证码"),content:h,inputWidth:"300px",ok:function(b){var d=a.String.trim(b);return d?(c&&c(d),void 0):n.t("验证码不能为空")},cancel:function(){d&&d()}});var i=a("#aMsgBoxVerify"),j=a("#imgMsgBoxVerify");i.listen("click",function(){var a=j.dom.src,b=new RegExp("&time=.*|$","i");return a=a.replace(b,"&time="+(new Date).valueOf()),j.dom.src=a,!1})}function f(a){var b;if(b=a.attrs?a.attrs:a.attrs={},"string"!=typeof b.account)try{b.account=m.getDefault().toString()}catch(c){}return"boolean"!=typeof b.saveSentCopy&&$S("attrs").user.save_sent<2&&(b.saveSentCopy=!0),"boolean"!=typeof b.requestReadReceipt&&"1"==p.get({field:"ntes_option",flag:"requirereceipt"})&&(b.requestReadReceipt=!0),"string"!=typeof b.charset&&"1"==p.get({field:"ntes_option",flag:"mailencode"})&&(b.charset="UTF-8"),a.returnInfo=!1,a.action="deliver",0===$S("attrs").user.save_sent&&(a.saveTextThreshold=1048576),a}function g(b){try{var c=$L("module.compose.ComposeAction",this)}catch(d){return d}var e=this,f=b.id,g=b.body;g.id=f,b.flag="replied",c.prototype.replyMessage({body:e.quickBuild(g),log:{action:"fastreply"},error:a.Function.bind(e.quickError,e,b,e.quickReply),callback:a.Function.bind(e.quickSuccess,e,b)}),a.Tips.show(n.t("正在回复邮件..."))}function h(b){try{var c=$L("module.compose.ComposeAction",this)}catch(d){return d}var e=this,f=b.id,g=b.body;g.ids=[f],b.flag="forwarded",c.prototype.forwardMessages({body:e.quickBuild(g),log:{action:"quickForward"},error:a.Function.bind(e.quickError,e,b,e.quickForward),callback:a.Function.bind(e.quickSuccess,e,b)}),a.Tips.show(n.t("正在转发邮件..."))}function i(a,b){a.callback&&a.callback({code:b.code})}function j(b,c,d){var e=this,f=b.callback||a.EMPTYFUNC(),g=e.error(d);if(g)return f({code:"S_ERROR"}),g;switch(d.code){case"FA_INVALID_VERIFY_CODE":case"FA_NEED_VERIFY_CODE":var h=d.code.split("_")[1].toLowerCase();return e.verify(h,function(a){b.body.verifyCode=a,c.call(e,b)},function(){f({code:"S_ERROR"})}),!0}return f({code:"S_ERROR"}),!1}try{var k=$L("util.Misc")}catch(l){return l}try{var m=$L("init.SenderList")}catch(l){return l}var n=new $I18N("module.compose.ComposeManager"),o=a.Object,p=a.Ud,q=a.createClass($N("module.compose.ComposeManager"));o.extend(q,{entry:b,resetModule:c,error:d,verify:e,quickBuild:f,quickReply:g,quickForward:h,quickSuccess:i,quickError:j})}($,window),function(a){function b(a){var b=this;b.module=a,b["class"]=a["class"]}function c(){var b=this,c=b.module;a.Array.each(b.names,function(a,d){try{b[d]=c[d]}catch(e){}})}function d(){var b=this;a.Object.each(b,function(a,c){c&&(b[a]=null),delete b[a]})}var e=a.createClass($N("module.compose.Compose")),f=["action","assist","attach","base","data","editor","event","form","info","view","sign","stationery","at","success"];a.Array.each(f,function(a,b){e.prototype[b]=null}),a.Object.extend(e.prototype,{param:null,"class":null,module:null,names:f,initialize:b,init:c,clear:d})}($,window),function(a){function b(b){var c=this,d={func:"mbox:compose",log:z.extend({l:"compose"},b.log),body:b.body,error:b.error,call:b.callback};a.Log.cache({ComposeSend:b.action}),c.wmsvr(d)}function c(a){var b=this,c={func:"upload:prepare",log:z.extend({l:"compose"},a.log),body:a.body,error:a.error,call:a.callback};b.wmsvr(c)}function d(b){try{var c=a.Uri.getUrl("notary_info");a.Ajax.jsonp(c,function(a){b&&b(a)},"callback")}catch(d){}}function e(a,b,c){function d(a){var b=a.children[0],c=b.children[0].innerHTML,d={code:c};return d}var e=new XMLHttpRequest,f=location.protocol+"//"+$G.environment.host+"/"+$G.config.appName+"/s?sid="+$G.user.sid,g="&func=mbox:composeF&action=deliver";"undefined"!=typeof FormData&&a&&(e.open("post",f+g),e.addEventListener("load",function(a){var e=a.currentTarget,f=d(e.responseXML);200===e.status&&("S_OK"===f.code?b&&b(a):c&&c("api-error",f.code,a))}),e.addEventListener("error",function(a){c&&c("network-error",a)}),e.addEventListener("abort",function(a){c&&c("abort",a)}),e.send(a))}function f(a){var b=this,c={func:"upload:prepare",log:z.extend({l:"compose"},a.log),body:a.body,error:a.error,call:a.callback};b.wmsvr(c)}function g(a){var b=this,c={func:"mbox:compose",body:{},call:a.callback};b.wmsvr(c)}function h(a){var b=this,c={func:"mbox:getComposeInfo",body:{id:b.info.get({cid:!0})},call:a.callback};b.wmsvr(c)}function i(a){var b=this,c={func:"mbox:cancelComposes",body:{ids:[b.info.get({cid:!0})]},call:a.callback};a.deleteDraft&&(c.body.deleteDraft=!0),b.wmsvr(c)}function j(a){var b=this,c={func:"mbox:restoreDraft",body:a.body,call:a.callback};b.wmsvr(c)}function k(a){var b=this,c={func:"mbox:replyMessage",log:z.extend({l:"read"},a.log),body:a.body,error:a.error,call:a.callback};b.wmsvr(c)}function l(a){var b=this,c={func:"mbox:forwardMessages",log:z.extend({l:"read"},a.log),body:a.body,error:a.error,call:a.callback};b.wmsvr(c)}function m(a){var b=this,c={func:"mbox:editMessage",body:a.body,call:a.callback};b.wmsvr(c)}function n(a){var b=this,c={func:"mbox:saveSent",body:{id:a.mid},ignoreError:!0,call:a.callback};b.wmsvr(c)}function o(a){var b=this,c={func:"global:sequential",body:{items:[{func:"mbox:saveSent","var":{id:a.saveMid}},{func:"mbox:deleteMessages","var":{id:a.delMid}}]},ignoreError:!0,call:a.callback};b.wmsvr(c)}function p(a){var b=this,c={func:"mbox:compose",body:{id:b.info.get({cid:!0}),action:"continue",returnInfo:!0,attrs:{attachments:a.attachments}},call:a.callback};b.wmsvr(c)}function q(b){var c=this,d=b.sid,e=null;if(d){e="object"==typeof d&&d.length?d:[d];var f=[];a.Array.each(e,function(a,b){f.push({id:b,deleted:!0})});var g={func:"mbox:compose",body:{id:c.info.get({cid:!0}),action:"continue",attrs:{attachments:f}},call:b.callback};c.wmsvr(g)}}function r(a){var b=this,c={func:"ntes:mbox:ynote",body:{action:"saveEmail",mid:a.mid},call:a.callback,error:a.error};b.data.get({status:"showEncrypt"})&&(c.body.password=b.encrypt.get()),b.wmsvr(c)}function s(a){var b=this,c={func:"mbox:cancelDeliver",body:{tinfo:a.tinfo},call:a.callback,error:a.error};b.wmsvr(c)}function t(a){var b=this,c={func:"upload:getTasks",body:{composeId:a.cid},call:a.callback,error:a.error};b.wmsvr(c)}function u(b){var c="//"+$S("host")+"/rcmd/rcmd?format=json&uid="+$S("uid")+"&sid="+$S("sid")+"&product=webmail&cmd=wrongContact",d=JSON.stringify(b["var"]),e={"var":d};a.Ajax.request({requestType:a.Ajax.XMLHTTP,method:a.Ajax.POST,url:c,rnd:!1,body:e,call:b.callback})}function v(a){var b=this,c={func:"ntes:mbox:getSubject",body:{url:a.url},call:a.callback,error:a.error};b.wmsvr(c)}try{var w=$L("module.BaseAction")}catch(x){return x}try{var y=$L("module.compose.Compose")}catch(x){return x}var z=a.Object,A=a.createClass($N("module.compose.ComposeAction"));z.mix(A,w,null,{}),z.extend(A.prototype,y.prototype),z.extend(A.prototype,{send:b,uploadPrepare:c,getNotaryBalance:d,getMessageData:f,sendByformData:e,getId:g,getInfo:h,cancelId:i,restoreDraft:j,replyMessage:k,forwardMessages:l,editMessage:m,saveSent:n,saveSentAndDel:o,syncAttach:p,deleteAttach:q,save2YNote:r,cancelDeliver:s,getTasks:t,contactCorrect:u,getSubject:v})}($,window),function(a,b){function c(a){var b=this;T.extend(b,{assist:{request:null,capture:null},status:{captureDialog:!1,captureIndex:0,dragSupport:"",dragTarget:"",dragEffect:""}}),W.superClass.initialize.call(b,a)}function d(){var a=this;W.superClass.init.call(a)}function e(){var a=this;a.assist.request=null,a.assist.capture=null,W.superClass.clear.call(a)}function f(a){var b=this;return"string"==typeof a.status?b.status[a.status]:"string"==typeof a.assist?b.assist[a.assist]:void 0}function g(a){var b=this,c=a.value;"string"==typeof a.status?b.status[a.status]=c:"string"==typeof a.assist&&(b.assist[a.assist]=c)}function h(a,b){if(!W.has()&&!b)return null;if(!W.hasNewVersion()&&!b)return null;switch(a){case"request":a="beta.httprequest";break;case"capture":a="ntes.screencapture";break;case"blob":a="beta.blobbuilder";break;case"desktop":a="beta.desktop";break;case"digest":a="ntes.blobdigest"}var c=W.createFactory(a);return c?c:null}function i(b){var c=this,d=c.base,e=S.t("安装"),f=S.t("安 装");"upload"==b&&(e=S.t("升级"),f=S.t("升 级"));var g=W.support();if(g){var h="2G";$S("cloud")&&(h=a.Number.convert($S("cloud").capacity));var i="<div>"+e+S.t("后您可以：")+"<ol>"+"<li>"+S.t("1. 发送")+h+S.t("超大附件")+"</li>"+"<li>"+S.t("2. 截屏功能")+"</li>"+"<li>"+S.t("3. 直接拖曳文件到写信窗口成为附件")+"</li>"+"<li>"+S.t("4. 复制粘贴文件成为附件")+"</li>"+"<li>"+S.t("5. 在邮件正文中插入本地图片")+"</li>"+"</ol>"+S.t("★ 安装过程可能会离开本页面，当前如有信件内容将被保存到草稿箱")+"</div>",j=null;j=a.Msgbox.show({type:"confirm",title:S.t("使用此功能，需要先")+e+S.t("网易邮箱插件"),content:i,okText:f,ok:function(){if(d.empty())c.install(j);else{var a=U.getVersion()||[0,0];U.chrome()&&a[0]>=21?c.install(j,d):d.send({action:"force",call:function(){c.install(j)}})}return!0}})}else{var k=U.getInfo(),i="";"windows"==k.os?i="<b>"+S.t("当前浏览器不支持安装本功能插件，请使用以下浏览器")+"</b><br />"+"1. Internet Explorer<br />"+S.t("2. IE内核模式浏览器，如360浏览器，世界之窗等")+"<br />"+S.t("3. 火狐浏览器(Mozilla Firefox)")+"<br />"+S.t("4. 谷歌浏览器(Google Chrome)")+"<p>"+S.t("★上述浏览器插件目前只限于Windows操作系统支持")+"</p>":"macintosh"==k.os&&(i="<b>"+S.t("当前浏览器不支持安装本功能插件，请使用以下浏览器")+"</b><br />"+"1. Safari<br />"+S.t("2. 火狐浏览器(Mozilla Firefox)")+"<br />"+S.t("3. 谷歌浏览器(Google Chrome)")),a.Msgbox.show({title:S.t("邮箱插件提示"),content:i})}}function j(a,b){W.install({close:function(){a.close()}},b)}function k(){var a=this;a.captureDestroy()}function l(){var a=this,b=a.get({assist:"request"});return b&&"undefined"==typeof b.send&&a.set({assist:"request",value:b=null}),b||(b=a.create("request")),b?(a.set({assist:"request",value:b}),b):null}function m(){var a=this,b=a.get({assist:"capture"});return b&&"undefined"==typeof b.captureScreen&&a.set({assist:"capture",value:b=null}),b||(b=a.create("capture")),b?(a.set({assist:"capture",value:b}),b):null}function n(){var a=this;if(U.chrome())a.nativeCapture(function(b){var c=[],d=a.get({status:"captureIndex"})+1;
a.set({status:"captureIndex",value:d});var e=S.t("截图")+d+".png";b.name=e,b.inlined=!0,c.push(b),a["native"].nativeSelect(c)});else{var b=a.captureGet();b&&(a.get({status:"captureDialog"})?b.focusCaptureDialog():(a.set({status:"captureDialog",value:!0}),b.captureScreen(function(b){a.set({status:"captureDialog",value:!1}),a.captureResult(b)})))}}function o(a){var b=this;a&&1==a.count&&b.captureUpload(a.files[0])}function p(a){var b=this,c=b.get({status:"captureIndex"})+1;b.set({status:"captureIndex",value:c});var d=S.t("截图")+c+".png";a.name=d,a.inlined=!0,b.attach.pluginSelect([a])}function q(){var a=this,b=a.get({assist:"capture"});if(b){if(a.get({status:"captureDialog"})){try{b.closeCaptureDialog()}catch(c){}a.set({status:"captureDialog",value:!1})}a.set({assist:"capture",value:b=null})}}function r(){var c=this;if(W.has()){b.composeClip||a(b.document).listen("keydown",function(){b.composeClip&&b.composeClip.apply(null,arguments)}),b.composeClip=function(b){var c=a.Context.module;"compose.ComposeModule"==c.mtype&&c.assist.clipKey(b,"globe")};var d=a(c.editor.getWindow()),e=a(d.dom.document),f=a(e.dom.body),g=e;e.listen("keydown",function(a){c.clipKey(a,"editor")}),U.ie()&&(g=f,e.listen("contextmenu",a.Function.bind(c.clipMenu,c))),g.listen("paste",a.Function.bind(c.clipImage,c))}else{var h=U.getVersion()||[0,0];if(U.firefox()||U.chrome()||U.ie()&&h[0]>=11){var d=a(c.editor.getWindow()),e=a(d.dom.document);e.listen("paste",function(a){c.nativeClipImage(a,"editor")})}}}function s(a){var b=this;if(U.ie()){var c=b.create("desktop");if(c)try{c.highLightPasteMenu(a)}catch(d){}}}function t(a,b){var c=this;(a.ctrlKey||a.metaKey)&&86==a.keyCode&&c.clipPaste(a,b)}function u(b,c){var d=this,e=d.create("desktop",!0);if(e){var f=null;try{f=e.getClipboardData(b)}catch(g){}if(f&&f.count>=1){var h=T.toArray(f.files);d.base.addTimer("clippaste",function(){d.attach.pluginSelect(h)},200),a.Event.stop(b)}else"editor"==c&&d.clipImage(b)}}function v(b){var c=this,d=c.create("desktop",!0);if(d){var e=null,f=null;try{e=d.getClipboardDataType()}catch(g){}if(e){if(e.files)return;if(e.html)return;if(e.text){if(!e.bitmap||!U.firefox())return;var h="";try{h=d.getClipboardText("text")}catch(g){}if(h)return c.editor.insert({text:h}),a.Event.stop(b),void 0}e.bitmap}try{f=d.getClipboardImage(b)}catch(g){}if(f&&1==f.count){var i=f.files[0];c.base.addTimer("clipimage",function(){c.captureUpload(i)},200),a.Event.stop(b)}}}function w(a){try{var c=$L("module.compose.ComposeNative",this)}catch(d){return d}var e=this,f=a.clipboardData;if(f&&f.items&&1==f.items.length){var g=[],h=f.items[0];if("file"==h.kind&&-1!=h.type.indexOf("image")){(U.firefox()||e.isBrowserPasteImageAsBase64())&&a.preventDefault();var i=e.get({status:"captureIndex"})+1;e.set({status:"captureIndex",value:i});var j=S.t("截图")+i+".png",k=h.getAsFile();k.name=j,k.inlined=!0,g.push(k)}e["native"].nativeSelect(g)}else if(b.clipboardData){f=b.clipboardData;var g=[];if(f.files.length>0){var h=f.files[0];if(h&&h.type&&-1!=h.type.indexOf("image")){a.preventDefault();var l=0,m=h.size-1,n=new FileReader;n.onloadend=function(a){if(a.target.readyState==FileReader.DONE){var b=[a.target.result],d=e.get({status:"captureIndex"})+1;e.set({status:"captureIndex",value:d});var f=S.t("截图")+d+".png",h=new Blob(b,{type:"image/png"});h.name=f,h.inlined=!0,g.push(h);var i=e.module,j=new c(i);j.init(),e["native"]=j,e["native"].nativeSelect(g)}};var o=h.slice(l,m+1);n.readAsArrayBuffer(o)}}}}function x(){return U.chrome()&&a.Browser.getVersion()[0]>=83}function y(c){function d(){chrome.runtime.sendMessage(g,{action:"capture",openUrl:"http://1.163.com"},function(a){if(a){var d=a.dataUrl;if(d){var g=f.dataUrlToBlob(d);c(g)}}else b.gChromeExtensionMailCaptureCheck&&(b.gChromeExtensionMailCaptureCheck=!1,e())})}function e(){a.Msgbox.show({type:"confirm",title:S.t("截图插件提示"),content:S.t("进入Chrome应用商店安装截图插件,安装成功后可使用截图功能！"),okText:S.t("立即安装"),ok:function(){b.gChromeExtensionMailCaptureCheck=!0,b.open(a.Uri.getUrl("compose_attach_chrome_capture",!0))}})}var f=this;if(!b.gChromeExtensionMailCaptureInstall&&!b.gChromeExtensionMailCaptureCheck)return e(),void 0;var g="jmhbgmmcnagjjihogbfmghlfegaidcfj";d()}function z(a){var b=atob(a.split(",")[1]);a.split(",")[0].split(":")[1].split(";")[0];for(var c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);var f=new Blob([c]);return f}function A(){try{var c=$L("module.compose.ComposeNative",this)}catch(d){return d}var e=this;e.base;var f=e.data,g=e.editor,h="",i=Number(a.Browser.ie());if(U.firefox()||U.chrome()||i>=10?"undefined"!=typeof FileReader&&(h="native"):U.safari()&&"undefined"!=typeof FileList&&(h="native"),h||W.has()&&(h="plugin"),h){if(e["native"]=e.attach,"native"==h&&W.has()){var j=e.module,k=new c(j);k.init(),e["native"]=k}if(e.set({status:"dragSupport",value:h}),!b.composeDrag){var l=a(b);U.ie()&&(l=a(l.dom.document.body),l.listen("dragenter",function(b){a.Event.stop(b)})),l.listen("dragover",function(){b.composeDrag.apply(null,arguments)}),b.composeDrag=function(b){var c=a.Context.module;"compose.ComposeModule"==c.mtype&&c.assist.dragOver(b,"globe")}}if(U.ie())a(g.getWindow().document.body).listen("dragover",function(a){e.dragOver(a,"editor")});else{var m=a(g.getWindow());m&&m.listen("dragover",function(a){e.dragOver(a,"editor")}),U.firefox()&&m&&m.listen("drop",function(a){e.dragDrop(a,"editor")},!0),m&&m.listen("drop",function(a){e.dragDrop(a,"editor")})}var n=f.get({moduleId:"attachDrag"}),o=f.get({moduleId:"attachDragClose"});n.listen("dragover",function(a){e.dragOver(a,"area")}),n.listen("drop",function(a){e.dragDrop(a,"area")}),n.listen("click",function(b){a.Event.stop(b)}),o.listen("click",function(){e.event.setDragArea({hide:!0,force:!0})})}}function B(b){var c=this,d=c.get({status:"dragSupport"}),e=!1;if("native"==d){var f=b.dataTransfer;f.files&&f.files.length?e=!0:f.types&&a.Array.each(T.toArray(f.types),function(b,c){return"text/html"==c?a.BREAK:"Files"==c?(e=!0,a.BREAK):void 0})}else if("plugin"==d){var g=c.create("desktop");if(g)try{var h=g.getDragData(b,"application/x-gears-files");h.count>0&&(e=!0)}catch(i){-2146827287==i.number&&(e=!0)}}return e}function C(a,b){var c=this,d=c.get({status:"dragSupport"});if(c.dragHas(a)){var e=!1;if("editor"==b){var f=0;if("native"==d){var g=a.dataTransfer;"number"==typeof g.mozItemCount?f=g.mozItemCount:g.files&&(f=g.files.length>0?g.files.length:1)}else if("plugin"==d){var h=c.create("desktop"),i=null;try{i=h.getDragData(a,"application/x-gears-files")}catch(j){}if(i&&1==i.count){var k=String(i.mimeTypes).toLowerCase();0===k.indexOf("image/")&&(f=1)}}1==f&&(e=!0)}"area"==b&&(e=!0),("globe"==b||"editor"==b)&&c.event.setDragArea({show:!0}),c.set({status:"dragEffect",value:e?"copy":"none"})}}function D(b,c){var d=this;d.get({status:"dragTarget"})!=c&&(d.set({status:"dragTarget",value:c}),d.dragCheck(b,c));var e=d.get({status:"dragEffect"});if(e){var f=b.dataTransfer;U.ie()?f.dropEffect="copy":(f.effectAllowed=e,f.dropEffect=e),d.base.addTimer("dragstop",function(){d.set({status:"dragTarget",value:""}),d.set({status:"dragEffect",value:""}),d.event.setDragArea({hide:!0})},200),a.Event.stop(b)}else d.base.addTimer("dragstop",function(){d.set({status:"dragTarget",value:""})},200)}function E(b,c){var d=this;if(d.get({status:"dragEffect"})){d.event.setDragArea({hide:!0,force:!0}),a.Event.stop(b);var e=d.get({status:"dragSupport"}),f=null,g=null;if("native"==e){var h=b.dataTransfer;f=h.files}else if("plugin"==e){var i=d.create("desktop");if(i)try{g=i.getDragData(b,"application/x-gears-files"),f=g.files}catch(j){}}if(f&&f.length>=1&&(f=T.toArray(f),"area"==c&&("native"==e?d["native"].nativeSelect(f):"plugin"==e&&d.attach.pluginSelect(f)),"editor"==c)){if(1!=f.length)return;var k=f[0],l="";if("native"==e?l=k.type:"plugin"==e&&(l=g.mimeTypes),l&&(l=String(l).toLowerCase()),0===l.indexOf("image/"))k.inlined=!0,"native"==e?d["native"].nativeSelect([k]):"plugin"==e&&d.attach.pluginSelect([k]);else if("text/html"==l||"text/plain"==l){var m="";if(k.getAsBinary&&k.getAsText){var n=k.size||k.fileSize||0;if(!(n>0&&102400>=n))return;var o="",p=k.getAsBinary(),q=p.substr(0,3);q==String.fromCharCode(239,187,191)||q.substr(0,2)==String.fromCharCode(255,254)||q.substr(0,2)==String.fromCharCode(254,255)||(o="GBK"),m=k.getAsText(o)}else;m&&("text/html"==l?d.editor.set({html:m}):d.editor.set({text:m}))}}}}function F(){var a=null,b=null;if("undefined"!=typeof MailAssistFactory)a=new MailAssistFactory;else try{a=new ActiveXObject("MailAssist.Factory"),b=a.create("ntes.updateservice")}catch(c){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-mailassist"]&&(a=document.createElement("object"),a.style.position="absolute",a.width=0,a.height=0,a.type="application/x-mailassist",document.body.appendChild(a),a&&"undefined"==typeof a.create&&(a=null))}a?(W.factory=a,W.updater=b?b:!1):W.factory=!1}function G(a){if(W.has())try{return W.factory.create(a)}catch(b){}return null}function H(){if(null===W.factory&&W.initFactory(),W.factory){if("undefined"!=typeof W.factory.create)return!0;W.factory=null}return!1}function I(){if(W.has()){var a=W.getVersion();if(2==a[0]&&a[1]>=1||a[0]>=3)return!0}return!1}function J(){var a=null;if(W.has()){var b=W.factory.version;b&&(a=b.split("."))}return a}function K(a){if(W.has()&&W.updater)try{return W.updater.StartUpdate(a),!0}catch(b){}return!1}function L(){var a=!1,b=U.getInfo();return"windows"==b.os&&(U.ie()||U.firefox())?(a=!0,b.shell?("360"==b.shell||"theworld"==b.shell||"sogou"==b.shell)&&(a=!0):a=!0):"macintosh"==b.os&&(U.safari()||U.firefox())&&(a=!0),a}function M(a,b){a=a||{};var c=U.getInfo();"windows"==c.os?W.installWindows(a,b):"macintosh"==c.os&&W.installMac(a,b)}function N(c,d){function e(){}function f(a){function b(){R.redirect(V.getUrl("compose_attach_chrome21_setup"))}a?a.send({action:"force",call:function(){b()}}):b()}var g=U.getInfo(),h=c.close||a.EMPTYFUNC();if(U.ie())R.redirect(V.getUrl("compose_attach_setup"));else if(U.firefox())try{var i="compose_attach_plugin",j=U.getVersion()||[0,0];if(j[0]>=5&&(i="compose_attach_firefox"),"undefined"!=typeof InstallTrigger)InstallTrigger.install({NetEaseMailPlugin:V.getUrl(i,!0)});else{h();var k=a.Msgbox.show({title:S.t("邮箱插件提示"),content:S.t("请按照浏览器顶部安装栏提示，按“允许”安装插件。")+"<br><br>"+S.t("安装成功后选择立即重启浏览器即可使用该功能！"),ok:function(){W.install({close:function(){k.close()}})}});if(!a("#ifrDownUrl")){var l=a.Element.create("IFRAME");l.attr({id:"ifrDownUrl"}),l.css({display:"none"}),document.body.appendChild(l.dom)}a("ifrDownUrl").attr({src:V.getUrl(i,!0)})}}catch(m){}else if(U.chrome()){h();var j=U.getVersion()||[0,0];if(j[0]>=21&&!g.__shell)if("163.com"==$S("domain"))try{var n=V.getUrl("compose_attach_chrome21",!0),o=document.createElement("LINK");o.rel="chrome-webstore-item",o.href=n;var p=document.getElementsByTagName("HEAD")[0];p.appendChild(o),chrome.webstore.install(n,function(){b.setTimeout(e,1e3)},function(){f(d)})}catch(m){f(d)}else f(d);else{if(a.Msgbox.show({title:S.t("邮箱插件提示"),content:S.t("请按照浏览器底部下载栏提示，按“继续”安装插件。")+"<br><br>"+S.t("安装成功后可马上使用新功能！"),ok:function(){b.setTimeout(e,1e3)}}),!a("#ifrDownUrl")){var l=a.Element.create("IFRAME");l.attr({id:"ifrDownUrl"}),l.css({display:"none"}),document.body.appendChild(l.dom)}a("#ifrDownUrl").attr({src:V.getUrl("compose_attach_chrome",!0)})}}}function O(c){var d=c.close||a.EMPTYFUNC();if(d(),U.safari()||U.chrome()){var e=V.getUrl("compose_attach_mac_plugin");b.open(e)}else if(U.firefox())try{var e=V.getUrl("compose_attach_mac_firefox");b.open(e);var f=a.Msgbox.show({title:S.t("邮箱插件提示"),content:S.t("请按照浏览器顶部安装栏提示，按“允许”安装插件。")+"<br><br>"+S.t("安装成功后选择立即重启浏览器即可使用该功能！"),ok:function(){W.install({close:function(){f.close()}})}});if(!a("#ifrDownUrl")){var g=a.Element.create("IFRAME");g.attr({id:"ifrDownUrl"}),g.css({display:"none"}),document.body.appendChild(g.dom)}a("#ifrDownUrl").attr({src:e})}catch(h){}}try{var P=$L("module.compose.Compose")}catch(Q){return Q}try{var R=$L("util.Misc")}catch(Q){return Q}var S=new $I18N("module.compose.ComposeAssist"),T=a.Object,U=a.Browser,V=a.Uri,W=a.createClass($N("module.compose.ComposeAssist"));T.inherit(W,P),T.extend(W.prototype,{initialize:c,init:d,clear:e,get:f,set:g,create:h,setup:i,install:j,destroy:k,requestGet:l,captureGet:m,captureStart:n,captureResult:o,captureUpload:p,captureDestroy:q,clipInit:r,clipMenu:s,clipKey:t,clipPaste:u,clipImage:v,nativeClipImage:w,nativeCapture:y,dataUrlToBlob:z,dragInit:A,dragHas:B,dragCheck:C,dragOver:D,dragDrop:E,isBrowserPasteImageAsBase64:x}),T.extend(W,{factory:null,updater:null,initFactory:F,createFactory:G,has:H,hasNewVersion:I,getVersion:J,startUpdate:K,support:L,install:M,installWindows:N,installMac:O})}($,window),function(a,b){function c(a){var b=this;Jc.superClass.initialize.call(b,a)}function d(){var a=this;a.initUploadHost(),a.initUploadRetryMax(),Jc.superClass.init.call(a)}function e(){var a=this;Jc.superClass.clear.call(a)}function f(){var b=this;b.postStop&&b.postStop();var c=b.fileGet();a.Array.each(c,function(c,d){"function"==typeof d["delete"]&&d["delete"](),d.cloud&&"upload"==d.state&&d.ret&&d.ret.oid&&a.Ajax.jsonp(b.getUploadProxy({type:"script",file:d,cancel:!0}),function(){})})}function g(a){var b=this,c=b.data;if(b.initUploadHost(),"super"==c.get({status:"uploadMode"})&&Ac.init(),"plugin"!=a){var d=b.sourceGet("element");d.browser.listen("mouseover",function(){d.link.addClass("nui-txt-link-hover")}),d.browser.listen("mouseout",function(){d.link.removeClass("nui-txt-link-hover")})}}function h(){var b=this,c=b.data,d=b.sourceGet("element");d.link=c.get({moduleId:"attachAdd"}),d.browser=c.get({moduleId:"attachBrowser"}),d.operate=c.get({moduleId:"attachOperate"}),d.area=c.get({moduleId:"attachArea"}),d.content=c.get({moduleId:"attachContent"}),d.progress=c.get({moduleId:"attachProgress"}),d.linkCloud=c.get({moduleId:"attachAddCloud"}),d.browserCloud=c.get({moduleId:"attachBrowserCloud"});var e=c.get({moduleId:"attachDashi"});e&&e.listen("click",function(){Fc.cache({cl_dashi:1},a.EMPTYFUNC)})}function i(){if(!$S("uploadProxy")){var b=a.Cookie.get("mail_upx",!0),c={"yeah.net":"t5hz.mail.yeah.net|t6hz.mail.yeah.net|t10hz.mail.yeah.net|t11hz.mail.yeah.net|t12hz.mail.yeah.net|t13hz.mail.yeah.net","126.com":"c1bj.mail.126.com|c2bj.mail.126.com|c3bj.mail.126.com|c4bj.mail.126.com|c5bj.mail.126.com|c6bj.mail.126.com|c7bj.mail.126.com","163.com":"c1bj.mail.163.com|c2bj.mail.163.com|c3bj.mail.163.com|c4bj.mail.163.com|c5bj.mail.163.com|c6bj.mail.163.com|c7bj.mail.163.com"},d={"188.com":"t1hz.188.com|t2hz.188.com","163.com":"t1hz.vip.163.com|t2hz.vip.163.com","126.com":"t1hz.vip.126.com|t2hz.vip.126.com"};if(b=a.String.trim(b),b||($S("isFree")?$S("isyeah")?b=c["yeah.net"]:$S("is126")?b=c["126.com"]:$S("is163")&&(b=c["163.com"]):$S("isVip")&&(b=$S("is188")?d["188.com"]:$S("is126vip")?d["126.com"]:d["163.com"]),Fc.cache({ComposeAttachUploadProxy:0})),b){var e=b.split("|");e=e.sort(function(){return.5-Math.random()}),e.length&&$S("uploadProxy",e)}}}function j(){Jc.UPLOAD_RETRY_MAX=$S("uploadProxy")?$S("uploadProxy").length:3}function k(a){return this.data.attachments[a]}function l(){var b=this,c=b.sourceGet("element"),d=b.sourceGet("layout"),e=c.operate,f=c.content,g=e.dom.clientWidth-10;if(!d.baseWidth||d.baseWidth!=g){d.baseWidth=g;var h=g+12,i=g+d.spaceWidth;f.css({width:h+"px"});var j=d.attachWidth+d.spaceWidth,k=Math.floor(i/j)||1,l=i%j,m=Math.floor(l/k),n=d.attachWidth+m;d.blockWidth=n;var o=b.fileGet();a.Array.each(o,function(a,b){var c=b.ui.container;c.css({width:n+"px"})})}}function m(b){var c=this,d=c.data,e=b.files,f=b.submit,g=b.cancel,h=1024*1024*$S("attachSize");$S("isVip")&&(h=52428800);var i=c.fileSize(),j=c.fileSize({context:!0}),k=0,l=h-i,m=0,n=0,o=0,p=0,q=0,r=!0,s=!0,t=!1,u=!1;if($S("cloud")&&c.getUploadHost()&&(m=$S("cloud").fileSizeLimit,n=$S("cloud").capacity,o=n-$S("cloud").spaceUsed,p=$S("cloud").duration),a.Array.each(e,function(a,b){if(b.err||(b.extLimit?b.err="extension":0===b.size?b.err="empty":m>0&&b.size>m?b.err="limitBig":o>0&&b.size+q>o?b.err="quotaBig":c.cloudTrigger()||(b.size>l?b.err=c.cloudStatus()?"limit":"retryErrorBig":b.size+q>l&&(b.err="quota"))),b.err&&("limit"==b.err||"quota"==b.err||"retryErrorBig"===b.err))if(c.cloudStatus())b.err="",t=!0;else{try{var d=$S("cloud")?"1":"0",e=c.getUploadHost()?"1":"0";Fc.cache({ComposeAttachCloudStatusError:"CLOUD_STATUS="+d+"|HOST_STATUS="+e+"|HOST="+c.getUploadHost()})}catch(f){}try{var g=$L("support.CloudSupport",this)}catch(f){return f}Fc.cache({CloudSupportInitRetry:1}),g.init()}b.err?r=!1:(s=!1,q+=b.size,b.inlined&&(k+=b.size))}),j+k>h)return a.Msgbox.show({header:Bc.t("附件上传提示"),icon:"err",title:Bc.t("添加的图片总大小不能超过")+a.Number.convert(h)}),void 0;if(t)return c.cloudTrigger(!0),c.movePrepare(q),c.cloudAutoTips(),c.prompt({cloud:!0}),c.filterCheck(b),void 0;if(c.cloudTrigger());else if($S("isCorp"));else{var v=q+i-j-k;if(c.cloudStatus()&&v>20971520){var w=Hc.get({field:"ntes_compose",flag:"upload_mode"}),x=parseInt(w,10),y=!1;if("0"==w){c.base;var z=c.form,A=[],B=[];if(d.get({status:"useSeparate"})?B[0]="separate":B=["to","cc","bcc"],a.Array.each(B,function(a,b){var c=z.getContact("suc",b);A=A.concat(c)}),0===A.length)y=!0;else{var C=["qq.com","vip.qq.com","163.com","126.com","yeah.net","vip.163.com","vip.126.com","188.com","vip.188.com"];a.Array.each(A,function(b,c){var d=c.domain.toLowerCase();return a.Array.has(C,d)?void 0:(y=!0,a.BREAK)})}y||(x=2)}else"1"==w&&(y=!0);y&&(c.cloudTrigger(!0),c.movePrepare(q),c.filterCheck(b),c.prompt({cloud:!0}),u=!0)}}u||(r?(Fc.cache({UploadFile:1}),f({ignore:null,select:e})):s?(c.filterFail(e),g()):c.filterSelect(e,f,g,q,l))}function n(b){var c=this;c.data;var d=b.files,e=b.submit,f=b.cancel,g=1024*1024*$S("attachSize"),h=c.fileSize({cloud:!1}),i=g-h,j=c.fileSize({cloud:!0}),k=0,l=0,m=0,n=0,o=0,p=!0,q=!0;$S("cloud")&&c.getUploadHost()&&(k=$S("cloud").fileSizeLimit,l=$S("cloud").capacity,m=l-$S("cloud").spaceUsed-j,n=$S("cloud").duration),a.Array.each(d,function(a,b){b.err||(b.extLimit?b.err="extension":0===b.size?b.err="empty":b.cloud?0===k||0===m?b.err="errorBig":b.size>k?b.err="limitBig":b.size+o>m&&(b.err="quotaBig"):b.size>i?b.err="limit":b.size+o>i&&(b.err="quota")),b.err?p=!1:(q=!1,o+=b.size)}),p?(Fc.cache({UploadFile:1}),e({ignore:null,select:d})):q?(c.filterFail(d),f()):c.filterSelect(d,e,f,o,i)}function o(b){var c="<h4>"+Bc.t("您选择的文件不能上传，原因如下：")+"</h4>",d="",e="//help.mail.163.com/newfeedback.do?m=add";a.Array.each(b,function(b,f){var g=f.name;a.String.len(g)>22&&(g=a.String.left(g,18));var h=f.err;Jc.errDescription[h]&&(h=Jc.errDescription[h],"limitBig"==f.err&&(h=Bc.t("超大附件单个文件大小超过")+a.Number.convert($S("cloud").fileSizeLimit)+Bc.t("限制"),Fc.cache({ComposeAttachSingleFileSizeOverLimit:f.size})),"retryErrorBig"===f.err&&(d='<p>建议您更换浏览器或刷新重试。如遇困难<a href="'+e+'">请反馈</a></p>')),c+='<p><span title="'+f.name+'">'+g+"</span>"+'<span class="nui-txt-impt">('+h+")</span>"+"</p>"}),a.Msgbox.show({header:Bc.t("附件上传提示"),icon:"err",content:c+d})}function p(b,c,d,e,f){var g=this,h=[],i=[],j=!1;g.cloudStatus()&&(f=$S("cloud").capacity-$S("cloud").spaceUsed),b=b.sort(function(a,b){return b.size-a.size}),a.Array.each(b,function(b,c){var d=c.name;if(a.String.len(d)>28&&(d=a.String.left(d,24)),("limit"==c.err||"quota"==c.err||"limitBig"==c.err||"quotaBig"==c.err)&&(j=!0,("quota"==c.err||"quotaBig"==c.err)&&(c.err="",e+=c.size)),c.err){var f=c.err;Jc.errDescription[f]&&(f=Jc.errDescription[f]),i[i.length]='<tr class="nui-table-row nui-table-row-disabled"><td class="nui-table-cell nui-table-cell-forChk nui-table-cell-isFirst"><label class="nui-chk"><input disabled="disabled" class="nui-chk-symbol" type="checkbox"/></label></td><td class="nui-table-cell P0"><b class="nui-ico nui-ico-att"></b></td><td class="nui-table-cell t0"><span title="'+c.name+'">'+d+"</span>"+'<span class="nui-txt-impt" title="'+f+'">('+f+")</span>"+"</td>"+'<td class="nui-table-cell I0">'+a.Number.convert(c.size)+"</td>"+"</tr>"}else h[h.length]='<tr class="nui-table-row nui-table-row-selected"><td class="nui-table-cell nui-table-cell-forChk nui-table-cell-isFirst"><label class="nui-chk"><input value="'+b+'" checked="checked" class="nui-chk-symbol" type="checkbox"/></label></td>'+'<td class="nui-table-cell P0"><b class="nui-ico nui-ico-att"></</td>'+'<td class="nui-table-cell t0">'+'<span title="'+c.name+'">'+c.name+"</span>"+"</td>"+'<td class="nui-table-cell I0">'+a.Number.convert(c.size)+"</td>"+"</tr>"});var k=Bc.t("您选择的部分附件由于以下原因，不能上传");j&&(k=Bc.t("本次选择的附件大小不能超过")+a.Number.convert(f));var l='<div class="nui-simpleTable nui-table bc0"><table><thead class="nui-table-head"><tr class="nui-table-row"><th class="nui-table-cell nui-table-cell-forChk nui-table-cell-isFirst"><label class="nui-chk"><input id="objMsgSelectAll" class="nui-chk-symbol" type="checkbox"/></label></th><th class="nui-table-cell s0">'+Bc.t("文件名")+"</th>"+'<th class="nui-table-cell C0">'+Bc.t("大小")+"</th>"+"</tr>"+"</thead>"+"</table>"+"</div>"+'<div class="bm0" style="overflow-y:scroll">'+'<div class="nui-simpleTable nui-table bn0">'+'<table id="tabMsgSelectList">'+'<tbody class="nui-table-body">'+i.join("")+h.join("")+"</tbody>"+"</table>"+"</div>"+"</div>"+'<div id="divMsgSelectTips" class="nui-normalTips nui-tips be0"></div>',m=function(){var b,c=a("#divMsgSelectTips");c.removeClass("g-tips-popup-err"),c.removeClass("g-tips-popup-succ"),e>f?(b='<b class="nui-ico nui-ico-err"></b>'+Bc.t("已选择了")+a.Number.convert(e)+Bc.t("，超出")+a.Number.convert(e-f),c.addClass("g-tips-popup-err")):(b='<b class="nui-ico nui-ico-suc"></b>'+Bc.t("已选择了")+a.Number.convert(e)+Bc.t("，可以上传"),c.addClass("g-tips-popup-succ")),i.length&&(b+='<span class="txt-tips">'+Bc.t("(有")+"<strong>"+i.length+"</strong>"+Bc.t("个不能选择)")+"</span>"),c.html(b)},n=a.Msgbox.show({type:"confirm",header:Bc.t("附件上传提示"),content:l,contentType:"wide",ok:function(){var d=[],e=[];a.Array.each(b,function(a,b){b.err?d.push(b):e.push(b)}),c({ignore:d,select:e})},cancel:d,close:d});m(),e>f&&n.buttons.ok.setDisabled(!0);var o=[],p=a("#objMsgSelectAll");p.listen("click",function(){var b=p.dom.checked;a.Array.each(o,function(a,c){c.dom.checked!=b&&c.dom.click()})}),a("#tabMsgSelectList").find("tr").each(function(c,d){d=a(d);var g=d.find("input");g.dom.disabled||(o.push(g),g.listen("click",function(){var a=parseInt(g.dom.value,10),c=b[a];g.dom.checked?(c.err="",e+=c.size,d.addClass("nui-table-row-selected")):(c.err="cancel",e-=c.size,d.removeClass("nui-table-row-selected")),m(),n.buttons.ok.setDisabled(e>f)}),d.listen("mouseover",function(){-1==d.dom.className.indexOf("nui-table-row-selected")&&d.addClass("nui-table-row-hover")}),d.listen("mouseout",function(){d.removeClass("nui-table-row-hover")}),d.listen("click",function(b){var c=a.Event.getTarget(b);c&&"string"==typeof c.type&&"checkbox"==c.type.toLowerCase()||g.dom.click()}))})}function q(b){var c=this,d=c.data,e=c.sourceGet("element"),f=c.sourceGet("tips"),g=$S("cloud"),h="";if(b.capacity&&g){var i,j=g.spaceUsed,k=g.capacity;if(i=0===k?0:Math.floor(100*(j/k)),i>=90){if(!f.capacity){var l=a.Element.create("DIV");l.html('<div class="nui-tips nui-normalTips nui-normalTips-err">'+Bc.t("超大附件容量已满，请先 ")+'<a href="javascript:void(0)">'+Bc.t("清理超大附件")+"</a>"+Bc.t(" 再继续上传文件。")+"</div>"),f.capacity=l,e.content.after(l.dom),l.find("A").listen("click",function(){c.cloudManage()})}f.capacity.show()}else f.capacity&&f.capacity.hide()}if(b.cloud&&!f.cloud){var m=$S("cloud").duration;h=b.text||Bc.t("附件将作为超大附件上传，")+"<span class='nui-txt-impt'>"+m+Bc.t("天")+"</span>"+Bc.t("内有效，若被删除或过期，收件人将无法下载。");var l=a.Element.create("DIV");l.setClass("M0"),l.html(h),e.content.after(l.dom),f.cloud=l,d.get({status:"vipMember"})||$S("isVip")?new a.Link({text:Bc.t("修改设置"),cls:"nui-txt-link",renderTo:l,click:function(){$E(["interface.OptionInterface"],function(a){a.entry({module:"BaseSetModule",inputName:"uploadmode"})})}}):(new a.Link({text:Bc.t("开通会员，享受超大附件50天内有效特权"),cls:"nui-txt-link",renderTo:l,click:function(){$E("product.Privileges",function(b){b.showDialog("plus","","filebox_annex1"),a.Log.cache({ComposeCloudfileTipsClick:1})})}}),a.Log.cache({ComposeCloudfileTipsShow:1})),new a.Link({cls:"nui-ico nui-ico-x",renderTo:l,click:function(){f.cloud.remove()}}),e.area.show()}b.remove&&(b.keys?a.Array.each(b.keys,function(a,b){f[b]&&(f[b].remove(),f[b]=null)}):Cc.each(f,function(a,b){b&&(b.remove(),f[a]=null)}))}function r(a){a=a||{};var b=this,c=a.value;"string"==typeof a.status?b.sourceGet("status")[a.status]=c:"string"==typeof a.element&&(b.sourceGet("element")[a.element]=c)}function s(b,c,d){var e=this;if(b.state=c,b.ui){var f=!1,g=!1,h=!1,i="",j=null,k=a.Number.convert(b.size)+" ";if(b.cloud)switch(b.state){case"select":i=Bc.t("待扫描，请稍候...");break;case"hash":i=-1==b.percent?Bc.t("扫描中，请稍候..."):Bc.t("扫描中，已完成")+b.percent+"%";break;case"hashover":i=Bc.t("扫描完毕，开始上传");break;case"wait":i=""===b.fid?Bc.t("待上传，请稍候..."):Bc.t("待续传，请稍候...");break;case"upload":if(-1==b.bytesLoaded)i=""===b.fid?Bc.t("正在上传..."):Bc.t("正在续传..."),e.cloudRename(b);else{c="percent";var l=b.speed,m=Jc.getSize(b.bytesLoaded,2),n=Jc.getSize(l.second,2)+"/S",o=Jc.getRemain(l.remain);j={uploaded:m,speed:n,remain:o}}break;case"pause":break;case"error":f=!0,i=d||b.err;break;case"success":f=!0,g=!0,h=!0,e.cloudRename(b),i=k+Bc.t("上传完成");break;case"link":switch(b.fileExist){case 1:i=k+'<span class="nui-txt-suc">'+Bc.t("续传完成")+"</span>";break;case 2:i=k+'<span class="nui-txt-suc">'+Bc.t("已存在此文件，快速上传完成")+"</span>";break;default:i=k+'<span class="nui-txt-suc">'+Bc.t("上传完成")+"</span>"}break;default:return}else switch(c){case"link":i=k+Bc.t("上传完成");break;case"error":f=!0,i=d||b.err;break;case"success":f=!0,g=!0,i=k+'<span class="nui-txt-suc">'+Bc.t("上传完成")+"</span>";break;case"select":case"wait":i=Bc.t("待上传，请稍候..."),"form"==b.type&&(i=Bc.t("您选择的附件将在点击发送后进行上传"));break;case"upload":if(-1==b.bytesLoaded)i=Bc.t("正在上传...");else{c="percent";var l=b.speed,m=Jc.getSize(b.bytesLoaded,2),n=Jc.getSize(l.second,2)+"/S",o=Jc.getRemain(l.remain);j={uploaded:m,speed:n,remain:o}}break;case"hash":i=b.percent&&-1==b.percent?Bc.t("扫描中，请稍候..."):Bc.t("扫描中，已完成")+b.percent+"%";break;case"fast":i=Bc.t("快速上传中...");break;default:return}e.setInfo(b,c,i,j),"error"==c&&e.setTotalProgress(),g&&"function"==typeof b["delete"]&&b["delete"](),f&&e.fileAutoUpload(),h&&e.cloudConvert(b)}}function t(b,c,d,e){c=c||"text";var f=b.ui;if(f){var g=f.info,h=f.tips,i=b.ui.container,j="q0";if("percent"==c){var k=b.percent?b.percent+"%":"",l=k,m="";if(e&&e.remain){l+=Bc.t(",剩余时间:")+e.remain;var n=a.Number.convert(b.size),o=a.String.escapeHTML(b.name);m=o+Bc.t(", 文件大小:")+n+Bc.t(", 已上传")+e.uploaded+Bc.t(", 上传速度:")+e.speed}var p='<div class="nui-progress"><span class="nui-progress-bar"><span class="nui-progress-bar-inner" style="width:'+k+';"></span>'+"</span>"+'<span class="nui-progress-text">'+l+"</span>"+"</div>";k&&g.html(p),m&&h.html(m)}else"error"==c?(i.addClass(j),d&&g.html(d),e&&e.text?h.html(e.text):(h.html(""),h.hide())):"resum"==c?i.removeClass(j):(d&&g.html(d),"success"==c&&(h.html(""),h.hide()))}}function u(a){var b=this;0===a.offset&&b.setProgress(a,0)}function v(a){var b=this,c=!1;0===a.length?c=!0:a.offset+a.length==a.size&&(c=!0),c&&(b.setLock(a,!0),b.setProgress(a,99))}function w(b,c){var d=this;if(b)if("boolean"==typeof b.lock)b.lock=c;else{var e=b;a.Array.each(d.fileGet(e),function(a,b){d.setLock(b,c)})}}function x(a,b,c){var d,e=this,f=a.size,g=b;0===a.length?c>f&&(d=Math.floor(100*(b/c)),g=Math.floor(f*(d/100))):g+=a.offset,a.bytesLoaded=g,d=Math.floor(100*(g/f)),d>98&&(d=98),e.setProgress(a,d)}function y(a,b,c){var d=this;if(a.bytesHashed=b,c)"-1"!=c&&(a.md5=c.toLowerCase()),a.percent=-1,d.setState(a,"wait"),d.fileAutoUpload();else{var e=Math.floor(100*(b/a.size));if(a.percent==e)return;a.percent=e,d.setState(a,"hash")}}function z(a){var b=(new Date).valueOf(),c=a.speed;if(c){var d=b-c.time;if(d>0){var e=a.bytesLoaded;if(e>0){var f=Math.round((e-c.bytes)/(d/1e3));f>0&&(c.bytes=e,c.second=f,c.remain=parseInt((a.size-e)/f,10)+1)}}}else c=a.speed={bytes:0,second:0,remain:-1};c.time=b}function A(a,b){var c=this;if(a.percent==b){var d=a.speed;if(!d)return;if((new Date).valueOf()-d.time<=1e3)return}else a.percent=b;switch(c.setSpeed(a),b){case 0:c.setState(a,"upload");break;case 100:c.setState(a,"success");break;default:c.setState(a,"upload")}Dc.newAttach&&a.inlined?c.inlinedProgress():c.setTotalProgress()}function B(){var b=this,c=b.sourceGet("element"),d=c.progress,e=b.fileProgress(),f=e.percent,g=e.bytesLoaded,h=e.bytesTotal;if(b.get({status:"totalBytes"})==h&&b.get({status:"totalPercent"})==f);else{if(f){var i="("+f+Bc.t("%,已上传")+a.Number.convert(g)+Bc.t(",总文件大小")+a.Number.convert(h)+")";d.show(),d.html(i)}else d.hide();b.set({status:"totalBytes",value:h}),b.set({status:"totalPercent",value:f})}}function C(a){a=a||{};var b=this;return"string"==typeof a.status?b.sourceGet("status")[a.status]:"string"==typeof a.element?b.sourceGet("element")[a.element]:a.count?b.fileCount():a.file?b.fileGet(a.file):void 0}function D(a){var b=this,c=!1;return b.getUploadHost()&&(a.inlined||(a.cloud?(a.md5?b.setInfo(a,"",Bc.t("正在尝试速传，请稍候...")):b.setInfo(a,"",Bc.t("正在检查容量，请稍候...")),c=!0):a.md5?(b.setState(a,"fast"),c=!0):a.sid&&(c=!0))),c&&(b.setLock(a,!0),b.setState(a,"upload")),c}function E(){var a=this,b=a.data,c="";if(b.get({status:"useWmsvr"}))return c;var d=$S("uploadProxy");return d&&d.length&&(c=d[0]),c}function F(a){var b=this,c=a.type,d=Ic.getUrl("compose_upload_url",!0);return d+="&composeId="+b.info.get({cid:!0}),d+="&type="+c}function G(b){var c=this,d=b.type,e=b.file,f="get";b.options&&(f=b.options);var g={},h=c.getUploadHost();""===h&&(h=$S("orgHost"));var i="https://"+h;if(i+="/upxmail/upload",i+="?sid="+$S("sid"),i+="&uid="+$S("orgUid"),i+="&cid="+c.info.get({cid:!0}),i+="&host="+$S("orgHost"),i+="&ver=js6",i+="&agent="+d,"script"==d||(g.cmc=a.Cookie.get("Coremail",!0),g.urs=$S("ursCookie")),e)if(g.type=e.cloud?1:0,g.name=e.name,g.size=e.size,e.path&&(g.path=e.path),e.md5&&(g.md5=e.md5),e.modtime&&(g.modtime=e.modtime),e.ret&&Cc.each(e.ret,function(a,b){g[a]=b}),b.check)if(e.cloud){i+="&chk=true";var j=c.moveSize();j>0&&(g.xsize=j)}else i+="&qry=true";else b.cancel?i+="&cal=true":(e.offset&&(g.offset=e.offset),e.length&&(g.length=e.length),e.inlined);else b.move&&(i+="&mov=true"),b.aid&&(g.aid=b.aid.join("|")),"number"==typeof b.size&&(g.size=b.size);switch(Cc.each(g,function(a,b){"string"!=typeof b&&(g[a]=String(b).valueOf())}),f){case"body":var k="",l=[];Cc.each(g,function(a,b){l.push(a+"="+encodeURIComponent(b))}),l.length&&(k=l.join("&")),e.options=k;break;case"form":e.options=g;break;case"header":var m={};Cc.each(g,function(a,b){m["Mail-Upload-"+a]=encodeURIComponent(b)}),e.options=m;break;default:Cc.each(g,function(a,b){i+=["&",a,"=",encodeURIComponent(b)].join("")}),"script"==d||(i+="&t="+(new Date).valueOf()),e&&(e.options=null)}return i}function H(){var b=this,c=[];return a.Array.each(b.fileGet({inlined:!1}),function(a,b){if("success"==b.state||"link"==b.state){var d={name:b.name,icon:b.icon};c.push(d)}}),c}function I(){var a=$S("uploadProxy");a&&a.length&&a.shift()}function J(a){a=a||{};var b=this,c={},d=a.type,e=a.path,f=a.name,g=a.mime,h=a.size,i=a.sid,j=a.eid;if(Cc.extend(c,Jc.file),d&&(c.type=d),e?(c.path=e,f||(f=e.replace(new RegExp(".*"+Jc.symbol),"")),b.fileGet({path:e}).length>=1&&(c.pathExist=!0)):f&&(f=f.replace(new RegExp(".*"+Jc.symbol),"")),f){c.name=f,c.icon=xc.getSubtype({type:"file32",name:f});
var k=f.split(".");if(k.length>1){var l=k.pop();l&&(l=l.toLowerCase(),c.ext=l,-1!=Ec.indexOf("."+l+".")&&(c.extLimit=!0))}}return g&&(c.mime=g),"number"==typeof h&&(c.size=h,"storage"==d&&(c.bytesLoaded=h)),i&&(c.sid=i),j&&(c.eid=j),a.cloud&&(c.cloud=a.cloud),c}function K(a){var b=this;return a?b.fileGet(a).length:Cc.count(b.sourceGet("files"))}function L(a){a=a||{};var b=this,c=[],d=b.sourceGet("files");return Cc.each(d,function(b,d){var e=!0;Cc.each(a,function(a,b){d[a]!=b&&(e=!1)}),e&&c.push(d)}),c}function M(a){var b=this,c=b.get({status:"fileIndex"}),d=b.sourceGet("files");a.cid="order_"+c++,b.set({status:"fileIndex",value:c}),d[a.cid]=a}function N(a,b){var c=this,d="";"string"==typeof a?d=a:"object"==typeof a&&(d=a.cid);var b=c.sourceGet("files");return d&&b[d]?(delete b[d],!0):!1}function O(a){var b=this,c=!1;return b.fileCount(a)>0&&(c=!0),c}function P(b){var c=this,d=0,e=c.fileGet(b);return a.Array.each(e,function(a,b){b.size>0&&(d+=b.size)}),d}function Q(a){var b=this,c=b.base,d=null,e=!0;a||(d=b.fileGet({state:"upload"}),0===d.length&&(d=b.fileGet({state:"wait"}),0===d.length&&c.runSequence("attachMove"))),d=b.fileGet({type:"plugin",state:"upload"},a),0===d.length?(d=b.fileGet({type:"plugin",state:"wait"},a),d.length&&(b.pluginCheck(d[0]),e=!1)):e=!1,d=b.fileGet({type:"native",state:"upload"},a),0===d.length?(d=b.fileGet({type:"native",state:"wait"},a),d.length&&(b.nativeCheck(d[0]),e=!1)):e=!1,b.fileAutoHash(a)&&(e=!1);var f=!e;return f||e&&c&&c.runSequence("uploadResult",0),f}function R(a){var b=this,c=null,d=!1;return c=b.fileGet({type:"plugin",state:"hash"},a),0===c.length?(c=b.fileGet({type:"plugin",state:"select"},a),c.length&&(b.pluginHash(c[0]),d=!0)):d=!0,d}function S(b){var c=this,d=0,e=0,f=0;return b=b||(Dc.newAttach?{inlined:!1}:null),a.Array.each(c.fileGet(b),function(a,b){e+=b.size,"error"==b.state||-1!=b.bytesLoaded&&(f+=-1==b.percent?b.bytesLoaded:Math.floor(b.size*(b.percent/100)))}),0===e?f=0:d=Math.round(100*(f/e)),{percent:d,bytesLoaded:f,bytesTotal:e}}function T(b,c){var d,e=this;e.setLock(b,!1);try{d=a.Eval.get("("+c+")")}catch(f){d={code:"JS_EVAL"}}var g={code:d.code};if(d.code==Gc){if("number"==typeof d.type){if(b.length){if(b.offset+=b.length,b.offset!=b.size)return b.ret=d.ret||b.ret,0===d.type&&b.ret&&b.ret.aid&&(b.sid=b.ret.aid),g["continue"]=!0,g;b.length=0}var h=d["var"];switch(d.type){case 0:b.sid=h.attachmentId;break;case 1:b.fid=h.fid,h.dupname&&(b.nameExist=!0,b.name=h.fileName),b.link=h}}else b.sid=d.attachId;e.setBytes(b,b.size,b.size),e.setProgress(b,100),b.inlined?e.inlineInsert(b):!b.cloud&&a.Array.has(["31","32","33"],b.icon)&&a.Array.has(["31","32","33"],b.icon)&&e.setInsert(b),b.retry=0}else{var i=d.overflowReason||"";e.error(b,d.code,i)&&(g.retry=!0)}return g}function U(){var a=this;return a.fileHas({state:"upload"})||a.fileHas({state:"hash"})}function V(){var a=this,b=!1;return a.fileGet({type:"form",state:"wait"}).length>=1&&(b=!0),b}function W(){var a=this;return Dc.newAttach?a.fileHas({state:"error",inlined:!1}):a.fileHas({state:"error"})}function X(b){var c=this,d=c.data,e=c.sourceGet("status");e.layoutInit||(c.layout(),e.layoutInit=!0);var f=c.sourceGet("layout");if(c.cloudTrigger()){switch(b.type){case"plugin":case"native":b.context||b.inlined?b.context=!0:b.cloud=!0}c.prompt({capacity:!0})}var g,h,i,j,k,l=c.base,m=b.name;if(g=a.Element.create("DIV"),g.setClass("G0"),b.mixed||b.inlined&&Dc.newAttach&&g.css({display:"none"}),f.blockWidth){var n=f.blockWidth+"px";g.css({width:n})}new a.Icon({renderTo:g,type:"file32",subtype:b.icon}),h=a.Element.create("DIV"),h.setClass("o0"),h.html(a.String.escapeHTML(m)),b.path?h.attr({title:b.path}):h.attr({title:m}),i=a.Element.create("DIV"),i.setClass("j0"),k=a.Element.create("DIV"),k.setClass("m0"),function(){var d=a.Element.create("A");d.attr({href:"javascript:void(0)"}),d.addClass("nui-txt-link"),d.html(Bc.t("删除")),d.listen("click",function(d){c.remove(b),c.netCheckClear(),a.Event.cancel(d)}),k.append(d.dom)}(),b.download&&function(){h.css({width:"170px"});var c=a.Element.create("SPAN");c.html("|"),k.append(c.dom);var d=a.Element.create("A");d.attr({target:"_blank",href:b.download}),d.addClass("nui-txt-link"),d.html(Bc.t("下载")),a.Browser.chrome()&&b.mime&&d.listen("dragstart",function(a){var c=[b.mime,m,b.download].join(":");try{a.dataTransfer.setData("DownloadURL",c)}catch(d){}}),k.append(d.dom)}(),j=a.Element.create("DIV"),j.setClass("n0"),j.css({display:"none"}),g.append(h.dom),g.append(k.dom),g.append(i.dom),g.append(j.dom),b.ui={container:g,name:h,info:i,tips:j,ctrl:k},"form"==b.type?c.setState(b,"wait"):"storage"==b.type?(c.setState(b,"success"),b.cloud||b.url||!a.Array.has(["31","32","33"],b.icon)||a.Array.has(["31","32","33"],b.icon)&&c.setInsert(b)):"link"==b.type?c.setState(b,"link"):"plugin"==b.type&&b.path?c.setState(b,"select"):c.setState(b,"wait"),d.get({status:"confirmSubject"})&&""===l.form.getSubject()&&(!b.url||m!=Bc.t("名片.vcf")&&m!=Bc.t("信纸.jpg"))&&(function(){var a;if(b.media)a=yc.getName()+Bc.t("录制的音视频邮件");else{var c=m.split(".");c.length>1&&c.pop(),a=c.join(".")}l.form.setSubject(a)}(),d.set({status:"confirmSubject",value:!1})),c.fileAdd(b),c.setAuto({type:"add",element:g}),c.setTips(b)}function Y(b){var c=this;if(Dc.newAttach&&b.inlined)c.inlinedError(b);else{var d=function(){var a=c.getResumLink(b,h);g.append(a.dom),b.ui.resum=a},e=b.ui,f=e.name,g=e.ctrl;if(b.ui.resum||b.ui.unlockOverflowLimit)return;f.css({width:"170px"});var h=a.Element.create("SPAN");if(h.html("|"),g.append(h.dom),b.ui.splitor=h,this.isOverflow(b)&&a.Ext.privilegeOverflow){f.css({width:"155px"});var i=c.getUnlockOverflowLimitLink(function(){i.remove(),b.ui.unlockOverflowLimit=null,d()});g.append(i.dom),b.ui.unlockOverflowLimit=i}else d()}}function Z(b,c){var d=this,e=a.Element.create("A");return e.attr({href:"javascript:void(0)"}),e.addClass("nui-txt-link"),e.html(Bc.t("续传")),e.listen("click",function(f){d.setInfo(b,"resum"),c.remove(),e.remove(),b.ui.resum=null,b.retry=0,d.setState(b,"wait"),d.fileAutoUpload(),a.Event.cancel(f)}),e}function $(b){var c=this,d=a.Element.create("A");return d.attr({href:"javascript:void(0)"}),d.addClass("nui-txt-link"),d.html(Bc.t("解除限制")),d.listen("click",function(d){c.showOverflowDialog(function(){b&&b()}),a.Event.cancel(d)}),d}function _(b,c){var d=this,e=arguments;if(!b.lock){if(b.sid)return d.action.deleteAttach({sid:b.sid,callback:function(a){a.code==Gc&&(d.inlineRemove(b),b.sid="",d.remove.apply(d,e))}}),void 0;if("function"==typeof b["delete"]&&b["delete"](),b.cid&&d.fileDelete(b),b.ui){var f=b.ui,g=f.container;b.ui=null,d.setAuto({type:"remove",element:g})}b.cloud&&"upload"==b.state&&(b.ret&&b.ret.oid&&a.Ajax.jsonp(d.getUploadProxy({type:"script",file:b,cancel:!0}),function(){}),b.ret&&b.ret.fid&&a.Ajax.jsonp(Ic.getUrl("compose_batch_delete_url")+"&op=batchDelete&fileIds="+b.ret.fid,function(){var a=$S("cloud"),c=a.spaceUsed;c-b.size>=0&&(a.spaceUsed=c-b.size,$S("cloud",a))})),d.cancelAutoSend(Bc.t("您已删除上传的附件，自动发送取消")),d.fileAutoUpload(),"function"==typeof c&&c()}}function ab(a){var b=this,c=b.sourceGet("element"),d=a.type,e=a.element,f=b.fileCount();if("add"==d?c.content.append(e.dom):"remove"==d&&e.remove(),f>0)c.area.show();else{c.area.hide(),b.prompt({remove:!0,keys:[]});try{var g=b.sourceGet("tips");g.plugin&&(g.plugin.remove(),g.plugin=null)}catch(h){}}("add"==d||"remove"==d)&&b.setTotalProgress()}function bb(b){var c=this,d=b.ui,e=d.ctrl,f=a.Element.create("A");f.attr({href:"javascript:void(0)"}),f.addClass("nui-txt-link"),f.html(Bc.t("插入正文")),f.listen("click",function(d){var e=c.fileSize({context:!0}),f=1024*1024*$S("attachSize");return e+b.size>f?(a.Msgbox.show({title:Bc.t("附件上传提示"),icon:"err",content:Bc.t("添加的图片总大小不能超过")+a.Number.convert(f)}),void 0):(Dc.newAttach?b.mixed=!0:b.inlined=!0,b.context=!0,c.inlineInsert(b),a.Event.cancel(d),void 0)}),e.prepend(f.dom),d.name.css({width:"148px"})}function cb(b){var c=b.ui,d=c.container,e=!1,f=a.Browser.getVersion()||[0,0];a.Browser.ie()&&6==f[0]&&(e=!0),d.listen("mouseover",function(){c.tips.html()&&(c.tips.show(),e&&d.css({zIndex:"100"}))}),d.listen("mouseout",function(){c.tips.hide(),e&&d.css({zIndex:"1"})})}function db(a){var b=this;if(a.inlined||a.mixed){var c=Ic.getUrl("compose_get_data",!0);c+="&composeId="+b.info.get({cid:!0}),c+="&attachId="+a.sid,c+="&rnd="+Math.random(),b.editor.insert({image:c})}}function eb(a){var b=this;if(a.inlined||a.context){var c=new RegExp("&sid="+$S("sid")+"&composeId="+b.info.get({cid:!0})+"&attachId="+a.sid,"i");b.editor.remove({tag:"img",reg:c}),a.inlined=a.context=!1}}function fb(){var b=this,c=[],d=b.fileGet({type:"storage",inlined:!0});return a.Array.each(d,function(a,b){b.sid&&c.push({id:b.sid,inlined:!1})}),c}function gb(){var b=this,c=[],d=b.fileGet({inlined:!0});a.Array.each(d,function(a,b){b.sid&&c.push({id:b.sid,inlined:!0})});var d=b.fileGet({mixed:!0});return a.Array.each(d,function(a,b){b.sid&&c.push({id:b.sid,mixed:!0})}),c}function hb(){var b=this,c=b.base,d=b.fileProgress({inlined:!0}),e=d.percent;d.bytesLoaded,d.bytesTotal;var f="",g=b.fileCount({inlined:!0}),h=b.fileCount({inlined:!0,state:"success"}),i=b.get({status:"inlinedExist"}),j=g-i,k=h-i;e&&(100==e?(c.tips(f),b.set({status:"inlinedExist",value:h})):(f=Bc.t("图片上传中")+(k+"/"+j)+"..."+e+"%",a.Tips.moduleTips?a.Tips.moduleTips.setText(f):c.tips(f)))}function ib(b){var c=this;c.data;var d=c.base;d.tips("");var e=c.sourceGet("tips"),f=e.inlined;if(f)f.show();else{f=a.Element.create("DIV"),f.setClass("M0 nui-tipsLayer nui-tipsLayer-arrDown nui-layer nui-layer-arrDown");var g=c.sourceGet("element");g.area.after(f.dom),e.inlined=f,f.html('<b class="nui-layer-arr" style="left:268px;"></b><div class="nui-layer-normal"><ul></ul></div>')}var h,i,j=f.dom.getElementsByTagName("UL")[0],k=b.name;h=a.Element.create("LI"),i=a.Element.create("SPAN"),i.html(a.String.escapeHTML(k)+'&nbsp;<span class="nui-txt-err">'+Bc.t("上传失败")+"</span>&nbsp;&nbsp;"),h.append(i.dom),function(){var d=a.Element.create("A");d.attr({href:"javascript:void(0)"}),d.addClass("nui-txt-link"),d.html(Bc.t("续传")),d.listen("click",function(d){c.setInfo(b,"resum"),b.retry=0,c.setState(b,"wait"),c.fileAutoUpload(),h.remove(),0===c.fileCount({inlined:!0,state:"error"})&&f.hide(),a.Event.cancel(d)}),h.append(d.dom)}(),function(){var d=a.Element.create("A");d.attr({href:"javascript:void(0)"}),d.addClass("nui-txt-link"),d.html(Bc.t("删除")),d.listen("click",function(d){c.remove(b),c.netCheckClear(),h.remove(),0===f.dom.getElementsByTagName("LI").length&&f.hide(),a.Event.cancel(d)}),h.append(d.dom)}(),j.appendChild(h.dom),b.ui2={container:h,name:i}}function jb(b,c){var d=this;d.base;var e=d.data,f=e.get({status:"fromEntry"});if(Cc.isArray(b)){var g="";if(c){if("compose"==f)return d.action.syncAttach({attachments:b,callback:function(b){b.code==Gc&&a.Array.each(b["var"].attachments,function(a,b){d.storageAdd(b)})}}),void 0;"draft"==f&&(g=Ic.getUrl("compose_get_data",!0)+"&mode=download&composeId="+d.info.get({cid:!0}))}return a.Array.each(b,function(a,b){g&&(b.download=g+"&attachId="+b.id),d.storageAdd(b)}),void 0}if(!b.deleted){var h=b.type,i=b.name||b.fileName;b.displayName&&(i=b.displayName);var j=b.contentType;if(!i&&j)switch(j.toLowerCase()){case"message/disposition-notification":i=Bc.t("已读回执");break;case"message/delivery-status":i=Bc.t("信息碎片");break;case"message/rfc822":i=Bc.t("邮件正文.txt");break;default:i="No name";var k=j.split("/");k[1]&&(j=k[1].toLowerCase(),"gif"==j||"png"==j?i+="."+j:("jpg"==j||"jpeg"==j)&&(i+=".jpg"))}var l=b.id||b.attachmentId,m=d.fileCreate({type:"storage",name:i,mime:j,size:b.size,sid:l});"url"==h&&(m.url=b.name),b._mid&&(m.mid=b._mid),b.inlined&&(m.inlined=!0,m.context=!0),b.mixed&&(m.mixed=!0,m.context=!0),b.media&&(m.media=b.media,m.context=!0),b.download&&(m.download=b.download),d.add(m)}}function kb(){var b=this,c=b.fileGet({state:"error"}),d="",e=!1;if(a.Array.each(c,function(a,b){d+=b.name+"<br/>"}),e);else{var f=Bc.t("以下附件尚未上传完成，请先删除或者续传附件：");a.Msgbox.show({title:f,icon:"err",content:d})}}function lb(b){var c=this,d=c.info.get({cid:!0});c.action.syncAttach({cid:d,callback:function(d){var e={state:"success",cloud:!1},f=c.fileGet(e),g=d["var"].attachments,h=[];a.Array.each(g,function(b,c){var d=!1;a.Array.each(f,function(b,e){return c.id==e.sid?(d=!0,a.BREAK):void 0}),d||h.push(c.id)}),h.length>0?c.action.deleteAttach({sid:h,callback:function(a){a.code==Gc&&c.base.send({action:"deliver"})}}):c.base.send({action:b})}})}function mb(b,c){var d,e=this;e.setLock(b,!1);try{d=a.Eval.get("("+c+")")}catch(f){d={code:"JS_EVAL"}}if(!b.cid)return!1;var g=d.type,h=d.ext;if(h&&("number"==typeof h.spaceused&&($S("cloud").spaceUsed=h.spaceused),"number"==typeof h.capacity&&($S("cloud").capacity=h.capacity),"number"==typeof h.sizelimit&&($S("cloud").fileSizeLimit=h.sizelimit),h.dupname&&h.filename&&(b.nameExist=!0,b.name=h.filename)),d.code==Gc){var i=d["var"];if(1==g){if($S("cloud").spaceUsed+=b.size,b.ret=d.ret||null,i){if(i.exist)return b.fileExist=2,e.complete(b,c),!1;b.fileExist=1,b.fid=i.fid,i.dupname&&(b.nameExist=!0,b.name=i.filename),b.offset=i.existlen,$S("cloud").spaceUsed-=b.size}}else if(0===g&&i)if(i.actualSize){if(i.actualSize==i.size)return e.complete(b,c),!1;b.offset=i.actualSize}else b.sid=i.attachmentId;return!0}if("UX_FILE_NOT_FOUND"==d.code)return!0;var j=e.error(b,d.code,"","check");return j&&e.resum(b),!1}function nb(b,c,d,e){var f=this;"TIMEOUT"==c&&f.fileBreak(b);var g=Bc.t("未知错误"),h=Bc.t("，请重试"),i=!0,j=!1;switch(c){case"JS_EVAL":g=Bc.t("服务器返回格式错误")+h;break;case"JS_PLUGIN":g=Bc.t("插件版本过低，请使用标准添加附件方式选择大文件");break;case"NS_402":case"FA_INVALID_SESSION":g=Bc.t("登录超时，请重新登录邮箱"),zc.relogin();break;case"NS_415":g=Bc.t("超大附件服务器因网络问题已暂停上传，请手动重试");break;case"NS_514":g=Bc.t("系统不支持多次同时重复上传同一个文件");break;case"NS_515":case"FA_OVERFLOW":case"FA_UPLOAD_SIZE_EXCEEDED":g="pref_smtp_max_send_mail_size"==d?Bc.t("附件大小超过限制"):"pref_flow_limit"==d?Bc.t("附件流量超过限制"):Bc.t("附件大小或流量超过限制"),b&&b.cloud&&(g=Bc.t("超过超大附件空间上限，请您先删除已上传文件")),i=!1;break;case"NS_700":case"NS_701":case"NS_705":case"NS_710":g=Bc.t("此文件存在不良信息，禁止上传");break;case"FA_SECURITY":g=Bc.t("浏览器信息丢失，请重新登录邮箱");break;case"WX_DATA_ERROR":g=Bc.t("浏览器错误")+h,b.skipSplit=!0;break;case"JS_HTTP":case"AS_HTTP":g=0===d?Bc.t("服务器连接错误"):Bc.t("服务器")+d+Bc.t("错误"),g+=h;break;case"AS_ERROR":if(-1!=d.indexOf("Error #"))try{d=d.split("#")[1],d=d.split(":")[0],g="2038"==d?Bc.t("文件可能被其他程序占用"):"2049"==d?Bc.t("服务器响应错误"):"2032"==d?Bc.t("网络错误"):Bc.t("错误码")+d,g+=h}catch(k){}break;case"TIMEOUT":g=Bc.t("上传超时")+h,f.prompt({speed:!0});break;default:g=Bc.t("上传失败，错误码")+c+h}if(b.err=g,b.errCode=c,b.errReason=d,b){if(f.setLock(b,!1),"JS_HTTP"==c||"AS_HTTP"==c||"AS_ERROR"==c||"WX_DATA_ERROR"==c||"UX_UNKNOWN"==c){if(b.retry>Jc.UPLOAD_RETRY_MAX)Fc.cache({UploadFileFailALL:1});else if(j=!0,"check"==e?(0===b.retry&&Fc.cache({UploadFileFailFirst:1}),Fc.cache({ComposeAttachSkipUploadHost:"code="+c+"|reason="+d+"|type="+e+"|host="+f.getUploadHost()}),f.skipUploadHost()):f.cloudTrigger()||"WX_DATA_ERROR"!=c&&b.retry<=Jc.UPLOAD_RETRY_MAX&&(Fc.cache({UploadFileFailFirst:1}),Fc.cache({ComposeAttachSkipUploadHost:"code="+c+"|reason="+d+"|type="+e+"|host="+f.getUploadHost()}),f.skipUploadHost()),b.retry==Jc.UPLOAD_RETRY_MAX&&0===b.offset){var l=f.fileSize();20971520>l&&f.data.set({status:"useWmsvr",value:!0})}b.retry++}j||f.setState(b,"error",g)}else a.Msgbox.show({icon:"err",title:g});try{var m=encodeURIComponent(b.name),n={code:c,reason:d,size:b.size,retry:b.retry,agent:b.type,name:m};Fc.record("attach",n)}catch(k){}return j||f.cancelAutoSend(Bc.t("附件上传失败，已为你取消了自动发送")),j}function ob(a){var b=this,c=b.base,d=Jc.sliceTime;c.addTimer("netCheck",function(){b.netCheckFire(a)},d)}function pb(a){var b=this;if("upload"==a.state&&a.useSplit){if(0===a.offset||a.offset==a.lastOffset)return a.cloud||b.set({status:"validServer",value:!0}),b.error(a,"TIMEOUT")?b.fileRetry(a,{code:"TIMEOUT"}):b.resum(a),void 0;a.lastOffset=a.offset,b.netCheckSet(a)}}function qb(){var a=this,b=a.base;b.clearTimer("netCheck")}function rb(a){var c=this,d=c.base,e=c.data;e.sequence.uploadResult&&(delete e.sequence.uploadResult,a?(d.tips(a),b.setTimeout(function(){d.tips("")},5e3)):d.tips(""))}function sb(){var b=this,c=[],d={state:"success",inlined:!1,media:!1,url:""},e=b.fileGet(d);return a.Array.each(e,function(a,b){b.sid&&c.push(b)}),c}function tb(a){var b=this,c=b.base;c.setSequence("attachMove",function(){var c=b.moveGet();c.length&&b.moveCloud(c,a)})}function ub(b,c){var d=this,e=d.base,f=d.data,g=[],h=0;a.Array.each(b,function(a,b){g.push(b.sid),h+=b.size}),a.Ajax.jsonp(d.getUploadProxy({type:"script",move:!0,aid:g,size:c}),function(a){e.tips(""),f.set({status:"uploadParam",value:null}),d.moveComplete(a)}),f.set({status:"uploadParam",value:{action:"move",size:c,xsize:h}}),e.tips(Bc.t("正在移动附件..."))}function vb(b){var c=this;if(b.code==Gc){var d=b.move;d&&d.length&&c.moveReplace(d)}else{var e="";switch(b.code){case"FA_OVERFLOW":e=Bc.t("超大附件容量超过")+a.Number.convert($S("cloud").capacity)+Bc.t("的限制！");break;default:e=Bc.t("超大附件系统繁忙，错误码")+b.code}a.Msgbox.show({icon:"err",title:e})}}function wb(b){var c=this,d=[];a.Array.each(b,function(a,b){d.push(b.attachmentId)}),c.action.deleteAttach({sid:d,callback:function(d){d.code==Gc&&a.Array.each(b,function(a,b){var d=c.fileGet({sid:b.attachmentId})[0];d&&(d.sid="",c.cloudConvert(d,b))})}})}function xb(){var a=this;a.base;var b=a.data,c=0,d=b.get({status:"uploadParam"});return d&&"move"==d.action&&d.xsize>0&&(c=d.xsize),c}function yb(a){var b=this;return a&&b.cloudStatus()&&b.set({status:"cloudTrigger",value:!0}),b.cloudStatus()?b.get({status:"cloudTrigger"}):!1}function zb(){var a=this;return a.getUploadHost()&&$S("cloud")?!0:!1}function Ab(b){var c=b.ui;b.nameExist&&c&&(c.name.html(a.String.escapeHTML(b.name)),c.tips.html(Bc.t("你已上传过同名文件，本文件已自动改名以避免覆盖旧文件")))}function Bb(b,c){var d=this;if(Cc.isArray(b))return a.Array.each(b,function(a,b){d.cloudConvert(b)}),void 0;"object"!=typeof b.link||c||(c=b.link);var e={type:"bigattach",url:$S("cloud").displayUrl+c.url,name:c.fileName,id:c.id,size:c.existlen,time:c.expireTime};c.preview&&(e.preview=$S("cloud").previewUrl+c.url),b.type="link";var f="";e.id&&-1!=e.id&&(f=[e.type,e.id].join(":")),b.eid=f,b.url=e.url,b.link=e,e.size&&(b.size=b.bytesLoaded=e.size),d.setState(b,"link")}function Cb(){var b=this,c=b.module;b.base;var d=b.data,e=Hc.get({field:"ntes_letter",flag:"autoSendTips"});if("0"==e){var f=d.get({component:"toolbar"}),g=f.find("button")[0];if(g){var h=new a.Layer({icon:{type:"info",size:"m"},width:"230px",items:[{html:"<span>"+Bc.t("附件正在上传，点击发送按钮，即可在")+"<br/>"+Bc.t("上传完成后自动发送。 ")+"</span>"},{xtype:"link",text:Bc.t("不再提示"),cls:"nui-txt-link",click:function(){Hc.set({field:"ntes_letter",flag:"autoSendTips",value:"1"}),this.ownerCt.destroy()}}],params:"hasArr arrUp hasClose",doNotHide:!0,renderTo:c.container});h.pointTo(g.getEl(),a.fly(c.container)),d.set({component:"autoSendTips",value:h})}}}function Db(){}function Eb(){try{var a=$L("product.FileCenter",this)}catch(b){return b}a.entry("bj_center")}function Fb(b){var c=this,d=c.module,e={module:d,attach:c,type:b};try{var f=$L("product.attach.BaseAttach",this)}catch(g){return g}(new f).entry(e),Fc.cache({cl_attachmsg:""+b},a.EMPTYFUNC)}function Gb(){var b=this,c=b.module,d={module:c,attach:b};try{var e=$L("product.attach.DropboxAttach",this)}catch(f){return f}(new e).entry(d),Fc.cache({cl_attachmsg:""+sType},a.EMPTYFUNC),(new e).entry(d)}function Hb(){}function Ib(b){var c=this,d=c.base;if(b&&b.length){var e=[];a.Array.each(b,function(a,b){b&&b.checked&&0===c.fileGet({type:"storage",mid:b.mid}).length&&e.push(c.netfolderStructure(b))}),e.length&&c.action.syncAttach({attachments:e,callback:function(b){if(b.code==Gc){var d=[],f=b["var"].attachments;a.Array.each(f,function(b,c){a.Array.each(e,function(a,b){c._mid==b._mid&&d.push(c)})}),c.storageAdd(d)}}})}d.setPage("compose")}function Jb(a){var b={};return b.type="netfolder",b.id=-1,b._mid=a.mid,b.name=a.name,b.contentType=a.type,"string"==typeof a.size&&(a.size=parseInt(a.size,10)),b.size=a.size,b}function Kb(b){var c=this;if(Cc.isArray(b))return a.Array.each(Cc.toArray(b),function(a,b){c.linkAdd(b)}),void 0;var d="";if(b.id&&-1!=b.id){if(d=[b.type,b.id].join(":"),c.fileGet({type:"link",eid:d}).length)return}else if(c.fileGet({type:"link",url:b.url}).length)return;var e=c.fileCreate({type:"link",name:b.name,eid:d,cloud:b.cloud});e.url=b.url,e.link=b,b.size&&(e.size=e.bytesLoaded=b.size),c.add(e)}function Lb(){var b=this,c=b.data,d=c.get({status:"fromEntry"}),e=!1,f=!1;if("draft"==d||"timeset"==d)e=!0;else if("compose"==d)return;for(var g,h=[];;){if(g=b.editor.get({id:"divEditorAttachLink"}),!g)break;var i=g.dom;e&&(e=!1,a.Array.each(Cc.toArray(i.childNodes),function(a,b){try{var c=b.innerHTML,d=JSON.parse(c);"bigattach"==d.type&&(f=!0),d.cloud=!0,h.push(d)}catch(e){}})),g.remove()}f&&b.cloudTrigger(!0),b.linkAdd(h)}function Mb(b){var c=this,d="",e=c.fileGet({type:"link"});if(e.length){var f=b.action,g=b.subject;g=encodeURIComponent(g);var h=!0;("deliver"==f||"schedule"==f)&&(h=!1);var i=[],j={};a.Array.each(e,function(b,d){var e=d.link;if(h)i[i.length]="<xmp>"+JSON.stringify(e)+"</xmp>";else{var f=d.url,k=d.name,l=e.type,m=j[l];m||(m=j[l]=[]);var n="",o=c.linkIcon(d);if("bigattach"==l){var p=e.preview||"",q=new Date(e.time),r=a.Date.format(q,Bc.t("yyyy年M月d日 H:mm"));f=a.String.uriAddParam(f,"title="+g),p&&(p=a.String.uriAddParam(p,"title="+g)),n='<div style="clear:both;height:36px;padding:6px 4px"><div style="float:left;width:36px"><a href="'+f+'"><img border="0" src="'+o+'" /></a>'+"</div>"+"<div>"+'<div style="padding:0px;font-size:12px;line-height:14px">'+'<a href="'+f+'" download="'+f+'" preview="'+p+'" fileid="'+e.id+'" filename="'+k+'" filesize="'+e.size+'" expiretime="'+e.time+'" target="_blank" style="color:#000;text-decoration:none">'+k+"</a>"+'<span style="color:#bbb"> ('+a.Number.convert(e.size)+", "+r+Bc.t(" 到期)")+"</span>"+"</div>"+'<div style="padding:4px 0px;font-size:12px;line-height:14px">'+(p?'<a href="'+p+'">'+Bc.t("在线预览")+"</a> | ":"")+'<a href="'+f+'">'+Bc.t("下载")+"</a>"+"</div>"+"</div>"+"</div>"}else"netfolder"==l?n='<div style="clear:both;height:36px;padding:6px 4px"><div style="float:left;width:36px"><a href="'+f+'"><img border="0" src="'+o+'" /></a>'+"</div>"+"<div>"+'<div style="padding:0px;font-size:12px;line-height:14px">'+'<a href="'+f+'" download="'+f+'" fileid="'+e.id+'" filename="'+k+'" filesize="'+e.size+'" target="_blank" style="color:#000;text-decoration:none">'+k+"</a>"+'<span style="color:#bbb"> ('+a.Number.convert(e.size)+")</span>"+"</div>"+'<div style="padding:4px 0px;font-size:12px;line-height:14px">'+'<a href="'+f+'">'+Bc.t("下载")+"</a>"+"</div>"+"</div>"+"</div>":"dropbox"==l&&(n='<div style="clear:both;height:36px;padding:6px 4px"><div style="float:left;width:36px"><a href="'+f+'"><img border="0" src="'+o+'" /></a>'+"</div>"+"<div>"+'<div style="padding:0px;font-size:12px;line-height:14px">'+'<a href="'+f+'" download="'+f+'" fileid="'+e._mid+'" filename="'+k+'" filesize="'+e.size+'" target="_blank" style="color:#000;text-decoration:none">'+k+"</a>"+'<span style="color:#bbb"> ('+a.Number.convert(e.size)+")</span>"+"</div>"+'<div style="padding:4px 0px;font-size:12px;line-height:14px">'+'<a href="'+f+'">'+Bc.t("下载")+"</a>"+"</div>"+"</div>"+"</div>");m.push(n)}}),h?d='<div id="divEditorAttachLink" style="display:none">'+i.join("")+"</div>":Cc.each(j,function(a,b){var c,e;"netfolder"==a?(c="divNeteaseNetfolder",e=Bc.t("文件")):"bigattach"==a?(c="divNeteaseBigAttach",e=Bc.t("超大附件")):"dropbox"==a&&(c="divNeteaseDropbox",e=Bc.t("Dropbox文件")),d+='<div id="'+c+'" style="clear:both;margin-top:10px;margin-bottom:15px;background:#DEE8F2;padding:4px;font-family:verdana,Arial,Helvetica,sans-serif">'+'<div style="font-size:14px;padding:4px 8px 8px 8px;line-height:16px">'+"<b>"+Bc.t("从网易")+$S("product")+Bc.t("邮箱发来的")+e+"</b>"+"</div>"+'<div style="background:#fff;padding:4px">'+b.join("")+"</div>"+"</div>"})}return d}function Nb(a){var b=Ic.getUrl("compose_attach_icon",!0),c=[b,"1",".gif"],d=a.ext;return d&&xc.icoFileIndex[d]&&(c[1]=xc.icoFileIndex[d]),c.join("")}function Ob(b){var c=this;if(b&&b.length){var d=[];a.Array.each(b,function(b,e){var f=e.name;f=f.split("&")[0];var g=c.fileGet({type:"storage",size:e.size});a.Array.each(g,function(b,c){return c.url&&0===c.url.indexOf(f)?(e=null,a.BREAK):void 0}),e&&d.push(e)}),d.length&&c.action.syncAttach({attachments:d,callback:function(b){if(b.code==Gc){var e=[],f=b["var"].attachments;a.Array.each(f,function(b,c){a.Array.each(d,function(a,b){c.name==b.name&&e.push(c)})}),c.storageAdd(e)}}})}}function Pb(b){var c=this;b&&b.length&&c.action.syncAttach({attachments:b,callback:function(d){if(d.code==Gc){var e=[],f=d["var"].attachments;a.Array.each(b,function(b,c){a.Array.each(f,function(b,d){if("internal"==d.type&&!d.deleted&&d.name==c.name){var f=d._mid,g=c._mid;-1!=f.indexOf(":")&&(f=f.split(":")[1]),-1!=g.indexOf(":")&&(g=g.split(":")[1]);var h=Math.abs(d.size-c.size);if(f==g&&100>h)return e.push(d),a.BREAK}})}),c.storageAdd(e)}}})}function Qb(b){var c=this;if(b&&b.length){var d=[];a.Array.each(b,function(a,b){b.code==Gc&&d.push(b["var"])}),c.storageAdd(d)}}function Rb(b){var c=this,d=c.editor;a.Array.each(b,function(b,e){c.storageAdd(e);var f=e.fileName,g=e.attachmentId,h=e.mediaType,i=e.totalTime,j="";"video"==h?(Fc.cache({cl_video:1},a.EMPTYFUNC),j='<div><img data-media="'+g+'" border="0" src="https://mimg.127.net/p/js5/lib/img/ico_video.gif" style="vertical-align: middle;"/>'+'<player id="cmd:voice" param="'+f+'" media="video"></player>'+'<span style="padding : 3px 5px">'+i+"</span>"+'<span style="line-height: 1.7; color: rgb(128, 128, 128);">'+Bc.t("(如果您看不到视频，请下载附件)")+"</span>"+"</div>"):"audio"==h&&(Fc.cache({cl_audio:1},a.EMPTYFUNC),j='<div><img data-media="'+g+'"  border="0" src="https://mimg.127.net/p/js5/lib/img/ico_audio.gif" style="vertical-align: middle;"/>'+'<player id="cmd:voice" param="'+f+'" media="audio"></player>'+'<span style="padding : 3px 5px">'+i+"</span>"+'<span style="line-height: 1.7; color: rgb(128, 128, 128);">'+Bc.t("(如果您看不到音频，请下载附件)")+"</span>"+"</div>"),j&&(j="<div>"+Bc.t("这个是我刚才录制的哇，你看看呀～～")+"</div>"+j+"<br/><div>&nbsp;&nbsp;</div>",d.insert({html:j}))})}function Sb(){var a=this,b=!1;return a.fileGet({type:"storage",name:Bc.t("信纸.jpg")}).length>=1&&(b=!0),b}function Tb(){var a=this,b=null,c=a.get({status:"stationeryUrl"});return c&&(b=a.fileGet({type:"storage",url:c})[0]),b}function Ub(a){var b=this,c=b.stationeryGet();return c?(b.remove(c,function(){b.set({status:"stationeryUrl",value:""}),a&&a()}),void 0):void 0}function Vb(b,c){var d=this,e=d.stationeryGet();if(e)return d.stationeryClear(function(){d.stationerySync(b,c)}),void 0;var f=d.stationeryStruct(b);d.set({status:"stationeryUrl",value:f.name}),d.action.syncAttach({attachments:[f],callback:function(b){if(b.code==Gc){var e=[];if(a.Array.each(b["var"].attachments,function(a,b){b.name==f.name&&(b.deleted||e.push(b))}),e.length>=1){var g=e.pop();return g.inlined="true",d.storageAdd(g),c(g.name)}}return c(null)}})}function Wb(a){var b={};return b.id=-1,b.type="url",b.mode="copy",b.name=a.imageUrl,b.displayName=Bc.t("信纸.jpg"),b.contentType=a.contentType,b.size=a.size,b}function Xb(){var a=this,b=a.base;b.setPage("photo")}function Yb(b){var c=this,d=c.base;d.setPage("compose");var e=c.editor;if(a.String.trim(b)){var f=b.split(";"),g="";a.Array.each(f,function(a,b){var c=b.split("+");g+='<a href="'+c[1]+'" target="_blank"><img border="0" src="'+c[0]+'"></a><br>'}),e.insert({html:g})}}function Zb(){var a=this,b=Ic.getUrl("compose_photo",!0),c=Ic.getUrl("compose_attach",!0),d=a.base.getCallName(function(){a.photoCallBack.apply(a,arguments)},!0);return c+="&call=window.parent."+d,b+="&backurl="+encodeURIComponent(c)}function $b(){var a=this,b=!1;return a.fileGet({type:"storage",name:Bc.t("名片.vcf")}).length>=1&&(b=!0),b}function _b(){var a=this,b=null,c=a.get({status:"cardUrl"});return c&&(b=a.fileGet({type:"storage",url:c})[0]),b}function ac(b){var c=this,d=c.cardGet();if(d)return c.remove(d,function(){c.set({status:"cardUrl",value:""}),c.cardSync(b)}),void 0;var e=c.cardStructure(b);c.set({status:"cardUrl",value:e.name}),c.action.syncAttach({attachments:[e],callback:function(b){if(b.code==Gc){var d=[];a.Array.each(b["var"].attachments,function(a,b){b.name==e.name&&(b.deleted||d.push(b))}),d.length>=1&&c.storageAdd(d.pop())}}})}function bc(a){var b={};return b.id=-1,b.type="url",b.mode="copy",b.name=a.ecardVCFUrl,b.displayName=Bc.t("名片.vcf"),b.contentType="text/x-vCard",b.size=a.ecardVCFFileSize,b}function cc(a){var b=this;b.mobileUrl=a?"http://config.mail.163.com:8080":Ic.getUrl("compose_attach_mobile",!0),b.mobileCheckInst()}function dc(){var a=this;if(Jc.appInstall)return a.mobileShowUpload(),void 0;var b={url:"/msgdispatcher/prestage/web/checkinst.do",callback:function(b){200==b.code&&("on"==b.data.inst?(a.mobileShowUpload(),Jc.appInstall=!0):"off"==b.data.inst&&a.mobileShowORCode())}};a.mobileRequest(b)}function ec(){var a=this,b={url:"/msgdispatcher/prestage/web/checkstatus.do",callback:function(b){if(200==b.code){var c=b.data.status;"-1"==c||"0"==c||"1"==c||"2"==c&&a.mobileShowUpload()}}};a.mobileRequest(b)}function fc(){var b=this,c=b.module,d=b.mobileUrl+"/msgdispatcher/prestage/web/getqrcode.do",e=a.String.uriAddParam(d,"sid="+$S("sid"))+("&uid="+$S("orgUid")),f=a.SenderList.getMobile();f&&(e+="&alias="+f.address),e+="&uidinuse="+$S("uid"),e+="&host="+$S("host"),e+="&cid="+b.info.get({cid:!0});var g=Ic.getUrl("compose_attach_mobile_mailmaster",!0),h=Ic.getUrl("compose_attach_mobile_help1",!0),i='<div id="'+c.createId("dvAttachMobile")+'" class="APP-editor-insertPic-mobile">'+'<div style="text-align:center;width:100%;height:auto;padding-bottom:10px"><img src="'+e+'"/></div>'+'<div class="APP-editor-insertPic-mobile-intro">'+Bc.t("从手机上传图片，此功能需要先安装并登录网易邮箱大师使用，")+"<br />"+Bc.t("请先扫描二维码下载安装。")+"</div>"+'<div class="APP-editor-insertPic-mobile-link">'+'<a href="'+g+'" target="_blank" class="nui-txt-link">'+Bc.t("或者手动下载邮箱大师 ")+"</a> &nbsp;"+'<a href="'+h+'" target="_blank" class="nui-txt-link">'+Bc.t("帮助")+"</a>"+"</div>"+"</div>",j=null;j=a.Msgbox.show({header:Bc.t("从手机上传图片"),content:i,extcls:"APP-editor-insertPic",contentType:"normal",noFooter:!0,autoFocus:!1,close:function(){b.mobileCheckStatus()}})}function gc(){var a=this;a.module;var b=a.data,c=Ic.getUrl("compose_attach_mobile_mailmaster",!0),d='<div style="text-align:center;width:100%;height:auto;padding-bottom:10px"><img src="https://mimg.127.net/xm/webmail/img/ecode_done.jpg"/></div><div class="APP-editor-insertPic-mobile-intro">'+Bc.t("扫描成功！建议您马上下载邮箱大师并登录，")+"<br/>"+Bc.t("打开手机中接收到的消息提醒，选择要上传的图片。")+"</div>"+'<div class="APP-editor-insertPic-mobile-link"><a href="'+c+'" target="_blank" class="nui-txt-link">'+Bc.t("或者手动下载邮箱大师")+"</a></div>",e=b.get({moduleId:"dvAttachMobile"});e.html(d)}function hc(){function c(){h=setTimeout(function(){d.mobileUpdateAttachInfo(),c()},j)}var d=this,e=d.module,f=Ic.getUrl("compose_attach_mobile_help2",!0),g='<div id="'+e.createId("dvAttachMobile")+'" class="APP-editor-insertPic-mobile">'+'<div style="text-align:center;width:100%;height:auto;padding-bottom:40px;padding-top:20px;"><img src="//mimg.127.net/xm/webmail/img/img-upload-minifed.png"/></div>'+'<div style="color:#81858a;">'+Bc.t("点击邮箱大师App推送的手机消息通知")+" >>  "+Bc.t("选择图片上传")+" >>  "+Bc.t("上传成功")+"<br/>"+"</div>"+'<div class="nui-fClear" style="color:#81858a;padding:20px 0 20px 6px; text-align:left;">'+'<div style="float:left;">'+"<p>没有收到手机消息通知？</p>"+"<p>步骤1：手动打开App，然后"+'<a id="'+e.createId("mobileRetry")+'" href="javascript:void(0)" class="nui-txt-link">'+Bc.t("点此重试")+"</a>"+"</p>"+"<p>步骤2：确认App与网页登录了相同的邮箱账号</p>"+"</div>"+'<div style="float:right">'+'<img style="height:60px;width:60px;" src="//mimg.127.net/xm/webmail/img/yxds-qrcode-minifed.png">'+"</div>"+"</div>"+'<div style="text-align:center">'+'<a href="'+f+'" class="nui-txt-link" target="_blank">'+Bc.t("获取帮助")+"&gt;&gt;</a>"+"</div>"+"</div>",h=null,i=null,j=1e4;
i=a.Msgbox.show({width:"450px",header:Bc.t("从手机上传图片"),content:g,extcls:"APP-editor-insertPic",contentType:"normal",noFooter:!0,autoFocus:!1,close:function(){return b.clearTimeout(h),d.mobileClose(this)},listeners:{afterRender:function(){d.mobileStart(),a("#"+e.createId("mobileRetry")).listen("click",function(){d.mobileStart()}),c()}}})}function ic(){var a=this,b=1024*1024*$S("attachSize"),c=a.fileSize(),d=b-c,e={func:"start",url:"/msgdispatcher/upload/web/startupload.do",param:{remainspace:d},callback:function(b){200==b.code&&a.info.set({tid:b.data.taskid})}};a.mobileRequest(e)}function jc(){var a=this,b=a.info.get({tid:!0});if(b){var c={func:"cancel",url:"/msgdispatcher/upload/web/cancel.do",param:{taskid:a.info.get({tid:!0})},callback:function(b){200==b.code&&(b.data,a.mobileUpdateAttachInfo(),a.info.set({tid:""}))}};a.mobileRequest(c),a.set({status:"validServer",value:!0})}}function kc(a){var b=this,c=a.action;switch(c){case"downloaded":b.mobileShowDownload();break;case"loggedin":b.mobileShowUpload();break;case"upload":4==a.status&&b.mobileUpload(a),(5==a.status||6==a.status)&&b.mobileFinish(a);break;case"":}}function lc(){var a=this,b=a.info.get({tid:!0});b&&a.mobileCancel()}function mc(b){var c=this;c.module;var d=c.data;b.uploadedaid;var e=b.nextupaid,f=b.overallmap;if(-1!=e){var g=f[e];if(g){var h=a.String.escapeHTML(g.name),i=xc.getSubtype({type:"file",name:h}),j='<div class="APP-editor-insertPic-mobile-fileIco">'+new a.Icon({type:"file75",subtype:i}).html()+"</div>"+'<div class="APP-editor-insertPic-mobile-fileName">'+h+"</div>"+'<div class="APP-editor-insertPic-mobile-loading"></div>'+'<div class="APP-editor-insertPic-mobile-intro">'+Bc.t("正在从手机上传图片中，请稍候")+"</div>",k=d.get({moduleId:"dvAttachMobile"});k.html(j)}}}function nc(b){var c=this,d=c.action,e=b.uploaded;b.remain,b.failed,d.getInfo({callback:function(b){var d=[],f=b["var"].attachments;a.Array.each(f,function(b,c){a.Array.each(e,function(a,b){c.id!==b&&d.push(c)})}),c.storageAdd(d),c.info.set({tid:""}),a.Msgbox.msgbox.close()}})}function oc(){var b=this,c=b.action;c.getInfo({callback:function(c){var d=[],e=c["var"].attachments;a.Array.each(e,function(a,c){b.fileHas({sid:c.id})||d.push(c)}),b.storageAdd(d)}})}function pc(b){var c=this,d=c.mobileUrl,e=d+b.url,f=a.String.uriAddParam(e,"sid="+$S("sid"))+("&uid="+$S("orgUid")),g=a.SenderList.getMobile();g&&(f+="&alias="+g.address),f+="&uidinuse="+$S("uid"),f+="&host="+$S("host"),f+="&cid="+c.info.get({cid:!0}),b.param&&Cc.each(b.param,function(a,b){var c="&"+[a,b].join("=");f+=c}),a.Ajax.jsonp(f,b.callback)}function qc(b,c){b=b||0,"number"==typeof c?0>c&&(c=0):c=2;var d=Math.pow(10,c),e=[],f=0,g=0,h=["","B","K","M","G","T"];return 0===b||(1024>b?(g=1,f=b):b<Math.pow(1024,2)?(g=2,f=Math.round(b/1024*d)/d):b<Math.pow(1024,3)?(g=3,f=Math.round(b/Math.pow(1024,2)*d)/d):(g=4,f=Math.round(b/Math.pow(1024,3)*d)/d)),e.push(String(f)),-1==e[0].indexOf(".")?c&&(e.push("."),a.Array.each(new Array(c),function(){e.push("0")})):(e=e[0].split("."),function(){var b=c-e[1].length;b>0&&a.Array.each(new Array(b),function(){e[1]+="0"})}(),e=[e.join(".")]),e.push(h[g]),e.join("")}function rc(b){var c="";if(-1==b)c="??:??:??";else if(b>86400)c="23:59:59";else{var d=new Array(3);d[2]=b%60,b-=d[2],b/=60,d[1]=b%60,b-=d[1],b/=60,d[0]=b,a.Array.each(d,function(a,b){10>b&&(c+="0"),c+=b,2>a&&(c+=":")})}return c}function sc(a){var b=a.errCode,c=a.errReason;return("FA_OVERFLOW"===b||"FA_UPLOAD_SIZE_EXCEEDED"===b)&&"pref_flow_limit"===c}function tc(a){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showUploadOverflowDialog(function(){a&&a()})}function uc(a){var b=this,c=b.view,d=a.size/1024/1024;"pdf"!==a.ext||d>20||c.PDFConvertTips(a)}try{var vc=$L("module.compose.Compose")}catch(wc){return wc}try{var xc=$L("util.Icon")}catch(wc){return wc}try{var yc=$L("init.SenderList")}catch(wc){return wc}try{var zc=$L("init.Support")}catch(wc){return wc}try{var Ac=$L("support.CloudSupport")}catch(wc){return wc}var Bc=new $I18N("module.compose.ComposeAttach"),Cc=a.Object;a.Browser;var Dc=a.Ext,Ec=a.EXTLIMIT,Fc=a.Log,Gc=a.S_OK,Hc=a.Ud,Ic=a.Uri,Jc=a.createClass($N("module.compose.ComposeAttach"));Cc.inherit(Jc,vc),Cc.extend(Jc.prototype,vc.prototype),Cc.extend(Jc,{file:{cid:"",sid:"",fid:"",eid:"",icon:"",cloud:!1,context:!1,type:"",mime:"",url:"",download:"",link:null,size:0,path:"",md5:"",modtime:null,useSplit:!1,skipSplit:!1,offset:0,lastOffset:0,length:0,fileExist:0,pathExist:!1,name:"",nameExist:!1,percent:-1,bytesHashed:-1,bytesLoaded:-1,retry:0,ext:"",extLimit:!1,state:"",err:"",errCode:"",errReason:"",blob:null,digest:null,speed:null,inlined:!1,mixed:!1,media:!1,lock:!1,ret:null,options:null,"delete":null,ui:null},errDescription:{extension:Bc.t("文件类型受限"),empty:Bc.t("文件内容为空"),limit:Bc.t("文件大小超过限制"),quota:Bc.t("文件大小超过总限制"),limitBig:Bc.t("文件大小超过超大附件单个文件限制"),quotaBig:Bc.t("文件大小超过超大附件总限制"),errorBig:Bc.t("超大附件服务异常"),retryErrorBig:Bc.t("附件上传出错"),2038:Bc.t("文件I/O错误")},filter:[{description:Bc.t("所有文件 (*.*)"),extension:"*.*","default":!0},{description:Bc.t("图片文件 (*.jpg;*.gif;*.png;*.bmp)"),extension:"*.jpg;*.gif;*.png;*.bmp"},{description:Bc.t("文档文件 (*.pdf;*.doc;*.xls;*.txt)"),extension:"*.pdf;*.doc;*.xls;*.txt"},{description:Bc.t("网页文件 (*.mht;*.htm;*.html)"),extension:"*.mht;*.htm;*.html"}],filterImage:[{description:Bc.t("图片文件 (*.jpg;*.gif;*.png;*.bmp)"),extension:"*.jpg;*.gif;*.png;*.bmp","default":!0}],sliceLength:196608,sliceTime:12e4,symbol:String.fromCharCode(92)+String.fromCharCode(92),appInstall:!1,UPLOAD_RETRY_MAX:[],getSize:qc,getRemain:rc});var Kc={initialize:c,clear:e,init:d,destroy:f,initProcess:g,initElement:h,initUploadHost:i,sourceGet:k,layout:l,filterCheck:m,corpFilterCheck:n,filterFail:o,filterSelect:p,prompt:q,set:r,setState:s,setInfo:t,setStart:u,setFinish:v,setLock:w,setBytes:x,setHash:y,setSpeed:z,setProgress:A,setTotalProgress:B,get:C,getCheck:D,getUploadHost:E,initUploadRetryMax:j,getUploadUrl:F,getUploadProxy:G,getPreview:H,skipUploadHost:I,fileCreate:J,fileCount:K,fileGet:L,fileAdd:M,fileDelete:N,fileHas:O,fileSize:P,fileAutoUpload:Q,fileAutoHash:R,fileProgress:S,complete:T,fileIsUpload:U,fileIsPost:V,fileIsError:W,add:X,resum:Y,remove:_,setAuto:ab,setInsert:bb,setTips:cb,setPDFConvertTips:uc,getResumLink:Z,getUnlockOverflowLimitLink:$,inlineInsert:db,inlineRemove:eb,inlineGet:fb,inlineSync:gb,inlinedProgress:hb,inlinedError:ib,storageAdd:jb,validLocal:kb,validServer:lb,check:mb,error:nb,showOverflowDialog:tc,isOverflow:sc,netCheckSet:ob,netCheckFire:pb,netCheckClear:qb,cancelAutoSend:rb,moveGet:sb,movePrepare:tb,moveCloud:ub,moveComplete:vb,moveReplace:wb,moveSize:xb,cloudTrigger:yb,cloudStatus:zb,cloudRename:Ab,cloudManage:Eb,cloudConvert:Bb,cloudAutoTips:Cb,cloudIsProxyAllFail:Db,msg:Fb,dropboxMsg:Gb,bigMsg:Hb,netfolderAdd:Ob,internalAdd:Pb,ynoteAdd:Qb,avMailAdd:Rb,netfolderStructure:Jb,netfolderCallBack:Ib,linkAdd:Kb,linkParse:Lb,linkHtml:Mb,linkIcon:Nb,stationeryHas:Sb,stationeryGet:Tb,stationeryClear:Ub,stationerySync:Vb,stationeryStruct:Wb,photoOpen:Xb,photoCallBack:Yb,photoGetUrl:Zb,cardHas:$b,cardGet:_b,cardSync:ac,cardStructure:bc,mobileMsg:kc,mobileClose:lc,mobileInit:cc,mobileCheckInst:dc,mobileCheckStatus:ec,mobileShowORCode:fc,mobileShowDownload:gc,mobileShowUpload:hc,mobileStart:ic,mobileUpload:mc,mobileCancel:jc,mobileFinish:nc,mobileRequest:pc,mobileUpdateAttachInfo:oc};Cc.extend(Jc.prototype,Kc)}($,window),function(a,b,c){function d(a){var b=this;wb.superClass.initialize.call(b,a)}function e(){var a=this;wb.superClass.init.call(a)}function f(){var a=this,b=a.editor;a.element(),a.defined(),a.initUd(),b.create(),a.module.scroll("main"),a.addTimer("delay",function(){a.startDelay()})}function g(){var b=this;b.module;var c=b.data,d=b.attach,e=b.editor;return c.get({status:"startDelay"})===!0?!0:(b.userDataResume(),d.initProcess(),b.focus(),b.autoSave(),b.autoKeep(),b.addTimer("assistDelay",function(){b.assist.dragInit(),b.assist.clipInit()},300),c.set({status:"startDelay",value:!0}),rb.notary&&a.Ud.getProxy({field:"product.notary.userpro",call:function(a){var c=a["product.notary.userpro"];1==c?(b.initNotary(),e.hideNotaryBtn()):e.notaryCheck()}}),rb.composeAt&&"compose"==c.get({status:"fromEntry"})&&b.addTimer("atDelay",function(){e.setPlaceholder({show:!0})},200),a.Ud.getProxy({field:["exten.mktToolSendNickname"],call:function(b){if(b["exten.mktToolSendNickname"]){var c=a(".hn1.nui-txt-link");c.css({display:"block"})}}}),void 0)}function h(b){var c=this,d=c.module,e=c.data;if(b.timer)return c.addTimer("layout",function(){b.timer=!1,c.layoutAdjust(b)},10),void 0;var f=e.layout;if(f&&f.baseHeight){var g=d.getModuleClass();g!=f.containerCls&&(a(d.container).replaceClass(f.containerCls,g),f.containerCls=g);var h=!1,i=!1,j=$S("clientHeight");if((j!=f.baseHeight||b.force)&&(d.layoutInit(),h=!0),h){var k=c.editor;k.setSize({height:f.editorHeight+"px"})}if(i&&c.success.resize(),b.attach){var l=c.attach;l.layout()}}}function i(){var b=this,c=b.module,d=b.data,e=b.event,f=b.form;"0"==ub.get({field:"ntes_global",flag:"compose_showContacts"})&&(a.SM.go({module:"address.AddressModule",noDragbar:!0,cacheModule:!0,cacheDom:!0,reset:!1,parent:c}),d.set({status:"showSide",value:!0})),"1"==ub.get({field:"ntes_compose",flag:"separate_default"})&&"compose"==d.get({status:"fromEntry"})&&e.setSeparate({show:!0});var g=$S("attrs").user.ntes_htmlbar;"number"==typeof g&&2==g&&d.set({status:"showHtmlbar",value:!1}),"3"!=ub.get({field:"ntes_compose",flag:"upload_mode"})&&d.set({status:"uploadMode",value:"super"}),"1"==ub.get({field:"ntes_option",flag:"requirereceipt"})&&f.setCheckbox("receipt",!0)}function j(){var b=this,c=b.module,d=b.data,e=b.form,f=["to","subject","main","succ","toolbar","ext","notary","encrypt","schedule"];a.Array.each(f,function(a,b){d.set({moduleId:b,value:b})}),a.Array.each(["to","subject"],function(a,b){e.addHoverEvent(b)}),c.attach.initElement()}function k(){var b=this.data;a.Ud.getProxy({field:["product.vipMember"],call:function(a){var c=a["product.vipMember"];b.set({status:"vipMember",value:c})}})}function l(a,b){var c=this,d=c.module,e=c.attach,f=c.data,g=c.editor,h=c.form,i=c.event,j=c.info;a=a||j.get({obj:!0});var k=a.account;k&&h.setSender(k);var l=!1,m=f.get({status:"fromEntry"});"reply"==m&&(l="2"==ub.get({field:"ntes_option",flag:"sendershow"}));var n=a.to;n&&h.setContact(n,"to",l);var o=a.cc;o&&(h.setContact(o,"cc",l),o.length&&i.setCc({show:!0,separate:!0}));var p=a.bcc;p&&(h.setContact(p,"bcc",l),p.length&&i.setBcc({show:!0,separate:!0}));var q=a.showOneRcpt;q&&i.setSeparate({show:!0});var r=a.subject;"string"==typeof r&&h.setSubject(r);var s=a.priority;1==s&&h.setCheckbox("priority",!0);var t=a.requestReadReceipt;t&&h.setCheckbox("receipt",!0);var u=a.scheduleDate;if(u&&(h.setCheckbox("schedule",!0),d.schedule.set(u)),!b){var v=a.content||"",w="html";if("boolean"==typeof a.isHtml&&!a.isHtml){w="text";var m=f.get({status:"fromEntry"});("edit"==m||"draft"==m||"timeset"==m)&&h.setCheckbox("text",!0)}g.setOriginal(v,w);var x=a.attachments;x&&e.storageAdd(x,!0);var y=a.link;y?e.linkAdd(y):e.linkParse(),"number"==typeof a.card&&c.sign.fillData({card:a.card}),c.changeSync()}}function m(b){var c=this,d=c.module,e=c.attach,f=c.data,g=c.info,h=f.get({status:"showScheduleInvitation"});if(c.sendCheck(b)&&"success"!=f.get({status:"curPage"})){if(f.get({component:"autoSendTips"}))try{f.get({component:"autoSendTips"}).hide()}catch(i){}if(f.get({component:"attachLayer"}))try{f.get({component:"attachLayer"}).hide()}catch(i){}var j={},k={action:b.action},l=g.get({cid:!0});if(l&&(j.id=l),"verify"==b.action)j.verifyCode=b.code;else{var m=j.attrs=c.sendBuild(b);c.info.set({obj:m}),c.info.set({con:[].concat(m.to,m.cc,m.bcc)})}j.returnInfo="deliver"==b.action||"schedule"==b.action||"verify"==b.action?!1:!0;var n=b.action;if("auto"==b.action||"force"==b.action?n="save":"verify"==b.action&&(n="deliver",f.get({status:"showSchedule"})&&(b.action=n="schedule")),j.action=n,c.attach.fileHas({type:"link"})&&(j.flagLinkAttached=!0),"deliver"==b.action&&0===$S("attrs").user.save_sent){var o=e.fileGet({context:!0});o&&o.length||(j.saveTextThreshold=f.saveTextThreshold)}if("deliver"==b.action&&1==$S("attrs").user.aftersend_saveaddr)try{a.Array.each(c.info.get({con:!0}),function(b,c){var d=c.replace(/^.*<|>$/g,"").toLowerCase();return fb.data.extDataMap.email[d]?void 0:(j.autosaveRcptsMode="add",a.BREAK)})}catch(i){}if("schedule"==b.action&&"0"==ub.get({field:"ntes_option",flag:"schedule_notify"})&&(j.notifyEML=!0),"deliver"==b.action&&f.get({status:"showEncrypt"})&&(j.encryptPassword=d.encrypt.get(),d.encrypt.get({save:!0})&&(j.savePassword=!0,j.attrs.saveSentCopy=!0,delete j.saveTextThreshold)),rb.ynote&&c.form.getCheckbox("ynote")&&(f.set({status:"save2YNote",value:!0}),j.attrs.saveSentCopy=!0,delete j.saveTextThreshold,sb.cache({cl_ynote:"1"},a.EMPTYFUNC)),rb.notary&&f.get({status:"showNotary"})&&(0===d.notary.userpro&&(j.attrs.saveSentCopy=!0),d.notary.status.useSign&&(j.attrs.content+='<div style="height:42px;line-height:42px;font-size:16px;text-align:center"><div style="font-family:\'楷体\', \'楷体_GB2312\'"><span style="color:#CC0000">'+ob.t("★")+"</span>"+ob.t(" 此邮件已被 ")+'<a href="http://gzy.mail.163.com/?from=mailread" style="text-decoration:none" target="_blank"><strong style="color:#CC0000">'+ob.t("网易公正邮")+"</strong></a>"+ob.t(" 保全存证，发件人承诺与您诚信沟通！ ")+'<span style="color:#CC0000">'+ob.t("★")+"</span></div></div>")),"deliver"==b.action&&"1"==ub.get({field:"ntes_compose",flag:"undo_send"})&&(j.delayTime=f.delayTime),"deliver"==b.action||"schedule"==b.action){pb.extend(k,c.log),f.get({status:"useSign"})&&(k.sign="1"),f.get({status:"showEncrypt"})&&(k.encrypt="1");var p=f.get({status:"fromEntry"});"compose"!=p&&(k.from=p),"shortcut"==b.source&&(k.cl_st=1)}b.body=j,f.set({status:"sendParam",value:b});var h=f.get({status:"showScheduleInvitation"});if(h&&"save"!==b.action&&"auto"!==b.action&&"force"!==b.action){var q=c.form,r=q.getScheduleInvitationData();try{var s=r.bccs;r.bccs=null;var t=nb.genIcs(r);if(!t)return c.tips("生成日程邀请失败"),c.sendReset(),void 0;c.setSequence("uploadResult",function(){var b=c.event,d=a.Object.extend(r,t);r.bccs=s,b.toggleScheduleInvitation(!0),c.sendICSLetter(j,k,d,0)}),c.assist.native.nativeSelect([t.blob])}catch(u){}}else c.action.send({body:j,log:k,callback:a.Function.bind(c.sendSuccess,c),error:a.Function.bind(c.sendError,c)});var v="";switch(b.action){case"deliver":v=ob.t("正在发送邮件...");break;case"schedule":v=ob.t("正在保存定时发信...");break;case"save":v=ob.t("正在保存邮件...");break;case"auto":case"force":v=ob.t("正在自动保存草稿...");break;case"verify":v=ob.t("正在进行验证码核对并发送邮件...")}v&&c.tips(v)}}function n(b,c,d,e){function f(){h.action.send({body:b,log:c,callback:function(a){g(a)},error:a.Function.bind(h.sendError,h)})}function g(b){if(a.Ext.ics2schedule){try{var c=$L("product.Schedule",this)}catch(e){return e}var f=a.Object.extend({uid:d.uid,sequence:d.sequence},d);c.addIcs(f,function(a){a&&200!==a.code&&h.tips("日程管理同步失败")})}h.sendSuccess(b)}var h=this;return e=e||0,$G.environment.isHMail?(f(),void 0):(h.action.uploadPrepare({body:{composeId:b.id,attachmentId:0,size:d.blob.size,fileName:d.blob.name,contentType:'text/calendar; charset="utf-8"; method=REQUEST'},error:function(){2>=e?h.sendICSLetter(b,c,d,e+1):(h.tips("日程邀请创建失败"),h.sendReset())},callback:function(){h.action.getInfo({callback:function(c){var d=c["var"].attachments;a.Object.each(d,function(a,b){/\.ics$/.test(b.name)&&(b.mixed=!0,b.inlined=!0,b.description="")}),b.attrs.attachments=d,f()}})}}),void 0)}function o(){var a=this,b=a.data;a.tips(""),b.set({status:"sendParam",value:null})}function p(b){var c=this,d=c.module,e=c.data,f=c.editor,g=c.form,h=c.attach;c.event;var i=b.action;if("verify"==i)return c.checkRepeatSend()?!0:!1;if("auto"==i){var j=f.getFinal();if(""===j)return!1}var k="save"===i||"auto"===i||"force"===i,l=e.get({status:"showScheduleInvitation"});if(k&&l){var m=a.LocalStorage.get("not_remind_not_save_schedule_invitation",!0),n=e.get({status:"iKnowScheduleInvitationNotSave"}),o=!m&&!n;if(o)return a.Msgbox.show({title:ob.t("存草稿后，日程信息暂不支持保存到草稿箱。"),buttons:[{text:ob.t("关闭并下次不再提示"),subclass:"mainBtn",click:function(){a.LocalStorage.set("not_remind_not_save_schedule_invitation",1,{expires:999},!0),a.Msgbox.msgbox&&a.Msgbox.msgbox.close(),c.send({action:"save"})}},{text:ob.t("我知道了"),click:function(){a.Msgbox.msgbox&&a.Msgbox.msgbox.close(),e.set({status:"iKnowScheduleInvitationNotSave",value:!0}),c.send({action:"save"})}}]}),!1}if("auto"!=i&&"force"!=i&&!c.checkRepeatSend())return!1;if("force"!=i){var p=e.get({status:"fromEntry"});if(("edit"==p||"draft"==p||"timeset"==p||"reply"==p||"forward"==p)&&""===c.info.get({cid:!0}))return"auto"==i||a.Msgbox.show({title:ob.t("您的信件正在加载中，请稍候！")}),!1}if(("deliver"==i||"save"==i)&&e.get({status:"showSchedule"})){if(!c.module.schedule.verify())return!1;i=b.action="schedule"}if("deliver"==i||"schedule"==i){if(!c.checkSenderName(b))return!1;if(!c.checkRev(b))return!1;if(!c.checkSubject(b))return!1;if(!c.checkScheduleInvitation())return!1;if(e.get({status:"showEncrypt"})&&!d.encrypt.verify())return!1;if(!c.checkAttachText(b))return!1;if(g.getCheckbox("chargesms"))try{var d=c.module,q=d.smsNotify,r=q.checkData();if(!r)return!1;e.set({status:"chargeSmsData",value:r})}catch(s){}}if("deliver"==i||"schedule"==i||"verify"==i||"save"==i){if(h.fileIsPost())return c.setSequence("postResult",function(){c.send(b)}),h.postUpload(),!1;if(h.fileIsUpload()){if(c.setSequence("uploadResult",function(){c.send(b)}),"save"==i)c.tips(ob.t("正在上传附件，上传完成后将自动保存到草稿箱"));else{var t={items:[{html:"<span>"+ob.t("正在上传附件，上传完成后将自动发送 ")+"</span>"},{xtype:"link",bracket:!0,text:ob.t("取消自动发送"),click:function(){delete e.sequence.uploadResult,this.destroy(),c.tips()}}]};c.tips(t)}return!1}if(h.fileIsError())return h.validLocal(),c.tips(""),!1;if(h.get({status:"validServer"}))return h.set({status:"validServer",value:!1}),h.validServer(i),!1}return!0}function q(b){b=b||{};var c=this,d=c.data,e=c.form,f=c.editor,g=c.attach,h=c.at,i={},j=e.getSender();i.account=j.toString(),j.smtp&&(i.accountSettings={smtpHost:"@",popWebId:j.popId}),d.get({status:"useSeparate"})?(i.showOneRcpt=!0,i.to=e.getContact("build","separate"),i.cc=i.bcc=[]):(i.showOneRcpt=!1,i.to=e.getContact("build","to"),i.cc=e.getContact("build","cc"),i.bcc=e.getContact("build","bcc"));var k=e.getSubject();if(""===a.String.trim(k)&&"auto"==b.action){var l=lb.getTime(0),m=$S("isCH")?"yyyy年M月d日 H:mm:ss":"dd/MM/yyyy H:mm:ss";k=a.Date.format(l,ob.t(m))+" "+ob.t("自动保存草稿")}i.subject=k;var n=f.getFinal();if(e.getCheckbox("text"))i.isHtml=!1;else if(i.isHtml=!0,"deliver"==b.action){var o=a.Browser.getVersion()||[0,0];a.Browser.ie()&&o[0]<=8&&(n=f.getFinal(!0)),n=n.replace(new RegExp('id="*(spnEditorSign|divEditorGraphSign)"*',"ig"),"")}var p=g.linkHtml({action:b.action,subject:k});p&&(i.isHtml||(i.isHtml=!0,n=f.getFinal("html")),n+=p),i.content=n,i.priority=e.getCheckbox("priority")?1:3,1==i.priority&&sb.cache({cl_priority:"1"},a.EMPTYFUNC),i.requestReadReceipt=e.getCheckbox("receipt"),1==i.requestReadReceipt&&sb.cache({cl_receipt:"1"},a.EMPTYFUNC),i.saveSentCopy=$S("attrs").user.save_sent<2,"schedule"==b.action&&(i.scheduleDate=c.module.schedule.get());var q=g.inlineSync();q&&q.length&&(i.attachments=q);var r="GBK";if("1"==ub.get({field:"ntes_option",flag:"mailencode"})&&(r="UTF-8"),i.charset=r,"deliver"==b.action||"save"==b.action||"schedule"==b.action){if(rb.composeAt){var s=h.getEmail();i.ctrls=s?{at:s}:null}d.get({status:"vipMember"})&&rb.plusBrand&&(i.ctrls||(i.ctrls={}),i.ctrls.plus=c.generatePlusFlag())}return i}function r(){var a=$G.user.uid,b=a.split("@"),c=b[0],d=b[1],e=(new Date).getTime().toString(),f=c+e+d,g=mb.encode(f);return e+"_"+g}function s(b){function d(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))}var e=new FormData;a.Object.each(b,function(a,f){return null!==f&&f!==c&&"account"!==a?"content"===a||"ics"===a?(b[a]=d(f),void 0):(e.append(a,f),void 0):void 0});var f="----=_Part_192136_678534016.1554711624931",g=[];g.push('Content-Type: multipart/alternative; boundary="'+f+'"'),g.push(""),g.push("--"+f),g.push("Content-Type: text/html;"),g.push("Content-Transfer-Encoding: base64"),g.push(""),g.push(b.content),g.push("--"+f),g.push('Content-Type: text/calendar; charset="utf-8"; method=REQUEST'),g.push("Content-Transfer-Encoding: base64"),g.push(""),g.push(b.ics),g.push("--"+f+"--");var h=(new Date).getTime(),i=new Blob([g.join("\r\n")],{type:"message/rfc822"});return e.append("action","deliver"),e.append("account",$G.user.uid),e.append("lettercontent",i,h+".eml"),e}function t(b){var c=this,d=c.data,e=c.info;c.tips("");var f=d.get({status:"sendParam"});if(sb.cache({ComposeSendSuccess:"save"==f.action}),"save"==f.action||"auto"==f.action||"force"==f.action||"continue"==f.action){e.set({obj:b["var"]}),b.draftId&&e.set({did:b.draftId}),("save"==f.action||"force"==f.action)&&d.set({status:"existActiveDraft",value:!0}),c.changeSync();var g=lb.getTime(0);("auto"==f.action||"save"==f.action)&&(a.Tips.show({succ:!0,expire:0,text:ob.t("邮件已于")+a.Date.format(g,"H:mm")+ob.t("成功保存到草稿箱")}),c.trans({action:"check"})),"function"==typeof f.call&&c.addTimer("force",function(){f.call()})}else{c.clearTimer();var h=e.get({cid:!0});e.set({cid:""}),"verify"==f.action&&(f.action="deliver"),c.success.render(b,h)}c.userDataRemove();try{var i=[2];"deliver"==f.action&&i.push(3),a.Listener.fire("compose:send",i),kb.request(["Folder"])}catch(j){}d.set({status:"sendParam",value:null})}function u(b){var c=this,d=c.data,e=c.info,f=c.attach;c.tips("");var g=d.get({status:"sendParam"});if(d.set({status:"sendParam",value:null}),"auto"==g.action)return!0;var h=b.code,i=b["var"];h==tb&&("string"==typeof i?e.set({cid:i}):"object"==typeof b["var"]&&e.set({obj:i}));var j=eb.error(b,g.action);if(c.isMailCapacityOverflow(j,b.code,b.overflowReason))return d.get({status:"vipMember"})||$S("isVip")?(j=ob.t("邮箱容量已满，邮件无法保存为草稿，请尽快清理邮箱。"),c.showMailCapacityOverflowDialog(j,g.action),void 0):(c.showMailCapacityOverflowDialog(j,g.action),void 0);if(j){if("FA_MTA_RCPT_ERROR"==j){var k,l=[];if(function(){var a,c=b.errorRcpts,d="",e=[];for(d in c)if("string"==typeof d&&-1!=d.indexOf("@")){if(c[d])switch(c[d]){case"MTA5104":a=ob.t("帐号被停用");break;case"MTA5107":a=ob.t("帐号不存在");break;case"MTA5101":a=ob.t("由于管理员限制，您没有权限发送邮件给企业外的邮件地址");break;default:a=ob.t("帐号被禁止")}else a=ob.t("系统不允许");a='<label title="'+a+'">'+d+"</label>",e.push(a),l.push(d)}k=e.join("<br>")}(),k){var m=ob.t("以下邮箱地址无效，将无法成功收到邮件"),n='<div class="nui-split" style="margin:12px 0"></div><div class="nui-txt-tips">'+ob.t("如果知道对方手机号码，可直接发送到他的手机号码@163.com")+"</div>";a.Msgbox.show({title:m,content:k+n,okText:ob.t("发送邮件，忽略无效地址"),cancelText:ob.t("返回编辑"),ok:function(){c.sendFixMta(l,!0)},cancel:function(){c.sendFixMta(l)}})}else a.Msgbox.show({title:ob.t("对不起，存在部分收件人无法收到信件！")});return!0}return j}switch(h){case"FA_INVALID_VERIFY_CODE":case"FA_NEED_VERIFY_CODE":var o=h.split("_")[1].toLowerCase();eb.verify(o,function(a){c.send({action:"verify",code:a})});break;case"FA_ATTACH_NOT_COMPLETED":case"FA_ATTACH_CRC_FAILED":var p=b.badAttachment;if(p){var q=p.name||"";q=a.String.encodeHTML(q);var r=ob.t("附件")+q+ob.t("上传不完整，部分文件丢失，是否删除？");a.Msgbox.show({type:"confirm",header:ob.t("附件校验出错"),title:r,ok:function(){c.action.deleteAttach({sid:p.id,callback:function(b){b.code==tb||a.Msgbox.show({title:ob.t("删除失败，请保存草稿后重新打开。")})}})}})}break;default:var s=f.fileGet({state:"success"});return s&&s.length?!1:(e.set({cid:""}),!1)}return!0}function v(a,b,c){return a&&"FA_OVERFLOW"===b&&"pref_quota"===c}function w(b,c){var d=this,e=d.data,f=e.get({status:"vipMember"})||$S("isVip"),g={save:"mailbox_capacity2",deliver:"mailbox_capacity1"},h={ComposeCapacityOverflowOnSave:1},i=b;f?a.Msgbox.show({title:i,cancelText:ob.t("取 消")}):a.Msgbox.show({title:i,okText:ob.t("开通邮箱会员"),cancelText:ob.t("取 消"),ok:function(){try{var a=$L("product.Privileges",this)}catch(b){return b}a.showDialog("plus","",g[c])}}),a.Log.cache(h)}function x(b,c){var d=this,e=d.form;c?(a.Array.each(["to","cc","bcc","separate"],function(a,c){e.removeContact(b,c)}),d.send({action:"deliver"})):a.Array.each(["to","cc","bcc","separate"],function(a,c){e.modifyContact(b,c,!1)})}function y(){var b=this,c=b.data;b.form;var d=c.get({status:"sendCheckCount"});if(d>=0){var e=c.get({status:"sendParam"}),f=c.get({status:"uploadParam"});if(e||f){if(e)if("save"==e.action||"auto"==e.action)a.Msgbox.show({title:ob.t("您的信件正在保存中，请稍候！")});else{var g=a.Msgbox.show({title:ob.t("您的信件正在发送中，请稍候！")});c.set({component:"sendMsgBox",value:g})}else"form"==f.action?a.Msgbox.show({title:ob.t("您的附件正在上传中，请稍候！")}):"move"==f.action&&a.Msgbox.show({title:ob.t("您的附件正在移动中，请稍候！")});return d++,d>=2&&(d=-1),c.set({status:"sendCheckCount",value:d}),!1}}return c.set({status:"sendCheckCount",value:0}),!0}function z(b){function c(c){ub.set({field:"ntes_compose",flag:"senderName",value:"1"});var e=ob.t("用户名");"mobile"==c&&(e=ob.t("手机号"));var g=ob.t("收件人只能看到您的")+e+ob.t("，可能没法知道是您的邮件。")+"<br />"+ob.t("为方便对方确认，请填写您的姓名：");return a.Msgbox.show({type:"prompt",title:ob.t("您还没设置姓名！"),content:g,okText:ob.t("保存并发送"),inputWidth:"300px",ok:function(c){var e=a.String.trim(c);return e?(a.Tips.show({succ:!0,text:ob.t("发件人姓名设置成功")}),d.form.setSender(new qb(f.address,e)),d.addTimer("sendCheck",function(){d.send(b)},10),ub.set({field:"true_name",value:e}),a.Listener.fire("options:personalModify",[{field:"true_name",value:e}]),void 0):ob.t("姓名不能为空")}}),!1}var d=this,e=d.form;if("0"==ub.get({field:"ntes_compose",flag:"senderName"})){var f=e.getSender(),g=f.address.split("@");if($S("domain")==g[1]&&f.name==g[0]){if(qb.checkMobile(f.name))return c("mobile");if(""===$S("attrs").user.true_name){var h=$S("attrs").user.displaysender;if(0===h)return c("account");if(1==h&&""===$S("attrs").user.nick_name)return c("account")}}}return!0}function A(b){function c(c){var h,i=function(){a.Msgbox.msgbox&&a.Msgbox.msgbox.close()},j=function(){i(),d.addTimer("sendCheck",function(){d.send(b)},10)},k=function(){i(),f.focus(c)},l=f.getContact("object",c);if(l.fail&&l.fail.length)return h="",a.Array.each(l.fail,function(a,b){h+=b.address+"\n"}),h=a.String.encodeHTML(h),h=h.replace(/\n/g,"<br>"),a.Msgbox.show({title:ob.t("以下邮箱地址无效，将无法成功收到邮件"),content:h,okText:ob.t("发送邮件，忽略无效地址"),ok:function(){f.removeContact(l.fail,c),j()},cancelText:ob.t("返回编辑"),cancel:k}),!1;var m=[];if(a.Array.each(l.suc,function(a,b){gb.isRefuse(b)&&(e.blackList[b.address.toLowerCase()]||m.push(b))}),m.length){h=ob.t("以下地址已经在您的黑名单中，您将无法收到他们的回信，是否不给他们发信？")+"<br/>",h='<strong class="nui-txt-impt">';for(var n=0;n<m.length;n++)h+=a.String.encodeHTML(m[n].toString())+"<br/>";return h+="</strong>",a.Msgbox.show({title:ob.t("以下地址已在您的黑名单中，将无法收到回信"),content:h,buttons:[{xtype:"button",text:ob.t("发信（但不给他们）"),type:"impt",click:function(){f.removeContact(m,c),j()}},{xtype:"button",text:ob.t("继续给他们写信"),click:function(){a.Array.each(m,function(a,b){e.blackList[b.address.toLowerCase()]=!0}),j()}},{xtype:"button",text:ob.t("返回编辑"),click:k}]}),!1}return g+=l.suc.length,!0}var d=this,e=d.data,f=d.form,g=0;if(e.get({status:"useSeparate"})){if(!c("separate"))return!1}else if(!(c("to")&&c("cc")&&c("bcc")))return!1;if(0===g)return d.tips({text:ob.t("请填写收件人地址后再发送"),expires:6e3}),f.focus(),!1;var h=$S("attrs").cos.pref_smtp_max_num_rcpts||0;return g>h?(function(){var b=ob.t("您选择的发件人总数为")+g+ob.t("人，超过")+h+ob.t("人的限制！");if($S("isFree"))e.get({status:"vipMember"})?(b+='<br><a href="'+vb.getUrl("compose_update_vip",!0)+'" target="_blank">'+ob.t("单次群发400封(VIP特权)，立即升级>")+"></a>",a.Msgbox.show({title:b,ok:function(){f.focus()}})):(b+="<br>"+ob.t("立即开通会员，可享单次群发200封特权"),a.Msgbox.show({title:b,okText:ob.t("开通邮箱会员"),cancelText:ob.t("取 消"),ok:function(){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showDialog("plus","","sender"),a.Log.cache({ComposeBaseRecvOverLimitClick:g})}}));else{var c;5==h?(c={"vip.163.com":"http://reg.vip.163.com/pay.m?b10ele1","vip.126.com":"http://reg.vip.126.com/pay.m?b66ele1","188.com":"http://pay.mail.188.com/html/pay/list.jsp?b11ele1"},b=ob.t("邮箱尚未开通，发送人数不可超过5人！")+"<br>"+ob.t("开通VIP邮箱，最高可群发400人！")+'<a href="'+c[$S("domain")]+'" target="_blank">'+ob.t("马上开通")+"&gt;&gt;</a>"):100==h&&(c={"vip.163.com":"b10dye5","vip.126.com":"b66dye5","188.com":"b11dye5"},b+="<br>"+a.Link.html({text:ob.t("升级400封单次群发"),click:function(){try{var b=$L("interface.OutlinkInterface",this)}catch(d){return d}b.goOutlink({url:vb.getUrl("option_viptype",!0)+"?"+c[$S("domain")],key:"option_viptype"}),a.Msgbox.msgbox.close()}})),a.Msgbox.show({title:b,ok:function(){f.focus()}})}a.Component.setEvents(),a.Log.cache({ComposeBaseRecvOverLimit:g})}(),!1):!0}function B(c){function d(){a.Msgbox.show({type:"confirm",title:ob.t("确定真的不需要写主题吗？"),ok:function(){f.setSubject(ob.t("来自")+(jb.getName()||$S("orgUid"))+ob.t("的邮件")),e.addTimer("sendCheck",function(){e.send(c)},10)},cancel:function(){e.addTimer("sendCheck",function(){f.focus("subject")},10)}})}var e=this,f=e.form;return""===a.String.trim(f.getSubject())?("shortcut"==c.source?b.setTimeout(d,300):d(),!1):!0}function C(){var a=this,b=a.data,c=a.form,d=b.get({status:"showScheduleInvitation"});if(!d)return!0;var e=c.getScheduleInvitationAddr(),f=c.getScheduleInvitationStartTime(),g=c.getScheduleInvitationEndTime();return e&&e.length>140?(c.focus("scheduleInvitationAddr"),void 0):f>g?(a.tips({text:ob.t("日程邀请结束时间必须大于开始时间"),expires:6e3}),c.focus("scheduleInvitationEndDay"),!1):!0}function D(b){var c=this,d=c.data,e=c.attach;if(d.get({status:"confirmAttach"})){d.set({status:"confirmAttach",value:!1});var f=e.get({count:!0});if(e.cardGet()&&f--,e.stationeryGet()&&f--,0===f){var g=c.editor.get({html2text:!0});if(-1!=g.indexOf(ob.t("附件")))return a.Msgbox.show({type:"confirm",title:ob.t("邮件中显示您可能希望发送附件，但实际没有任何附件，您确认继续发送吗？"),okText:ob.t("继续发送"),cancelText:ob.t("返 回"),ok:function(){c.addTimer("sendCheck",function(){c.send(b)},10)}}),!1}}return!0}function E(){var a=this,b=a.attach,c=a.data,d=c.change,e=!1;if(d.composeInfo){var f=b.get({count:!0});if(b.cardGet()&&f--,b.stationeryGet()&&f--,f!=d.attachCount&&(e=!0),!e){var g=a.sendBuild();pb.isEqual(g,d.composeInfo)||(e=!0)}}return e}function F(){var a=this,b=a.data,c=a.attach,d=b.change;d.composeInfo=a.sendBuild();var e=c.get({count:!0});c.cardGet()&&e--,c.stationeryGet()&&e--,d.attachCount=e}function G(){var b=this,c=b.data,d=b.form,e=b.editor,f="to";c.get({status:"useSeparate"})&&(f="separate");var g=c.get({status:"fromEntry"});d.getContact("empty",f)&&"reply"!=g?d.focus(f):(a.String.trim(d.getSubject())?e.focus(!1):d.focus("subject"),d.removeFocusCls("to"))}function H(){var b=this,c=b.data,d=b.editor,e=b.form,f=b.attach,g=!0;return"success"==c.get({status:"curPage"})?g:("compose"==c.get({status:"fromEntry"})?e.getContact("empty","to")?e.getContact("empty","cc")?e.getContact("empty","bcc")?e.getContact("empty","separate")?""!==a.String.trim(e.getSubject())?g=!1:f.get({count:!0})>0?g=!1:d.get({empty:!0})?c.get({status:"empty"})||(g=!1):g=!1:g=!1:g=!1:g=!1:g=!1:g=!1,g)}function I(){var a=this,b=a.data,c=a.attach;a.addTimer("save",function(){"compose"==b.get({status:"curPage"})&&(b.get({status:"sendParam"})||b.get({status:"uploadParam"})||c.fileIsUpload()||!a.changeCheck()||(2==b.get({status:"autoSaveTime"})&&b.set({status:"autoSaveTime",value:5}),a.send({action:"auto"}))),a.autoSave()},6e4*b.get({status:"autoSaveTime"}))}function J(){var a=this;a.addTimer("keep",function(){a.info.get({cid:!0})&&a.action.getInfo({callback:function(){}}),a.autoKeep()},15e5)}function K(){var a=this,b=a.data,c="",d=b.get({status:"sendParam"}),e=b.get({status:"uploadParam"});return d?c=d.action:e&&(c=e.action),c}function L(a,c,d){d=d||0;var e=this,f=e.data;if(f){var g=f.timer;e.clearTimer(a),g[a]=b.setTimeout(function(){delete g[a],c()},d)}}function M(a){var c=this,d=c.data,e=d.timer;e&&(a?"number"==typeof e[a]&&(b.clearTimeout(e[a]),delete e[a]):pb.each(e,function(a){c.clearTimer(a)}))}function N(){var c=this,d=c.form,e=$S("uid").replace("@","."),f=d.getContact("build","to"),g=d.getSubject(),h=c.editor.get(),i={to:f,subject:g,content:h};
a.Storage.set(e,JSON.stringify(i)),b.composeResume=!1}function O(){var b=$S("uid").replace("@",".");try{a.Storage.remove(b)}catch(c){}}function P(){var c=this,d=c.data;if("compose"==d.get({status:"fromEntry"})&&!b.composeResume){b.composeResume=!0;var e=$S("uid").replace("@","."),f="";try{f=a.Storage.get(e)}catch(g){}if(f){c.userDataRemove();var h=null;try{h=JSON.parse(f)}catch(g){}h&&c.fillContent(h)}}}function Q(){var b=this;b.empty()||a.Msgbox.show({type:"confirm",title:ob.t("网络连接已断开，是否将信件内容保存到本地电脑？")+"<br>"+ob.t("（提示：下次登录邮箱，写信时内容将自动恢复）"),ok:a.Function.bind(b.userDataSave,b)})}function R(){var b=this;b.empty()||a.Msgbox.show({type:"confirm",title:ob.t("登录状态已失效，是否将信件内容保存到本地电脑？")+"<br>"+ob.t("（提示：登录邮箱后，写信时内容将自动恢复）"),ok:function(){b.userDataSave(),b.data.set({status:"confirmExit",value:!1}),a.Support.relogin()}})}function S(a,b){var c=this,d=c.data;d.sequence[a]=b}function T(a,b){var c=this,d=c.data,e=d.sequence[a];return"function"==typeof e?"number"==typeof b?(c.addTimer("sequence"+a,function(){c.runSequence(a)},b),!0):(delete d.sequence[a],e(),!0):!1}function U(a,c){var d=this,e=d.module,f="ComposeCall"+e.createId("c");"object"!=typeof b[f]&&(b[f]={});var g="f"+lb.getTime(0).valueOf();return"undefined"!=typeof b[f][g]&&(g+="x"),b[f][g]=function(){return c&&delete b[f][g],a?a.apply(null,arguments):void 0},f+"."+g}function V(){var a=this,c=a.module,d="ComposeCall"+c.createId("c");"object"==typeof b[d]&&pb.each(b[d],function(a){b[d][a]=null,delete b[d][a]})}function W(b){var c,d,e=this,f=e.module,g=e.data,h=g.get({element:"main"}),i=g.get({element:"succ"}),j={},k=g.get({element:"toolbar"});if(g.get({status:"curPage"})!=b){if("compose"==b)j.hide(),d=j.find("iframe"),d.attr({src:"about:blank"}),h.show(),k.show();else if("success"==b){i.show(),h.hide(),k.hide();var l=f._child;l&&a(l.container).hide()}else"photo"==b&&(c=j.find("form"),c.empty(),j.setStyle({height:h.dom.offsetHeight+"px"}),j.show(),c.attr({action:e.attach.photoGetUrl()}),c.dom.submit(),h.hide(),k.hide());g.set({status:"curPage",value:b})}}function X(b,c){var d=this;if(b){b.module="compose",b.noFire=!0,gb.setAttr(b),"boolean"!=typeof c&&(c=!1),d.fireOption([b],!c);var e=b.flag?b.flag:b.field,f=b.value,g={};g[e]=f,sb.cache(g,a.EMPTYFUNC)}}function Y(b,c){var d=this,e=d.data,f=d.event,g=d.form;if(a.Array.each(b,function(b,h){var i="",j=h.flag?h.flag:h.field,k=h.value;switch(j){case"ntes_htmlbar":var l=2!=k?!0:!1;d.editor.setHtmlbar({show:l,hide:!l});break;case"compose_nav":f.switchNav(k);break;case"compose_showContacts":var m="1"!=k?!0:!1;f.switchSide({show:m});break;case"remindShow":rb.contactCorrect="0"==k?!0:!1;break;case"requirereceipt":var n="1"==k?!0:!1;g.setCheckbox("receipt",n);break;case"true_name":case"nick_name":case"displaysender":var o=e.get({component:"sender"}),p={type:"sender",tabindex:"2",raiaLabel:ob.t("发件人地址，点击可以设置发件人")},q=[];try{var r=jb.getList(),s=jb.getDefault();a.Array.each(r,function(b,c){var d=a.String.encodeHTML(c.toString()),e=ib.getSubtype({type:"folder",domain:c.domain});"dft"==e&&(e="other"),q.push({text:d,icon:{type:"folder",subtype:e},click:function(){o.setValue(c)}})}),p.email=s;var t={xtype:"menu",groups:[{items:q},{items:[{text:ob.t("设置默认发件人与昵称"),click:function(){try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"AccountCenterModule",exit:!1,inputName:"SectionSenderManage"})}}]}]};p.menu=t,o.update(p)}catch(u){}break;case"flashupload":case"replySign":case"forwardSign":case"signPosition":case"upload_mode":i=ob.t("设置成功，下次进入写信生效"),e.set({status:"empty",value:!1});break;case"signUpdate":case"cache":e.set({status:"empty",value:!1})}c&&i&&a.Tips.show(i)}),!c)try{var h=e.get({component:"toolbar"}),i=d.view.getOption();h.find("button")[5].menu.update(i)}catch(j){}}function Z(){var b=this,c=vb.getUrl("compose_preview"),d=b.getCallName(function(){var c=b.data,d=b.form,e={};e.sender=d.getSender(),c.get({status:"useSeparate"})?e.separate=d.getContact("suc","separate"):(e.to=d.getContact("suc","to"),e.cc=d.getContact("suc","cc"),e.bcc=d.getContact("suc","bcc"));var f=d.getSubject();return f=f?a.String.escapeHTML(f):ob.t("(无主题)"),e.subject=f,e.editor=b.editor.getPreview(),e.attach=b.attach.getPreview(),e});c+="&call=window.opener."+d;var e=document.createElement("FORM");e.action=c,e.method="POST",e.target="_blank";var f=document.createElement("INPUT");f.type="hidden",f.name="content",f.value=b.editor.getFinal(),e.appendChild(f),document.body.appendChild(e),e.submit()}function $(b){try{var c;a.Tips.module(b,c)}catch(d){}}function _(b){if(rb.human_trans){var c=this,d=c.module,e=c.data,f=c.editor,g=c.info,h=d.createId("ext"),i=b.action;if("goHuman"==i){var g=c.info,j=g.get({did:!0})||g.get({mid:!0});return hb.goHuman({mid:j,vendor:b.vendor}),void 0}if("0"===ub.get({field:"huodong_option",flag:"humanTrans"})&&!e.get({status:"humanTransTips"}))switch(i){case"check":var k=f.get({html2text:!0});k.length>20&&(k=k.substr(0,300),k=a.String.trim(k),null===k.match(/[^\x00-\x80]/g)&&c.trans({action:"dict"}));break;case"dict":e.set({status:"humanTransTips",value:!0});var l=[{html:"<span><span class='nui-block-icon'><b class='nui-ico nui-ico-translate'></b></span><span style='padding-left:20px;'>"+ob.t("您正在进行英文编辑，如有需要可使用 ")+"</span></span>"},{xtype:"link",text:ob.t("查词典"),click:function(){try{}catch(b){return b}hb.change(),sb.cache({cl_trans:"2"},a.EMPTYFUNC)}},{html:"<span>"+ob.t(" 功能 ")+"</span>"},{xtype:"link",text:ob.t("不再提醒"),click:function(){ub.set({field:"huodong_option",flag:"humanTrans",value:"1"}),this.ownerCt.destroy()}}],m={renderTo:h,renderBy:"before",extcls:"wn1",subclass:"assistBlock",params:"hasClose",items:l};new a.Block(m),sb.cache({cl_transshow:"2"},a.EMPTYFUNC);break;case"replyTrans":e.get({moduleId:"ext"});var l=[{html:"<span><span class='nui-block-icon'><b class='nui-ico nui-ico-translate'></b></span><span style='padding-left:20px;'>"+ob.t("试试用中文写邮件，")+"</span></span>"},{xtype:"link",text:ob.t("网易专业翻译"),click:function(){c.send({action:"auto",call:function(){c.trans({action:"goHuman",vendor:"reply"})}}),sb.cache({cl_trans:"3"},a.EMPTYFUNC)}},{html:"<span>"+ob.t("帮您完成翻译。 ")+"</span>"},{xtype:"link",text:ob.t("不再提醒"),click:function(){ub.set({field:"huodong_option",flag:"humanTrans",value:"1"}),this.ownerCt.destroy()}}],m={renderTo:h,renderBy:"before",extcls:"wn1",subclass:"assistBlock",params:"hasClose",items:l};new a.Block(m),sb.cache({cl_transshow:"3"},a.EMPTYFUNC)}}}function ab(){var a=this,b=a.module;if(!b.notary){try{var c=$L("module.compose.ComposeNotary",this)}catch(d){return d}var e=new c(b);e.init(),b.notary=e,e.checkSign()}}function bb(){var b=this,c=b.data,d=b.event;if(b.info.get({cid:!0})){var e=!1;c.get({status:"confirmDeleteDraft"})||!c.get({status:"existActiveDraft"})&&b.info.get({did:!0})&&(e=!0),b.action.cancelId({deleteDraft:e,callback:null}),b.info.set({cid:""})}b.clearTimer(),b.attach.destroy(),b.assist.destroy(),c.set({status:"curPage",value:"destroy"}),b.tips(""),a.Tips.show({hidden:!0}),b.removeCallName(),d.toggleScheduleInvitation(!0);var f=b.module;a.Array.each(f.names,function(a,b){f[b].clear()}),a.Array.each(["param","class","module","names","stationery"],function(a,b){f[b]=null,delete f[b]})}try{var cb=$L("module.compose.Compose")}catch(db){return db}try{var eb=$L("module.compose.ComposeManager")}catch(db){return db}try{var fb=$L("support.AddressSupport")}catch(db){return db}try{var gb=$L("support.OptionSupport")}catch(db){return db}try{var hb=$L("product.Translate")}catch(db){return db}try{var ib=$L("util.Icon")}catch(db){return db}try{var jb=$L("init.SenderList")}catch(db){return db}try{var kb=$L("init.Sync")}catch(db){return db}try{var lb=$L("util.Misc")}catch(db){return db}try{var mb=$L("util.MD5")}catch(db){return db}try{var nb=$L("product.Schedule")}catch(db){return db}var ob=new $I18N("module.compose.ComposeBase"),pb=a.Object,qb=a.Email,rb=a.Ext,sb=a.Log,tb=a.S_OK,ub=a.Ud,vb=a.Uri,wb=a.createClass($N("module.compose.ComposeBase")),xb={initialize:d,init:e,start:f,startDelay:g,layoutAdjust:h,defined:i,element:j,initUd:k,fillContent:l,send:m,sendICSLetter:n,sendReset:o,sendCheck:p,sendBuild:q,sendSuccess:t,sendError:u,sendFixMta:x,isMailCapacityOverflow:v,showMailCapacityOverflowDialog:w,generatePlusFlag:r,buildByClient:s,checkRepeatSend:y,checkSenderName:z,checkRev:A,checkSubject:B,checkScheduleInvitation:C,checkAttachText:D,changeCheck:E,changeSync:F,focus:G,empty:H,addTimer:L,clearTimer:M,autoSave:I,autoKeep:J,getAction:K,userDataSave:N,userDataRemove:O,userDataResume:P,connectBreak:Q,sessionBreak:R,setSequence:S,runSequence:T,getCallName:U,removeCallName:V,setPage:W,setOption:X,fireOption:Y,preview:Z,tips:$,trans:_,initNotary:ab,destroy:bb};pb.inherit(wb,cb),pb.extend(wb.prototype,xb)}($,window),function(a,b,c){function d(a){var b=this;j.extend(b,{index:0,delayTime:33,saveTextThreshold:1048576,timer:{},sequence:{},change:{},layout:{},element:{},component:{},letterpaper:{},log:{},blackList:{},status:{fromEntry:"",curPage:"compose",inputChoose:"to",sendParam:null,defaultContent:"",uploadParam:null,uploadMode:null,flashReady:!1,moduleOut:!1,empty:!0,fullScreen:!1,paramBody:null,autoSaveTime:2,existActiveDraft:!1,sendCheckCount:0,initTimer:!1,initSign:!1,initAddress:!1,initStationery:!1,chargeSmsData:null,useSms:null,useSign:null,useSeparate:null,showTo:!0,showCc:!1,showBcc:!1,showScheduleInvitation:!1,iKnowScheduleInvitationNotSave:!1,showSide:!1,showSchedule:!1,showEncrypt:!1,save2YNote:!1,showHtmlbar:!0,showPlaceholder:!1,confirmDeleteDraft:!0,confirmAttach:!0,confirmSubject:!0,confirmExit:!0,saveContact:!0,useWmsvr:!1,humanTransTips:!1},attachments:{files:{},element:{link:null,browseContainer:null,input:null,formContainer:null,formIframe:null,flash:null,flashContainer:null,nativeRequest:null,area:null,info:null,content:null,ulContainer:null,progress:null},tips:{},layout:{attachWidth:285,spaceWidth:8},status:{notaryBalance:c,validServer:!1,layoutInit:!1,confirmSize:!1,cloudTrigger:!1,flashTimer:!1,cardUrl:"",totalPercent:-1,totalBytes:-1,flashIndex:0,fileIndex:1,inputIndex:1,inlinedExist:0,vipMember:!1,remindShowId:0,showContactsId:0}}}),k.superClass.initialize.call(b,a)}function e(){var a=this;k.superClass.init.call(a)}function f(b){var c=this,d=c.module,e=b.value;if("string"==typeof b.status)return c.status[b.status]=e,void 0;if("string"==typeof b.element)return c.element[b.element]=e,void 0;if("string"==typeof b.component)return c.component[b.component]=e,void 0;if("string"==typeof b.moduleId){var f=a("#"+d.createId(e));return c.element[b.moduleId]=f,void 0}}function g(b){var c=this,d=c.module;if("string"==typeof b.status)return c.status[b.status];if("string"==typeof b.element)return c.element[b.element];if("string"==typeof b.component)return c.component[b.component];if("string"==typeof b.moduleId){var e=a("#"+d.createId(b.moduleId));return e}}try{var h=$L("module.compose.Compose")}catch(i){return i}var j=a.Object,k=a.createClass($N("module.compose.ComposeData"));j.inherit(k,h),j.extend(k.prototype,{initialize:d,init:e,set:f,get:g})}($,window),function(a,b,c){function d(){}function e(a){var b=this;lb.extend(b,{component:{sign:null,portrait:null,stationery:null},mode:null,editorCmpt:null}),qb.superClass.initialize.call(b,a)}function f(){var a=this;a.element,qb.superClass.init.call(a)}function g(){var a=this;qb.superClass.clear.call(a.component),qb.superClass.clear.call(a)}function h(){var a=this,b=a.base;try{a.render()}catch(c){b.addTimer("editor",function(){try{a.render()}catch(b){}},100)}}function i(){var a=this;a.module;var b=a.data,c=b.layout;c.editorHeight;var d=jb.mode.BASIC;1==pb.get({field:"ntes_letter",flag:"editorToolbar"})&&(d=jb.mode.BASIC),2==pb.get({field:"ntes_htmlbar"})&&(a.mode=d);var e=b.get({component:"editor"});a.editorCmpt=e,e.composeEditor=a,a.custom(),a.bindEvent(),a.hideNotaryBtn(),"0"==pb.get({field:"ntes_compose",flag:"editor_notary_tips"})&&(1==pb.get({field:"ntes_letter",flag:"editorToolbar"})||2==pb.get({field:"ntes_htmlbar"})||setTimeout(function(){a.showLayer()},1e3))}function j(){var b=this,c=b.editorCmpt;if(!qb.initPlugin){qb.initPlugin=!0;var d=["Capture","Image","Portrait","Microphone","Sign","Stationery","Basic","Translate","Notary","Full","FullScreen"];a.Array.each(d,function(a,d){c.plugin[d]={},c.plugin[d].selected=b["btn"+d]}),c.plugin.Capture.selected=b.btnCapture,c.plugin.Image.selected=b.btnImage,c.plugin.Portrait.selected=b.btnPortrait,c.plugin.Microphone.selected=b.btnMicrophone,c.plugin.Sign.selected=b.btnSign,c.plugin.Stationery.selected=b.btnStationery,c.plugin.Basic.selected=b.btnMode,c.plugin.Full.selected=b.btnMode}}function k(){var b=this,c=b.module,d=b.event,e=b.form,f=b.editorCmpt;if(f.listen("iframeClick",a.Function.bind(d.hideFloat,d)),f.listen("iframeKeydown",a.Function.bind(b.keyPress,b)),f.listen("modeChanged",a.Function.bind(b.modeChange,b)),a.Ext.activityChristmas){f.listen("iframeKeyup",function(){var d=b.get({html2text:1});a.Support.showChristmasRain(d,c._expando)});var g=e.data.get({component:"subject"});g.listen("keyup",function(){var b=g.getValue();a.Support.showChristmasRain(b,c._expando)})}b.bindPasteEvent()}function l(){var b=this,c=a(b.getWindow()),d=a(c.dom.document),e=a(d.dom.body),f=a.Browser.ie()?e:d;f.listen("paste",a.Function.bind(b.pasteAction,b))}function m(a){var b=this,c=b.editorCmpt;return"string"==typeof a.html?c.setContent(a.html,c.editMode||jb.mode.BASIC):"string"==typeof a.text?c.setContent(a.text,c.editMode||jb.mode.TEXT):c.setContent(a)}function n(a){var b=this;b.editorCmpt.changeMode(a)}function o(a){var b=this;b.editorCmpt.setSize(a)}function p(b,c){var d=this,e=d.data,f=e.get({status:"fromEntry"}),g=e.get({status:"paramBody"});if(-1!=b.indexOf(kb.t("附件"))&&e.set({status:"confirmAttach",value:!1}),"text"==c&&("edit"==f||"draft"==f||"timeset"==f||(c="html",b=a.String.encodeHTML(b),b=["<pre>","<br>",b,"</pre>"].join(""))),"html"==c&&("reply"==f||"forward"==f)){b=b.replace(new RegExp('id="*(spnEditorSign|divEditorGraphSign|divNeteaseMailCard)"*',"ig"),"");var h="0";try{h=pb.get({field:"ntes_option",flag:"signPosition"})}catch(i){}if("0"==h){var j=g.defaultContent||"";j+=d.getBreakLine(5),j+='<div id="spnEditorSign" style="position:relative;zoom:1"></div>',$S("isFree")?j+='<div id="divNeteaseMailCard"></div>':$S("isVip")&&(j+='<div id="divEditorGraphSign"></div>'),j+=d.getBreakLine(1),b=j+b}else{var k=g.defaultContent||"";k+=d.getBreakLine(5),b=k+b}}if("html"==c){if(b){d.set({html:b});var l=mb.getInfo();switch(l.os){case"ipad":case"ipod":case"iphone":case"android":d.switchText({text:!0,force:!0})}}}else d.set({text:b});d.sign.load(),d.checkTips()}function q(a){a=a||{};var b=this;b.base;var c=b.data,d=c.get({status:"showHtmlbar"});if(a.show==d)return!1;var e=b.editorCmpt;if(e.editMode==jb.mode.TEXT);else if(d)b.mode=e.editMode,b.setMode(jb.mode.HIDE);else{var f=b.mode||jb.mode.BASIC;b.setMode(f)}return c.set({status:"showHtmlbar",value:!d}),!0}function r(b){function c(b,c,d){try{var e=0,f=0,g=c.dom||c,h=g,i=10;d=d&&d.dom||d||a.Component.getScrollParent(h)||document.body;do e+=g.offsetTop||0,f+=g.offsetLeft||0,g=g.offsetParent;while(g&&g!==d&&g!==d.offsetParent);b.dom.style.left=f+i+"px",b.dom.style.top=e+10+"px"}catch(j){}}if(a.Ext.composeAt){b=b||{};var d=this;d.base,d.module;var e=d.data,f=e.get({status:"showPlaceholder"});if(b.show==f)return!1;var g=b.text||kb.t("尝试下写信输入@，@联系人后系统自动把此人加到收件人"),h=e.get({moduleId:"editor"}),i=e.get({component:"editorPlaceholder"});return i||(i=new a.Component({html:'<div class="iy1">'+g+"</div>",renderTo:h,listeners:{click:{handler:function(){d.focus(),d.setPlaceholder({show:!1})}}}}),c(i.getEl(),d.editorCmpt.iframe,a.fly(h)),e.set({component:"editorPlaceholder",value:i})),b.show?i.show():i.hide(),e.set({status:"showPlaceholder",value:b.show}),!0}}function s(a){a=a||{};var b=this,c=b.data,d=b.editorCmpt;if(a.empty){var e=c.get({status:"defaultContent"});return b.isEmpty(e)}return"string"==typeof a.id?d.getIframeEl("#"+a.id):"string"==typeof a.tag?d.getIframeEl(a.tag):a.html?d.getContent(jb.mode.BASIC,"html"):a.html2text?d.getContent(jb.mode.BASIC,"text"):a.text?d.getContent(jb.mode.TEXT,"text"):d.getContent()}function t(){var a=this;return a.editorCmpt.getPreviewContent()}function u(a){var b=this,c=b.editorCmpt,d=c.editMode,e=d==jb.mode.TEXT?"text":"html",f="";try{return f=c.getFinalContent(d,e),a&&(f=c.filterDisplayNone(f)),f}catch(g){return""}}function v(){var a=this,b=a.editorCmpt;return b.win}function w(a){var b=this,c=b.editorCmpt,d=c.getBreakLine(a);return d}function x(b){var c=this,d=c.editorCmpt,e=d.getContent();return/img/i.test(e)?!1:e==b?!0:(e=a.String.trim(d.getContent(d.editMode,"text")),e?!1:!0)}function y(a){var b=this;b.editorCmpt,b.editorCmpt.del(a)}function z(a){var b=this,c=b.editorCmpt;c.focus(a)}function A(a){var b=this,c=b.editorCmpt;a.html&&(c.insertHtml(a.html),b.setPlaceholder({show:!1})),a.image&&(c.insertImage(a.image),b.setPlaceholder({show:!1}))}function B(b){b=b||{};var c=this,d=c.editorCmpt,e=c.data,f=e.get({status:"showHtmlbar"}),g=b.text,h="text"==d.editMode;if(g==h)return!1;if(g)b.force?(f&&(c.mode=d.editMode),c.setMode(jb.mode.TEXT),c.form.setCheckbox("text",!0,!0)):c.get({empty:!0})?c.switchText({text:!0,force:!0}):a.Msgbox.show({type:"confirm",title:kb.t("将此邮件转换为纯文本将会遗失某些格式，您确定要继续吗？"),ok:function(){c.switchText({text:!0,force:!0})}});else{var i=f?c.mode:jb.mode.HIDE;c.setMode(i),c.form.setCheckbox("text",!1,!0)}}function C(a){var b=this,c=b.base;if(nb.shortcut&&(a.ctrlKey||a.metaKey)){var d=a.keyCode;83==d&&(c.getAction()||(mb.chrome()?c.addTimer("save",function(){try{c.send({action:"save"})}catch(a){}},500):c.send({action:"save"})))}27==a.keyCode&&setTimeout(function(){b.data.get({moduleId:"editor"}).dom.nextSibling.focus()},0),b.setPlaceholder({show:!1})}function D(){var b=this,c=b.data;c.get({status:"fullScrren"}),b.editorCmpt,b.setPlaceholder({show:!1}),nb.notary&&a.Ud.getProxy({field:"product.notary.userpro",call:function(a){var c=a["product.notary.userpro"];1==c?b.hideNotaryBtn():b.notaryCheck()}})}function E(a){var b=this,c=b.editorCmpt,d=b.component,e=0===a.indexOf("//");e&&(a="https:"+a),d.portrait.hide(),c.insertPortrait(a),b.setPlaceholder({show:!1})}function F(a,b,c){var d=this;c=c||d.compareLength;for(var e=Math.min(a.length,b.length),f=0;e>f;f++){var g=c(a[f],b[f]);if(0!==g)return g}return d.compareLength(a.length,b.length)}function G(a,b){return a>b?1:b>a?-1:0}function H(a,b,c,d){return a.replace(c,function(a){return b[d]+=1,new Array(a.length+1).join(" ")})}function I(a){var b=this;try{var c=b.oSelectorWeights.hasOwnProperty(a)?b.oSelectorWeights[a]:null;if(c)return c;var d=[0,0,0,0],e=a;return a=a.replace(/:not\(([^\)]*)\)/g,"     $1 "),a=a.replace(new RegExp("{[^]*","gm"),""),a=b.handleSelectorTwo(a,d,/(\[[^\]]+\])/g,2),a=b.handleSelectorTwo(a,d,/(#[^\#\s\+>~\.\[:]+)/g,1),a=b.handleSelectorTwo(a,d,/(\.[^\s\+>~\.\[:]+)/g,2),a=b.handleSelectorTwo(a,d,/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,3),a=b.handleSelectorTwo(a,d,/(:[\w-]+\([^\)]*\))/gi,2),a=b.handleSelectorTwo(a,d,/(:[^\s\+>~\.\[:]+)/g,2),a=a.replace(/[\*\s\+>~]/g," "),a=a.replace(/[#\.]/g," "),b.handleSelectorTwo(a,d,/([^\s\+>~\.\[:]+)/g,3),c=d,b.oSelectorWeights[e]=c,b.oSelectorWeights[e]}catch(f){return[0,0,0,0]}}function J(a){var c=this,d=c.form,e=c.data;c.editorCmpt.fire("beforePaste");var f=mb.getInfo();"macintosh"==f.os&&mb.safari()&&c.compatibleSafariPasteImg();var g=a.clipboardData||b.clipboardData,h="";if(!mb.isIE()&&(h=g.getData("text/html"))){var i=c.convertPasteContent(h);if(i!==h){a.preventDefault();try{c.editorCmpt.cmd.insertHtml(i)}catch(j){}}}if(setTimeout(function(){c.editorCmpt.fire("afterPaste",h),c.afterPaste(h)},0),e.get({status:"confirmSubject"})&&""===d.getSubject()){var k=c.get({html2text:!0});setTimeout(function(){var a=c.get({html2text:!0}),b=k.length,d=a.length,e=3e3;if(!(b>e||d>e)){for(var f=0;b>f&&d>f&&k.charAt(b-f-1)==a.charAt(d-f-1);f++);for(var g=b-f,h=d-f,f=0;b>f&&d>f&&k.charAt(f)==a.charAt(f);f++);g>f&&(g=f);var i=(g==h?a:a.substring(g,h)).replace(/[\r\n]/gi,"");0===i.indexOf("http://")&&c.getSubject(i)}},15)}}function K(){var c=this;setTimeout(function(){for(var d=c.editorCmpt.doc,e=d.getElementsByTagName("IMG"),f=0;f<e.length;f++){var g=e[f];(0===g.src.indexOf("webkit-fake-url")||0===g.src.indexOf("blob"))&&(g.url=g.src,g.src="https://mimg.127.net/xm/webmail/img/local.png",g.unselectable="on",g.style.cursor="pointer",a(g).listen("click",function(){var c=a.Uri.getUrl("compose_attach_fakeurl",!0)+"&url="+encodeURIComponent(g.url);b.open(c)}))}},15)}function L(a){var c=this,d="<div>"+a+"</div>";if(!mb.chrome()&&!mb.firefox())return a;if("function"==typeof b.DOMParser){var e=(new DOMParser).parseFromString("<html><head></head><body>"+d+"</body></html>","text/html").body.children[0],f=Element.prototype.getElementsByTagName.apply(e,["STYLE"]);f=[].slice.call(f,0);var g=b.Object.getOwnPropertyDescriptor(HTMLStyleElement.prototype,"sheet"),h=g.get,i=h.apply(f[0]),j=i.cssRules;j=Array.prototype.filter.call(j,function(a){return a instanceof CSSStyleRule||a.type==CSSRule.STYLE_RULE}),j.sort(function(a,b){return a=c.handleSelector(a.selectorText),b=c.handleSelector(b.selectorText),c.compareSelector(a,b)});for(var k,l=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1),m=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;k=l.nextNode();){for(var n=k.style.cssText,o=0;o<j.length;o++)m.apply(k,[j[o].selectorText])&&k.style&&(k.style.cssText+=j[o].cssText.match(/\{([\S\s]*)\}/)[1]);k.style.cssText+=n}var p=e.innerHTML.split("<table"),q="<table"+p[1].slice(0,p[1].indexOf("</table>"))+"</table>";return q+="<div><br /></div>"}}function M(a){var b=document.createElement("div"),c=a.replace(/\s*(<html>|<\/html>|<body>|<\/body>)\s*/g,"");b.innerHTML=c.replace(/<!--[\w\s]*-->/g,"");for(var d=b.querySelectorAll("*"),e=0;e<d.length;e++){var f=d[e],g=f.style.position;if(g&&"fixed"===g.toLowerCase()){var h=f.parentNode;h.removeChild(f)}}var i=b.innerHTML;return b.innerHTML="",i}function N(a){var b=this,c=b.getPasteConvertType(a),d="";switch(c){case"excel":d=b.convertExcel(a);break;case"web":d=b.convertHtml(a);break;case"text":d=a}return d}function O(a){return a.indexOf('xmlns:x="urn:schemas-microsoft-com:office:excel"')>-1?"excel":/^<html>/g.test(a)?"web":"text"}function P(b){var c=this,d=c.data;c.base,c.action.getSubject({url:b,callback:a.Function.bind(c.fillSubject,c),error:function(){return!0}}),d.set({status:"confirmSubject",value:!1})}function Q(b){var c=this,d=c.form;""===d.getSubject()&&b.code==a.S_OK&&d.setSubject(b["var"].title)}function R(){if(nb.editor_tips&&!qb.loadTips){var b=this,c=a.Uri.getUrl("letterpaper_tips");a.Ajax.jsonp(c,function(a){b.showTips(a)},"jsonp")}}function S(c){if(200==c.code&&(qb.loadTips=!0,c.visible)){var d=this,e=d.module,f=d.stationery,g=d.data;d.component;var h=d.editorCmpt,i=h.editDv.dom,j=c.letter,k=j.name,l=j.iconUrl,m=a(h.toolbarDv.find(".APP-editor-commond-stationery").dom).offset(),n=m.x-97-d.getPadding()+"px",o="33px",p='<b class="nui-layer-arr"></b><div class="jn1">'+kb.t("新信纸")+"</div>"+'<div id="'+e.createId("stationeryTips")+'" class="jo1">'+'<a class="hr1" href="#">'+'<img class="ih1" src="'+l+'" alt="'+k+'">'+"</a>"+"</div>"+'<div class="jr1">'+k+"</div>",q=new a.Layer({renderTo:i,extcls:"mJ1",left:n,top:o,hasClose:!1,content:p});ob.cache({sh_stationery_tips:j.id},a.EMPTYFUNC);var r=g.get({moduleId:"stationeryTips"});r.listen("click",function(){f.select({item:j}),q.hide(),ob.cache({cl_stationery_tips:j.id},a.EMPTYFUNC),ob.cache({cl_stationery_paper:j.id},a.EMPTYFUNC)}),b.setTimeout(function(){q.hide()},15e3)}}function T(){$S("clientWidth")||$S("clientWidth",document.documentElement.clientWidth);var a=0,b=$S("clientWidth");return 1680>=b||(a=1920>=b?52:2560>=b?104:156),a}function U(){var b=this,c=b.composeEditor;"3"!=pb.get({field:"ntes_compose",flag:"upload_mode"})?c.assist.captureStart():a.Msgbox.show({title:kb.t("普通附件上传模式不支持截图，请切换到高级上传模式")}),ob.cache({cl_capture:"1"},a.EMPTYFUNC)}function V(){var b=this,c=b.composeEditor,d='<div class="nui-normalTabs nui-tabs"><div id="dvMsgBoxTab1" class="nui-tabs-item nui-tabs-item-selected">'+kb.t("我的电脑")+"</div>"+'<div id="dvMsgBoxTab2" class="nui-tabs-item nui-tabs-item-hover">'+kb.t("网址URL")+"</div>"+"</div>"+'<ul class="APP-editor-insertPic-panel">'+'<li id="liMsgBoxPanel1" class="APP-editor-insertPic-panel-item">'+'<div class="APP-editor-insertPic-remark">'+kb.t("点击“浏览”，在您电脑中选择要上传的图片，每张图片上传完毕后将会自动添加到正文中")+"</div>"+"</li>"+'<li id="liMsgBoxPanel2" class="APP-editor-insertPic-panel-item" style="display:none"></li>'+"</ul>",e=null;e=a.Msgbox.show({header:kb.t("添加图片"),content:d,extcls:"APP-editor-insertPic",contentType:"normal",autoFocus:!1,listeners:{afterRender:function(){new a.Button({renderTo:a("#liMsgBoxPanel1").dom.firstChild,text:kb.t("浏览"),subclass:"mainBtn",click:function(){if("3"!=pb.get({field:"ntes_compose",flag:"upload_mode"})){if(ib.has());else if(c.attach.nativeClick){var b=c.attach,d=a("#inputFileImage");d||(d=a.Element.create("input"),d.css({visibility:"hidden"}),d.attr({id:"inputFileImage",type:"file",size:"1",multiple:!0,accept:"image/*"}),document.body.appendChild(d.dom)),d.one("change",function(){var c=d.dom.files;if(c.length){c=a.Object.toArray(c),a.Array.each(c,function(a,b){b.inlined=!0}),b.nativeSelect(c);try{d.dom.value=""}catch(e){}}}),d.dom.click()}else a.Msgbox.show({title:kb.t("附件上传模式已被修改，使用新模式上传图片，需要重新进入写信生效")});e.close()}else a.Msgbox.show({title:kb.t("普通附件上传模式不支持本地图片上传，请切换到高级上传模式")})}}),new a.Button({renderTo:a("#liMsgBoxPanel1").dom.firstChild,text:kb.t("取消"),click:function(){e.close()}}),new a.Component({html:"<span></span>",renderTo:"liMsgBoxPanel2",items:[{xtype:"input"},{xtype:"button",text:kb.t("添加"),subclass:"mainBtn",click:function(){var a=this.ownerCt.find("input")[0],b=a.getValue();b&&"http://"!=b?(c.insert({image:b}),e.close()):a.showTips(kb.t("请输入合法的地址"),"err")}},{xtype:"button",text:kb.t("取消"),click:function(){e.close()}},{html:'<p class="APP-editor-insertPic-remark">'+kb.t("请在输入框里面填上要添加图片的URL")+"</p>"}]}),this.buttons.ok.hide()}}});var f=a("#dvMsgBoxTab1","#dvMsgBoxTab2"),g=a("#liMsgBoxPanel1","#liMsgBoxPanel2");f.listen("click",function(b){var c=0,d=1,e=a.Event.getTarget(b);"dvMsgBoxTab2"==e.id&&(c=1,d=0);var h="nui-tabs-item-selected";-1==f.doms[c].className.indexOf(h)&&(a(f.doms[d]).setClass("nui-tabs-item nui-tabs-item-hover"),a(g.doms[d]).hide(),a(f.doms[c]).setClass("nui-tabs-item nui-tabs-item-selected"),a(g.doms[c]).show())}),ob.cache({cl_image:"1"},a.EMPTYFUNC)}function W(){var c=this,d=c.composeEditor;a.Browser.getVersion()||[0,0];var e=b.SpeechRecognition||b.webkitSpeechRecognition;if(e){var f='<div class="APP-editor-speech"><div class="nui-multiLineIpt nui-ipt"><textarea id="textAreaComposeVoice" class="nui-ipt-input"></textarea></div><div class="APP-editor-speech-tips nui-txt-tips nui-txt-s12"><span class="APP-editor-speech-tipsLeft">'+kb.t("请点击图标")+"</span>"+'<button id="voiceButton" style="display:inline-block;padding:0;overflow:hidden;border:none;outline:none;" class="APP-editor-speech-iptOuter">'+'<img alt="Start" id="start_img" src="https://mimg.127.net/p/js6/lib/img/mic/mic.gif" style="width: 100%;height: 100%;">'+"</button>"+'<span class="APP-editor-speech-tipsRight">'+kb.t("开始语音输入")+"</span>"+"</div>"+"</div>";a.Msgbox.show({type:"confirm",contentType:"wide",header:kb.t("语音输入"),content:f,ok:function(){var b=a("#textAreaComposeVoice").dom.value;d.insert({html:b})}});var e=e||webkitSpeechRecognition,g=new e;g.lang="zh-CN",g.interimResults=!1,g.maxAlternatives=1,g.onresult=function(b){var c=b.results[0][0].transcript;a("#textAreaComposeVoice").dom.value+=c},g.onstart=function(){a("#voiceButton").find("img").dom.src="https://mimg.127.net/p/js6/lib/img/mic/mic-animate.gif"},g.onspeechstart=function(){},g.onspeechend=function(){a("#voiceButton").find("img").dom.src="https://mimg.127.net/p/js6/lib/img/mic/mic.gif",g.stop()},g.onerror=function(b){var c="";switch(b.error){case"not-allowed":c=kb.t("打开语音输入失败，请检查是否有输入设备，以及麦克风权限");break;case"network":c=kb.t("语音输入翻译失败，请检查网络");break;default:c=kb.t("未知错误")+"："+b.error}a.Msgbox.show({title:'<p style="margin-top:-10px;">'+c+"</p>"})},a("#voiceButton").listen("click",function(){g.start()})}else{var h=kb.t("您的浏览器不支持语音输入功能，建议您选择")+"<br/>"+kb.t("Google Chrome浏览器进行体验，");a.Browser.chrome()&&(h=kb.t("您的Chrome浏览器版本过低，建议您升级到新版本进行体验，"));var f=h+'<a href="http://codown.youdao.com/163chrome/b/output/ChromeSetup/ChromeSetup.exe" target="_blank">'+kb.t("立即下载")+"</a>。<br/>"+kb.t("点击此处")+'<a href="http://chrome.163.com" target="_blank">'+kb.t("了解详情")+"</a>。";a.Msgbox.show({title:f})}}function X(a,b,c){var d=this,e="basic"==c?"0":"1";pb.set({field:"ntes_letter",flag:"editorToolbar",value:e}),d.changeMode(c)}function Y(b,c,d){var e=this,f=e.composeEditor;f.module;var g=f.component,h=e.editDv.dom,i=c.offset(),j=i.x-109-f.getPadding()+"px",k="42px",l=200;if(a(document).width()<=1510&&(j=a(document).width()-600-l-f.getPadding()+"px"),g[d])return g[d].showing||(a.Browser.isIE()?setTimeout(function(){g[d].show({left:j})},100):g[d].show({left:j})),void 0;var m=f.base.getCallName(a.Function.bind(f.portraitAdd,f)),n=a.Uri.getUrl("compose_portrait_v2")+"&call=window.parent."+m,o={renderTo:h,width:"476px",height:"280px",left:j,top:k,extcls:"APP-editor-menuNoBorder-insertFace",groups:[{style:"right:0px",content:'<iframe class="APP-editor-menu-iframe" style="width:476px;height:280px;" allowtransparency="allowtransparency" src="'+n+'" frameborder="0" scrolling="no"></iframe>'}]};a.Browser.isIE()?setTimeout(function(){g[d]=c.dom[d]=new a.Menu(o)},100):g[d]=c.dom[d]=new a.Menu(o)}function Z(b,c,d){var e=this,f=e.composeEditor,g=f.sign,h=f.component,i=e.editDv.dom;e.plugin[d];var j=[],k={};if(h[d]&&h[d].showing)return h[d]=null,void 0;var l=c.offset(),m=l.x-47-f.getPadding()+"px",n=(l.x<500?"55":"33")+"px",o={renderTo:i,left:m,top:n,groups:[k]};g.each({text:!0,call:function(b,c){c&&j.push({text:a.String.escapeHTML(c.name),click:function(){g.select({text:!0,id:c.id})}})}}),nb.linkedin&&j.push({text:kb.t("linkedIn签名"),click:function(){ob.cache({cl_sign_linkedin:"1"},a.EMPTYFUNC),g.select({linkedin:!0,id:1})||a.Msgbox.show({type:"confirm",title:kb.t("你还未设置linkedIn签名，是否立即设置？"),ok:function(){try{var b=$L("interface.OptionInterface",this)}catch(c){return c}ob.cache({cl_sign_set:"1"},a.EMPTYFUNC),b.entry({module:"SignModule",exit:!1})}})}}),(!$S("isVip")||$G.environment.isCh)&&j.push({text:kb.t("个性签名"),click:function(){ob.cache({cl_sign_custom:"1"},a.EMPTYFUNC),g.showCustom()}}),j.length&&j.push({type:"split"}),j.push({text:kb.t("设置签名"),click:function(){try{var b=$L("interface.OptionInterface",this)}catch(c){return c}ob.cache({cl_sign_set:"1"},a.EMPTYFUNC),b.entry({module:"SignModule",exit:!1})}}),k.items=j,a.Browser.isIE()?setTimeout(function(){h[d]=new a.Menu(o)},100):h[d]=new a.Menu(o)}function $(b,c){var d=this,e=d.composeEditor,f=e.module,g=f.data,h=f.base,i=g.get({moduleId:"header"}),j=a(f.container),k=g.get({status:"showSide"}),l=g.get({status:"fullScrren"});g.set({status:"fullScrren",value:!l});var m=g.get({component:"toolbar"}),n=m.getEl().find(".nui-toolbar-ext").hide();l?(i.removeClass("nA2"),j.removeClass("frame-main-noTop"),k&&a.Frame.setViewType("l-r",f),h.layoutAdjust({force:!0,timer:!0}),c.html('<b class="ico ico-editor ico-editor-toFullScr"></b>'),c.setClass("APP-editor-commond-btn APP-editor-switchFullScreen-toFull"),n.show()):(i.addClass("nA2"),j.addClass("frame-main-noTop"),k&&a.Frame.setViewType("normal"),h.layoutAdjust({force:!0,timer:!0}),c.html('<b class="ico ico-editor ico-editor-toMiniScr" title="'+kb.t("取消全屏")+'"></b>'),c.setClass("APP-editor-commond-btn APP-editor-switchFullScreen-toMini"),n.hide()),d.plugin.More.resize.call(d)}function _(b,c,d){var e=this,f=e.composeEditor,g=f.module,h=f.component;
if(h[d])return h[d].show(),void 0;var i=e.editDv.dom,j=c.offset(),k=j.x-89-f.getPadding()+"px",l="33px",m='<b class="nui-layer-arr"></b><div id="'+g.createId("paperContent")+'">'+'<div id="'+g.createId("paperBtn")+'" class="hf0"></div>'+'<div class="cM0">'+'<ul id="'+g.createId("paperList")+'" class="fB0"></ul>'+"</div>"+'<div id="'+g.createId("paperPage")+'" class="he0"></div>'+"</div>";h[d]=new a.Layer({renderTo:i,extcls:"kv0",left:k,top:l,hasClose:!0,content:m}),f.stationery.load()}function ab(){ob.cache({cl_trans:"1"},a.EMPTYFUNC);var b=this,c=b.composeEditor,d=c.base;d.send({action:"auto",call:function(){d.trans({action:"goHuman",vendor:"write"})}})}function bb(){ob.cache({cl_notary_editor:"1"},a.EMPTYFUNC);var b=this,c=b.composeEditor;c.module;var d=c.event,e=c.data;if(e.get({status:"initExt"})!==!0)d.extActive();else{var f=e.get({element:"ext"});"none"==f.dom.style.display&&d.extActive()}var g=e.get({component:"notary"});g.getChecked()!==!0&&g.setChecked(!0)}function cb(){var a=this;a.module,a.stationery,a.component;var b=a.editorCmpt;return b.rendered?void 0:(b.listen("afterRender",function(){a.showLayer()}),void 0)}function db(){function b(){var b=h.get({component:"notary"}),c=i.getEl(),d=a(c).find(".APP-editor-commond-notary");d&&d.show(),b&&b.show()}function d(){var b=h.get({component:"notary"}),c=i.getEl(),d=a(c).find(".APP-editor-commond-notary");d&&d.hide(),b&&b.hide()}var e=this,f=e.module,g=f.action,h=f.data,i=h.get({component:"editor"}),j=h.get({status:"notaryBalance"});j?b():d(),nb.notary&&a.Ud.getProxy({field:"product.notary.single.balance",call:function(a){var d=a["product.notary.single.balance"],e=h.get({status:"notaryBalance"});-1===d&&e===c?g.getNotaryBalance(function(a){a&&200===a.code&&(a.single_num>0&&b(),h.set({status:"notaryBalance",value:a.single_num}))}):0===d?h.set({status:"notaryBalance",value:d}):(b(),h.set({status:"notaryBalance",value:d}))}})}function eb(){var b=this,c=b.module,d=c.data,e=d.get({component:"editor"}),f=d.get({component:"notary"}),g=e.getEl(),h=a(g).find(".APP-editor-commond-notary");h&&h.hide(),f&&f.hide()}function fb(b){if(b){var c=document.createElement("div");c.innerHTML=b;for(var d=c.querySelectorAll("img"),e=0;e<d.length;e++){var f=d[e],g=f.src,h=g.indexOf("file://")<0;h||a.Tips.module({text:kb.t("您粘贴的文本里存在本地图片，浏览器不支持解析，请单独粘贴图片"),expires:3e3})}}}try{var gb=$L("module.compose.Compose")}catch(hb){return hb}try{var ib=$L("module.compose.ComposeAssist")}catch(hb){return hb}try{var jb=$L("component.editor.Editor")}catch(hb){return hb}var kb=new $I18N("module.compose.ComposeEditor"),lb=a.Object;a.Function;var mb=a.Browser,nb=a.Ext,ob=a.Log,pb=a.Ud,qb=a.createClass($N("module.compose.ComposeEditor")),rb={initialize:e,init:f,clear:g,create:h,render:i,custom:j,bindEvent:k,bindPasteEvent:l,getPasteConvertType:O,convertPasteContent:N,convertExcel:L,convertHtml:M,set:m,setMode:n,setSize:o,setOriginal:p,setHtmlbar:q,setPlaceholder:r,get:s,getPreview:t,getFinal:u,getWindow:v,getBreakLine:w,isEmpty:x,remove:y,focus:z,insert:A,switchText:B,keyPress:C,modeChange:D,portraitAdd:E,oSelectorWeights:sb,compareSelector:F,compareLength:G,handleSelectorTwo:H,handleSelector:I,pasteAction:J,compatibleSafariPasteImg:K,getSubject:P,fillSubject:Q,checkTips:R,showTips:S,showLayer:cb,notaryCheck:db,hideNotaryBtn:eb,checkAt:d,getPadding:T,btnCapture:U,btnImage:V,btnMicrophone:W,btnMode:X,btnFull:X,btnBasic:X,btnPortrait:Y,btnSign:Z,btnFullScreen:$,btnStationery:_,btnTranslate:ab,btnNotary:bb,afterPaste:fb};lb.inherit(qb,gb),lb.extend(qb.prototype,rb);var sb={}}($,window),function(a){function b(a){var b=this;B.superClass.initialize.call(b,a)}function c(){var a=this;B.superClass.init.call(a)}function d(b){b=b||{};var c=this,d=c.base,e=b.func;c.data;var f="bottom"==b.pos?"2":"1";switch(e){case"deliver":y.cache({cl_send:f},a.EMPTYFUNC),d.send({action:"deliver"});break;case"save":y.cache({cl_save:f},a.EMPTYFUNC),d.send({action:"save"});break;case"preview":y.cache({cl_preview:f},a.EMPTYFUNC),d.preview();break;case"cancel":y.cache({cl_cancel:f},a.EMPTYFUNC),a.MultiTab.remove(a.Context.module);break;case"dict":y.cache({cl_dict:f},a.EMPTYFUNC);try{}catch(g){return g}Translate.change();break;case"card":u.startApp({name:"cards_read",appId:4,text:w.t("邮箱贺卡"),url:A.getUrl("cards_read")});break;case"postcard":u.startApp({name:"read_postcard",appId:3,text:w.t("明信片"),url:A.getUrl("read_postcard")})}}function e(a){a=a||{};var b=this;b.base,b.form;var c=b.data,d=c.get({status:"showTo"}),e=c.get({element:"to"}),f=a.toggle;if(a.show){if(d)return;f=!0}if(a.hide){if(!d)return;f=!0}f&&(d?e.hide():e.show(),c.set({status:"showTo",value:!d}))}function f(b){b=b||{};var c=this;c.base;var d=c.form,e=c.data,f=e.get({status:"showCc"}),g=c.getLink("cc"),h=e.get({element:"cc"});h||(h=c.createRev("cc"));var i=b.toggle;if(b.show){if(f)return;i=!0}if(b.hide){if(!f)return;i=!0}if(i){if(f){if(b.separate);else if(!d.getContact("empty","cc"))return new a.Msgbox({type:"confirm",title:w.t("要删除已经存在的所有抄送地址吗？"),ok:function(){d.setContact(null,"cc"),c.setCc({hide:!0})}}),void 0;g.setText(w.t("抄送")),h.hide(),b.separate||"cc"==e.get({status:"inputChoose"})&&d.focus("to")}else g.setText(w.t("删除抄送")),h.show(),b.separate||d.focus("cc");e.set({status:"showCc",value:!f})}}function g(b){b=b||{};var c=this;c.base;var d=c.form,e=c.data,f=e.get({status:"showBcc"}),g=c.getLink("bcc"),h=e.get({element:"bcc"});h||(h=c.createRev("bcc"));var i=b.toggle;if(b.show){if(f)return;i=!0}if(b.hide){if(!f)return;i=!0}if(i){if(f){if(b.separate);else if(!d.getContact("empty","bcc"))return new a.Msgbox({type:"confirm",title:w.t("要删除已经存在的所有密送地址吗？"),ok:function(){d.setContact(null,"bcc"),c.setBcc({hide:!0})}}),void 0;g.setText(w.t("密送")),h.hide(),b.separate||"bcc"==e.get({status:"inputChoose"})&&d.focus("to")}else g.setText(w.t("删除密送")),h.show(),b.separate||d.focus("bcc");e.set({status:"showBcc",value:!f})}}function h(b){b=b||{};var c=this;c.base;var d=c.form,e=c.data,f=e.get({status:"useSeparate"}),g=c.getLink("all"),h=g[0],i=g[1],j=g[2],k=e.get({element:"separate"});k||(k=c.createRev("separate"));var l=b.toggle;if(b.show){if(f)return;l=!0}if(b.hide){if(!f)return;l=!0}if(l){if(f){h.show(),i.show(),j.setText(w.t("群发单显")),k.hide();var m=d.getContact("suc","separate"),n=m.length,o={};a.Array.each(m,function(a,b){o[b.address.toLowerCase()]=1});var p=function(b){var c=[];n&&a.Array.each(d.getContact("suc",b),function(a,b){var d=b.address.toLowerCase();o[d]&&(o[d]++,c.push(b))}),c.length?d.setContact(c,b):d.setContact(null,b)};if(f.showTo&&(p("to"),c.setTo({show:!0,separate:!0})),f.showCc&&(p("cc"),c.setCc({show:!0,separate:!0})),f.showBcc&&(p("bcc"),c.setBcc({show:!0,separate:!0})),n){var q=[];a.Array.each(m,function(a,b){o[b.address.toLowerCase()]>1||q.push(b)}),d.addContact(q,"to")}d.setContact(null,"separate"),d.focus(f.inputChoose),f=null}else f={},f.inputChoose=e.get({status:"inputChoose"}),h.hide(),i.hide(),j.setText(w.t("取消群发单显")),k.show(),e.get({status:"showTo"})&&(d.addContact(d.getContact("suc","to"),"separate"),c.setTo({hide:!0,separate:!0}),f.showTo=!0),e.get({status:"showCc"})&&(d.addContact(d.getContact("suc","cc"),"separate"),c.setCc({hide:!0,separate:!0}),f.showCc=!0),e.get({status:"showBcc"})&&(d.addContact(d.getContact("suc","bcc"),"separate"),c.setBcc({hide:!0,separate:!0}),f.showBcc=!0),d.focus("separate");e.set({status:"useSeparate",value:f})}}function i(b){var c=this;c.module;var d=c.form,e=c.data,f=c.view,g="",h={xtype:"emailcontainer",key:b,containerfocus:function(){d.choose(b),d.addFocusCls(b)},containerblur:function(){d.removeFocusCls(b),a.Ext.contactCorrect&&d.remindValid(b)},containerupdate:function(){var a=d.getAllRecvNum();a>=21&&f.showMaketToolTips()},domain:"163.com"};z.contactCorrect&&(h.itemwarnremove=function(a){d.remindRemove(b,a)});var i=w.t("地址输入框，请输入邮件地址，多人时地址请以分号隔开"),j={cc:{tabIndex:1,title:w.t("同时将这封邮件发给其他联系人"),inputLable:w.t("抄送")+i},bcc:{tabIndex:1,title:w.t("该地址对于其他收件人是不可见的"),inputLable:w.t("密送")+i},separate:{tabIndex:1,tips:{text:w.t("群发的邮件，采用一对一单独发送，每个收件人只看到自己的地址")},title:w.t("会对多个人一对一的发送， 每个人将单独收到发给他/她的邮件"),inputLable:w.t("群发单显")+i}};x.extend(h,j[b]);var k={cc:w.t("抄送人"),bcc:w.t("密送人"),separate:w.t("群发单显")},l=k[b],m={text:l,cls:"nui-txt-link",title:w.t("点击添加")+l,click:function(){y.cache({cl_rev:b},a.EMPTYFUNC),d.showContact(b)}},n=l;try{var o=new a.Link(m);n=o.html();var p=new v(h);g=p.html(),e.set({component:b,value:p})}catch(q){}var r=a.Element.create("DIV");r.setClass("kZ0 jL0"+b),"separate"!=b||$G.environment.isCh||(r.dom.style.paddingLeft="100px");var s=e.get({element:"to"});if("bcc"==b){var t=e.get({element:"cc"}),u=t||s;u.after(r.dom)}else s.after(r.dom);n+="separate"==b?'<span style="margin-left:-4px">：</span>':"：";var A='<label class="fn0">'+n+"</label>"+'<div class="dG0">'+'<div class="bz0">'+g+"</div>"+"</div>"+'<div class="gH1"></div>';return r.html(A),a.Component.setEvents(),e.set({element:b,value:r}),d.addHoverEvent(b),r}function j(b){function c(){var b=g.get({component:"attachLayer",value:b});if(b){var c=b.getEl();"none"!==c.dom.style.display&&b.pointTo(a("#"+h.createId("attachAdd")),a.fly(h.container))}}function d(){var b=g.get({component:"schedule"});b&&b.setDisabled(!1),o.pre().remove(),l.setText(m),g.set({status:"showScheduleInvitation",value:j}),a.Log.cache({ComposeICSHide:1})}var e=this,f=e.view,g=e.data,h=e.module,i=g.get({status:"showScheduleInvitation"}),j=!i,k=e.getLink("all"),l=k[3],m=j?w.t("删除日程邀请"):w.t("日程邀请"),n=h.container,o=a(n).find(".ia0");if(j){if(b)return;var p=g.get({component:"schedule"}),q=f.createScheduleInvitation();o.before(q),p&&p.setDisabled(),l.setText(m),g.set({status:"showScheduleInvitation",value:j}),a.Component.setEvents(),c(),a.Log.cache({ComposeICSShow:1})}else b?d():new a.Msgbox({type:"confirm",title:w.t("是否删除此日程邀请？"),ok:function(){d(),c()}})}function k(a){var b=this,c=b.data,d=c.get({component:"toolbar"}),e=d.find("link");switch(a){case"cc":return e[3];case"bcc":return e[4];case"all":return[e[3],e[4],e[5],e[6]]}}function l(){var b=this,c=b.module,d=b.base,e=b.data,f=c.editor;e.get({status:"initExt"})!==!0&&(b.extCreate(),e.set({status:"initExt",value:!0}));var g=e.get({element:"ext"}),h=e.get({component:"extLink"});if("none"==g.dom.style.display){y.cache({cl_more_s:"1"},a.EMPTYFUNC),h.setText(w.t("隐藏选项 ")+'<b class="nui-ico">k</b>');try{var i=e.layout,f=b.editor;f.setSize({height:i.editorHeight-34+"px"})}catch(j){}}else y.cache({cl_more_h:"2"},a.EMPTYFUNC),h.setText(w.t("更多选项 ")+'<b class="nui-ico">j</b>');g.toggle(),z.notary&&a.Ud.getProxy({field:"product.notary.userpro",call:function(a){var b=a["product.notary.userpro"];1==b?f.hideNotaryBtn():f.notaryCheck()}}),d.layoutAdjust({timer:!0,force:!0})}function m(){var b=this,c=b.module,d=b.data,e=b.editor,f=d.get({element:"ext"}),g=new a.Checkbox({text:w.t("紧急"),title:w.t("设置邮件投递优先级")});d.set({component:"priority",value:g});var h=new a.Checkbox({text:w.t("已读回执"),title:w.t("启用回执功能，您可以了解收件人是否阅读了您发送的邮件")});d.set({component:"receipt",value:h});var i="";if(z.notary){var j=new a.Checkbox({text:w.t("邮件存证"),checkedchange:function(){var b=this;if(!c.notary){try{var d=$L("module.compose.ComposeNotary",this)}catch(e){return e}var f=new d(c);f.init(),c.notary=f}c.notary.toggle({click:!0})||b.setChecked(!1,!0),y.cache({cl_notary:"1"},a.EMPTYFUNC)}});d.set({component:"notary",value:j}),i=j.html()}var k=new a.Checkbox({text:w.t("纯文本"),title:w.t("把邮件内容切换成纯文本，它将无法插入表情，图片以及将丢失正文颜色等"),checkedchange:function(){var b=this.getChecked();this.setChecked(!1,!0),e.switchText({text:b,click:!0}),y.cache({cl_text:"1"},a.EMPTYFUNC)}});d.set({component:"text",value:k});var l=new a.Checkbox({text:w.t("定时发送"),checkedchange:function(){var b=this;if(!c.schedule){try{var d=$L("module.compose.ComposeSchedule",this)}catch(e){return e}var f=new d(c);f.init(),c.schedule=f}c.schedule.toggle({click:!0})||b.setChecked(!1,!0),y.cache({cl_schedule:"1"},a.EMPTYFUNC)}});d.set({component:"schedule",value:l});var m=new a.Checkbox({text:w.t("邮件加密"),checkedchange:function(){if(!c.encrypt){try{var b=$L("module.compose.ComposeEncrypt",this)}catch(d){return d}var e=new b(c);e.init(),c.encrypt=e}c.encrypt.toggle({click:!0})||this.setChecked(!1,!0),y.cache({cl_encrypt:"1"},a.EMPTYFUNC)}});d.set({component:"encrypt",value:m});var n="",o="";if(z.ynote){var p=new a.Checkbox({text:w.t("保存到有道云笔记")});d.set({component:"ynote",value:p}),o=p.html();var q=A.getUrl("ynote",!0),r=new a.Link({cls:"nui-fIBlock",icon:"help",link:q,title:w.t("什么是有道云笔记?"),attrs:"style = 'margin:8px 0 0 -8px;'",target:"_blank"}).html();o+=r}var d=c.data,s=d.get({status:"showScheduleInvitation"}),t=g.html()+h.html()+i+k.html()+l.html()+m.html()+n+o;f.dom.firstChild.innerHTML=t,a.Component.setEvents(),s&&setTimeout(function(){l.setDisabled()},50)}function n(){var b=this,c=b.module;if(!c.notary){var d=new ComposeNotary(c);d.init(),c.notary=d}c.notary.toggle({click:!0})||this.setChecked(!1,!0),y.cache({cl_notary:"2"},a.EMPTYFUNC)}function o(b){var c=this;c.module;var d=c.base,e="1"==b;return e?a.Frame.fullScreen():a.Frame.fullScreen("hfull"),d.addTimer("layout",function(){c.attach.layout()},300),!0}function p(b){b=b||{};var c=this,d=c.module,e=c.base,f=c.data,g=f.get({status:"showSide"}),h=d._child;return b.show==g?!1:(g?a.Frame.setViewType("normal"):(h?a.SM.show(h):a.SM.go({module:"address.AddressModule",noDragbar:!0,reset:!1,parent:d}),a.Frame.setViewType("l-r",d)),f.set({status:"showSide",value:!g}),e.addTimer("layout",function(){c.attach.layout()},300),!0)}function q(){var b=this,c=b.editor;a.Menu.hideAllMenu(),c.setPlaceholder({show:!1}),c.at.autoComplete&&c.at.autoComplete._remove()}function r(b){var c=this,d=c.base,e=c.data,f=e.get({moduleId:"attachDrag"}),g=e.get({moduleId:"attachDragClose"}),h="none"!=f.dom.style.display;if(b.toggle)return h?c.setDragArea({hide:!0,force:!0}):c.setDragArea({show:!0,close:!0}),void 0;if(b.show)return h||(b.close?(f.set("dragType","close"),g.show()):(f.set("dragType","auto"),g.hide()),c.setDragArea({auto:!0}),f.show()),a.Browser.ie()&&!b.close,void 0;if(b.hide){var i=!1;return h&&("close"==f.get("dragType")?b.force&&(i=!0):i=!0),i&&d.addTimer("dragarea",function(){f.hide()},a.Browser.ie()?0:500),a.Browser.ie(),void 0}if(b.auto){var j=0;j+=282;var k=j+"px";return f.css({height:k,lineHeight:k}),void 0}}try{var s=$L("module.compose.Compose")}catch(t){return t}try{var u=$L("init.CustomAppManager")}catch(t){return t}try{var v=$L("component.emailinput.EmailContainer")}catch(t){return t}var w=new $I18N("module.compose.ComposeEvent"),x=a.Object;a.Tab;var y=a.Log,z=a.Ext;a.Ud;var A=a.Uri,B=a.createClass($N("module.compose.ComposeEvent"));x.inherit(B,s),x.extend(B.prototype,{initialize:b,init:c,fireBar:d,setTo:e,setCc:f,setBcc:g,setSeparate:h,createRev:i,toggleScheduleInvitation:j,getLink:k,extActive:l,extCreate:m,switchNotary:n,switchNav:o,switchSide:p,hideFloat:q,setDragArea:r})}($,window),function(a){function b(a){var b=this;M.extend(b,{element:{priority:null,receipt:null,text:null,sms:null},fixData:{},fixElement:{}}),Q.superClass.initialize.call(b,a)}function c(){var a=this;Q.superClass.init.call(a)}function d(b){var c,d,e,f=this,g=f.data,h=g.get({component:"sender"});if("string"==typeof b&&(b=P.matchEmail(b)),b){c=b.address,d=b.name;var i=J.getList();a.Array.each(i,function(b,d){return d.address==c?(e=d,a.BREAK):void 0}),e&&(d&&(e.name=d),h.setValue(e))}}function e(){var a=this,b=a.data.get({component:"sender"}),c=b.getValue();return c}function f(a,b){if(!M.isArray(a)||0!==a.length){var c=this,d=c.getContainer(b,!0);d.addItem(a)}}function g(a,b,c){var d=this,e=d.getContainer(b,!0);if(a)if(c){var f=[];try{for(var g=0,h=a.length;h>g;g+=1){var i,j=P.getEmails(a[g],null,!0),k=j.match;k.length>0&&(i=k[0],f.push(i))}}catch(l){}for(var m,n=K.mappingEmails(f,c),o=[],p=n.data,g=0,h=p.length;h>g;g+=1)m=p[g],o.push(new O(m.address,m.name));e.setItem(o)}else e.setItem(a);else e.clearItem()}function h(b,c){var d=this,e=d.getContainer(c);if(e){if("build"==b){var f=e.get("suc");return a.Array.each(f,function(a,b){if(b.name&&-1!=b.name.indexOf('"'))if(-1!=b.name.indexOf('\\"')){var c=b.name.replace(/\\"/g,"§");c=c.replace(/"/g,""),b.name=c.replace(/§/g,'\\"')}else b.name=b.name.replace(/"/g,"");f[a]=b.toString()}),f}return e.get(b)}var g;switch(b){case"object":g={suc:[],fail:[]};break;case"array":case"suc":case"build":case"fail":g=[];break;case"empty":g=!0;break;case"dom":g=null}return g}function i(a,b){var c=this,d=c.getContainer(b);d&&d.delItem(a)}function j(a,b,c){var d=this,e=d.getContainer(b);e&&e.setItemValid(a,c)}function k(b){var c=this;c.choose(b);var d={to:L.t("收件人"),cc:L.t("抄送人"),bcc:L.t("密送人"),separate:L.t("群发单显")},e=d[b];try{var f=$L("component.contact.SelectContact",this)}catch(g){return g}var h=c.getContact("suc",b);f.show({exist:h,title:e,data:K.data,callback:function(d){var e=[];a.Array.each(d,function(a,b){e.push(b)}),c.setContact(e,b),c.focus(b)},cancel:function(){c.focus(b)}})}function l(a,b){var c=this,d=c.data,e=c.event;a||(a=d.get({status:"inputChoose"}));var f=d.get({component:a});return!f&&b&&e.createRev(a),d.get({component:a})}function m(a){var b=this,c=b.data;if(N.contactCorrect){a||(a=c.get({status:"inputChoose"}));var d=b.getContact("build",a),e=c.change;if(e.composeInfo){var f="separate"==a?"to":a;if(!M.isEqual(d,e.composeInfo[f])){e.composeInfo[f]=d;for(var g=c.get({component:a}),h=g.get("array"),i=[],j=0;j<h.length;j++)i.push(h[j].address);var k={"var":{input:i},callback:function(c){b.remindShow(a,c)}};b.action.contactCorrect(k)}}}}function n(b,c){var d=this,e=d.base,f=d.data;d.module;var g=c.responseText,h=a.Eval.get(g);if(h&&200==h.code){var i=h.data,j=i.wrongbob,k=i.wrongdomain;if(M.isEmpty(j)&&M.isEmpty(k))return;d.fixElement[b]||(d.fixElement[b]={},d.fixElement[b].child={});var l=d.fixElement[b];M.each(j,function(a,b){d.fixData[a]={address:b,type:0}}),M.each(k,function(b,c){if(d.fixData[b])return a.CONTINUE;var e=b.split("@")[0]+"@"+c;d.fixData[b]={domain:c,address:e,type:1}});var m=l.component,n=f.get({component:b});m?(m.empty(),m.show()):(m=a.Element.create("DIV"),m.setClass("bK0"),n.getEl().after(m.dom),l.component=m);var o=a.Element.create("P");o.html(L.t("我们发现您输入的地址可能有误，请选择修改：")),m.append(o.dom),M.each(d.fixData,function(c,e){var f=e.type,g=e.address,h=n.findItem(c);if(!h)return a.CONTINUE;h.setWarn(f);var i=a.Element.create("P"),j=a.Element.create("SPAN");j.html(c+" →");var k=a.Element.create("A");k.attr({href:"javascript:void(0)"}),k.setClass("nui-txt-link");var o=0===f?g:e.domain;k.html(o),k.listen("click",function(e){h.fixWarn({address:g}),d.remindRemove(b,c),a.Event.cancel(e)}),i.append(j.dom),i.append(k.dom),m.append(i.dom);var p=c.toLowerCase();l.child[p]=i}),new a.Link({text:L.t("关闭该提醒功能"),cls:"nui-txt-link",renderTo:m,click:function(){m.empty(),m.hide(),e.setOption({field:"ntes_letter",flag:"remindShow",value:"1"},!0),N.contactCorrect=!1,M.each(d.fixData,function(b){var c=n.findItem(b);return c?(c.fixWarn({address:c.address}),void 0):a.CONTINUE});var b=f.get({status:"remindShowId"});if(b){var c=a.Component._items[b];c.setChecked(!1,!0)}}})}}function o(a,b){var c=this,d=c.fixElement[a];b=b.toLowerCase(),d.child[b].remove(),delete d.child[b],M.isEmpty(d.child)&&(d.component.empty(),d.component.hide())}function p(a){var b=this,c=b.data.get({component:"subject"});try{c.fireRender(),c.setValue(a)}catch(d){}b.module.setText(a)}function q(){var a=this,b=a.data.get({component:"subject"});return b.getValue()}function r(){var a=this,b=a.data.get({component:"scheduleInvitationAddr"});return b.getValue()}function s(){var a=this,b=a.data.get({component:"scheduleInvitationRemind"});return b.getValue()}function t(){var a=this,b=a.data.get({component:"scheduleInvitationStartDay"}),c=b.getValue().split(" ")[0],d=new Date(c);return d}function u(){var a=this,b=a.data.get({component:"scheduleInvitationEndDay"}),c=b.getValue().split(" ")[0],d=new Date(c);return d}function v(){var a=this,b=a.data.get({component:"scheduleInvitationStartDay"}),c=a.data.get({component:"scheduleInvitationStartTime"}),d=b.getValue().split(" ")[0],e=new Date(d);return e.setHours(0),e.getTime()+c.getValue()}function w(){var a=this,b=a.data.get({component:"scheduleInvitationEndDay"}),c=a.data.get({component:"scheduleInvitationEndTime"}),d=b.getValue().split(" ")[0],e=new Date(d);return e.setHours(0),e.getTime()+c.getValue()}function x(){function b(b){return a.Array.map(b||[],function(b,c){var d=new a.Uri(c);return(a.String.encodeHTML(d.name)||d.address)+":"+d.address})}var c=this,d=c.getContact("build","to"),e=c.getContact("build","cc"),f=c.getContact("build","bcc"),g=c.getSubject(),h={},i=c.getScheduleInvitationAddr(),j=c.data.get({component:"isScheduleInvitationTimeAll"}).getChecked(),k=j?1:0,l=c.getScheduleInvitationStartTime(),m=c.getScheduleInvitationEndTime(),n=new Date(l),o=new Date(m);j&&(n.setHours(0,0,0,0),o.setHours(0,0,0,0));var p="0_0",q=a.Ext.ics2schedule?c.getScheduleInvitationRemind():p,r=q.split("_"),s=Number(r[1]),t=Number(r[0]),u=[{action:"EMAIL",interval:s,unit:t}],v=b(d),w=b(e),x=b(f);return h.tos=v,w&&w.length&&(h.ccs=w),x&&x.length&&(h.bccs=x),h.oIcs={summary:g,start:n.getTime(),end:o.getTime()},h.oIcs.allday=k,i&&(h.oIcs.location=i),0!==t&&(h.oIcs.valarmList=u),h}function y(a){var b=this,c=b.data,d=c.get({component:a});return d?d.getChecked():c.get({status:a})}function z(a,b,c){var d=this,e=d.data;e.set({status:a,value:b});var f=e.get({component:a});f||(d.event.extActive(),f=e.get({component:a})),f.setChecked(b,c)}function A(a){var b=this,c=b.data;a?"subject"==a||b.choose(a):a=c.get({status:"inputChoose"});var d=c.get({component:a});d&&d.focus()}function B(a){var b=this,c=b.data;c.set({status:"inputChoose",value:a})}function C(a){var b=this;a||(a=b.data.get({status:"inputChoose"})),b.data.get({component:a}).blur()}function D(b){var c=this,d=c.data,e="iU2",f=" iT1",g=d.get({element:b});g.listen("mouseover",function(){var b=a(this);b.hasClass(e)||b.addClass(f)}),g.listen("mouseout",function(){var b=a(this);b.removeClass(f)})}function E(a){var b=this,c=b.data,d="iU2",e=c.get({element:a});e.addClass(d)}function F(a){var b=this,c=b.data,d="iU2",e=c.get({element:a});e.removeClass(d)}function G(){var a=this,b=a.module;b.base;var c=b.data,d=b.form,e=0;if(c.get({status:"useSeparate"})){var f=d.getContact("build","separate");e+=f?f.length:0}else{var g=d.getContact("build","to"),h=d.getContact("build","cc"),i=d.getContact("build","bcc");e+=g?g.length:0,e+=h?h.length:0,e+=i?i.length:0}return e}try{var H=$L("module.compose.Compose")}catch(I){return I}try{var J=$L("init.SenderList")}catch(I){return I}try{var K=$L("support.AddressSupport")}catch(I){return I}var L=new $I18N("module.compose.ComposeForm"),M=a.Object,N=a.Ext,O=a.Email,P=a.Uri,Q=a.createClass($N("module.compose.ComposeForm"));M.inherit(Q,H),M.extend(Q.prototype,{initialize:b,init:c,setSender:d,getSender:e,addContact:f,setContact:g,getContact:h,removeContact:i,modifyContact:j,showContact:k,getContainer:l,remindValid:m,remindShow:n,remindRemove:o,setSubject:p,getSubject:q,getScheduleInvitationAddr:r,getScheduleInvitationRemind:s,getScheduleInvitationStartTime:v,getScheduleInvitationEndTime:w,getScheduleInvitationData:x,getScheduleInvitationStartDate:t,getScheduleInvitationEndDate:u,getCheckbox:y,setCheckbox:z,addHoverEvent:D,addFocusCls:E,removeFocusCls:F,focus:A,choose:B,blur:C,getAllRecvNum:G})}($,window),function(a){function b(a){var b=this;j.extend(b,{cid:"",did:"",mid:"",tid:"",ids:null,obj:{},con:[]}),k.superClass.initialize.call(b,a)}function c(){var a=this;k.superClass.init.call(a)}function d(a){a=a||{};var b=this;"object"==typeof a.obj&&(b.obj=a.obj,a.obj.id&&(a.cid=a.obj.id)),"string"==typeof a.cid&&(b.cid=a.cid),"string"==typeof a.did&&(b.did=a.did),"string"==typeof a.mid&&(b.mid=a.mid),"string"==typeof a.tid&&(b.tid=a.tid),"object"==typeof a.ids&&(b.ids=a.ids),"object"==typeof a.con&&(b.con=a.con)}function e(a){a=a||{};var b=this;return a.cid?b.cid:a.did?b.did:a.mid?b.mid:a.tid?b.tid:a.ids?b.ids:a.obj?b.obj:a.con?b.con:void 0}function f(){var a;try{a=i.getTime(0)}catch(b){a=new Date}return["c",a.valueOf()].join(":")}try{var g=$L("module.compose.Compose")}catch(h){return h}try{var i=$L("util.Misc")}catch(h){return h}var j=a.Object,k=a.createClass($N("module.compose.ComposeInfo"));j.inherit(k,g),j.extend(k.prototype,{initialize:b,init:c,set:d,get:e,getClientId:f})}($,window),function(a){function b(a){var b=this;u.extend(b,{component:{schedule:null},element:{area:null,year:null,month:null,day:null,hour:null,minute:null,focus:null,info:null},status:{fill:!1,date:null}}),t.superClass.initialize.call(b,a)}function c(){var a=this;t.superClass.init.call(a),a.render()}function d(){var a=this;t.superClass.clear.call(a.element),t.superClass.clear.call(a)}function e(){var b=this,c=b.module,d=b.data,e=b.element;e.area=d.get({element:"schedule"});var f=s.t("发送时间：")+'<select id="'+c.createId("scheduleYear")+'"></select> '+s.t("年")+" "+'<select id="'+c.createId("scheduleMonth")+'"></select> '+s.t("月")+" "+'<select id="'+c.createId("scheduleDay")+'"></select> '+s.t("日")+" "+'<select id="'+c.createId("scheduleHour")+'"></select> '+s.t("时")+" "+'<select id="'+c.createId("scheduleMinute")+'"></select> '+s.t("分")+" "+'<p class="bB0">'+s.t("本邮件将在 ")+'<strong id="'+c.createId("scheduleInfo")+'"></strong>'+s.t(" 发送到对方邮箱")+"</p>"+'<a id="'+c.createId("scheduleFocus")+'" href="javascript:void(0)" hidefocus="hidefocus" style="text-decoration:none;display:none">　</a>';e.area.html(f),new a.Link({cls:"nui-block-close nui-close",icon:"close",renderTo:e.area,click:function(){var a=d.get({component:"schedule"});a.setChecked(!1)}}),e.year=d.get({moduleId:"scheduleYear"}),e.month=d.get({moduleId:"scheduleMonth"}),e.day=d.get({moduleId:"scheduleDay"}),e.hour=d.get({moduleId:"scheduleHour"}),e.minute=d.get({moduleId:"scheduleMinute"}),e.focus=d.get({moduleId:"scheduleFocus"}),e.info=d.get({moduleId:"scheduleInfo"});var g=function(){b.setChange()};a.Array.each(["year","month","day","hour","minute"],function(a,b){e[b].listen("change",g)})}function f(a){a=a||{};var b=this;return"string"==typeof a.status?b.status[a.status]:b.get({status:"date"})}function g(a){a=a||{};var b=0,c=a.year,d=a.month;if(a.date&&(c=a.date.getFullYear(),d=a.date.getMonth()+1),!c||!d)return b;if((0===c%4&&0!==c%100||0===c%400)&&2==d)b=29;else switch(d){case 1:case 3:case 5:case 7:case 8:case 10:case 12:b=31;break;case 2:b=28;break;case 4:case 6:case 9:case 11:b=30}return b}function h(a){a=a||{};var b=this;a.date?(b.set({status:"date",value:a.date}),b.update({sync:!0})):"string"==typeof a.status?b.status[a.status]=a.value:(b.setDefault(a),b.toggle({open:!0}))}function i(){var b=this,c=b.element,d=[];a.Array.each(["year","month","day","hour","minute"],function(a,b){d.push(parseInt(c[b].dom.value,10))});var e=b.getDay({year:d[0],month:d[1]});d[2]>e&&(d[2]=e),d[1]--;var f=new Date(d[0],d[1],d[2],d[3],d[4]);b.set({date:f})}function j(a){var b=this,c=r.getTime(0);return b.fill({date:c}),a?c=a:(c.setDate(c.getDate()+1),c.setHours(0),c.setMinutes(0),c.setSeconds(0,0)),b.set({date:c}),c}function k(){var b=this;return b.get()<=r.getTime(0)?(new a.Msgbox({content:s.t("定时发信时间不能比当前时间早！")}),!1):!0}function l(b){b=b||{};var c=this;c.module;var d=c.element,e=c.data,f=e.get({status:"showSchedule"}),g=!0;if(b.open&&f)return!1;if(b.close&&!f)return!1;if(g){if(f)d.area.hide();else{if(e.get({status:"useSms"}))return new a.Msgbox({title:s.t('抱歉，"定时发信"功能无法与"短信通知"同时使用。')}),!1;if(e.get({status:"showEncrypt"}))return new a.Msgbox({title:s.t('抱歉，"定时发信"功能无法与"邮件加密"同时使用。')}),!1;if(e.get({status:"showNotary"}))return new a.Msgbox({title:s.t('抱歉，"定时发信"功能无法与"邮件存证"同时使用。')}),!1;c.get({status:"date"})||c.setDefault(),d.area.show(),d.focus.show();try{d.focus.dom.focus(),d.focus.dom.blur()}catch(h){}d.focus.hide()}return e.set({status:"showSchedule",value:!f}),!0}return!1}function m(a){a=a||{};var b=this;if(!b.get({status:"fill"})){for(var c=b.element,d=a.date,e=d.getFullYear(),f=e+5;f>e;e++)c.year.append(b.createOption({value:String(e)}));for(var g=1;12>=g;g++)c.month.append(b.createOption({value:String(g)}));for(var h=1;31>=h;h++)c.day.append(b.createOption({value:String(h)}));for(var i=0;24>i;i++)c.hour.append(b.createOption({value:String(i)}));for(var j=0;60>j;j++)c.minute.append(b.createOption({value:String(j)}));b.set({status:"fill",value:!0})}}function n(b){b=b||{};var c=this,d=c.element,e=c.get({status:"date"});if(b.sync)a.Array.each(["year","month","day","hour","minute"],function(a,b){var f,g=d[b];switch(a){case 0:f=e.getFullYear();try{var h=g.dom.options,i=parseInt(h[h.length-1].value,10);f>i&&g.append(c.createOption({value:String(f)}))}catch(j){}break;case 1:f=e.getMonth()+1;break;case 2:f=e.getDate();break;case 3:f=e.getHours();break;case 4:f=e.getMinutes();break;default:f=0}var k=String(f);g.dom.value!=k&&(g.dom.value=k)}),c.update({day:!0}),c.update({info:!0});else if(b.day){var f=d.day,g=c.getDay({date:e}),h=f.dom.options.length;if(g!=h){var i;if(g>h)for(i=h+1;g>=i;i++)f.append(c.createOption({value:String(i)}));else for(i=h;i>g;i--)new a.Element(f.dom.options[i-1]).remove()}}else if(b.info){var j="",k=e.getFullYear(),l=e.getMonth()+1,m=e.getDate(),n=e.getHours(),o=e.getMinutes(),p=r.getTime(0);p.setHours(0,0,0,0);var q=p.getDay();0===q&&(q=7);var t=new Date(e.valueOf());t.setHours(0,0,0,0);var u=t.valueOf()-p.valueOf();switch(u/=864e5){case-2:j=s.t("前天");break;case-1:j=s.t("昨天");break;case 0:j=s.t("今天");break;case 1:j=s.t("明天");break;case 2:j=s.t("后天");break;default:var v=a.Date.getWeek(e);u>=1-q&&7-q>=u?j=s.t("本周")+v:u>7-q&&14-q>=u?j=s.t("下周")+v:u>-7-q&&1-q>u?j=s.t("上周")+v:(k!=p.getFullYear()&&(j=k+s.t("年")),j+=k==p.getFullYear()&&e.getMonth()==p.getMonth()?s.t("本月"):l+s.t("月"),j+=m+s.t("日周")+v)}6>n?j+=s.t("凌晨"):11>n||11==n&&30>o?j+=s.t("早上"):13>n||13==n&&30>o?j+=s.t("中午"):18>n?j+=s.t("下午"):24>n&&(j+=s.t("晚上")),j+=n+" : ",10>o&&(j+="0"),j+=o,d.info.dom.innerHTML=j,$G.environment.isCh||(d.info.dom.innerHTML=[k,l,m].join("-")+" "+[n,o].join(":"))}}function o(a){a=a||{};var b=a.value||"",c=a.text||b,d=document.createElement("option");return d.innerHTML=c,d.value=b,d}try{var p=$L("module.compose.Compose")}catch(q){return q}try{var r=$L("util.Misc")}catch(q){return q}var s=new $I18N("module.compose.ComposeSchedule"),t=a.createClass($N("module.compose.ComposeSchedule")),u=a.Object;u.inherit(t,p),u.extend(t.prototype,{initialize:b,init:c,clear:d,render:e,get:f,getDay:g,set:h,setChange:i,setDefault:j,verify:k,toggle:l,fill:m,update:n,createOption:o})}($,window),function(a){function b(a){var b=this;A.extend(b,{signData:{text:null,card:null,graph:null,linkedin:null},fill:{text:-1,card:-1,graph:-1,linkedin:-1}}),E.superClass.initialize.call(b,a)}function c(){var a=this;E.superClass.init.call(a)}function d(){var a=this,b=a.data;b.get({status:"initSign"})!==!0&&(b.set({status:"initSign",value:!0}),x.getSignList(function(b){var c=!1;b&&(a.set({text:b}),a.selectDefault({text:!0})),c=a.getStationery(),$S("isFree")?a.getCardList(function(b){a.set({card:b}),c||a.selectDefault({card:!0})}):$S("isVip")&&a.getGraphList(function(b){a.set({graph:b}),c||a.selectDefault({graph:!0})}),D.linkedin&&y.getSign(function(b){b&&(b.id=1,a.set({linkedin:[b]}),a.selectDefault({linkedin:!0}))})}))}function e(a){var b=this,c=b.signData;a.text?c.text=a.text:a.card?c.card=a.card:a.graph?c.graph=a.graph:a.linkedin&&(c.linkedin=a.linkedin)}function f(a){var b=this,c=b.signData;return a.text?c.text:a.card?c.card:a.graph?c.graph:a.linkedin?c.linkedin:void 0}function g(b){var c=this,d=null;return b.call=function(c,e){return b["default"]&&(e.isDefault||e.defaultCard)||b.index==c||b.id==e.id?(d=e,a.BREAK):void 0},c.each(b),d
}function h(){var a=this;return a.base,a.data,a.form,!1}function i(b){var c=this,c=this,d=c.base,e=B.get({field:"ntes_compose",flag:"card"});if("1"==e||"2"==e){var f=d.getCallName(function(a){"success"==a.result&&b(a.msg)},!0),g=a.String.uriAddParam(C.getUrl("compose_ecard",!0),"callback=window."+f);return a.Ajax.request({url:g,requestType:a.Ajax.SCRIPT}),!0}return!1}function j(b){var c=this,d=c.base,e=d.getCallName(function(a){a&&a.length&&b(a)},!0),f=a.String.uriAddParam(C.getUrl("compose_graphsign"),"func=window."+e);a.Ajax.request({url:f,charset:"gbk",requestType:a.Ajax.SCRIPT})}function k(b){var c=this,d=c.get(b);d&&a.Array.each(d,b.call)}function l(b){var c=this,d=c.base,e=c.data,f=c.getItem(b);if(f){var g=e.get({status:"useSign"})||{};if(b.text){g.text=f;var h=f.content;!f.isHtml&&h&&(h=a.String.escapeHTML(f.content)),c.fillText(h)}else if(b.card)g.card==f||(g.card=f,c.attach.cardSync(f)),c.fillCard(f.html);else if(b.graph)g.graph=f,c.fillGraph(f.str);else if(b.linkedin){g.text=f;var h=f.content;c.fillText(h)}return b["default"]&&(g["default"]=f,d.changeSync()),e.set({status:"useSign",value:g}),!0}return!1}function m(a){var b=this,c=b.form,d=b.data,e=b.editor;if(!c.getCheckbox("text")){var f=d.get({status:"fromEntry"});if("compose"==f);else if("reply"==f||"forward"==f){if("reply"==f&&"1"==B.get({field:"ntes_option",flag:"replySign"}))return;if("forward"==f&&"0"==B.get({field:"ntes_option",flag:"forwardSign"}))return}else{if("timeset"!=f)return"draft"==f?void 0:"edit"==f?void 0:void 0;if(b.fillHas())return;if(a.card&&b.attach.cardHas())return}if(!d.get({status:"useSign"})){var g=b.fillData(a);if(-1!=g?a.id=g:a["default"]=!0,b.select(a),"compose"==d.get({status:"fromEntry"})){var h=e.get();d.set({status:"defaultContent",value:h})}}}}function n(a){var b=this,c=b.editor,d=!1;if(a){var e="";if(a.text?e="spnEditorSign":a.card?e="divEditorGraphSign":a.graph&&(e="divNeteaseMailCard"),e)try{var f=c.get({id:e});f&&f.dom.innerHTML&&(d=!0)}catch(g){}}else(b.fillHas({text:!0})||b.fillHas({card:!0})||b.fillHas({graph:!0}))&&(d=!0);return d}function o(a){var b=this,c=b.fill;if("boolean"==typeof a.text&&a.text)return c.text;if("number"==typeof a.text)b.fill.text=a.text;else{if("boolean"==typeof a.card&&a.card)return c.card;if("number"==typeof a.card)c.card=a.card;else{if("boolean"==typeof a.graph&&a.graph)return c.graph;if("number"==typeof a.graph)c.graph=a.graph;else{if("boolean"==typeof a.linkedin&&a.linkedin)return c.linkedin;"number"==typeof a.linkedin&&(c.linkedin=a.linkedin)}}}}function p(b){var c=this,d=c.editor;if(b==a.String.stripTags(b)&&(b=b.replace(/ /g,"&nbsp;"),b=b.replace(/\n/g,d.getBreakLine(1))),-1!=b.indexOf("$date$")){var e=w.getTime(!0),f=a.Date.format(e,z.t("yyyy年M月d日"));b=b.replace(/\$date\$/g,f)}b="<p style='margin: 0'>--</p>"+b+'<div style="clear:both"></div>';var g=d.get({html:!0});if(-1!=g.indexOf("spnEditorSign"))try{var h=d.get({id:"spnEditorSign"});h&&h.html(b)}catch(i){}else g=[g,d.getBreakLine(5),'<div id="spnEditorSign" style="position:relative;zoom:1">',b,"</div>"].join(""),d.set(g)}function q(a){var b=this,c=b.editor,d=c.get({html:!0});if(-1!=d.indexOf("divNeteaseMailCard"))try{var e=c.get({id:"divNeteaseMailCard"});e&&e.html(a)}catch(f){}else d=[d,c.getBreakLine(5),'<div id="divNeteaseMailCard">',a,"</div>"].join(""),c.set(d)}function r(a){var b=this,c=b.editor,d=c.get({html:!0});if(-1!=d.indexOf("divEditorGraphSign"))try{var e=c.get({id:"divEditorGraphSign"});e&&e.html(a)}catch(f){}else d=[d,c.getBreakLine(5),'<div id="divEditorGraphSign">',a,"</div>"].join(""),c.set(d)}function s(a,b){var c=this,d=c.editor,e=d.get({html:!0});if(-1!=e.indexOf("dvLetterAngle"))try{var f=d.get({id:"dvLetterAngle"});f&&f.html(a)}catch(g){}else{var h,e=d.get({html:!0}),i='<div id="dvLetterAngle">'+a+"</div>",j='<div id="spnEditorSign" style="position:relative;zoom:1"></div>';h=0===b?[e,d.getBreakLine(5),i,j]:[e,d.getBreakLine(5),j,i],e=h.join(""),d.set(e)}}function t(){var a=this;try{var b=$L("interface.OptionInterface",this)}catch(c){return c}b.showSignList(function(b){b&&a.fillText(b)})}try{var u=$L("module.compose.Compose")}catch(v){return v}try{var w=$L("util.Misc")}catch(v){return v}try{var x=$L("support.OptionSupport")}catch(v){return v}try{var y=$L("product.Linkedin")}catch(v){return v}var z=new $I18N("module.compose.ComposeSign"),A=a.Object;a.Function;var B=a.Ud,C=a.Uri,D=a.Ext,E=a.createClass($N("module.compose.ComposeSign"));A.inherit(E,u),A.extend(E.prototype,{initialize:b,init:c,load:d,set:e,get:f,getItem:g,getStationery:h,getCardList:i,getGraphList:j,each:k,select:l,selectDefault:m,fillHas:n,fillData:o,fillText:p,fillCard:q,fillGraph:r,fillLetterAngle:s,showCustom:t})}($,window),function(a){function b(a){var b=this;o.extend(b,{atData:{},menuShow:!1}),r.superClass.initialize.call(b,a)}function c(){var a=this;r.superClass.init.call(a),a.initComplete()}function d(){}function e(b){var c=this,d=c.atData,e=b.split(",");a.Array.each(e,function(a,b){d[b]=!0})}function f(a){var b=this,c=b.atData;c[a]=null}function g(a){var b=this,c=b.editor,d=b.form,e=c.editorCmpt;b.addEmail(a.address),e.insertAtNode(a),d.addContact([a],"to")}function h(){if(a.Ext.composeAt){var b=this,c=b.atData,d=b.editor,e=d.editorCmpt,f=[];if(!a.Object.isEmpty(c)){var g=e.doc.getElementsByTagName("SPAN");a.Array.each(g,function(a,b){var d=b.getAttribute("ntes_mm_email");d&&c[d]===!0&&f.push(d)})}return f.join(",")}}function i(){function b(b){var c=p.getEmails(b,"Email");c.match.length>0&&a.Array.each(c.match,function(a,b){i.addItem(b)})}function c(a,b){if(a.length>0&&(a=a.substr(1)),""===a)return b.toString();var c;try{var c=b.name,d=b.email,e=c.toLowerCase(),f=d.toLowerCase()}catch(g){return}a=q.trim(a).toLowerCase();var h=d;if(c&&(h='"'+c+'"<'+d+">"),""===a)return h;if(1==a.length){if(0===f.indexOf(a)||0===e.indexOf(a)||b.fpy&&0===b.fpy.indexOf(a))return h}else if(f.indexOf(a)>-1||e.indexOf(a)>-1||b.py&&b.py.indexOf(a)>-1||b.fpy&&b.fpy.indexOf(a)>-1)return h}function d(b){var c=k[b].CONTACTS,d=n.getEmails(c);a.Array.each(d,function(a,b){i.addItem(b)})}function e(a,b){a=q.trim(a).toLowerCase(),a.length>0&&(a=a.substr(1));var c=b.N.toLowerCase();return""===a?null:c.indexOf(a)>-1?!0:void 0}try{var f=$L("support.AddressSupport",this),g=$I("util.AutoComplete")}catch(h){return h}var i=this;try{if(!f.dataInited)return;if(this.autoCompltedInited)return;this.autoCompltedInited=!0;for(var j=f.data.extDataMap.groupArray||[],k=[],l=0,m=j.length;m>l;l++){var o=j[l];if(o.N&&o.CONTACTS&&o.CONTACTS.length){var r=k.length;o.index=r,k[r]=o}}}catch(h){}i.autoComplete=new g({product:"editorat",fill:b,match:c,groupData:k,groupFill:d,groupMatch:e})}function j(b){var c,d,e=this,f=e.data,g=e.form;if(b&&b.wholeText?(c=b.parentNode,d=b.wholeText):"SPAN"==b.tagName&&"@"==b.getAttribute("ntes_mm_email")&&(c=b,d="@"),d&&d.length>=2&&/\s/.test(d[1]))return e.autoComplete&&e.autoComplete._remove(),void 0;if(d&&0===d.indexOf("@")){var h=a(c),i=h.offset(),j=i[1]+h.dom.offsetHeight+0,k=i[0]+h.dom.offsetWidth+0,l=a(g.editor.editorCmpt.iframe).offset(),m=g.editor.editorCmpt.body.scrollTop||0;if(k+=l[0],j+=l[1]-m,"@"==d){var n=[],o=[];f.get({status:"useSeparate"})?o[0]="separate":o=["to","cc","bcc"],a.Array.each(o,function(a,b){var c=g.getContact("suc",b);n=n.concat(c)}),e.autoComplete.data=n}else e.autoComplete.data=null;e.autoComplete.pos=[k,j],e.autoComplete.outerKey=d,e.autoComplete.createMenu()}else{var p=e.autoComplete.div,q=e.autoComplete.table;p&&q&&e.autoComplete._remove()}}function k(b,c){var d,e,f=this;if(b&&b.wholeText?(d=b.parentNode,e=b.wholeText):"SPAN"==b.tagName&&"@"==b.getAttribute("ntes_mm_email")&&(d=b,e="@"),e&&0===e.indexOf("@")){var g=f.autoComplete.div,h=f.autoComplete.table;if(g&&h){f.autoComplete.operate(c);var i=c.keyCode||c.which;(13==i||38==i||40==i)&&(a.Event.cancel(c),a.Event.stop(c))}}}try{var l=$L("module.compose.Compose")}catch(m){return m}try{var n=$L("component.emailinput.EmailContainer")}catch(m){return m}var o=a.Object;a.Function,a.Ud;var p=a.Uri;a.Ext;var q=a.String,r=a.createClass($N("module.compose.ComposeAt"));o.inherit(r,l),o.extend(r.prototype,{initialize:b,init:c,load:d,addEmail:e,getEmail:h,removeEmail:f,addItem:g,initComplete:i,fireKeyup:j,fireKeydown:k})}($,window),function(a){function b(a){var b=this;D.extend(b,{component:{category:null},element:{content:null,btn:null,list:null,page:null}}),G.superClass.initialize.call(b,a)}function c(){var a=this;a.element,G.superClass.init.call(a)}function d(){var a=this;G.superClass.clear.call(a.element),G.superClass.clear.call(a)}function e(b){var c=this,d=c.data,e=d.letterpaper;if(c.element,c.component,!e.category){var f=E.getUrl("letterpaper_get")+"&categoryValue=&pageSize=11";return a.Ajax.jsonp(f,function(a){e.category=a.category,"string"!=typeof e.curId&&(e.curId=""),e.curCategory=a.curCategory,e.curPage=a.curPage,e.curData=a.letterPaper,e.nonUse=a.nonUse,e.ver=a.date,e.pageSize=a.pageSize,b()},"jsonp"),!1}d.set({status:"initStationery",value:!0})}function f(){var b=this,c=b.data,d=c.letterpaper,e=b.element;if(b.component,c.get({status:"initStationery"})===!0)return!0;if(!d.category){var f=arguments.callee,g=E.getUrl("letterpaper_get")+"&pageSize=11";return a.Ajax.jsonp(g,function(a){d.category=a.category,"string"!=typeof d.curId&&(d.curId=""),d.curCategory=a.curCategory,d.curPage=a.curPage,d.curData=a.letterPaper,d.nonUse=a.nonUse,d.ver=a.date,d.pageSize=a.pageSize,f.call(b)},"jsonp"),!1}e.content=c.get({moduleId:"paperContent"}),e.btn=c.get({moduleId:"paperBtn"}),e.list=c.get({moduleId:"paperList"}),e.page=c.get({moduleId:"paperPage"}),b.fill(),c.set({status:"initStationery",value:!0})}function g(){var a=this,b=a.data,c=b.letterpaper;return c}function h(){var a=this,b=a.getObj();return b.ver||""}function i(){var a=this,b=a.getObj();return b.nonUse}function j(){var a=this,b=a.getObj();return b.pageSize}function k(b){var c=this;if("undefined"==typeof b){var d=c.getObj();return d.category}var e=null,f=c.getCategory();return f&&a.Array.each(f,function(c,d){return d.id==b?(e=d,a.BREAK):void 0}),e}function l(b){var c=this,d=null;if("0"==b)d=c.getNon();else{var e=c.getCurList();a.Array.each(e,function(c,e){return e.id==b?(d=e,a.BREAK):void 0})}return d}function m(){var b=this,c=b.getCurId(),d=[],e=[b.getNon()].concat(b.getCurList());return a.Array.each(e,function(a,b){var e={id:b.id,title:b.name||"",src:b.wmIconUrl||b.iconUrl,active:!1};"0"==b.id&&""===c&&(e.active=!0),b.id==c&&(e.active=!0),d.push(e)}),d}function n(){var a=this,b=a.getObj(),c=b.curId||"";return c}function o(){var a=this,b=a.getObj(),c=b.curData;return c}function p(){var a=this,b=a.getObj(),c=b.curCategory;return c}function q(){var a=this,b=a.getObj(),c=b.curPage;return c}function r(){var a=this,b=a.getCurCategory(),c=b.pageCount;return c}function s(a){var b=this,c=b.getObj();c.curCategory=a.curCategory,c.curPage=a.curPage,c.curData=a.letterPaper}function t(a){var b=this;b.element;var c=b.data,d=b.getObj(),e=b.getVer();d.curId=a,e&&(c.log.letterId=e+"_"+a)}function u(b){var c=this;c.data;var d=c.getObj();c.element;var e=c.component,f=c.getCategory(b);d.curCategory=f,e.category.setText(f.name),c.setCurPage(1),F.cache({cl_stationery_category:b},a.EMPTYFUNC)}function v(b){var c=this,d=E.getUrl("letterpaper_get");d+="&categoryValue="+c.getCurCategory().id,d+="&nextPage="+b,d+="&pageSize="+c.getPageSize(),a.Ajax.jsonp(d,function(a){c.setObj(a),c.render()},"jsonp")}function w(b){var c=this,d=b.index,e=c.getCurPage();if(b.prev||b.next){var f=c.getCurPageCount();b.prev?(d=e-1,1>d&&(d=f)):(d=e+1,d>f&&(d=1))}c.setCurPage(d),F.cache({cl_stationery_page:""+d},a.EMPTYFUNC)}function x(a){function b(b){if(f.html){var g=f.html;b&&(g=g.replace(f.imageUrl,b));var i=g.split("<STATIONERY><STATIONERY>"),k=i[0]+"<STATIONERY>",l="<STATIONERY>"+i[1];h=[k,"<div>",j,"</div>",l].join("")}else h="<div>"+j+"</div>";d.set({html:h});var m=d.get({tag:"STATIONERY"});m?d.focus({element:m}):d.focus(),c.setCurId(e),"function"==typeof a.callback&&a.callback()}var c=this,d=c.editor,e=null,f=null;a.item?(f=a.item,e=f.id):a.id&&(e=a.id,f=c.getItem(e));var g=c.getCurId();if(e==g)return!1;var h="";try{h=d.get({html:!0})}catch(i){}var j="",k=new RegExp("<STATIONERY>","i"),l="<br><br><br><br><br><br><br><br><br><br>";if(""===g&&k.test(h)&&(g="draft"),""===g||"0"==g){j=h;var m=!1;try{var n=d.get({id:"spnEditorSign"});n&&n.innerHTML&&(m=!0)}catch(i){}m||(j+=l)}else{var o=h.split(k);o&&o.length&&o[1]&&(j=o[1],"0"==e&&(j=j.replace(new RegExp(l,"i"),""))),"undefined"!=j&&j||(j=h)}return"custom"==f.imageType?c.attach.stationerySync(f,function(a){a&&b(a)}):(c.attach.stationeryClear(),b()),!0}function y(){var b=this,c=b.module;b.data;var d=c.createId("paperBtn"),e=[],f=b.getCategory();a.Array.each(f,function(a,c){var d={text:c.name,click:function(){c.id!=b.getCurCategory().id&&b.setCurCategory(c.id)}};e.push(d)});var g={renderTo:d,delegateTo:"self",text:C.t("全部"),subclass:"dropdownBtn",menu:{xtype:"menu",groups:[{items:e}]}},h=b.component;h.category=new a.Button(g),b.render()}function z(){var b=this,c=b.element,d=b.getContent();c.list.empty();var e="N0";a.Array.each(d,function(d,f){var g=a.Element.create("LI");g.addClass("dm0");var h=a.Element.create("A");h.addClass("bP0"),h.dom.title=f.title,h.dom.href="javascript:void(0)";var i=a.Element.create("IMG");i.addClass("bR0"),i.dom.src=f.src;var j=a.Element.create("SPAN");j.addClass("bA0"),h.append(i.dom),h.append(j.dom),g.append(h.dom),f.active&&g.addClass(e),h.listen("click",function(){b.select({id:f.id,click:!0});var d=c.list.find("."+e);d&&d.removeClass(e),a(this).addClass("N0"),F.cache({cl_stationery_paper:f.id},a.EMPTYFUNC)}),c.list.append(g.dom)}),c.page.empty();var f=b.getCurPageCount(),g=b.getCurPage();if(f>1){var h=a.Element.create("A");h.dom.href="javascript:void(0)",h.dom.innerHTML=C.t("上页"),h.listen("click",function(){var a={click:!0,prev:!0};b.page(a)}),c.page.append(h.dom)}for(var i=[],j=1;f>=j;j++){var k={text:j+"/"+f,value:j};j==g&&(k.checked=!0),i.push(k)}var l={options:i,subclass:"simpleSelect",delegateTo:"self",renderTo:c.page.dom,selectedchange:function(){var a={click:!0,index:this.value};b.page(a)}},m=b.component;if(m.select=new a.Select(l),f>1){var n=a.Element.create("A");n.dom.href="javascript:void(0)",n.dom.innerHTML=C.t("下页"),n.listen("click",function(){var a={click:!0,next:!0};b.page(a)}),c.page.append(n.dom)}}try{var A=$L("module.compose.Compose")}catch(B){return B}var C=new $I18N("module.compose.ComposeStationery"),D=a.Object,E=a.Uri,F=a.Log,G=a.createClass($N("module.compose.ComposeStationery"));D.inherit(G,A),D.extend(G,{pageLimit:12,pageLimit2:4}),D.extend(G.prototype,{initialize:b,init:c,clear:d,load:f,preLoad:e,getObj:g,getVer:h,getNon:i,getPageSize:j,getCategory:k,getItem:l,getContent:m,getCurId:n,getCurList:o,getCurCategory:p,getCurPage:q,getCurPageCount:r,setObj:s,setCurId:t,setCurCategory:u,setCurPage:v,page:w,select:x,fill:y,render:z})}($,window),function(a,b){function c(a){var b=this;V.extend(b,{saveContact:{}}),bb.superClass.initialize.call(b,a)}function d(){var a=this;bb.superClass.init.call(a)}function e(b,c){var d=this,e=d.base,f=d.module;f.removeChildMod=!0,f._child=null,f.cacheModule=!1,f.cacheByVar=!0;try{d.fillAll(b,c)}catch(g){}if(d.sync(),a.Context.module==f&&a.Frame.setViewType("normal"),e.setPage("success"),d.showJust(),$S("isVip")&&d.vipSms(),Y.smspack)try{d.smsCharge()}catch(g){}}function f(){var b=this;b.base;var c=b.data,d=c.get({component:"sendMsgBox"});if(d)try{d.close(),c.set({component:"sendMsgBox",value:null})}catch(e){}b.setMboxFlag(),a.Tips.show({hidden:!0})}function g(a){var b=this,c=b.data,d=b.module;if(document.body.clientWidth>1440){var e=c.get({moduleId:"succMain"});e.addClass("lc3")}b.fillTop(a);var f=b.fillTips(a);b.fillStamp(a),b.fillContact(a),b.fillAd(),c.get({status:"showNotary"})&&0===d.notary.userpro&&(b.singleNotaryUsed(a),f=!0),f||b.fillAdTips(),"1"==_.get({field:"ntes_compose",flag:"undo_send"})?b.fillCancel(a):b.fillSendAd(a),b.save2YNote(a)}function h(b){var c=b.percent;if(!(!c||"number"!=typeof c||0>c||c>100)){var d=Math.abs(a.Support._getHashCode($S("uid")))%100;d<b.percent?b.hit&&b.hit():b.miss&&b.miss()}}function i(){var b=new Date("2019/05/21 00:00:00").getTime(),c=new Date("2019/06/10 00:00:00").getTime(),d=a.Misc.getTime().getTime();return d>=b&&c>=d}function j(b){var c=this,d=c.module;c.base;var e=c.data,f=c.info,g=e.get({status:"sendParam"}),h=U.t("发送成功");"schedule"==g.action&&(h=U.t("定时发信设置成功"));var i=e.get({moduleId:"succInfo"}),j='<b class="nui-ico se0 pv1"></b>'+h;i.html(j);var k=e.get({moduleId:"succOperate"}),l=f.get({mid:!0});if(l?new a.Link({renderTo:k,tabindex:"1",cls:"je1",text:'<b class="nui-ico se0 ov0"></b>'+U.t("返回该邮件"),click:function(){Z.cache({sl_back:"1"},a.EMPTYFUNC),a.MultiTab.removeTab(function(){d.extend.history?P.entry(d.extend.history):P.entry({id:l,from:"compose"}),c.exit()})}}):new a.Link({renderTo:k,tabindex:"1",cls:"je1",text:'<b class="nui-ico se0 ov0"></b>'+U.t("返回收件箱"),click:function(){Z.cache({sl_inbox:"1"},a.EMPTYFUNC),a.MultiTab.removeTab(function(){N.entry({fid:1}),c.exit()})}}),"deliver"==g.action){var m=f.get({obj:!0});m.saveSentCopy&&(b.saveSentFailed||b.saveSentIgnored||(c.sentLink=new a.Link({renderTo:k,tabindex:"1",cls:"je1",text:'<b class="nui-ico se0 pw1"></b>'+U.t("查看已发邮件"),click:function(){Z.cache({sl_view:"1"},a.EMPTYFUNC),a.MultiTab.removeTab(function(){var a=e.get({status:"saveSentAndDel"});a?N.entry({fid:3}):P.entry({id:b.savedSent.msid?[b.savedSent.msid,b.savedSent.mid].join(":"):b.savedSent.mid}),c.exit()})}})))}new a.Link({renderTo:k,tabindex:"1",cls:"je1",text:'<b class="nui-ico se0 oM0"></b>'+U.t("继续写信"),click:function(){Z.cache({sl_continue:"1"},a.EMPTYFUNC),a.MultiTab.removeTab(function(){M.compose(),c.exit()})}});var n="";if(e.get({status:"vipMember"})){var o=c.getRandomSpeed();n='<div style="color:#C69431;font-size:14px;text-align:center;padding-top:30px;">('+U.t("已为邮箱会员加速，发信仅用")+" "+o.time+" "+U.t("秒，打败")+" "+o.percent+"% "+U.t("的用户")+")</div>"}setTimeout(function(){a(k).append(n)},0)}function k(){var a=[{time:.3,percent:99.9},{time:.4,percent:99.8},{time:.5,percent:99.7},{time:.6,percent:99.5},{time:.7,percent:99.4},{time:.8,percent:99.3},{time:.9,percent:99.2}],b=Math.floor(Math.random()*a.length);return a[b]}function l(b){var c=this,d=c.data,e=c.info,f=d.get({status:"sendParam"}),g=e.get({obj:!0}),h=d.get({moduleId:"succTips"}),i=null,j=null;if("schedule"==f.action){var k=U.t("邮件将在")+a.Date.format(g.scheduleDate,U.t("yyyy年M月d日 H:mm"))+U.t("发送，邮件发送前，暂时保存在");i=[{html:"<span>"+k+"</span>"},{xtype:"link",text:U.t("草稿箱"),click:function(){Z.cache({sl_draft:"1"},a.EMPTYFUNC),N.entry({fid:2})}}]}else if("deliver"==f.action){if(g.saveSentCopy){if(b.saveSentFailed);else if(b.saveSentIgnored){var l=new a.Link({text:U.t("开通会员，享受超大存储空间"),cls:"nui-txt-link",click:function(){try{var a=$L("product.Privileges",this)}catch(b){return b}a.showDialog("plus","","mailbox_capacity1")}}),k="<span>"+U.t("因为邮箱容量已满，未能保存到“已发送”文件夹 ")+l.html().replace("<a",'<a style="text-decoration:none;" ')+"</span>",m="<span>"+U.t("因为邮箱容量已满，未能保存到“已发送”文件夹 ")+"</span>";if((d.get({status:"vipMember"})||$S("isVip"))&&(k="<span>"+U.t("因为邮箱容量已满，未能保存到“已发送”文件夹，请及时清理邮箱")+"</span>"),$S("isVip")){var n=!1,o=$S("attrs").subcos,p=o.split(",");$S("isvip")?a.Array.has(p,"90")&&(n=!0):$S("is188")?a.Array.has(p,"35")&&(n=!0):$S("is126vip")&&a.Array.has(p,"29")&&(n=!0);var q={xtype:"link",text:U.t("升级容量"),click:function(){try{var a=$L("interface.OutlinkInterface",this)}catch(b){return b}a.goOutlink({key:"option_viptype"})}},r={xtype:"link",text:U.t("清理邮件"),click:function(){try{var a=$L("interface.OutlinkInterface",this)}catch(b){return b}a.goOutlink({key:"optimizer_full"})}};i=[{html:m},{html:"<span>"+U.t(" 建议您 ")+"</span>"}],n?i.push(r):(i.push(q),i.push({html:"<span>"+U.t(" 或者 ")+"</span>"}),i.push(r))}else i=[{html:k}];a.Log.cache({ComposeCapacityOverflowOnDeliver:1})}else if(b.saveSentId&&0===$S("attrs").user.save_sent)if(b.savedSent){var k="<span>"+U.t("邮件大小超过了 ")+"<b>1M</b>"+U.t("，正文已保存到“已发送”，附件未保存。")+"</span>";i=[{html:k},{xtype:"link",text:U.t("保存该邮件"),click:function(){Z.cache({sl_save:"1"},a.EMPTYFUNC),c.action.saveSentAndDel({saveMid:b.saveSentId,delMid:b.savedSent.msid?[b.savedSent.msid,b.savedSent.mid].join(":"):b.savedSent.mid,callback:function(b){if(b.code==$){j.hide();var e={renderTo:h,extcls:"sZ1",subclass:"assistBlock",params:"hasClose",content:U.t("保存成功！同时已为你设置发信后邮件全部自动保存。")};new a.Block(e),c.setSaveSend(),d.set({status:"saveSentAndDel",value:!0})}else{var f,g=b["var"][0].code;switch(g){case"FA_MAIL_NOT_FOUND":f=U.t("确认超时，系统未能保存该邮件！");break;case"FA_INVALID_PARAMETER":f=U.t("格式错误，系统未能保存该邮件！");break;default:f=U.t("异常错误，系统未能保存该邮件！")}a.Msgbox.show({title:f})}}})}}]}else{var k="<span>"+U.t("邮件大小超过了 ")+"<b>1M</b>"+U.t("，没有保存到“已发送”，")+"</span>";i=[{html:k},{xtype:"link",text:U.t("保存该邮件"),click:function(){Z.cache({sl_save:"1"},a.EMPTYFUNC),c.action.saveSent({mid:b.saveSentId,callback:function(b){if(b.code==$){j.hide();var d="<span>"+U.t("保存成功！")+'<span class="nui-txt-tips">'+U.t("您可以设置自动保存以后所有已发送邮件")+"</span> </span>",e={renderTo:h,extcls:"sZ1",subclass:"assistBlock",params:"hasClose",items:[{html:d},{xtype:"link",text:U.t("自动保存"),bracket:!0,click:function(){Z.cache({sl_setsave:"2"},a.EMPTYFUNC),c.setSaveSend(this)}}]};new a.Block(e)}else{var f;switch(b.code){case"FA_MAIL_NOT_FOUND":f=U.t("确认超时，系统未能保存该邮件！");break;case"FA_INVALID_PARAMETER":f=U.t("格式错误，系统未能保存该邮件！");break;default:f=U.t("异常错误，系统未能保存该邮件！")}a.Msgbox.show({title:f})}}})}}]}}else{var k="<span>"+U.t("邮件未保存")+"&nbsp;</span>";i=[{html:k},{xtype:"link",text:U.t("设置自动保存"),click:function(){Z.cache({sl_setsave:"1"},a.EMPTYFUNC),O.entry({module:"BaseSetModule",inputName:"afterSendRule"})}}]}if(d.get({status:"showEncrypt"})){var s=c.module.encrypt,k="<span>&nbsp;"+U.t("邮件已加密，密码为：")+'<strong class="nui-txt-impt">'+a.String.escapeHTML(s.get())+"</strong></span>",t={html:k};i?i.push(t):i=[t]}}if(i){var u={renderTo:h,extcls:"sZ1",subclass:"assistBlock",params:"hasClose",items:i};return j=new a.Block(u),h.show(),!0}}function m(){var b=this,c=b.data,d=b.info,e=c.get({status:"sendParam"});if("deliver"==e.action&&Y.stamp){var f=c.get({moduleId:"succStamp"}),g="";a.Array.each(d.get({con:!0}),function(b,c){var d=c.replace(/^.*<|>$/g,"").toLowerCase(),e=d.split("@")[1];return"163.com"==e||"126.com"==e?(g=d,a.BREAK):void 0});var h=ab.getUrl("compose_stamp_get");h+="&mid="+(new Date).valueOf(),g&&(h+="&to="+g);var i=d.get({obj:!0});h+="&subject="+encodeURIComponent(i.subject);var j=a.Element.create("iframe");j.setClass("qg1"),j.attr({frameBorder:0,allowTransparency:!0,tabIndex:"-1",src:h}),f.append(j.dom),f.show()}}function n(c){function d(b){var c=b.name?'"'+b.name+'"<'+b.address+">":b.address;return a.String.escapeHTML(c)}function e(b){var c=a.Event.getTarget(b);try{var d=a.Element.inside(c,n.dom)||a.Element.inside(c,m.getEl().dom);d||(n.hide(),m.getEl().removeClass("lO1"))}catch(e){}}function f(){g.click2Hide||(g.click2Hide=e,a(document).listen("click",g.click2Hide),a(b).listen("blur",g.click2Hide))}var g=this,h=g.data,i=g.info,j=h.get({status:"sendParam"});if("deliver"==j.action){if(c.pabResult){try{L.addExtContact(c.pabResult)}catch(k){}try{a.Array.each(c.pabResult,function(a,b){"added"==b.action&&(g.saveContact[b.item["EMAIL;PREF"].toLowerCase()]=b.item)})}catch(k){}}var l=a.Element.create("DIV");l.setClass("fI1");var m=new a.Link({cls:"cZ1",renderTo:l,tabindex:"1",click:function(){Z.cache({sl_contact:"0"},a.EMPTYFUNC),"none"==n.dom.style.display?(this.getEl().addClass("cA1"),n.show(),f()):(this.getEl().removeClass("cA1"),n.hide())}}),n=a.Element.create("DIV");n.setClass("cY1"),n.css({display:"none"});var o={},p=0,q=i.get({con:!0});a.Array.each(q,function(b,c){if(!c)return a.CONTINUE;var e=ab.matchEmail(c);if(!e)return a.CONTINUE;if(e.key=e.address.toLowerCase(),!o[e.key]){if(o[e.key]=e,e.added=g.saveContact[e.key],e.exist=L.data.extDataMap.email[e.key],e.id="",e.phone="",e.added){var f=e.added;e.id=f.id}else if(e.exist){var f=e.exist[0];e.id=f[W],e.name=L.getGivenName(f),e.phone=f[X]||"",e.groups=f.groups||[]}else p++;e.name==e.address&&(e.name=e.name.split("@")[0]);var h=a.Element.create("DIV");h.setClass("bC1");var i=a.Element.create("SPAN");i.setClass("U1"),i.html(d(e)),h.append(i.dom),n.append(h.dom);var j=null;j=new a.Link({renderTo:h,cls:"T1 nui-txt-cLink",text:e.added||e.exist?'<b class="nui-ico se0 px1"></b>'+U.t("编辑"):'<b class="nui-ico se0 qo1"></b>'+U.t("添加"),click:function(){e.added||e.exist?(Z.cache({sl_edit:"1"},a.EMPTYFUNC),L.contactDialog({type:"modify",addr:{id:e.id},callback:function(a){i.html(d(a))}})):(Z.cache({sl_add:"1"},a.EMPTYFUNC),L.contactDialog({type:"add",addr:{name:e.name,email:e.address},callback:function(a){e.id=a.id,e.added=a,i.html(d(a)),j.update({text:'<b class="nui-ico se0 px1"></b>'+U.t("编辑")});var b='<b class="nui-ico se0 qm1"></b>';g.newCount--,g.newCount>0?(b+=g.newCount+U.t("个收件人不在通讯录中"),g.linkRev=m):b+=U.t("已成功发送到收件人(")+g.allCount+")",m.update({text:b})}}))}}),h.listen("mouseover",function(){h.addClass("dF1")}),h.listen("mouseout",function(){h.removeClass("dF1")})}});var r='<b class="nui-ico se0 qm1"></b>',s=V.count(o);p?(r+=p+U.t("个收件人不在通讯录中"),g.newCount=p,g.allCount=s,g.linkRev=m):r+=U.t("已成功发送到收件人(")+s+")",m.update({text:r});var t=a.Element.create("DIV");t.setClass("br1");var u="",v="0",w="";1==$S("attrs").user.aftersend_saveaddr?(w=U.t("已自动添加到通讯录"),u=U.t("取消自动添加")):(w=U.t("尚未设置自动添加收件人到通讯录"),u=U.t("设置自动添加"),v="1"),new a.Link({id:"compose_success_saveaddr",cls:"T1 nui-txt-cLink",renderTo:t,text:u,click:function(){Z.cache({sl_setaddress:v},a.EMPTYFUNC),g.setSaveAddress(this)}}),$S("isFree")&&$G.environment.isCh&&V.count(o)>=3&&new a.Link({renderTo:t,text:U.t("加入邮件列表"),cls:"T1 nui-txt-cLink",click:function(){Z.cache({sl_list:"1"},a.EMPTYFUNC),g.setMailList(o)}});var x=a.Element.create("SPAN");x.html(w),t.append(x.dom),n.append(t.dom),l.append(n.dom);var y=h.get({moduleId:"succOperate"});y.append(l.dom)}}function o(a){var b=this,c=b.data,d=a.savedSent.msid?[a.savedSent.msid,a.savedSent.mid].join(":"):a.savedSent.mid,e=c.get({moduleId:"succAd"}),f="",g=ab.getUrl("compose_notary_suc")+"&mid="+d;f='<iframe src="'+g+'"  allowTransparency="true" frameborder="0" scrolling="no" width="1px" height="1px"></iframe>',e.after(f)}function p(b,c){c=c||0;var d=1,e=2e3,f=this,g=b.savedSent.msid?[b.savedSent.msid,b.savedSent.mid].join(":"):b.savedSent.mid,h=ab.getUrl("compose_notary_single")+"&mid="+g;a.Ajax.jsonp(h,function(a){var g=a.code;404===g&&d>c&&setTimeout(function(){f.singleNotaryUsed(b,c+1)},e)})}function q(){function b(){gAd.getByCallback("composeTips",{},function(b){var c=b.composeTips||"";if(c){var d=new a.Link({cls:"nui-closeable-x",attrs:' style="top:12px;"',click:function(){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showProduct("noAd","noAd_xxcg"),a(".xH1").hide()}}).html();c='<div class="xH1 nui-closeable">'+c+d+"</div>",e.before(c)}})}if($S("isFree")&&"ud"!=$S("ad").userType){var c=this,d=c.data,e=d.get({moduleId:"succAd"});try{var f=c.info;if(f.get({obj:!0}),a.Ext.secondauthPromote){try{var g=$L("support.OptionSupport",this)}catch(h){return h}g.getSecondauth(function(c){if(c)b();else{var d='<i class="nui-ico nui-ico-remind"></i>'+U.t(" 不要等帐号被盗才后悔！您还未开启登录二次验证，邮箱存在安全隐患，赶快行动！"),f=new a.Link({text:U.t("马上开启"),click:function(){try{var b=$L("interface.OptionInterface",this)}catch(c){return c}b.entry({module:"MailSecurityModule",linkName:"secondauth"}),Z.cache({sl_secondauthPromote:"1"},a.EMPTYFUNC)}}).html(),g=a.Component.html({html:'<a href="javascript:void(0);" class="nui-block-close nui-close"><b class="nui-ico nui-ico-close">x</b></a>',listeners:{click:{handler:function(){a(".xV1").hide()}}}});i='<div class="xV1 nui-textBlock nui-textBlock-err nui-block">'+g+d+f+"</div>",e.before(i),a.Component.setEvents()}})}else b()}catch(h){var i="";e.before(i)}}}function r(){var a=this,b=a.data;a.module;var c=b.get({moduleId:"succAd"}),d="";if($S("isFree"))if("ud"==$S("ad").userType){var e=ab.getUrl("compose_ud_suc",!0);try{var f=a.info.get({con:!0});e+="#n="+f.length}catch(g){}d='<iframe src="'+e+'"  allowTransparency="true" frameborder="0" scrolling="no" width="100%" height="400"></iframe>',c.setClass(""),c.html(d)}else a.renderAdOfFreeUser();else if($S("isVip")){var e=ab.getUrl("compose_vip_suc",!0);try{var f=a.info.get({con:!0});e+="#n="+f.length}catch(g){}d='<iframe src="'+e+'"  allowTransparency="true" frameborder="0" scrolling="no" width="100%" height="400"></iframe>',c.setClass(""),c.html(d)}else gAd.getByCallback("compose",{},function(a){var b=a.compose||"";c.html(b),c.setClass("")})}function s(){var b=this,c=b.data,d=c.get({moduleId:"succAd"}),e="",f=["compose","composeBanner"];document.body.clientWidth>1440&&f.push("composeCenter"),gAd.getByCallback(f,{},function(b){var c=b.compose,f=b.composeBanner,g=b.composeCenter;if(c){var h=new a.Link({cls:"nui-closeable-x",click:function(){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showProduct("noAd","noAd_xxcg"),a(".sE1").hide()}}).html();c='<div class="sE1 nui-closeable">'+c+h+"</div>"}if(f){var h=new a.Link({cls:"nui-closeable-x",click:function(){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showProduct("noAd","noAd_xxcg"),a(".sD1").hide()}}).html();f='<div class="sD1 nui-closeable">'+f+h+"</div>"}if(c&&(e+=c),g){var h=new a.Link({cls:"nui-closeable-x",click:function(){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showProduct("noAd","noAd_xxcg"),a(".Br0").hide()}}).html();g='<div class="Br0 nui-closeable">'+g+h+"</div>",e+=g}f&&(e+=f),e&&d.html(e)})}function t(){}function u(b){var c=new a.Link({cls:"nui-closeable-x",click:function(){try{var a=$L("product.Privileges",this)}catch(c){return c}a.showProduct("noAd","noAd_xxcg"),b&&b()}}).html();return c}function v(c){function d(){var a={tinfo:c.sentTInfo,callback:e,error:f};i.cancelDeliver(a)}function e(c){b.clearInterval(p),l.hide(),a.MultiTab.removeTab(function(){var b={id:c["var"].draftMid,cancel:!0};M.draft(b),a.Tips.show(U.t("发送撤销成功"))})}function f(){m.setText(U.t("重试")),a.Tips.show(U.t("撤销失败，请重试"))}function g(){o>0?(o--,n.html("("+o+")")):(b.clearInterval(p),l.hide(),h.fillSendAd())}var h=this,i=h.action;h.base;var j=h.data,k=j.get({moduleId:"succInfo"}),l=a.Element.create("SPAN");l.css({fontSize:"14px",marginLeft:"5px"}),k.append(l.dom);var m=null,n=null,o=30,p=null;c.sentTInfo?(m=new a.Link({renderTo:l,text:U.t("取消发送"),cls:"nui-txt-link",click:function(){c.saveSentId&&0===$S("attrs").user.save_sent?i.saveSent({mid:c.saveSentId,callback:function(b){if(b.code==$)d();else{var c;switch(b.code){case"FA_MAIL_NOT_FOUND":c=U.t("确认超时，系统未能保存该邮件！");break;case"FA_INVALID_PARAMETER":c=U.t("格式错误，系统未能保存该邮件！");
break;default:c=U.t("异常错误，系统未能保存该邮件！")}a.Tips.show(c)}}}):d()}}),n=a.Element.create("SPAN"),n.setClass("nui-txt-aside"),n.html("("+o+")"),l.append(n.dom),p=b.setInterval(g,1e3)):l.hide()}function w(){if(!$S("isVip")){var b=this,c=b.module,d=b.data,e=d.get({moduleId:"succInfo"}),f=a.Element.create("SPAN");f.css({fontSize:"14px",marginLeft:"12px",verticalAlign:"middle",display:"inline-block",lineHeight:"2em"}),e.append(f.dom);var g,h=R.getMobile();h&&(g=h.address.split("@")[0]);var i,j=null;j=new a.Link({renderTo:f,text:'<b class="nui-ico nui-ico-mobile2" style="display:inline-block;height:20px;width:20px;color:#555555;margin-bottom: 4px;"></b>'+U.t("手机收发邮件更方便"),cls:"nui-txt-link"}),a.Event.listen(j.el.dom,"mouseover",function(){Z.cache({sl_sendyxds1:"1"},a.EMPTYFUNC),i?i.show():i=new a.Layer({renderTo:c.container,pointTo:f,items:[{html:"<div style='text-align:center'><img src='https://mimg.127.net/xm/webmail/img/cmp_yxds2.png' width='102'height='102'/></div>"},{xtype:"component",items:[{html:'<h3 style="font-size:14px;color:#808080;line-height="1em";padding-top:12px;>'+U.t("下载网易邮箱大师")+"</h3>"}]}],params:"hasArr arrUp",doNotHide:!0})}),a.Event.listen(j.el.dom,"mouseleave",function(){i.hide()})}}function x(b){var c=this,d=c.action;c.base;var e=c.data,f=e.get({status:"save2YNote"});if(f){var g=U.t("保存到有道云笔记失败，请手动保存。"),h=b.code;if(h==$){var i=[b.savedSent.msid,b.savedSent.mid].join(":");d.save2YNote({mid:i,callback:function(){a.Tips.show({succ:!0,text:U.t("邮件成功保存到有道云笔记")})},error:function(b){if(h=b.code,"S_PARTIAL_OK"==h){var c=b["var"],d="";if(c&&c.fails&&c.fails.length)for(var e=c.fails,f=0;f<e.length;f++)d+=a.String.escapeHTML(e[f].resource)+"<br/>";a.Msgbox.show({header:U.t("邮件部分保存成功！")+"<br/>"+U.t("以下附件因类型受限，无法保存："),title:d})}else a.Msgbox.show({title:g})}})}else a.Msgbox.show({title:g})}}function y(b){var c=U.t("邮箱参数设置成功");1!=_.get({field:"save_sent"})?_.set({field:"save_sent",value:1,call:function(){b&&b.setText(U.t("取消自动保存")),a.Tips.show({succ:!0,text:c})}}):_.set({field:"save_sent",value:2,call:function(){b&&b.setText(U.t("自动保存")),a.Tips.show({succ:!0,text:c})}})}function z(b){var c=b.getEl(),d=U.t("邮箱参数设置成功"),e=[U.t("设置自动添加"),U.t("取消自动添加")];c.html()==e[1]?_.set({field:"aftersend_saveaddr",value:0,call:function(){c.html(e[0]),a.Tips.show({succ:!0,text:d})}}):_.set({field:"aftersend_saveaddr",value:1,call:function(){c.html(e[1]),a.Tips.show({succ:!0,text:d})}})}function A(a){var b={dp:"addt",t:"m"},c=[];V.each(a,function(a,b){c.push(b.address)}),b.members=c.join(",");try{var d=$L("interface.AddressInterface",this)}catch(e){return e}d.entry({action:"mailgroups",param:b})}function B(){var b=this,c=b.info,d=b.data.get({status:"fromEntry"}),e="";if("reply"==d)e="replied";else{if("forward"!=d)return;e="forwarded"}var f=c.get({mid:!0}),g=c.get({ids:!0});f?N.setReFw(f,e):g&&a.Array.each(g,function(a,b){N.setReFw(b,e)})}function C(){var b=this,c=b.data;b.form,b.info;var d=c.get({moduleId:"succInfo"}),e=a.Element.create("SPAN");d.append(e.dom),T.getNotaryStatus(function(b){b&&(e.css({fontSize:"14px",marginLeft:"5px"}),new a.Link({cls:"nui-txt-link",renderTo:e,text:'<b class="nui-ico nui-ico-sms nui-ico-gzy" style="margin-bottom:2px"></b>'+U.t("公正邮将为您存证")+"</a>",click:function(){try{var b=$L("interface.AppCenterInterface",this)}catch(c){return c}b.gotoApp(147e3),Z.cache({sl_just:"1"},a.EMPTYFUNC)}}))})}function D(){var b=this,c=b.data,d=c.get({status:"sendParam"});if("deliver"==d.action){var e=$I("module.compose.ComposeModule"),f=c.get({moduleId:"succInfo"}),g=a.Element.create("SPAN");g.css({fontSize:"14px",marginLeft:"5px"}),f.append(g.dom),2==e.sms_bind?new a.Link({cls:"nui-txt-link",renderTo:g,text:'<b class="nui-ico nui-ico-sms" style="margin-top:-9px;color:#555555;"></b>'+U.t("短信通知收件人"),click:function(){b.smsPriority("compose_vip_sms")}}):new a.Link({cls:"nui-txt-link",renderTo:g,text:'<b class="nui-ico nui-ico-sms" style="margin-top:-9px;color:#555555;"></b>'+U.t("Ta若回邮件，短信提醒我"),click:function(){Q.goOutLink("eaw",{param:{source:"open_eaw_write2"}})}})}}function E(){var b=this,c=b.data;b.form,b.info;var d=c.get({status:"sendParam"});if("deliver"==d.action){var e=c.get({moduleId:"succInfo"}),f=a.Element.create("SPAN");f.css({fontSize:"14px",marginLeft:"5px",verticalAlign:"middle",display:"inline-block"}),e.append(f.dom),new a.Link({cls:"nui-txt-link",renderTo:f,text:'<b class="nui-ico nui-ico-sms nui-ico-sms" style="margin-bottom: 4px;margin-right:2px;"></b>'+U.t("短信通知收件人"),click:function(){b.smsPriority("compose_sms_flash")}})}}function F(){var b=this,c=b.data,d=b.form,e=b.info;if($G.environment.isCh){var f=c.get({status:"sendParam"});if("deliver"==f.action){var g=e.get({obj:!0});if(1!=g.priority){var h=d.getSender().address,i=h.split("@")[1].toLowerCase();if("163.com"==i||"126.com"==i||"yeah.net"==i){var j=ab.getUrl("compose_sms_free"),k=g.subject,l="multi",m="",n="",o="",p=e.get({con:!0});if(1==p.length){var q=ab.matchEmail(p[0]);if(q&&(l=q.address,!R.isSender(l))){m=q.name;var r=L.getAddrObj(l);r&&(n=r[W],o=r[X]||"");var s,t=R.getMobile(),u="",v=R.getName();try{s=S.getTime(0)}catch(w){s=new Date}var x=s.getHours();if(t){u=t.address;var y=l.split("@");y[0];var z=y[1].toLowerCase();if("vip.163.com"==z||"vip.126.com"==z||"188.com"==z)return;if(8>x||x>22)return}var A={tid:l,tname:m,mobile:u,tmobile:o,title:k,from:"compose",cid:n,sender:h,sender_nick:v};for(var B in A)j+="&"+B+"="+encodeURIComponent(A[B]);var C=s.valueOf()+"",D=bb.encrypt(C);j+="&mid="+encodeURIComponent(C)+"&sign="+encodeURIComponent(D);var E=c.get({moduleId:"succInfo"}),F=a.Element.create("SPAN");F.css({fontSize:"14px",marginLeft:"5px"}),E.append(F.dom),new a.Link({cls:"nui-txt-link",renderTo:F,text:'<b class="nui-ico nui-ico-sms" style="margin-bottom: 5px;"></b>'+U.t("免费短信通知"),click:function(){a.Msgbox.show({header:U.t("免费短信通知"),width:"546px",contentType:"custom",noFooter:!0,content:'<iframe id="composeSucSmsIframe" src="'+j+'" style="display:block;width:100%;height:270px" scrolling="no" frameborder="0"></iframe>'})}})}}}}}}}function G(b){function c(){var a=document.createElement("FORM");a.action=n,a.method="POST",a.target="composeSucSmsIframe";for(var b in B){var c=document.createElement("INPUT");c.type="hidden",c.name=b;var d;d="tas"==b?JSON.stringify(B[b]):B[b],c.value=d,a.appendChild(c)}document.body.appendChild(a),a.submit()}var d,e=this,f=e.info,g=f.get({obj:!0}),h=R.getName();try{d=S.getTime(0)}catch(i){d=new Date}for(var j={compose_sms_priority:{title:U.t("免费短信通知"),height:"320px"},compose_sms_flash:{title:U.t("短信通知收件人"),height:"320px"},compose_vip_sms:{title:U.t("短信通知收件人"),height:"265px",width:"528px"}},k=d.valueOf()+"",l=bb.encrypt(k),m=g.subject,n=ab.getUrl(b),o=j[b],p=o.title,q=f.get({con:!0}),r=q.length,s=[],t=0;r>t;t++){var u=q[t],v=null,w=ab.getEmails(u,"Email");if(1==w.match.length){v=w.match[0];var x=v.address,y=v.name,z={tauid:x,receiver_nick:y},A=L.getAddrObj(x);A&&(z.cid=A[W],z.mobile=A[X]||"",V.isArray(z.mobile)&&(z.mobile=z.mobile[0])),s.push(z)}}a.Msgbox.show({header:p,contentType:"custom",noFooter:!0,width:o.width,content:'<iframe id="composeSucSmsIframe"  name="composeSucSmsIframe" src="about:blank" style="display:block;width:100%;height:'+o.height+'" scrolling="no" frameborder="0"></iframe>'});var B={mid:k,title:m,tid:l,sender_nick:h,muti:"true",from:"compose",tas:s};c()}function H(){try{a.Msgbox.msgbox.destroy()}catch(b){}var c=this,d=c.data,e=d.get({moduleId:"succTips"});e.hide()}function I(a){var b="",c="";a=a.substr(1);for(var d=a.length,e=0;d>e;e++){var f=e;1==e?f=4:4==e&&(f=1),b=(a.charCodeAt(f)<<1)+e,c+=String.fromCharCode(b)}return c}try{var J=$L("module.compose.Compose")}catch(K){return K}try{var L=$L("support.AddressSupport")}catch(K){return K}try{var M=$L("interface.ComposeInterface")}catch(K){return K}try{var N=$L("interface.MboxInterface")}catch(K){return K}try{var O=$L("interface.OptionInterface")}catch(K){return K}try{var P=$L("interface.ReadInterface")}catch(K){return K}try{var Q=$L("init.CustomAppManager")}catch(K){return K}try{var R=$L("init.SenderList")}catch(K){return K}try{var S=$L("util.Misc")}catch(K){return K}try{var T=$L("init.Support")}catch(K){return K}var U=new $I18N("module.compose.ComposeSuccess"),V=a.Object;a.Function;var W=a.EMAIL_ID,X=a.EMAIL_PHONE,Y=a.Ext,Z=a.Log,$=a.S_OK,_=a.Ud,ab=a.Uri,bb=a.createClass($N("module.compose.ComposeSuccess")),cb={initialize:c,init:d,render:e,sync:f,fillAll:g,fillTop:j,fillTips:l,fillStamp:m,fillContact:n,fillAdTips:q,fillNotary:o,fillAd:r,fillSendAd:w,fillCancel:v,getCloseLink:u,singleNotaryUsed:p,getRandomSpeed:k,save2YNote:x,setSaveSend:y,setSaveAddress:z,setMailList:A,setMboxFlag:B,showJust:C,vipSms:D,smsCharge:E,smsActive:F,smsPriority:G,smsClose:H,abtest:h,isABTestTime:i,exit:t,renderAdOfFreeUser:s};V.inherit(bb,J),V.extend(bb.prototype,cb),V.extend(bb,{encrypt:I})}($,window),function(a,b,c){function d(a){var b=this;W.superClass.initialize.call(b,a)}function e(){var a=this;W.superClass.init.call(a)}function f(){var c=this,d=c.module,e=d.event,f=d.data,g="showContact",h=O.t("显示通讯录");"1"!=S.get({field:"ntes_global",flag:"compose_showContacts"})&&(g="hideContact",h=O.t("隐藏通讯录"));var i={groups:[{items:[{xtype:"button",tabindex:"1",text:O.t("发送"),subclass:"mainBtn",icon:{type:"sent",subtype:"white"},click:function(){e.fireBar({func:"deliver",pos:"top"})}}]},{items:[{xtype:"button",text:O.t("预 览"),hidden:"ch"!=$G.environment.lang,tabindex:"1",click:function(){e.fireBar({func:"preview"})}}]},{items:[{xtype:"button",text:O.t("存草稿"),tabindex:"1",click:function(){e.fireBar({func:"save",pos:"top"})}}]},{items:[{xtype:"button",text:O.t("取 消"),tabindex:"1",click:function(){e.fireBar({func:"cancel"})}}]},{items:[{xtype:"link",text:O.t("创建属于您的网易群邮"),cls:"nui-txt-link hn1",tabindex:"2",click:function(){c.__markt_tool_tips_layer__&&(c.__markt_tool_tips_layer__.destroy(),c.__markt_tool_tips_layer__=null);var d="compose_market_tool_entry_tips_showed"+$S("uid");a.LocalStorage.set(d,"1"),U.cache({Compose_market_tool_entry_click:1},a.EMPTYFUNC);var e=a.Uri.getUrl("marketTool",!0);b.open(e,"_blank")}}]},{items:[{xtype:"link",text:O.t("贺卡"),cls:"nui-txt-link",icon:"greetingcard",hidden:!T.compose_card,tabindex:"2",click:function(){e.fireBar({func:"card"}),U.cache({cl_card:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"link",text:O.t("明信片"),icon:"postcard",cls:"nui-txt-link",hidden:!T.compose_card,rightBracket:"<span style='margin-left:6px;' class='nui-txt-aside'>|</span>",tabindex:"2",click:function(){e.fireBar({func:"postcard"}),U.cache({cl_postcard:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"link",text:O.t("抄送"),cls:"nui-txt-link",title:O.t("同时将这封邮件发给其他联系人"),tabindex:"1",click:function(){e.setCc({toggle:!0,click:!0}),U.cache({cl_cc:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"link",text:O.t("密送"),cls:"nui-txt-link",title:O.t("同时将这封邮件发给其他联系人，但收件人和抄送人不会看到密送人"),tabindex:"1",click:function(){e.setBcc({toggle:!0,click:!0}),U.cache({cl_bcc:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"link",text:O.t("群发单显"),cls:"nui-txt-link",title:O.t("会对多个人一对一的发送， 每个人将单独收到发给他/她的邮件"),tabindex:"2",click:function(){e.setSeparate({toggle:!0,click:!0}),U.cache({cl_separate:1},a.EMPTYFUNC)}}],type:"ext"},{items:[{xtype:"link",text:O.t("日程邀请"),hidden:!a.Ext.ics2,cls:"nui-txt-link",title:O.t(""),tabindex:"1",click:function(){e.toggleScheduleInvitation()}}],type:"ext"},{items:[{xtype:"button",icon:"setting",title:O.t("写信设置"),tabindex:"2",subclass:"roundBtn",click:function(){this._menu_||(this._menu_=new a.Menu(c.getOption()),this._menu_.attachTo({clickFrom:this.getEl(),delegateTo:"self"}),this._menu_.fire("attachToShow"))}}],type:"ext"},{items:[{xtype:"button",icon:g,title:h,tabindex:"2",subclass:"roundBtn",click:function(){var b=S.get({field:"ntes_global",flag:"compose_showContacts"}),d="1",e=O.t("显示通讯录"),g="showContact";"1"==b&&(d="0",e=O.t("隐藏通讯录"),g="hideContact");var d="1"==b?"0":"1";c.base.setOption({field:"ntes_global",flag:"compose_showContacts",value:d}),this.update({icon:g,title:e});var h=f.get({status:"showContactsId"});if(h){var i=a.Component._items[h];i.setChecked("0"===d,!0)}}}],type:"ext"}]},j="";try{var k=new a.Toolbar(i);j=k.html(),f.set({component:"toolbar",value:k})}catch(l){}return j}function g(){var b=this.module,c=b.base,d=b.data,e=b.event,f=2!=S.get({field:"ntes_htmlbar"})?!0:!1,g="1"==S.get({field:"ntes_compose",flag:"compose_nav"})?!0:!1,h="1"!=S.get({field:"ntes_global",flag:"compose_showContacts"})?!0:!1,i=S.get({field:"ntes_compose",flag:"upload_mode"}),j="0"==S.get({field:"ntes_option",flag:"replySign"})?!0:!1,k="1"==S.get({field:"ntes_option",flag:"forwardSign"})?!0:!1,l="1"!=S.get({field:"ntes_option",flag:"signPosition"})?!0:!1;"1"==S.get({field:"ntes_option",flag:"requirereceipt"})?!0:!1;var m=S.get({field:"save_sent"}),n=1==S.get({field:"aftersend_saveaddr"})?!0:!1,o="0"==S.get({field:"ntes_letter",flag:"remindShow"}),p=b.createId("compose-settings-remindShow"),q=b.createId("compose-settings-showContacts");d.set({status:"remindShowId",value:p}),d.set({status:"showContactsId",value:q});var r;r=[{text:O.t("如果对方邮箱不支持20M以上普通附件，使用超大附件"),checked:"0"==i||"1"==i,click:Q.bind(c.setOption,c,{field:"ntes_compose",flag:"upload_mode",value:"0"})},{text:O.t("附件超过50M才使用超大附件"),checked:"2"==i,click:Q.bind(c.setOption,c,{field:"ntes_compose",flag:"upload_mode",value:"2"})},{text:O.t("不支持多文件同时上传，其他模式异常时使用"),checked:"3"==i,click:Q.bind(c.setOption,c,{field:"ntes_compose",flag:"upload_mode",value:"3"})}];var s={xtype:"menu",extcls:"nui-settingMenu",delegateTo:"self",reverse:!0,groups:[{items:[{text:O.t("正文工具栏"),extText:{xtype:"checkbox",subclass:"switch",text:O.t("已显示"),unCheckText:O.t("已隐藏"),value:1,checked:f,checkedchange:function(a){var b=a?1:2;c.setOption({field:"ntes_htmlbar",value:b})}}},{text:O.t("左侧栏"),hidden:!0,menu:{groups:[{items:[{text:O.t("展开"),checked:g,click:Q.bind(c.setOption,c,{field:"ntes_compose",flag:"compose_nav",value:"1"})},{text:O.t("折叠 (默认)"),checked:!g,click:Q.bind(c.setOption,c,{field:"ntes_compose",flag:"compose_nav",value:"0"})}],checkType:"radio"}]}},{text:O.t("右侧通讯录"),extText:{xtype:"checkbox",subclass:"switch",text:O.t("已显示"),unCheckText:O.t("已隐藏"),value:1,checked:h,id:q,checkedchange:function(a){var b=a?"0":"1";c.setOption({field:"ntes_global",flag:"compose_showContacts",value:b})}}},{text:O.t("收件人域名检查与提示"),extText:{xtype:"checkbox",subclass:"switch",text:O.t("已开启"),id:p,unCheckText:O.t("已关闭"),checked:o,checkedchange:function(a){var b=a?"0":"1";c.setOption({field:"ntes_letter",flag:"remindShow",value:b})}}},{text:O.t("附件上传方式"),menu:{extcls:"nui-settingMenu sT1",groups:[{items:r,checkType:"radio"}]}},{text:O.t("回复时添加签名"),extText:{xtype:"checkbox",subclass:"switch",text:O.t("已开启"),unCheckText:O.t("已关闭"),value:1,checked:j,checkedchange:function(a){var b=a?"0":"1";c.setOption({field:"ntes_option",flag:"replySign",value:b})}}},{text:O.t("转发时添加签名"),extText:{xtype:"checkbox",subclass:"switch",text:O.t("已开启"),unCheckText:O.t("已关闭"),value:0,checked:k,checkedchange:function(a){var b=a?"1":"0";c.setOption({field:"ntes_option",flag:"forwardSign",value:b})}}},{text:O.t("回复转发时签名位置"),doNotHide:!0,extText:{xtype:"checkgroup",checkType:"radio",checkedchange:function(a){c.setOption({field:"ntes_option",flag:"signPosition",value:a})},items:[{value:"0",text:O.t("原文上方"),checked:l,subclass:"btn"},{value:"1",text:O.t("原文下方"),checked:!l,subclass:"btn"}]}},{text:O.t("邮件撤回"),extText:{xtype:"checkbox",subclass:"switch",text:O.t("已开启"),unCheckText:O.t("已关闭"),value:!0,checked:T.letterRecall,checkedchange:function(a){try{var b=$L("support.OptionSupport",this)}catch(c){return c}b.setWithDraw(a)}}},{text:O.t("发信后自动保存邮件"),menu:{extcls:"nui-settingMenu",groups:[{items:[{text:O.t("保存小于1M的邮件和大于1M邮件的正文"),checked:0===m,click:Q.bind(c.setOption,c,{field:"save_sent",value:0})},{text:O.t("全部保存到“已发送”文件夹"),checked:1==m,click:Q.bind(c.setOption,c,{field:"save_sent",value:1})},{text:O.t("不保存"),checked:2==m,click:Q.bind(c.setOption,c,{field:"save_sent",value:2})}],checkType:"radio"}]}},{text:O.t("发信后自动保存联系人"),extText:{xtype:"checkbox",subclass:"switch",text:O.t("已开启"),unCheckText:O.t("已关闭"),value:1,checked:n,checkedchange:function(a){var b=a?"1":"0";c.setOption({field:"aftersend_saveaddr",value:b})}}},{text:O.t("默认使用群发单显"),hidden:$S("isFree"),extText:{xtype:"checkbox",subclass:"switch",text:O.t("已开启"),unCheckText:O.t("已关闭"),value:1,checked:"1"==S.get({field:"ntes_compose",flag:"separate_default"}),checkedchange:function(a){var b=a?"1":"2";S.set({field:"ntes_compose",flag:"separate_default",value:b});var c={};a?c.show=!0:c.hide=!0,e.setSeparate(c)}}},{text:O.t("发件人设置"),click:function(){U.cache({cl_account:1},a.EMPTYFUNC);try{var b=$L("interface.OptionInterface",this)}catch(c){return c}b.entry({module:"AccountCenterModule",exit:!1,inputName:"SectionSenderManage"})}},{text:O.t("签名设置"),click:function(){U.cache({cl_sign:1},a.EMPTYFUNC);try{var b=$L("interface.OptionInterface",this)}catch(c){return c}b.entry({module:"SignModule",exit:!1})}},{text:O.t("更多设置"),gap:"before",click:function(){U.cache({cl_more:1},a.EMPTYFUNC);try{var b=$L("interface.OptionInterface",this)}catch(c){return c}b.entry({module:"BaseSetModule",exit:!1})}}]}]};return s}function h(){var a=this,b=a.module,c=b.createId("header"),d='<header id="'+c+'" class="qa0">'+a.getRev("to")+a.getSubject()+a.getAttach()+"</header>";return d}function i(b){var c=this,d=c.module;d.base;var e=d.form,f={xtype:"emailcontainer",key:b,tabIndex:1,title:O.t("发给多人时地址请以分号隔开"),inputLable:O.t("收件人地址输入框，请输入邮件地址，多人时地址请以分号隔开"),choose:!0,containerfocus:function(){e.choose(b),e.addFocusCls(b)},containerblur:function(){e.removeFocusCls(b),a.Ext.contactCorrect&&e.remindValid(b)},containerupdate:function(){var a=e.getAllRecvNum();a>=21&&c.showMaketToolTips()}};f.tips={text:O.t("输入对方手机号，就能给他发邮件")},f.domain="163.com",a.Ext.contactCorrect&&(f.itemwarnremove=function(a){e.remindRemove(b,a)});var g={text:O.t("收件人"),cls:"nui-txt-link",title:O.t("点击添加收件人"),click:function(){U.cache({cl_rev:b},a.EMPTYFUNC),e.showContact(b)}},h=O.t("收件人"),i="";try{var j=new a.Link(g);h=j.html();var k=new M(f);i=k.html(),d.data.set({component:b,value:k})}catch(l){}var m=d.createId(b),n='<div id="'+m+'" class="kZ0 eB0">'+'<label class="fn0">'+h+O.t("：")+"</label>"+'<div class="dG0">'+'<div class="bz0">'+i+"</div>"+"</div>"+'<div class="gH1"></div>'+"</div>";return n}function j(){var b=a(".hn1"),c=this,d="compose_market_tool_entry_tips_showed"+$S("uid"),e=a.LocalStorage.get(d);return e?void 0:(c.__markt_tool_tips_layer__&&c.__markt_tool_tips_layer__,U.cache({Compose_market_tool_tips_show:1},a.EMPTYFUNC),c.__markt_tool_tips_layer__?(c.__markt_tool_tips_layer__.show(),void 0):(c.__markt_tool_tips_layer__=new a.Layer({renderTo:b,params:"arrUp",extcls:"dM1",hasClose:!0,doNotHide:!0,content:'<span style="font-size: 14px;color: #333333;">'+O.t("网易群邮为您提供群邮模版、客户联系人管理以及群邮数据反馈，为您提供更高效的邮件群发服务。")+"</span>",listeners:{closeclick:function(){c.__markt_tool_tips_layer__.destroy(),c.__markt_tool_tips_layer__=null,a.LocalStorage.set(d,"1"),U.cache({Compose_market_tool_tips_close:1},a.EMPTYFUNC)}}}),void 0))}function k(){var b=this,c=b.module,d=c.form,e=c.data,f=c.createId("subjectInput"),g={tabIndex:1,ariaLabel:O.t("邮件主题输入框，请输入邮件主题"),maxLength:"256",voiceInput:!0,inputId:f,listeners:{focus:function(){d.addFocusCls("subject")},blur:function(){c.setText(this.getValue()),d.removeFocusCls("subject")}}},h="";try{var i=new a.Input(g);h=i.html(),e.set({component:"subject",value:i})}catch(j){}var k=c.createId("subject"),l='<div id="'+k+'" class="kZ0 fu0">'+'<label class="fn0" for="'+f+'"><span class="cr1">'+O.t("主　题")+"</span>：</label>"+'<div class="dG0">'+'<div class="bz0">'+h+"</div>"+"</div>"+'<div class="gH1"></div>'+"</div>";return l}function l(){var b=this,c=b.module,d=c.attach,e=c.event,f=c.assist,g={xtype:"menu",groups:[{items:[{text:O.t("从“网盘/超大附件”添加"),click:function(){d.msg("file"),U.cache({cl_nfcloud:"1"},a.EMPTYFUNC)}},{text:O.t("从“往来附件”添加"),click:function(){d.msg("internal"),U.cache({cl_internal:"1"},a.EMPTYFUNC)}}]}]};T.ynote&&g.groups[0].items.push({text:O.t("从“有道云笔记”添加"),click:function(){d.msg("ynote"),U.cache({cl_ynote:"1"},a.EMPTYFUNC)}}),(R.ie()||R.firefox()||R.chrome())&&g.groups.push({items:[{text:O.t("拖拽添加"),click:function(){f.get({status:"dragSupport"})?e.setDragArea({toggle:!0}):f.setup("new"),U.cache({cl_drag:"1"},a.EMPTYFUNC)}}]});var h={xtype:"link",icon:"dArr",tabindex:"-1",cls:"nui-txt-link ca0",listeners:{click:function(){if(!this.menuInit){this.menuInit=!0;var b=new a.Menu(g);b.attachTo({clickFrom:this.getEl()}),b.fire("attachToShow")}}}},i="";try{var j=new a.Link(h);i=j.html()}catch(k){}var l=c.createId("attachUpload"),m='<iframe id="'+l+'"  name="'+l+'" src="about:blank" style="display:none"></iframe>',n="3G",o=O.t("点击添加附件");if($S("cloud")){var p=$S("cloud").fileSizeLimit;n=a.Number.convert(p),$S("isFree")&&(o=O.t("一次可发送2000张照片，600首MP3，一部高清电影"))}$S("isVip")&&(n+='<b class="nui-ico nui-ico-tequan" style="margin-top:-2px;margin-left:2px;margin-right:2px;"></b>');var q="",r="",s="";$S("isFree")&&(T.mobile_upload||(s='<a id="'+c.createId("attachDashi")+'" href="https://mail.163.com/dashi/activity/gift/index.jsp?from=fj"  title="'+O.t("邮箱大师领15G超大附件")+'" class="nui-txt-link cm1" target="_blank">'+O.t("邮箱大师领15G超大附件")+"</a>"));var t=b.createOtherEntryHTML(),u="";if(T.newYearCard){var v=new a.Link({text:O.t("发春节贺卡"),cls:"nui-txt-link nui-txt-imptLink",attrs:' style="float: left;margin-top: 10px;color: #C00!important;"',title:O.t("发春节贺卡"),click:function(){c.newYearLetter(),a.Log.cache({cl_new_year:"1"},a.EMPTYFUNC)}});u=v.html()}var w='<div class="ia0"><div id="'+c.createId("attachOperate")+'" class="fv0">'+'<a href="javascript:void(0)" id="'+c.createId("attachAdd")+'"  title="'+o+'" class="cb0 nui-txt-link"><b class="nui-ico nui-ico-cmpAttach"></b>'+O.t("添加附件")+"</a>"+r+'<span id="'+c.createId("attachSize")+'" class="nui-txt-tips" style="float: left;margin-top:12px;margin-right:4px;'+q+'">('+O.t("单文件最大")+'<strong class="nui-txt-impt">'+n+"</strong>)</span>"+i+s+t+u+'<div id="'+c.createId("attachProgress")+'" 	class="cH0"></div>'+m+'<div id="'+c.createId("attachBrowser")+'" title="'+o+'"	class="by0 ej1" style="display:none;"></div>'+'<div id="'+c.createId("attachBrowserCloud")+'" title="'+O.t("添加超大附件")+'" class="by0 ci1" style="display:none;"></div>'+'<div id="'+c.createId("attachDrag")+'"  		class="R0" style="display:none;">'+'<a id="'+c.createId("attachDragClose")+'" href="javascript:void(0)" class="nui-ico nui-ico-x" hidefocus="hidefocus"><b class="nui-ico nui-ico-close">x</b></a>'+O.t("请把文件拖放到这个区域，就可作为附件添加。")+"</div>"+"</div>"+'<div id="'+c.createId("attachArea")+'" class="bs0">'+'<div id="'+c.createId("attachContent")+'" class="D0"></div>'+"</div>"+"</div>";return w}function m(){var b="compose_ppt_entry_"+$S("uid"),c=a.LocalStorage.get(b),d='<span class="cs0">|</span>',e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAAYCAMAAACCyC6UAAAAtFBMVEXMAgDMAwDRCQDMAgAAAADMAgD////icG/RGxricnHRGRj++/v77u7SIB/ODQzfY2LXOjn0ysrojIzfYF/QFRTNBAP66OjcUVDbSknaRUTPERDOCgn99vb429v21tb21NTxubnuq6vsoqLmgoLjdXTUJyb9+Pj439/10NDyvr7vsrLuqqrtp6frnZ3rm5vplZXlgYDgZWTeWlnVLy7zxMTywsLpkZHniIjkeXjhbm3YQD/WNDMFNBBzAAAABXRSTlPmphztAPMTpaIAAAEwSURBVDjLndTJcoJAGATgAe0/xEFFQGVxQ8F9N3ve/70yA6EStgP0pYua+ar6wrC2qjDUCFPUNlNbqJmWyhTUjsJYfdTEACnqaT3EES0+ZGzYnd+zuDwtj55o48vu0LP8kBngRPG9IxmyXkdFxM1/yHIcx8CYLIjodAXgr5dFdOLff6ib7OLynkHbF1Eu3Ysomm6HOYSdXLQaXXkPeOd2EWkufeRRSA9gsDRoLGqAEoTzJErRdDabWUBEIWy6D/ULPL4qRd5ol6KzaZpfADYLWGJWMMWYjFIkDvrZebhM/KOYdaPumz4sRwj0RxY55Opilka3eYAK1NH3WeRPDvGs+Z76VQgWJSjsi8g9i3U8y+SkVSIsEhTHA/BJB4i4NEcG1UtzxBqYRr97o4el0RP2A3HKJq3E5XnJAAAAAElFTkSuQmCC",f=['<span  style="position:relative;">',O.t("PPT模版"),c?"":'<img src="'+e+'" style="position:absolute;top:-4px;right:-28px;width:26px;height:12px;">',"</span>"].join(""),g=new a.Link({text:f,cls:"nui-txt-link cm1 App-compose-attach-ppt-entry",title:O.t("PPT模版"),click:function(){var c=this;try{var d=$L("interface.OutlinkInterface",this)}catch(e){return e}d.goOutlink({key:"ppt_template",fullScreen:!0,group:"ppt_template"}),a.LocalStorage.set(b,"1",{expires:999999,domain:$S("fullDomain")});var f=c.el.find("img");f&&f.remove(),a.Log.cache({Comopose_PPT_click:1})}}),h=[d,g.html()];return h.join("")}function n(){var b=this,c=b.event,d=b.getScheduleInvitationTime(),e=a.Ext.ics2schedule?b.getScheduleInvitationRemind():"",f=b.getScheduleInvitationAddr(),g=[d,e,f].join(""),h=new a.Link({cls:"nui-block-close nui-close bt2",icon:"close",click:function(){c.toggleScheduleInvitation()}}),i=h.html(),j='<div class="dc2">'+i+g+"</div>";return j}function o(){function b(b,c){var d=b.rawConfig.options,e=a.Array.has(d,function(a){return a.value===c});if(e)b.setValue(c);else{var f=b.menu?b.menu.find("menuitem"):null;a.Array.each(f,function(a,b){b.setChecked(!1)})}}var c=this,d=c.module,e=c.data,f=d.createId("scheduleInvitationTime"),g=d.createId("scheduleInvitationStartDay"),h=new Date,i=h.getHours(),j=h.getMinutes(),k=i+1+j/60>=23.5,l=i+j/60>=23.5,m=null,n=1e3*60*(60*i+j),o=n;k&&(o=0,m=new Date,m.setDate(m.getDate()+1));var p=c.createDatePicker({id:"startDate",x:80,y:-130,type:"start",defaultDate:l?m:null}),q=c.createDatePicker({id:"endDate",x:80,y:-130,type:"end",defaultDate:k?m:null}),r=c.createTimeSelector(0,null,function(a,d){d.setValue(c.TSToTime(a)),d.__prevValue=d.getValue(),b(r,a),c.updateEndTimeSelector()}),s=c.createTimeSelector(o,function(b){if(k&&!l){var c=!1,d=36e5,e=24*d;a.Array.each(b,function(a,b){!c&&b.value+e-n>=d&&(b.checked=!0,c=!0)})}else b.length>=3?b[2].checked=!0:b[b.length-1].checked=!0},function y(y,a){y>=r.getValue()?(a.setValue(c.TSToTime(y)),a.__prevValue=a.getValue(),b(s,y)):a.setValue(a._prevValue)}),t=new a.Checkbox({name:"isScheduleInvitationTimeAll",value:"1",text:O.t("全天"),checked:!1,checkedchange:function(a){r.setDisabled(a),s.setDisabled(a)}});e.set({component:"scheduleInvitationStartDay",value:p}),e.set({component:"scheduleInvitationEndDay",value:q}),e.set({component:"scheduleInvitationStartTime",value:r}),e.set({component:"scheduleInvitationEndTime",value:s}),e.set({component:"isScheduleInvitationTimeAll",value:t});var u='<span class="cd3">'+O.t("到")+"</span>",v=[p.html(),r.html(),u,q.html(),s.html(),t.html()].join(""),w=c.getFormLabel(g,O.t("时  间")),x=c.getFormItem(f,w,v,!1);return x}function p(){var b=this,c=b.module,d=b.data,e=c.createId("scheduleInvitationRemind"),f=c.createId("scheduleInvitationRemindSelect"),g={width:$G.environment.isCh?"100px":"120px",options:[{text:O.t("不提醒"),value:"0_0"},{text:O.t("日程开始时"),value:"1_0"},{text:O.t("10分钟前"),value:"1_10",checked:!0},{text:O.t("30分钟前"),value:"1_30"},{text:O.t("1小时前"),value:"2_1"},{text:O.t("1天前"),value:"3_1"},{text:O.t("1周前"),value:"4_1"}],selectedIndex:3,selectedchange:function(b){var c="";switch(b){case"0_0":c="ComposeICSRemindSelected_NoRemind";break;case"1_0":c="ComposeICSRemindSelected_WhileBegin";break;case"1_10":c="ComposeICSRemindSelected_Before10Min";break;case"1_30":c="ComposeICSRemindSelected_Before30Min";break;case"2_1":c="ComposeICSRemindSelected_Before1Hour";break;case"3_1":c="ComposeICSRemindSelected_Before1Day";break;case"4_1":c="ComposeICSRemindSelected_Before1Week"}var d={};d[c]=1,a.Log.cache(d)}},h="";try{var i=new a.Select(g);h=i.html(),d.set({component:"scheduleInvitationRemind",value:i})}catch(j){}var k=b.getFormLabel(f,O.t("提  醒")),l=b.getFormItem(e,k,h,!1);return l}function q(){var b=this,c=b.module,d=b.data,e=c.createId("scheduleInvitationAddr"),f=c.createId("scheduleInvitationAddrInput"),g="",h={tabIndex:1,ariaLabel:O.t("添加地址"),placeholder:O.t("添加地址"),maxLength:"256",voiceInput:!0,inputId:f,width:"468px",listeners:{blur:function(){var a=this,b=a.getValue();b.length>140&&a.showTips(O.t("字数过多，最多支持140个字"))}}};try{var i=new a.Input(h);g=i.html(),d.set({component:"scheduleInvitationAddr",value:i})}catch(j){}var k=b.getFormLabel(f,O.t("地  点")),l=b.getFormItem(e,k,g,"bH2");return l}function r(a,b){var c=['<label class="fn0" for="'+a+'">','<span class="cr1">'+b+"</span>：","</label>"].join("");return c}function s(a,b,c,d){var e="";d=d||"";var e=['<div id="'+a+'" class="kZ0 fu0">',b,'<div class="'+d+'">','<div class="bz0">',c,"</div>","</div>",'<div class="gH1"></div>',"</div>"].join("");return e}function t(b){function c(){var c=this;if(!c.calendar){var h={popupRenderTo:a(e.container).find(".tH0"),fixX:b.x,fixY:b.y,focus:b.date,filterFn:function(){return!0},onselect:function(e){var h=f.get({component:"scheduleInvitationStartDay"}),i=f.get({component:"scheduleInvitationEndDay"}),j=e.getTime(),k=a.Date.format(e,"yyyy-MM-dd"),l=a.Date.getWeek(e,0),m=k+" "+O.t("周")+l,n=g.getScheduleInvitationEndTime(),o=g.getScheduleInvitationStartTime(),p=new Date(n);p.setHours(0,0,0,0),n=p.getTime(),"start"===b.type&&j>=n?(h.setValue(m),i.setValue(m)):"end"===b.type&&o>j?(h.setValue(m),i.setValue(m)):c.setValue(m),c.focus(),d.updateEndTimeSelector()}};c.calendar=new a.Calendar(h),c.calendar.el=c.getEl()}setTimeout(function(){c.calendar.getLayer().show()},0)}var d=this,e=d.module,f=d.data,g=d.form,h=b.defaultDate||new Date,i=a.Date.format(h,"yyyy-MM-dd"),j=a.Date.getWeek(h,0),k=i+" "+O.t("周")+j,l=new a.Input({id:e.createId("dateTimeInput_"+b.id),width:$G.environment.isCh?"110px":"140px",placeholder:"yyyy-MM-dd",value:k||"",iconBtn:"calendar",iconbtnclick:c,keydown:function(a){a.preventDefault()}});return l}function u(){var b=this;b.module;var c=b.data,d=b.form,e=c.get({component:"scheduleInvitationEndTime"}),f=c.get({component:"scheduleInvitationStartTime"}),g=c.get({component:"isScheduleInvitationTimeAll"}),h=d.getScheduleInvitationStartDate(),i=d.getScheduleInvitationEndDate(),j=g.getChecked();if(!j){var k=f.getValue(),l=h.getTime()===i.getTime()?k:0,m=e.getValue(),n=!1,o=b.getTimeSelectOptions(l);a.Array.each(o,function(a,b){b.value===m&&(b.checked=!0,n=!0)}),n||(o[0].checked=!0),e.update({options:o})}}function v(b,d,e){function f(){p.getEl().css({position:"absolute",top:"0px",left:"0px",bottom:"0px",border:"none",overflow:"hidden",paddingLeft:"0px",paddingRight:"0px",marginRight:"0px",backgroundColor:"#fff"});var a=h.TSToTime(o._originGetValue());p.setValue(a)}function g(){return{xtype:"input",width:"36px",click:function(){},focus:function(){p._prevValue=p.getValue(),setTimeout(function(){p.getEl().find("input").dom.focus()},100)},blur:function(){var a=h.timeToTS(p.getValue());a===c?p.setValue(p._prevValue):e(h.timeToTS(p.getValue()),p)}}}var h=this,i=h.getTimeSelectOptions(b),j=new Date,k=new Date;k.setHours(0,0,0,0);var l=j.getTime()-k.getTime(),m=18e5;d?d(i):a.Array.each(i,function(a,b){var c=b.value-l;c>0&&m>c&&(b.checked=!0)});var n={options:i,selectedchange:function(a){e&&e(a,p)}},o=new a.Select(n),p=o.add(g());return o._input=p,p.listen("afterRender",function(){f()
}),o.listen("afterRender",function(){o.getEl().css({position:"relative"}),o.add(p)}),o.listen("update",function(){o.remove(p.getEl().dom.id),p=o.add(g()),o._input=p,f()}),o.listen("destroy",function(){o._input=null}),o._originGetValue=o.getValue,o.getValue=function(){var a=o._input.getValue();return h.timeToTS(a)},o}function w(b){var c=(b/36e5).toString().split("."),d=Number(c[0]||"0"),e=b%36e5/6e4;return[a.Number.format(d,2),a.Number.format(e,2)].join(":")}function x(a){if(!a)return c;var b=a.split(":"),d=b[0],e=b[1],f=Number(d),g=Number(e),h=0;return d&&!isNaN(f)&&f>=0&&23>=f?(h=1e3*3600*f,e&&!isNaN(g)&&g>=0&&59>=g?h+=1e3*60*g:c):c}function y(a){a=a||0;for(var b=18e5,c=2*b,d=[],e=0;24>e;e++){var f=e>=10?e:"0"+e,g=e*c,h=g+b;g>=a&&d.push({text:f+":00",value:g}),h>=a&&d.push({text:f+":30",value:h})}return d}function z(){var a=this,b=a.module,c=b.data;b.action,b.editor,b.layoutInit();var d=c.layout.editorHeight,e=b.createId("editor"),f=N.mode.BASIC;1==S.get({field:"ntes_letter",flag:"editorToolbar"}),2==S.get({field:"ntes_htmlbar"})&&(f=N.mode.HIDE);var g={editMode:f,width:"100%",height:d+"px"},h=!1,i={};T.human_trans||(h=!0,i.translate=1),T.notary||(h=!0,i.notary=1),h&&(g.btnNoShow=i);var j=new N(g);c.set({component:"editor",value:j});var k='<section class="pY0"><div id="'+e+'" >'+j.html()+"</div>"+"</section>";return k}function A(){var a=this,b=a.module,c=b.createId("notary"),d='<div id="'+c+'" class="nui-block gn0 dl0" style="display:none"></div>';return d}function B(){var a=this,b=a.module,c=b.createId("schedule"),d='<div id="'+c+'" class="nui-assistBlock nui-block gn0" style="display:none"></div>';return d}function C(){var a=this,b=a.module,c=b.createId("encrypt"),d='<div  id="'+c+'" class="nui-assistBlock nui-block gn0" style="display:none"></div>';return d}function D(){var a=this,b=a.module,c=b.createId("ext"),d='<div id="'+c+'" class="mT0" style="display:none">'+'<div class="gm0"></div>'+a.getNotary()+a.getSchedule()+a.getEncrypt()+"</div>";return d}function E(){function b(b,c,d){var e=this;if(!P.isEqual(e.value,b)||d){var f="",g=b.name;if(g=a.String.escapeHTML(g),f=g?'<span class="bk0">'+a.String.encodeHTML(g)+"</span>"+'<span class="bf0">&lt;'+b.address+"&gt;</span>":'<span class="bf0">'+b.address+"</span>",f+=' <b class="nui-ico nui-ico-unfold"></b>',c)return f;e.setText(f),e.value=b}}function c(a){var b=L.getUid(),c=L.getMobile(),d=!1;return a==b.address&&(d=!0),null!==c&&a==c.address&&(d=!0),d}function d(a,b){var c=f(a,b);g.senderMenu.update(c)}function e(b){var c=[];try{var e=L.getList(),f=b;f||(f=L.getDefault()),a.Array.each(e,function(b,e){var g=a.String.encodeHTML(e.toString()),j={xtype:"menuitem",id:h.createId(e.address),text:g,click:function(){if(a.Log.cache({cl_switchsender:"1"},a.EMPTYFUNC),T.notary&&i.get({status:"showNotary"})){var b=L.getUid(),c=L.getMobile(),f=!1,g=e.address;g==b.address&&(f=!0),null!==c&&g==c.address&&(f=!0),f?n.setValue(e):new a.Msgbox({type:"confirm",title:O.t("邮件存证仅对邮箱主帐号或关联的手机号码邮箱有效，切换到其他发件人无效，是否继续切换？"),okText:O.t("继续切换"),ok:function(){n.setValue(e);var a=i.get({component:"notary"});a.setChecked(!1)},cancel:function(){}})}else n.setValue(e),d(e,!0)}};e.address==f.address&&(j.checked=!0),c.push(j)})}catch(g){f=new a.Email($S("uid"))}return c}function f(b,d){var f=e(b),h="";L.getList();var i=b;i||(i=L.getDefault()),h=i.name;var j=c(i.address),k={xtype:"component",hidden:!j,extcls:"yI0",items:[{xtype:"label",text:O.t("发信昵称:")},{xtype:"label",text:h},{xtype:"label",text:" "},{xtype:"input",hidden:!0,width:"100px",maxLength:12,value:h,listeners:{click:{handler:function(){a.Event.cancelBubble()}}}},{xtype:"link",cls:"nui-txt-link",text:O.t("修改"),click:function(){var b=this,c=b.getRoot().find("input")[0];if(b.getText()==O.t("修改")){var d=b.getRoot().find("label")[1];c.show(),c.select(),d.hide(),b.update({text:O.t("确定")}),a.Event.cancelBubble()}else{var f=a.String.trim(c.getValue());if(f){try{var h=$L("support.OptionSupport",this)}catch(j){return j}h.setDisplayName(f,function(){var b=new V(i.address,f);n.setValue(b,!1,!0);var c=g.senderMenu,d=c.find("menuitem"),h=e(b);a.Array.each(d,function(b,c){a.Array.each(h,function(b,d){return c.id==d.id?(c.update(d),a.BREAK):void 0})});var j=c.find("link");if(j&&j.length>0){var k=j[0],l=c.find("input")[0];l.hide();var m=c.getRoot().find("label")[1];m.show(),m.setText(f),l.setValue(m.getText()),k.update({text:O.t("修改")})}c.rawConfig.hiddenTime=1e3,c.setHiddenOnMouseOut()})}a.Event.cancelBubble()}}}]},l={xtype:"menu",hidden:d,groups:[{items:f,checkType:"radio"},{items:[k,{text:O.t("设置发件人昵称"),hidden:j,click:function(){try{var a=$L("interface.OptionInterface",this)}catch(b){return b}a.entry({module:"AccountCenterModule",exit:!1,inputName:"SectionSenderManage",address:i.address})}}]}],listeners:{hide:function(){var a=this,b=a.find("link");if(b&&b.length>0){var c=b[0];if(c.getText()!=O.t("修改")){var d=a.find("input")[0];d.hide();var e=a.getRoot().find("label")[1];e.show(),d.setValue(e.getText()),c.update({text:O.t("修改")})}}}}};return l}var g=this,h=g.module,i=h.data;h.event;var j="";try{var k=L.getDefault(),l=f(),m={cls:"nui-txt-link cp0",tabindex:"2",title:O.t("发件人地址，点击可以设置发件人"),text:b(k,!0),click:function(){},listeners:{afterRender:function(){var b=this;b.menu=new a.Menu(l);var c=a("#"+h.createId("main"));b.menu.attachTo({clickFrom:b.getEl(),renderTo:c}),g.senderMenu=b.menu}}},n=g._SenderLink=new a.Link(m);i.set({component:"sender",value:n}),n.value=k,n.setValue=b,n.getValue=function(){return this.value},j=n.html(),a.Listener.listen("options:nonEssentialNameModify",function(){var b=L.getList();a.Array.each(b,function(a,b){b.address==n.value.address&&n.setValue(b),d(b,!0)})})}catch(o){}var p='<div class="ec0"><span class="cz0">'+O.t("发件人：")+"</span>"+j+"</div>";return p}function F(b){var c=this,d=b.ui.container.dom;new a.Link({text:O.t("取消"),cls:"nui-txt-link",click:function(){}}),new a.Link({text:O.t("立即查看"),cls:"nui-txt-link",click:function(){}}),["<div>","<p>",O.t("PDF 格式转换上线了，点击立即体验。"),"</p>","<div>",O.t("PDF 格式转换上线了，点击立即体验。"),"</div>","</div>"].join(""),c.__pdf_convert_tips__=new a.Layer({renderTo:d,params:"arrUp",extcls:"iY2",hasClose:!0,doNotHide:!0,content:"<div><p>"+O.t("PDF 格式转换上线了，点击立即体验。")+"</p><div></div></div>",listeners:{closeclick:function(){c.__pdf_convert_tips__.destroy(),c.__pdf_convert_tips__=null}}})}function G(){var b=this,c=b.module,d=c.data,e=c.event,f=new a.Button({xtype:"button",text:O.t("发送"),subclass:"mainBtn",tabindex:"1",icon:{type:"sent",subtype:"white"},click:function(){e.fireBar({func:"deliver",pos:"bottom"})}}),g=new a.Button({xtype:"button",tabindex:"1",text:O.t("&nbsp;取 消&nbsp;"),click:function(){e.fireBar({func:"cancel",pos:"bottom"})}}),h=new a.Link({text:O.t("更多发送选项 ")+'<b class="nui-ico">j</b>',cls:"nui-txt-link",click:function(){e.extActive()}});d.set({component:"extLink",value:h});var i='<footer class="jp0">'+f.html()+g.html()+'<div class="iu1">'+b.getSender()+'<div class="fq0"><span>|</span>'+h.html()+"</div></div>"+"</footer>";return i}function H(){var a=this,b=a.module,c=b.createId("succ"),d='<div id="'+c+'" class="frame-main-cont-body frame-main-cont-body-noToolbar nui-scroll uY0" style="display:none;top:0px;">'+'<section id="'+b.createId("succMain")+'" class="sQ1">'+'<h1 id="'+b.createId("succInfo")+'" 	class="tK1" tabindex="1" role="tooltip"></h1>'+'<div id="'+b.createId("succTips")+'" style="display:none;"></div>'+'<div id="'+b.createId("succStamp")+'" style="display:none;"></div>'+'<div id="'+b.createId("succOperate")+'" class="py1" role="navigation" tabindex="1" aria-label="'+O.t("发送成功快速导航")+'"></div>'+'<div id="'+b.createId("succAd")+'"class="tA1"></div>'+"</section>"+"</div>";return d}function I(){var a=this,b=a.module,c=b.createId("toolbar"),d=b.createId("main"),e='<header id="'+c+'" class="frame-main-cont-head">'+a.getToolbar()+"</header>"+'<div id="'+d+'"class="frame-main-cont-body nui-scroll">'+'<section class="tH0">'+a.getHeader()+a.getEditor()+a.getExtend()+a.getFooter()+"</section>"+"</div>"+a.getSuccess();return e}try{var J=$L("module.compose.Compose")}catch(K){return K}try{var L=$L("init.SenderList")}catch(K){return K}try{var M=$L("component.emailinput.EmailContainer")}catch(K){return K}try{var N=$L("component.editor.Editor")}catch(K){return K}var O=new $I18N("module.compose.ComposeView"),P=a.Object,Q=a.Function,R=a.Browser,S=a.Ud,T=a.Ext,U=a.Log,V=a.Email,W=a.createClass($N("module.compose.ComposeView")),X={initialize:d,init:e,getToolbar:f,getOption:g,getHeader:h,getRev:i,getSubject:k,getAttach:l,createOtherEntryHTML:m,createScheduleInvitation:n,getScheduleInvitationTime:o,getScheduleInvitationRemind:p,getScheduleInvitationAddr:q,getFormLabel:r,getFormItem:s,createDatePicker:t,createTimeSelector:v,getTimeSelectOptions:y,updateEndTimeSelector:u,TSToTime:w,timeToTS:x,getEditor:z,getExtend:D,getNotary:A,getSchedule:B,getEncrypt:C,getSender:E,getFooter:G,getSuccess:H,getHtml:I,showMaketToolTips:j,PDFConvertTips:F};P.inherit(W,J),P.extend(W.prototype,X)}($,window),function(a){function b(a){var b=this;q.superClass.initialize.call(b,a)}function c(){var a=this;q.superClass.init.call(a)}function d(a){var b=this;a||(q.superClass.initProcess.call(b,"native"),b.initInput())}function e(){var a=this;s.getInfo();var b=a.data,c=a.sourceGet("element"),d=a.createInput();d.listen("change",function(){var b=d.dom.files;if(b.length){b=r.toArray(b),a.nativeSelect(b);try{d.dom.value=""}catch(c){}}}),c.browser.append(d.dom),c.browser.show(),c.input=d,b.set({status:"uploadMode",value:"native"})}function f(){var b=this,c=s.getInfo();b.data,b.sourceGet("element");var d=a.Element.create("input");return d.setClass("O0"),d.attr({type:"file",size:"1",multiple:!0}),"windows"==c.os&&s.safari()&&d.attr({multiple:!1}),d}function g(){var a=this,b=a.sourceGet("element");b.input.dom.click()}function h(b,c){var d=this,e=[];a.Array.each(b,function(a,b){var f=b.name||b.fileName,g=0;"number"==typeof b.size?g=b.size:"number"==typeof b.fileSize&&(g=b.fileSize);var h=d.fileCreate({type:"native",name:f,size:g,cloud:c});if(b.lastModifiedDate)try{h.modtime=b.lastModifiedDate.valueOf()}catch(i){}h.blob=b,b.inlined&&(h.inlined=h.context=!0),e.push(h)}),d.filterCheck({files:e,submit:function(b){a.Array.each(b.select,function(a,b){b["delete"]=function(){d.fileRemove(b),b["delete"]=null},d.add(b)}),d.fileAutoUpload()},cancel:function(){}})}function i(b,c){var d=this,e=d.attach;if(d.getCheck(b)){var f=d.nativeGet(b);if(!f)return;f.onreadystatechange=function(){4==f.readyState&&(f.onreadystatechange=null,200==f.status?d.check(b,f.responseText)&&(d.fileUpload(b),d.netCheckSet(b)):d.error(b,"JS_HTTP",f.status,"check")?d.nativeCheck(b,{code:"JS_HTTP",reason:f.status}):d.resum(b))};var g=d.getUploadProxy({type:"native",file:b,options:"body",check:!0},c);f.open(a.Ajax.POST,g,!0),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(b.options)}else b.cloud?(b.err="retryErrorBig",e.filterFail([b])):d.fileUpload(b),d.netCheckSet(b)}function j(b,c){var d=this,e=d.nativeGet(b);if(e)if(e.upload&&(e.upload.onprogress=function(a){a.lengthComputable&&d.setBytes(b,a.loaded,a.total)}),e.onreadystatechange=function(){switch(e.readyState){case 1:d.setStart(b);break;case 2:d.setFinish(b);break;case 4:if(e.onreadystatechange=null,e.upload&&(e.upload.onprogress=null),d.netCheckClear(),b.blob)if(200==e.status){var a=d.complete(b,e.responseText);if(a.code==t)a["continue"]&&(d.fileUpload(b),d.netCheckSet(b));else if(a.retry){var c={code:a.code};d.fileRetry(b,c)}else d.resum(b)}else if(b.abort)b.abort=!1;else if(d.error(b,"JS_HTTP",e.status)){var c={code:{code:"JS_HTTP",reason:e.status}};d.fileRetry(b,c)}else d.resum(b)}},d.getUploadHost()){var f=b.blob,g=!1;if((f.slice||f.mozSlice||f.webkitSlice)&&(g=!0),b.skipSplit)b.useSplit=!1,b.offset=0,b.length=0;else if(g){b.useSplit=!0,b.length=o.sliceLength,b.offset+b.length>b.size&&(b.length=b.size-b.offset);var h=b.offset+b.length;f.slice?f=f.slice(b.offset,h):f.mozSlice?f=f.mozSlice(b.offset,h):f.webkitSlice&&(f=f.webkitSlice(b.offset,h))}var i=d.getUploadProxy({type:"native",file:b,options:"header"},c);e.open(a.Ajax.POST,i,!0),b.options&&r.each(b.options,function(a,b){e.setRequestHeader(a,b)}),e.setRequestHeader("Content-Type","application/octet-stream"),e.send(f)}else if(e.open(a.Ajax.POST,d.getUploadUrl({type:"native"}),!0),"undefined"!=typeof FormData)try{var j=new FormData;j.append("Filedata",b.blob,b.blob.name),e.send(j)}catch(k){}else if(b.blob.getAsBinary){var l=encodeURIComponent(b.name);l=l.replace(new RegExp("%(\\w{2})","ig"),function(a,b){return String.fromCharCode(parseInt(b,16))});var m="------neteasemailnativeupload"+(new Date).getTime(),n="--",p="\r\n",q=[];q.push(n,m,p),q.push('Content-Disposition: form-data; name="Filedata"; filename="',l,'"',p),q.push("Content-Type: application/octet-stream",p,p),q.push(b.blob.getAsBinary(),p),q.push(n,m,n,p),e.setRequestHeader("Content-Type","multipart/form-data; boundary="+m);try{var s=q.join("");e.sendAsBinary(s)}catch(k){}}}function k(a,b){var c=this;c.nativeCheck(a,b)}function l(a){var b=this;if("success"!=a.state&&"wait"!=a.state){var c=b.get({element:"nativeRequest"});try{a.abort=!0,c.abort()}catch(d){}}}function m(a){var b=this;a.blob&&(a.blob=null),b.fileBreak(a)}function n(b){var c=this;a.Browser.firefox()&&c.set({element:"nativeRequest",value:null}),a.Browser.chrome()&&b.retry>0&&c.set({element:"nativeRequest",value:null});var d=c.get({element:"nativeRequest"});if(!d){try{d=new XMLHttpRequest}catch(e){}d&&c.set({element:"nativeRequest",value:d})}return d}try{var o=$L("module.compose.ComposeAttach")}catch(p){return p}var q=a.createClass($N("module.compose.ComposeNative")),r=a.Object,s=a.Browser,t=a.S_OK;r.inherit(q,o),r.extend(q.prototype,{initialize:b,init:c,initProcess:d,initInput:e,createInput:f,nativeClick:g,nativeSelect:h,nativeCheck:i,fileUpload:j,fileRetry:k,fileBreak:l,fileRemove:m,nativeGet:n})}($,window),function(a){function b(a){var b=this;q.superClass.initialize.call(b,a)}function c(){var a=this;q.superClass.init.call(a)}function d(){var a=this;q.superClass.initProcess.call(a,"plugin"),a.initEvent()}function e(){var b=this,c=b.data,d=b.sourceGet("element");d.link.listen("click",function(c){b.pluginBrowse({type:"file",title:p.t("选择要上传的文件"),call:function(a){a.length&&b.pluginSelect(a)}}),a.Event.cancel(c)}),c.set({status:"uploadMode",value:"plugin"})}function f(a){var b=this,c=b.assist.create("desktop");if(c){var d={};switch(d.singleFile=a.single?!0:!1,a.title&&(d.title=a.title),a.type){case"file":d.filter2=n.filter;break;case"image":d.filter2=n.filterImage}c.openFiles(function(c){var d=a.call,e=r.toArray(c);"function"==typeof d&&b.base.addTimer("pluginBrowse",function(){d(e)},0)},d)}}function g(b,c){var d=this,e=[];a.Array.each(b,function(a,b){var f=0;try{f=b.blob.length}catch(g){}var h="";try{h=b.path}catch(g){}var i=d.fileCreate({type:"plugin",name:b.name,path:h,size:f,cloud:c});i.blob=b.blob,b.inlined&&(i.inlined=i.context=!0),e.push(i)}),d.filterCheck({files:e,submit:function(b){a.Array.each(b.select,function(a,b){b["delete"]=function(){d.fileRemove(b),b["delete"]=null},d.add(b)}),d.fileAutoUpload()},cancel:function(){}})}function h(a){var b=this,c=b.assist.create("digest");c&&(b.setState(a,"hash"),a.digest=c.CalculateMD5WithProgress(a.blob,function(c){a.digest&&(a.digest=null,c=c||"-1",b.setHash(a,a.size,c))},function(c){a.digest&&b.setHash(a,c)}))}function i(b,c){var d=this;if(d.getCheck(b)){var e=d.assist.requestGet();if(!e)return;if(!b.path)return d.error(b,"JS_PLUGIN"),void 0;e.onreadystatechange=function(){4==e.readyState&&(e.onreadystatechange=null,200==e.status?d.check(b,e.responseText)&&(d.fileUpload(b),d.netCheckSet(b)):d.error(b,"JS_HTTP",e.status,"check")?d.pluginCheck(b,{code:"JS_HTTP",reason:e.status}):d.resum(b))};var f=d.getUploadProxy({type:"plugin",file:b,options:"body",check:!0},c);e.open(a.Ajax.POST,f,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(b.options)}else d.fileUpload(b),d.netCheckSet(b)}function j(b,c){var d=this,e=d.assist.requestGet();if(e)if(e.upload.onprogress=function(a){a.lengthComputable&&d.setBytes(b,a.loaded,a.total)},e.onreadystatechange=function(){switch(e.readyState){case 1:d.setStart(b);break;case 2:b.path;break;case 4:if(e.onreadystatechange=e.upload.onprogress=null,d.netCheckClear(),b.blob)if(200==e.status){var a=d.complete(b,e.responseText);a.code==s?a["continue"]&&(d.fileUpload(b),d.netCheckSet(b)):a.retry?d.fileRetry(b,{code:a.code}):d.resum(b)}else d.error(b,"JS_HTTP",e.status)?d.fileRetry(b,{code:"JS_HTTP",reason:e.status}):d.resum(b)}},d.getUploadHost()&&b.path){var f=b.blob;b.useSplit=!0,b.length=n.sliceLength,b.offset+b.length>b.size&&(b.length=b.size-b.offset),f=f.slice(b.offset,b.length);var g=d.getUploadProxy({type:"plugin",file:b,options:"header"},c);e.open(a.Ajax.POST,g,!0),b.options&&r.each(b.options,function(a,b){e.setRequestHeader(a,b)}),e.setRequestHeader("Content-Type","application/octet-stream"),e.send(f)}else{e.open(a.Ajax.POST,d.getUploadUrl({type:"plugin"}),!0);var h="------neteasemailpluginupload"+(new Date).getTime(),i="--",j="\r\n",k=[];k.push(i,h,j),k.push('Content-Disposition: form-data; name="Filedata"; filename="',b.name,'"',j),k.push("Content-Type: application/octet-stream",j,j),k.push(b.blob),k.push(j),k.push(i,h,i,j),e.setRequestHeader("Content-Type","multipart/form-data; boundary="+h),e.setRequestHeader("Cookie","Coremail="+a.Cookie.get("Coremail",!0));try{var f=d.assist.create("blob");f&&(f.append(k),e.send(f.getAsBlob()))}catch(l){}}}function k(a,b){var c=this;c.pluginCheck(a,b)}function l(a){var b=this;if("success"!=a.state&&"wait"!=a.state){var c=b.assist.requestGet();try{c.abort()}catch(d){}}}function m(a){var b=this;if(a.blob&&(a.blob=null),a.digest){try{a.digest.abort()}catch(c){}a.digest=null}b.fileBreak(a)}try{var n=$L("module.compose.ComposeAttach")}catch(o){return o}var p=new $I18N("module.compose.ComposePlugin"),q=a.createClass($N("module.compose.ComposePlugin")),r=a.Object,s=a.S_OK;r.inherit(q,n),r.extend(q.prototype,{initialize:b,init:c,initProcess:d,initEvent:e,pluginBrowse:f,pluginSelect:g,pluginHash:h,pluginCheck:i,fileUpload:j,fileRetry:k,fileBreak:l,fileRemove:m})}($,window),function(a){function b(a){var b=this;p.superClass.initialize.call(b,a)}function c(){var a=this;p.superClass.init.call(a)}function d(){var a=this;p.superClass.initProcess.call(a,"post"),a.initForm()}function e(){var a=this,b=a.data;a.postCreate(),a.postAdd(),a.postSwitch({enable:!0}),b.set({status:"uploadMode",value:"post"})}function f(){var b=this,c=b.module,d=b.sourceGet("element"),e=c.createId("attachUpload"),f=a.Element.create("FORM");f.setClass("by0"),f.dom.method="POST",f.dom.target=e,d.operate.append(f.dom),d.formContainer=f}function g(a){var b=this,c=b.sourceGet("element");if("boolean"==typeof a.enable){var d=c.formContainer;a.enable?d.show():d.hide()}}function h(){var b=this,c=b.data,d=c.get({status:"uploadParam"});if(d&&"form"==d.action)try{var e=b.module,f=e.createId("attachUpload");a.fly("#"+f).attr({src:"about:blank"})}catch(g){}}function i(){var a=this,b=a.base,c=a.data,d=a.sourceGet("element"),e=a.getUploadUrl({type:"form"}),f=b.getCallName(function(){a.postResult.apply(a,arguments)},!0);e+="&call=window.parent."+f,d.formContainer.attr({action:e,encoding:"multipart/form-data",enctype:"multipart/form-data"}),c.set({status:"uploadParam",value:{action:"form"}}),d.formContainer.dom.submit(),b.tips(o.t("正在上传附件...")),a.setLock({type:"form",state:"wait"},!0)}function j(b){var c=this,d=c.base,e=c.data,f={type:"form",state:"wait"};if(e.set({status:"uploadParam",value:null}),c.setLock(f,!1),b.code==r){var g=c.fileGet(f),h=q.toArray(b.composeAttach);h=h.slice(h.length-g.length),a.Array.each(g,function(b,d){a.Array.each(h,function(b,c){return!c||c.name!=d.name&&c.name!=d.path?void 0:(d.sid=c.id,d.size=d.bytesLoaded=c.size,h[b]=null,a.BREAK)}),c.setState(d,"success")}),d.runSequence("postResult")}else c.error(null,b.code,b.overflowReason);d.tips("")}function k(){var b=this,c=b.sourceGet("element"),d=a.Element.create("input"),e=b.get({status:"inputIndex"});d.setClass("O0"),d.attr({type:"file",size:"1",name:"file"+e++}),b.set({status:"inputIndex",value:e}),d.listen("keydown",function(b){a.Event.cancel(b)});var f=!1,g=function(){f!==!0&&(f=!0,b.postSelect(d)||d.remove(),b.postAdd())};d.one("change",g),d.one("propertychange",g),c.formContainer.append(d.dom)}function l(b){var c=this;c.element;var d=b.dom.value;if(!d)return!1;var e=c.fileCreate({type:"form",path:d});return e.extLimit?(a.Msgbox.show({title:o.t("您所选择的附件：")+'<span style="color:#f00">'+e.name+"</span>"+o.t(" ，出于安全考虑，请勿添加该类附件！")}),!1):e.pathExist?(a.Msgbox.show({title:o.t("您已选择了此附件，请勿重复添加相同附件！")}),!1):(b.css({zIndex:-1}),e["delete"]=function(){b.remove(),e["delete"]=null},c.add(e),!0)}try{var m=$L("module.compose.ComposeAttach")}catch(n){return n}var o=new $I18N("module.compose.ComposePost"),p=a.createClass($N("module.compose.ComposePost")),q=a.Object,r=a.S_OK;q.inherit(p,m),q.extend(p.prototype,{initialize:b,init:c,initProcess:d,initForm:e,postCreate:f,postSwitch:g,postStop:h,postUpload:i,postResult:j,postAdd:k,postSelect:l})}($,window),function(a){function b(){if(a.Ext.composeAt){var b=this.module;try{b.at.initComplete()}catch(c){}}}function c(a){var b=this.module,c=b.base;try{c.fireOption(a)}catch(d){}}function d(){var a=this.module,b=a.data,c=a.sign;try{b.set({status:"initSign",value:!1}),c.load()}catch(d){}}function e(a){var b=this.module,c=b.info,d=b.attach;if(a&&a.body){var e=a.body,f=e.action;if("loggedin"==f||"downloaded"==f)d.mobileMsg(e);else if("upload"==f){var g=e.cid,h=c.get({cid:!0});g==h&&d.mobileMsg(e)}}}new $I18N("module.compose.ComposeListener");var f=$I("module.BaseListener"),g=a.createClass($N("module.compose.ComposeListener"));a.Object.inherit(g,f,{_listeners:{"options:composeModify":{handler:c},"options:personalModify":{handler:c},"options:signModify":{handler:d},"compose:imageUpload":{handler:e},"addr:dataInit":{handler:b},"addr:dataReset":{handler:b}}})}($,window),function(a){function b(){var b=this;b["class"]=W,b.module=b;var c=W.getAttachClass();R.attach=$L(c),a.Array.each(b.names,function(a,c){try{b[c]=new R[c](b)}catch(d){}})}function c(){var b=this;a.Array.each(b.names,function(a,c){try{b[c].init()}catch(d){}}),b.base.start(),b.initData(),$S("isVip")&&(b.vipCheck(),b.vipSmsCheck()),a.Log.cache({cl_compose:1},a.EMPTYFUNC)}function d(){var a=this,b=a.action,c=a.base,d=a.data,e=a.info,f=a.at,g=a._var,h=g.extend||{},i=d.get({status:"fromEntry"}),j=h.param||{},k="",l=null;j.id&&(k=j.id),"string"!=typeof k&&(l=k,k="");var m=h.info||{};j.info&&(m=j.info);var n=h.body||{};j.body&&(n=j.body),("reply"==i||"forward"==i)&&(n.attrs||(n.attrs={}),n.attrs.account||(n.attrs.account=P.getDefault().toString()));var o={action:i};switch(d.set({status:"paramBody",value:n}),i){case"draft":e.set({did:k}),n.id=k;var p=null;j.time&&(p=new Date(j.time)),j.date&&(p=j.date),p&&d.set({status:"fromEntry",value:"timeset"}),b.restoreDraft({body:n,callback:function(a){var b=a["var"];p&&(b.scheduleDate=p),e.set({obj:b}),d.set({status:"existActiveDraft",value:!0}),c.fillContent(),c.focus(),b.ctrls&&b.ctrls.at&&f.addEmail(b.ctrls.at)}});break;case"edit":e.set({mid:k}),n.id=k,b.editMessage({body:n,callback:function(a){var b=a["var"];e.set({obj:b}),c.fillContent(),c.focus(),b.ctrls&&b.ctrls.at&&f.addEmail(b.ctrls.at)}});break;case"reply":e.set({mid:k}),c.fillContent(n.attrs,!0),n.id=k,n.toAll&&(o.action="replyall"),n.withAttachments&&(o.action="replyallattach",n.supportTNEF=!0),b.replyMessage({body:n,log:o,callback:function(a){e.set({obj:a["var"]}),c.fillContent(),c.focus(),j.lang&&"west"==j.lang&&c.trans({action:"replyTrans"})}});break;case"forward":l?e.set({ids:l}):e.set({mid:k}),c.fillContent(n.attrs,!0),l?(n.mode="attach",n.ids=l,n.attrs.isHtml=!0):(n.ids=[k],n.supportTNEF=!0),b.forwardMessages({body:n,log:o,callback:function(a){e.set({obj:a["var"]}),c.fillContent(),c.focus()}});break;default:e.set({cid:e.getClientId()});var m=h.info||{};if(j.info&&(m=j.info),c.fillContent(m),m.stationeryId){var q=a.stationery;q.preLoad(function(){q.select({id:m.stationeryId})})}}}function e(a){var b=this,c=b.data,d=b._var,e=b.extend=d.extend||{},f="compose";e.type&&(f=e.type),c.set({status:"fromEntry",value:f}),a()}function f(){var a=this,b=a._var,c=b.param,d=c.type+c.cid;return d}function g(a){var b=this;return b.fTextCall=a,b.stext||b.setText("",!0)}function h(a,b){var c=this,d=c.data;if(c.fTextCall){if(a);else{var e="";try{e=d.get({status:"fromEntry"})}catch(f){}switch(e){case"draft":a=Q.t("草稿");break;case"reply":a=Q.t("回复");break;case"forward":a=Q.t("转发");break;default:a=Q.t("写信")}}return b?(a!=Q.t("写信")&&(a+=Q.t("加载中")),a):(c.stext=a,c.fTextCall(a),void 0)}}function i(){}function j(){var a=this,b=a.attach,c=a.base,d=a.data,e=!1;try{b.get({cloud:!0})||"compose"==d.get({status:"curPage"})&&(e=c.empty())}catch(f){}return e}function k(b,c,d){var e=this,f=e.data,g=e.success;if(e.destroyFinish)return!0;var h=e.base,i=f.get({status:"showScheduleInvitation"});if(!h)return!0;if(e.empty())return h.clearTimer("keep"),h.clearTimer("save"),!0;var f=e.data,j=e.attach;if("destroy"==f.get({status:"curPage"}))return!0;if(f.get({status:"confirmExit"})){var k=function(){if(f.attachments.files){var b=f.attachments.files,d=[],e=0;for(var g in b)b[g].cloud&&b[g].ret&&(b[g].ret.fid&&d.push(b[g].ret.fid),e+=b[g].size);if(d.length){var h;h=1===d.length?d[0]:d.join(","),a.Ajax.jsonp(V.getUrl("compose_batch_delete_url")+"&op=batchDelete&fileIds="+h,function(){var a=$S("cloud"),b=a.spaceUsed;b-e>=0&&(a.spaceUsed=b-e,$S("cloud",a))})}}f.set({status:"confirmExit",value:!1}),c()},l=function(){a.Msgbox.msgbox&&a.Msgbox.msgbox.close()};if("success"!=f.get({status:"curPage"})){if(f.get({status:"uploadParam"})||j.fileIsUpload()){if(f.attachments.files){var m=f.attachments.files,n=[],o=0;for(var p in m)m[p].cloud&&(m[p].ret.fid&&n.push(m[p].ret.fid),o+=m[p].size);if(n.length){var q;q=1===n.length?n[0]:n.join(","),a.Ajax.jsonp(V.getUrl("compose_batch_delete_url")+"&op=batchDelete&fileIds="+q,function(){var a=$S("cloud"),b=a.spaceUsed;b-o>=0&&(a.spaceUsed=b-o,$S("cloud",a))})}}return b?a.Msgbox.show({type:"confirm",title:Q.t("附件正在上传，确定中断和放弃对此信件所作的操作?"),ok:k}):l(),!1}if(h.changeCheck()||i){if(b){var r=i?"vW0":"",s=i?'<div style="color:#999;">'+Q.t("提示：存草稿后，日程信息暂不支持保存到草稿箱")+"</div>":"";a.Msgbox.show({extcls:r,title:Q.t("您正在写信中，是否离开写信页面？"),content:s,closeClick:function(){d&&d()},buttons:[{text:Q.t("离开并存草稿"),subclass:"mainBtn",click:function(){h.send({action:"force",call:k}),l()}},{text:Q.t("离开不存草稿"),click:function(){f.set({status:"confirmDeleteDraft",value:!1}),k(),l()}},{text:Q.t("取消"),click:function(){l(),d&&d()}}]})}else l();return!1}}}return g&&g.exit&&g.exit(),h.destroy(),a.JS.remove(e),e.destroyFinish=!0,!0}function l(){var a=this,b=T.getInfo();switch(b.os){case"ipad":case"ipod":case"iphone":case"android":break;default:a.base.layoutAdjust({attach:!0,timer:!0})}}function m(){$S("isVip")&&this.vipCheck()}function n(){var a=this;a.data}function o(){}function p(){var a=this,b=a.base,c=a.data;try{c.get({status:"confirmExit"})&&(c.get({status:"sendParam"})||c.get({status:"uploadParam"})||a.attach.fileIsUpload()||!b.changeCheck()||b.send({action:"auto"}))}catch(d){}}function q(){var a=this,b=a.data,c=b.layout;$S("clientHeight")||$S("clientHeight",document.documentElement.clientHeight),c.baseHeight=$S("clientHeight"),c.baseTop=86,c.topToolbar=62,c.bottomToolbar=82,c.baseCenter=122,b.get({status:"fullScrren"})&&(c.baseTop=c.baseCenter=0),c.editorHeight=c.baseHeight-(c.baseTop+c.topToolbar+c.baseCenter+c.bottomToolbar)+2;var d=b.get({element:"ext"}),e=0;d&&(e=d.dom.offsetHeight||0),c.editorHeight-=e,c.editorMin=300,c.editorHeight=Math.max(c.editorHeight,c.editorMin),c.containerCls=a.getModuleClass()}function r(){$S("clientWidth")||$S("clientWidth",document.documentElement.clientWidth);var a="tW0",b=$S("clientWidth");return 1680>=b||(a+=1920>=b?" CW0":2560>=b?" CV0":" CB0"),a}function s(){function b(){if(W.isValid)return!1;var b=a.Context.module;b&&b.mtype&&"compose.ComposeModule"==b.mtype?a.JS.back():a.JS.go({module:"welcome.WelcomeModule"})}if(W.isValid)return!0;var c=!1,d=$S("attrs").subcos,e=d.split(",");if($S("isvip")?a.Array.has(e,"192")&&(c=!0):$S("is188")?a.Array.has(e,"230")&&(c=!0):$S("is126vip")&&a.Array.has(e,"101")&&(c=!0),c){var f=V.getUrl("compose_vip_valid");return a.Msgbox.show({header:Q.t("发信激活"),contentType:"custom",noFooter:!0,content:'<iframe id="composeSucSmsIframe" src="'+f+'" style="display:block;width:100%;height:200px" scrolling="no" frameborder="0"></iframe>',close:b}),!1}return!0}function t(){W.isValid=!0;var b="http://"+$S("host")+"/js6/compose/reload.jsp?sid="+$S("sid");a.Ajax.request({requestType:a.Ajax.IFRAME,rnd:!0,url:b}),a.Msgbox.msgbox&&a.Msgbox.msgbox.close()}function u(){if(!W.sms_bind){W.sms_bind=-1;var b=V.getUrl("compose_vip_sms_bind2",!0);a.Ajax.jsonp(b,function(a){a&&200==a.code&&(W.sms_bind=2)})}}function v(){var b=a.Browser,c="module.compose.";if("3"!=U.get({field:"ntes_compose",flag:"upload_mode"})){var d=b.getVersion()||[0,0],e=b.getInfo(),f=!0;if(f&&R.assist.hasNewVersion())return c+"ComposePlugin";var g=!1,h=e.shell;if(h)d[0]>=24&&(g=!0);else if(b.chrome())d[0]>=20&&(g=!0);else if(b.firefox())d[0]>=4&&(g=!0);else if(b.opera())d[0]>=15&&(g=!0);else if(b.safari())(5==d[0]&&d[1]>=1||d[0]>=6)&&(g=!0);else if(b.edge())g=!0;else if(b.ie()&&d[0]>=10)try{(new Blob).slice&&(g=!0)}catch(i){}if(g)return c+"ComposeNative"}return c+"ComposePost"}function w(){var b=this,c=b.data;c.set({status:"empty",value:!1});var d=a.getClass($N("interface.ComposeInterface"));d.entry({type:"compose",param:{info:{subject:Q.t("祝您新春快乐！"),stationeryId:196}}})}try{var x=$L("interface.ComposeInterface")}catch(y){return y}try{var z=$L("module.BaseModule")}catch(y){return y}try{$L("module.compose.ComposeAttach")}catch(y){return y}try{$L("module.compose.ComposePlugin")}catch(y){return y}try{$L("module.compose.ComposeNative")}catch(y){return y}try{$L("module.compose.ComposePost")}catch(y){return y}try{var A=$L("module.compose.Compose")}catch(y){return y}try{var B=$L("module.compose.ComposeListener")}catch(y){return y}try{var C=$L("module.compose.ComposeAction")}catch(y){return y}try{var D=$L("module.compose.ComposeAssist")}catch(y){return y}try{var E=$L("module.compose.ComposeBase")}catch(y){return y}try{var F=$L("module.compose.ComposeData")}catch(y){return y}try{var G=$L("module.compose.ComposeEditor")}catch(y){return y}try{var H=$L("module.compose.ComposeEvent")}catch(y){return y}try{var I=$L("module.compose.ComposeForm")}catch(y){return y}try{var J=$L("module.compose.ComposeInfo")}catch(y){return y}try{var K=$L("module.compose.ComposeView")}catch(y){return y}try{var L=$L("module.compose.ComposeSign")}catch(y){return y}try{var M=$L("module.compose.ComposeSuccess")}catch(y){return y}try{var N=$L("module.compose.ComposeAt")}catch(y){return y}try{var O=$L("module.compose.ComposeStationery")}catch(y){return y}try{var P=$L("init.SenderList")}catch(y){return y}var Q=new $I18N("module.compose.ComposeModule"),R={};R.action=C,R.assist=D,R.base=E,R.data=F,R.editor=G,R.event=H,R.form=I,R.info=J,R.view=K,R.sign=L,R.success=M,R.at=N,R.stationery=O;var S=a.Object,T=a.Browser,U=a.Ud,V=a.Uri,W=a.createClass($N("module.compose.ComposeModule"));
S.mix(W,z,{"interface":x},{}),S.extend(W.prototype,A.prototype);var X={_visibilableTime:0,_isJD1111Show:!0,initialize:b,init:c,initData:d,getData:e,getGroup:f,getText:g,setText:h,reset:i,empty:j,exit:k,resize:l,cache:m,onBeforeDisappear:n,switchIn:o,switchOut:p,layoutInit:q,getModuleClass:r,vipSmsCheck:u,vipCheck:s,vipCheckSuc:t,newYearLetter:w};S.extend(W.prototype,X),S.extend(W,{cls:"tW0",ariaLabel:Q.t("写信"),View:R.view,Listener:B,getAttachClass:v})}($,window),function(a){function b(){}function c(){var a,b=this,c=b.module,d="tL0";a=b.getHeader()+b.getPersonal();var e='<div id="'+c.createId("address")+'"  class="'+d+'">'+a+"</div>";return e}function d(){var b=this,c=b.module,d="";try{var e=new a.Input({placeholder:i.t("查找联系人"),iconBtn:"search",iconbtnclick:function(){c.searchCancel()},listeners:{keyup:{handler:function(){c.searchMatch()}}}}),f=new a.Link({title:i.t("快速添加联系人"),text:'<b class="nui-ico nui-ico-add2"></b>',cls:"qP0",click:function(){c.addFast(),a.Log.cache({cl_add:"1"},a.EMPTYFUNC)}});c.set({component:"searchInput",value:e}),c.set({component:"searchLink",value:f}),d=e.html()+f.html()}catch(g){}var h="",j='<header class="frame-main-cont-head">'+h+d+"</header>";return j}function e(){var b=this,c=b.module,d=a.Uri.getUrl("compose_corp_address"),e='<div id="'+c.createId("corp")+'" class="frame-main-cont-body" style="overflow:hidden">'+'<iframe id="'+c.createId("corpIframe")+'" style="width:100%;height:100%" src="'+d+'" frameborder="0" allowTransparency="true"></iframe>'+"</div>";return e}function f(){var a=this,b=a.module,c="",d='<div id="'+b.createId("personal")+'" class="frame-main-cont-body nui-scroll" '+c+">"+'<section class="tC0">'+'<div id="'+b.createId("search")+'" class="pX0"></div>'+'<div id="'+b.createId("list")+'"class="nui-simpleTree nui-tree rs0"></div>'+"</section>"+"</div>";return d}try{var g=$L("module.BaseView")}catch(h){return h}var i=new $I18N("module.address.AddressView"),j=a.Object,k=a.createClass($N("module.address.AddressView"));j.mix(k,g,{},{initialize:b,getHtml:c,getHeader:d,getCorp:e,getPersonal:f,todo:function(){}})}($,window),function(a){function b(){var a=this.module;try{a.refresh()}catch(b){}}try{var c=$L("module.BaseListener")}catch(d){return d}new $I18N("module.address.AddressListener");var e=a.createClass($N("module.address.AddressListener"));a.Object.inherit(e,c,{_listeners:{"addr:dataInit":{handler:b},"addr:dataReset":{handler:b}}})}($,window),function(a,b,c){function d(a){var a=this;N.extend(a,{status:{},element:{},component:{}}),S.superClass.initialize.call(a,a)}function e(a){a&&a()}function f(){var b=this;b.element,b.set({element:"list",value:a("#"+b.createId("list"))}),b.set({element:"search",value:a("#"+b.createId("search"))}),b.render("list"),b.set({status:"show",value:"list"})}function g(){var a=this;a.element}function h(){var a=this;a.render("list")}function i(a){var b=this,c=a.value;"string"==typeof a.status?b.status[a.status]=c:"string"==typeof a.element?b.element[a.element]=c:"string"==typeof a.component&&(b.component[a.component]=c)}function j(a){var b=this;return"string"==typeof a.status?b.status[a.status]:"string"==typeof a.element?b.element[a.element]:"string"==typeof a.component?b.component[a.component]:void 0}function k(b){var c=this,d={};if(d.group=[],"list"==b){var e=[],f={type:"spec",item:e},g=c.adCompose();g.length&&e.push.apply(e,g),e.push({type:"me",name:M.t("给自己写一封信"),email:new O(H.getAccount().address,M.t("我"))}),d.group.push(f)}var h=F.data.extDataMap.groupArray||[],i=[];try{i=h[0].CONTACTS}catch(j){}var k={type:"all",name:i.length?M.t("所有"):M.t("所有联系人"),nameTitle:M.t("所有联系人"),sumTitle:M.t("添加所有联系人"),item:[]},l={};a.Array.each(i,function(a,b){var d=c.filterItem(b);d&&(k.item.push(d),l[d.id]=k.item.length-1)}),k.item.length>500&&(k.fold=!0),a.Array.each(h,function(b,e){if(0===b)return a.CONTINUE;var f=c.filterGroup(e,l,k.item);f&&(f.fold=!0,f.sumTitle=M.t("添加该组联系人"),d.group.push(f))}),d.group[d.group.length-1].hasLine=!0,d.group.push(k);var m=c.get({element:"list"});m.empty(),m.append(c.renderTree(d).dom),c.renderMark(l,k.item),F.getRecentContact({call:a.Function.bind(c.renderCommon,c)})}function l(d){function e(b){var c=a.Event.getTarget(b);if("B"==c.tagName.toUpperCase()){var d=c.getAttribute("companyId");if(null!==d)return{companyId:d};c=c.parentNode.parentNode}if("A"==c.tagName.toUpperCase()&&(c=c.parentNode),"LI"==c.tagName.toUpperCase()){var e=c.getAttribute("data-id"),f=c.getAttribute("data-sub");if(null!==e){var g=parseInt(e,10),h={index:g};if(null!==f){var i=parseInt(f,10);h.sub=i}return h}}}var f=this;if(d.item){var g=a.Element.create("UL");if(g.addClass("nui-tree"),"spec"==d.type)a.Array.each(d.item,function(a,b){g.append(f.renderItem(b).dom)}),d.element.append(g.dom);else{for(var h=d.item.length,i=[],j=0;h>j;j++){var k=d.item[j],l="";if(k.email){l=k.email.defaultName;var m="";k.type&&"vip"==k.type&&(m='<b class="nui-ico nui-ico-user nui-ico-user-vip"></b>');var n='<li data-id="'+j+'"><a href="javascript:void(0)" class="pW0">'+m+a.String.encodeHTML(l);k.yellowPage&&(n+='<b companyId="'+k.yellowPage+'" class="nui-ico nui-ico-yellowpage"></b>'),n+="</a></li>",i.push(n)}else if(k.emails)for(var o=0;o<k.emails.length;o++){var m="",p=k.emails[o],q=new O(p,k.name);l=q.defaultName,p&&O.checkVip(p)&&(m='<b class="nui-ico nui-ico-user nui-ico-user-vip"></b>');var n='<li data-id="'+j+'" data-sub="'+o+'"><a href="javascript:void(0)" class="pW0">'+m+a.String.encodeHTML(l);k.yellowPage&&(n+='<b companyId="'+k.yellowPage+'" class="nui-ico nui-ico-yellowpage"></b>'),n+="</a></li>",i.push(n)}}if(g.dom.innerHTML=i.join(""),g.listen("click",function(g){var h=e(g);if(h!==c)if(h.companyId){var i="http://114.163.com/company/"+h.companyId;b.open(i),P.cache({cl_yellowpage:"1"},a.EMPTYFUNC)}else{var j=h.index,k=d.item[j];if(h.sub!==c){var l=k.emails[h.sub],m=new O(l,k.name),n={email:m};f.addItem(n)}else f.addItem(k);P.cache({cl_item:"1"},a.EMPTYFUNC)}}),"common"!=d.type)try{g.listen("contextmenu",function(a){var b=e(a);if(b!==c&&b.index>=0){var g,h=b.index,i=d.item[h];b.sub!==c&&(g=i.emails[b.sub]);var j={groups:[{items:[{text:M.t("编辑"),click:function(){F.contactDialog({type:"modify",addr:{id:i.id,email:g},callback:function(){f.refresh()}})}},{text:M.t("删除"),click:function(){g?F.deleteContactAttr({id:i.id,type:"email",value:g,call:function(){f.refresh()}}):F.deleteContact({contacts:[i.id],call:function(){f.refresh()}})}}]}],width:"120px"};L.show(j)}})}catch(r){}d.element.append(g.dom);for(var s=g.dom.getElementsByTagName("LI"),t=s.length,j=0;t>j;j++){var u=s[j],v=u.getAttribute("data-id"),w=u.getAttribute("data-sub"),x="";try{if(null!==v){var y=parseInt(v,10),k=d.item[y];if(null!==w){var z=parseInt(w,10);x=k.emails[z]}else x=k.email.address}}catch(r){}u.title=x}}d.element.set("fill",!0)}}function m(b,c,d){var e=this,f=null;if(b.N){var g=b.CONTACTS;if(g.length){var h=[];a.Array.each(g,function(a,b){var f=e.filterItem(b,c,d);f&&h.push(f)}),h.length&&(f={id:b.id,name:b.N,item:h})}}return f}function n(a,b,c){var d=null;if(b)d=c[b[a[R]]];else{var e=null,f=a[R];if(f){var g=F.data.extDataMap.contactLite[f];if(g&&g.email&&g.email.length){var h=g.email;d={id:a[R],yellowPage:g.yellowPage},1==h.length?(d.email=new O(h[0],g.name),e=h[0]):h.length>1&&(d.emails=h,d.name=g.name)}}else e=a[Q],d={email:new O(e)};e&&d&&O.checkVip(e)&&(d.type="vip")}return d}function o(b){var c=this,d=a.Element.create("DIV");return b.group&&a.Array.each(b.group,function(b,e){if(d.append(c.renderGroup(e).dom),e.hasLine){var f=a.Element.create("DIV");f.setClass("nui-split nui-split-dotted"),d.append(f.dom)}}),d}function p(b){var c=this,d=b.element=a.Element.create("DIV");if(d.addClass("nui-tree-item"),"spec"==b.type)d.addClass("nui-tree-item-spec");else{var e=a.Element.create("SPAN");if(e.addClass("nui-tree-item-label"),b.name){d.set("foldText",M.t("折叠")),d.set("unfoldText",M.t("展开"));var f=a.Element.create("A");f.addClass("g-contacts-groups-name"),f.attr({href:"javascript:void(0)"});var g=a.Element.create("SPAN");g.addClass("nui-tree-item-symbol"),e.listen("click",function(){var a=!d.get("fold"),e=d.get(a?"unfoldText":"foldText"),g="nui-tree-item nui-tree-item-isFold",h="nui-tree-item nui-tree-item-isUnfold";a?d.setClass(g):(d.get("fill")!==!0&&c.fillGroup(b),d.setClass(h)),f.attr({title:e}),d.set("fold",a)}),e.append(g.dom),new a.Icon({type:"rArr",title:M.t("展开"),extcls:"nui-tree-item-symbol-fold",renderTo:g.dom}),new a.Icon({type:"dArr",title:M.t("折叠"),extcls:"nui-tree-item-symbol-unfold",renderTo:g.dom});var h=b.name.substr(0,7);h!=b.name&&(h+=".."),h=a.String.encodeHTML(h),h+="("+b.item.length+")";var i=a.Element.create("span");i.attr({title:b.nameTitle||b.name}),i.setClass("nui-tree-item-text"),i.html(h),e.append(i.dom)}if(b.item){var j=null,k="nui-tree-item-label-hover";e.listen("mouseover",function(){e.addClass(k),j?j.show():(j=a.Element.create("A"),j.addClass("nui-tree-item-ext nui-txt-link"),j.attr({href:"javascript:void(0)"}),j.html(M.t("添加该组")),j.listen("click",function(d){c.addGroup(b),a.Event.stop(d)}),e.append(j.dom))}),e.listen("mouseout",function(){e.removeClass(k),j&&j.hide()})}d.append(e.dom)}return b.fold?(d.addClass("nui-tree-item-isFold"),d.set("fold",!0)):("spec"!=b.type&&d.addClass("nui-tree-item-isUnfold"),d.set("fold",!1),c.fillGroup(b)),d}function q(b){var c=this,d=a.Element.create("LI");d.addClass("nui-tree-item nui-tree-item-noChild");var e=a.Element.create("A");if(e.addClass("pW0"),e.attr({href:"javascript:void(0)"}),b.click?e.listen("click",b.click):e.listen("click",function(){c.addItem(b),"me"==b.type&&P.cache({cl_me:"1"},a.EMPTYFUNC)}),b.type){var f=a.Element.create("SPAN");f.addClass("nui-tree-item-icon");var g=a.Element.create("B");switch(g.addClass("nui-ico"),b.type){case"other":g.addClass("nui-ico-user nui-ico-user-other");break;case"me":g.addClass("nui-ico-user nui-ico-user-me");break;default:g.setClass(b.type)}f.append(g.dom),e.append(f.dom)}var h="",i="";return b.email&&(h=b.email.defaultName,i=b.email.toString()),b.name&&(h=b.name),h&&(i||(i=h),e.append(document.createTextNode(h))),b.title&&(i=b.title),i&&e.attr({title:i}),d.append(e.dom),d}function r(b,c){var d=this,e=F.getMarkData(!0),f=[];e&&e.contact&&e.contact.length&&a.Array.each(e.contact,function(a,b){"group"!=b.ctype&&(b[R]=b.cid,f.push(b))});var g={N:M.t("星标联系人"),CONTACTS:f},h=d.filterGroup(g,b,c);if(h){h.fold=!0,h.type="mark",h.sumTitle=M.t("添加该组联系人");var i=d.get({element:"list"}),j=a(i.dom.firstChild.firstChild);j.after(d.renderGroup(h).dom)}}function s(b){var c=this;if(!c.get({status:"commonLoad"})&&b&&b.length){var d={N:M.t("常用联系人"),CONTACTS:b},e=c.filterGroup(d);if(e){e.fold=!0,e.type="common",e.sumTitle=M.t("添加该组联系人");var f=c.get({element:"list"}),g=a(f.dom.firstChild.firstChild);g.after(c.renderGroup(e).dom),c.set({status:"commonLoad",value:!0})}}}function t(c){var d=this,e=a.Element.create("DIV");if(c.item&&c.item.length){var f=a.Element.create("DIV");f.addClass("nui-assistBlock nui-block mp0"),f.html(M.t("搜索到")+"<strong>"+c.item.length+"</strong>"+M.t("个联系人")+'&nbsp;[<a href="javascript:void(0)" class="nui-txt-link">'+M.t("全部添加")+"</a>]"),a.Event.live({context:f,selector:"A",event:"click",handler:function(){d.addGroup(c)}}),e.append(f.dom),a.Array.each(c.item,function(c,f){var g=a.Element.create("A");g.addClass("kY0"),g.attr({href:"javascript:void(0)",title:f.email.toString()}),d.live(g,"click",function(){d.addItem(f)});var h=a.Element.create("STRONG"),i=f.name||f.email.name;f.yellowPage&&(i+='<b companyId="'+f.yellowPage+'" class="nui-ico nui-ico-yellowpage"></b>'),h.html(i),f.yellowPage&&a(h.dom.lastChild).listen("click",function(c){var d=a.Event.getTarget(c),e=d.getAttribute("companyId");null!==e&&(b.open("http://114.163.com/company/"+e),P.cache({cl_yellowpage:"1"},a.EMPTYFUNC),a.Event.stop(c))});var j=a.Element.create("P");j.html(f.address||f.email.address),g.append(h.dom),g.append(j.dom),e.append(g.dom)})}else{var f=a.Element.create("DIV");f.addClass("nui-assistBlock nui-block mp0"),f.html(M.t("没有符合条件的联系人")+' [<a href="javascript:void(0)" class="back txt-link">'+M.t("返回")+"</a>]"),f.find("A").listen("click",function(b){d.searchCancel(),a.Event.cancel(b)}),e.append(f.dom)}return e}function u(b){var c=this,d=[];a.Array.each(b.item,function(a,b){if(b.emails)for(var c=b.emails,e=0;e<c.length;e++){var f=c[e],g=new O(f,b.name);d.push(g)}else d.push(b.email)}),c.addItem({email:d}),P.cache({cl_group:"1"},a.EMPTYFUNC)}function v(b){var c=a.Context.module,d=c.form;d.addContact(b.email),d.focus()}function w(){var a=this;F.contactDialog({type:"add",callback:function(){a.refresh()}})}function x(){var c=[];try{c=b.fAdAddressModuleLink()}catch(d){}return a.Array.each(c,function(a,b){b.border=!0,b.type||(b.type="other")}),c}function y(){var b=this,c=b.get({component:"searchInput"}),d=a.Event.getEvent(),e=d.keyCode;27==e&&c.setValue("");var f=a.String.trim(c.getValue());if(f){var g=c.find("icon")[0];g.update({type:"close",title:M.t("取消")}),g.getDom().setAttribute("aria-label",M.t("取消")),b.resultMatch({key:f})}else b.searchCancel();P.cache({cl_search:"1"},a.EMPTYFUNC)}function z(){var b=this;if("search"==b.get({status:"show"})){var c=b.get({component:"searchInput"}),d=c.find("icon")[0];d.update({type:"search",title:M.t("立即查找")}),d.getDom().setAttribute("aria-label",M.t("立即查找")),a.String.trim(c.getValue())&&(c.setValue(""),c.showPlaceholder()),b.resultCancel()}}function A(a){a=a||{};var b,c=this,d=c.match(a);b=d.length?c.renderResult({item:d}):c.renderResult({item:null});var e=c.get({element:"search"}),f=c.get({element:"list"});e.empty(),e.append(b.dom),"search"!=c.get({status:"show"})&&(f.hide(),e.show(),c.set({status:"show",value:"search"}))}function B(){var a=this;if("search"==a.get({status:"show"})){var b=a.get({element:"search"}),c=a.get({element:"list"});b.hide(),b.empty(),c.show(),a.set({status:"show",value:"list"})}}function C(b){b=b||{};var c=b.key||"",d=[],e=new RegExp("("+c+")","i"),f='<b class="nui-txt-mark">$1</b>';return a.Object.each(F.data.extDataMap.contactLite,function(b,c){var g,h,i=!1,j=c.name,k=c.email,l=k.length,m=a.String.encodeHTML(j);if(e.test(j)?(h=m.replace(e,f),i=!0):h=m,i){for(var n=0;l>n;n++){var o={id:c[R],yellowPage:c.yellowPage,name:h};g=k[n],e.test(k[n])&&(o.address=g.replace(e,f));var p=new O(g,j);o.email=p,d.push(o)}return a.CONTINUE}for(var n=0;l>n;n++)if(g=k[n],e.test(g)){var p=new O(g,j),o={id:c[R],yellowPage:c.yellowPage,name:h,email:p,address:g.replace(e,f)};d.push(o),i=!0}return i?a.CONTINUE:void 0}),d}function D(a){var b=this,c=b.get({status:"currentTab"});if(a!=c){b.set({status:"currentTab",value:a});var d=b.get({element:"address"}),e=b.get({element:"corp"}),f=b.get({element:"personal"}),g=b.get({component:"searchInput"}),h=b.get({component:"searchLink"});"corp"==a?(e.show(),f.hide(),d.setClass("tL0 uu1"),g.hide(),h.hide()):"personal"==a&&(e.hide(),f.show(),d.setClass("tL0 oT1"),g.show(),h.show())}}function E(){}try{var F=$L("support.AddressSupport")}catch(G){return G}try{var H=$L("init.SenderList")}catch(G){return G}try{var I=$L("module.address.AddressView")}catch(G){return G}try{var J=$L("module.address.AddressListener")}catch(G){return G}try{var K=$L("module.BaseModule")}catch(G){return G}try{var L=$L("util.Contextmenu")}catch(G){return G}var M=new $I18N("module.address.AddressModule"),N=a.Object,O=a.Email,P=a.Log,Q=a.EMAIL_ADDRESS,R=a.EMAIL_ID,S=a.createClass($N("module.address.AddressModule"));N.mix(S,K,{Listener:J,View:I},{initialize:d,getData:e,init:f,clear:g,refresh:h,set:i,get:j,render:k,adCompose:x,fillGroup:l,filterGroup:m,filterItem:n,renderTree:o,renderGroup:p,renderItem:q,renderMark:r,renderCommon:s,renderResult:t,addGroup:u,addItem:v,addFast:w,searchMatch:y,searchCancel:z,resultMatch:A,resultCancel:B,match:C,switchSide:D,resize:E,todo:function(){}})}($,window);